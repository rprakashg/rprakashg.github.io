{"componentChunkName":"component---src-templates-blog-post-js","path":"/setup-prometheus-on-eb-with-docker/","result":{"data":{"site":{"siteMetadata":{"url":"https://rprakashg.github.io","title":"rprakashg.github.io"}},"markdownRemark":{"html":"<h1>Overview</h1>\n<p>In this post I will walkthrough how you can setup a monitoring stack that includes <a href=\"http://prometheus.io\">Prometheus</a> as monitoring server and <a href=\"http://grafana.com\">Grafana</a> for creating beautiful charts and monitoring dashboards and Prometheus Push Gateway so applications that prometheus server cannot reach can simply push their metrics into the gateway where Prometheus server would scrape all the metrics off of. My assumption is you are familiar with Prometheus, Grafana, Docker and Elastic Beanstalk service within AWS as I won't go too much into it, instead the key focus will be mostly on docker support within Elastic Beanstalk specifically multi container applications.</p>\n<h2>Multi Container Docker platform support in Elastic Beanstack</h2>\n<p>If your application has more than one container, Elastic beanstalk allows us to create an environment where you can run multiple containers. Elastic beanstalk is integrated with ECS and all aspects of ECS is taken care of for you including cluster creation, task definition and execution which is pretty cool if you ask me. Monitoring stack we are going to setup involves three containers</p>\n<ul>\n<li>Grafana</li>\n<li>Prometheus</li>\n<li>Push gateway (for applications to push metrics to Prometheus)</li>\n</ul>\n<p>Diagram below shows a high level architecture for our monitoring stack.\n<img src=\"/images/mon-post.jpg?raw=true\" alt=\"\"></p>\n<h3>Dockerrun.aws.json</h3>\n<p>Multi container apps on elastic beanstalk requires you to create a configuration JSON file called Dockerrun.aws.json file. This file is specific to elastic beanstalk but is very similar to docker compose file which is used for composing multi container applications. Version 1 is used when you want launch a single container and Version 2 is used for multi container apps. Since our monitoring stack involved more than 1 container we will go with version 2. Below you can see the Dockerrun.aws.json file we are going to need for provisioning this monitoring stack.</p>\n<p>We are going to define three volumes in our Dockerrun.aws.json file.</p>\n<ul>\n<li>\"prometheus-conf\" : Prometheus configuration file will be stored and read from this volume by prometheus server</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\"volumes\": [\n        {\n            \"name\": \"prometheus-conf\",\n            \"host\": {\n                \"sourcePath\": \"/var/app/current/prometheus\"\n            }\n        },\n        {\n            \"name\": \"prometheus-data\",\n            \"host\": {\n                \"sourcePath\": \"/data/prometheus\"\n            }\n        },\n        {\n            \"name\": \"prometheus-gateway-data\",\n            \"host\": {\n                \"sourcePath\": \"/data/prometheus_gateway\"\n            }\n        }\n    ]</code></pre></div>\n<h3>Testing Locally</h3>\n<p>To test this locally you simply run following command in eb cli</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">eb local run</code></pre></div>\n<p>What even cool is when you run the above command, it automatically creates a docker-compose.yml file in \".elasticbeanstalk\" directory for testing your multi container application.</p>\n<h2>Deploying the stack to elastic beanstalk</h2>\n<h3>Install elastic beanstalk CLI</h3>\n<p>Since we are going to be interacting with elastic beanstalk service, we will install the elastic beanstalk CLI first by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pip install --upgrade --user awsebcli</code></pre></div>\n<h3>Create an elastic beanstalk application</h3>\n<p>Run commands below to create an elastic beanstalk application</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir prometheus\ncd prometheus\neb init</code></pre></div>\n<h3>Create an elastic beanstalk environment</h3>\n<p>Using a pre-defined configuration create an elastic beanstalk environment by running command shown below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">eb create prometheus --cfg prometheus --profile {name}</code></pre></div>\n<h2>Summary</h2>\n<p>This is a real good option for teams that are building microservices and need a good monitoring stack for collecting metrics from these services as well as visualizing them. This approach allows teams to be self sufficient rather than be dependant on other teams that own/provide centralized monitoring solution. Obviously if your centralized monitoring solution is using Prometheus, prometheus does support scrapping metrics from other prometheus servers so you can have all the metrics in a centralized monitoring stack which will enable you to create wholistic view across the entire services topology</p>\n<p>Hope this helps,</p>\n<p>Ram Gopinathan</p>","frontmatter":{"title":"Setup prometheus on AWS using elastic beanstalk and docker","date":"June 10, 2017","tags":null,"author":"Ram Gopinathan"}}},"pageContext":{"slug":"/setup-prometheus-on-eb-with-docker/"}},"staticQueryHashes":["1611934721","2366241629"]}