{
    "componentChunkName": "component---src-templates-post-list-js",
    "path": "/2",
    "result": {"data":{"site":{"siteMetadata":{"title":"rprakashg.github.io","author":"RAM GOPINATHAN"}},"allMarkdownRemark":{"totalCount":25,"edges":[{"node":{"excerpt":"Overview I wanted to test mounting Amazon Elastic File System as persistent storage for containerized microservices running on kubernetes and realized there are lot of infrastructure pieces that mostâ€¦","html":"<h2>Overview</h2>\n<p>I wanted to test mounting Amazon Elastic File System as persistent storage for containerized microservices running on kubernetes and realized there are lot of infrastructure pieces that most developers at customers I work with don't really understand. Additionally kubernetes clusters and underlying infrastructure components are usually managed by platform/cloud infra teams and often as a developer you are at the mercy of those teams to enable and support these capabilities at the infra level. Its important for developers to understand also what's required at infra structure layer and that's exactly what this post is intended for. Also I hope this helps developers who are tasked with app modernization and containerization to test these capabilities without much road blocks and helps them have appropriate conversations and tradeoff discussions with platform/cloud teams</p>\n<p>You can find all of the content I'm covering in this post <a href=\"https://github.com/rprakashg/tf_eks_with_efs\">here</a> Github repo. I'm going to use EKS to demonstrate. What I realized as I was going through this journey like a developer would is that end to end information you need to have is scattered in multiple places and can be difficult for an enterprise developer to put all of that into perspective. I also figured I needed to have a repeatable process so I decided to just automate all aspects of infrastructure setup and configurations using Terraform.</p>\n<p>Summarizing below at a high level what you would need setup and configured at the infrastructure layer before you can use EFS as persistent storage in your containerzed applications running on Kubernetes:</p>\n<ul>\n<li>\n<ol>\n<li>Obviously you need a kubernetes cluster to run containerized application (For demonstration I'm using EKS here) and worker nodes in cluster are provisioned in private subnets and spread across multiple availability zones within a region</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>EFS csi driver installed and configured on cluster. Since I'm using EKS here this is accomplished using EKS addons</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>EFS file system provisioned. This <a href=\"https://docs.aws.amazon.com/efs/latest/ug/creating-using-create-fs.html\">doc</a> really gets into details about configuring EFS filesystem. I highly recommend reading it.</li>\n</ol>\n</li>\n</ul>\n<p>Diagram below will help visualize a regional deployment of EFS with EKS cluster.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9c4dcdff932dbb6c050435ff1a16abc/78958/eks_with_efs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEhUlEQVQ4y32O7U9adxTHz70/QLhcihRRnu7lXkBAEamAIgI+II6JD7U1alsfmuqW1a5dnQ+ggFwedivQdinWNlvbNemWpkuztbPt7Oq2NMuSZUv2Ytm7vdlfsKRv984Fa5a92ovPyTn5nvPJAae/f9w+NM9Dyx6yNHWJtNES0oXWkK43+f+EEq/pTSBtXw5RPXMC1tkpAKYXwFTaKTB8ohcKZ3HjjTDSl48h/eYQospHkaHch/SbgwcM7GeGchjpN988mAeQ/nYUr4tdFhjajiEY/VsAbVd1LR1bDTF8mZDUFygly1vEdOYYTmWacHjrDzDkehGdDSM624cMWRsOkT2gs1GczvYgKjOCTFfkiF6OiAzNpxAwzgmkj89W6XgfYS0GCEXqpawm/Yi4+hJAn1+vMm+0korU11Ll+jOSTGxjmsxngvqCQ6Zc/1yiXN+RKRIPsNpCGadiYyKDYxyBbbRLuPAzgG/L3O27zqyacqi+vkhaFTk47Llmb+jYMubNfJXdXpTZ6nik8Vzzq3xbbMlWkLU0FkgbvSGkqAJN6BfPCw2eYQRMaFoANGDWYsxkLs33wBRIqnIuLZU31rIbXG1T6UI/xGkFxO2H6/lGrZpfkdlLC4OQcdfBAitn+CN6De8n9EuzQoP7OALTSEbo3t4D0+VfutsK3/M/FEcKk3w5AHN/VrdsfNekK/6e/vSDuYsPr5y5CGf2FH2Fx2p98bdLxVzs7adXp5Ow8KtOs/5Uao13CGn3aQS0awo5430iSO6I21Y+tn6Z6i+dSGfbYOUnXcdqWQpLr2purY3P3+VGz0HsL3V47UMZLL6qLq3OTtznjsYh/iNdl7wvs8Z8QspzGkGlGJZahSruEUkuPbBA7x2XeP5eQ3XqOUUuP5OquG0Wjt9thqN3jqi4rxjJ4jeEintCw9Q9O0Ruu+Tpx0bF6kOSWWl/LaTdM4hdbhceWt+RymNfmBvHyv6axQdWcm1Xr1x6QYi5Xdo0fdNtmtpqFWd2adX7u4Qk/UJPz91y2iZuesXcNqOMPSHZFa+w4gLaOYnoWFSkzZ0TVXPXCXn6nKxmjSdrUpuEmkuKVInrUjm/QtYmzh+q9Op0SqRKlolqjiMVqQsyZfIjQpM/K6o46OZJBIxrAKnfywqpjRMCajOMt0yPiOpT/aj2kyiuKZ1B5LddGI6eY1LYwWEvALpLMwLVvTdw2+oAapkaFuluhHBqY1KgvpgXMq5BBEaHH5klbjDkAUInAbyBcYHXfwr5Omdwn/YdLDg0JujKWwY7M9aTgYkw4YY98HVP4pUdr/8kCs0AsByAmfDsu4B1BBHb3gUGKgT2hgh0Dw5gwUgUDw714cOGPHjGnOJAxugPcuZx36yr2rUDEBwJ452RKN5/ahAazBFg6BCw3s59F7COgIB1BBDrCODG5gBONXRgaosXU5vdmLl1GJMoVEiirLLIGYnlsEeFa/URTG1xYxqLFzPY/bjREcDZ11QcgooQ25cdBMbmIG46gGlsx7tHFzAAmQiAFLZ3v4uxjvZ/dyoP/Pe24voHz7E6EEnQWZgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"eks_with_efs\"\n        title=\"eks_with_efs\"\n        src=\"/static/d9c4dcdff932dbb6c050435ff1a16abc/5a190/eks_with_efs.png\"\n        srcset=\"/static/d9c4dcdff932dbb6c050435ff1a16abc/772e8/eks_with_efs.png 200w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/e17e5/eks_with_efs.png 400w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/5a190/eks_with_efs.png 800w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/c1b63/eks_with_efs.png 1200w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/78958/eks_with_efs.png 1320w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When EFS is provisioned we are creating 3 mount targets one for each AZ and use the private subnets in VPC where worker nodes are running for the elastic network interfaces (eni) that will be provisioned in our VPC. For cost and performance reasons this is recommended. Mount target provides an IP address for an NFSv4 endpoint at which you can mount an Amazon EFS file system. Additionally a security group is created to allow ingress traffic from private subnets where worker nodes in my EKS cluster are running. In addition to mount targets I'm also creating an access point to allow application access. Check out this <a href=\"https://docs.aws.amazon.com/efs/latest/ug/efs-access-points.html\">article</a> on Amazon EFS access points for more details. For more details on how EFS file system is provisioned checkout the <a href=\"https://github.com/rprakashg/tf_eks_with_efs/blob/main/deploy/eks/efs.tf\">efs.tf</a></p>\n<h2>Deploying EKS cluster with EFS csi addon and EFS filesystem</h2>\n<p>We install and configure EKS and the required and infrastructure components by running Terraform scripts. You can find the Terraform scripts <a href=\"https://github.com/rprakashg/tf_eks_with_efs\">here</a> These terraforms scripts are assembled from various examples available in terraform aws github modules.</p>\n<p>Clone this <a href=\"https://github.com/rprakashg/tf_eks_with_efs\">github repo</a> Run command below to install and configure EKS with EFS</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd tf_eks_with_efs/deploy/eks\n\nterraform init\nterraform plan\nterraform apply</code></pre></div>\n<p>When <code class=\"language-text\">terraform apply</code> command successfully completes you should see an output like the one shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ac419cc9b2c38fa485953f44a501f0b/077b7/tf_output.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUElEQVQoz4WRbW+CMBSFC+J4KRBRB1oQSOt4MY5EGBPj9P//q7Nw3cyWLPPDyUnvaZ/23rK2bXE6ndB1HXa7HZRS5OO6KApsNhvKh2FA0zRgjEHTNPI/dTgccByO6N977Pd7SClR1zUBR3iSJDifz7TnG/iv+rcel48LhuOA5rXBVm3RtR1pzMqipOx6uVItz3N6tRCCFIYhXRoEwQ2YZAkylSFVKUQmMI8WSFUGkQvIQkLkMaI4utUyge3LFmmaEnTUer0mvwPNxILxPAVzNUxmBozAALMYjMUU7IlRpns6mMMwmRuPW57FM3CPwzZtGBMD5tSEbdlwLAeu45Jzm8PjHnzug3MOy7LgOM7dx5pt29B1HUxJRb8plaT5VHVFHq1WiOOYWgqjEL7vg7v8F8g0TYK5rvsDqBSiKEJZlqiqiuazXC7p0Kjx0KiHrX7pEyOqxoZ4fgkbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"tf_output\"\n        title=\"tf_output\"\n        src=\"/static/3ac419cc9b2c38fa485953f44a501f0b/5a190/tf_output.png\"\n        srcset=\"/static/3ac419cc9b2c38fa485953f44a501f0b/772e8/tf_output.png 200w,\n/static/3ac419cc9b2c38fa485953f44a501f0b/e17e5/tf_output.png 400w,\n/static/3ac419cc9b2c38fa485953f44a501f0b/5a190/tf_output.png 800w,\n/static/3ac419cc9b2c38fa485953f44a501f0b/077b7/tf_output.png 1166w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can update the local kubeconfig file by running the command <code class=\"language-text\">aws eks --region us-west-2 update-kubeconfig --name \"admincluster\"</code> If you used a different region and cluster name be sure to use values that matches your environment.</p>\n<p>We can test connecting to the new cluster by running the command <code class=\"language-text\">kubectl get nodes</code></p>\n<h2>Deploy a Sample application to EKS cluster and mount EFS as persistent filesystem storage</h2>\n<p>Now that we have a k8s cluster with EFS all configured using terraform we can deploy a sample application pod and mount the newly created Amazon Elastic FileSystem storage as persistent storage</p>\n<p>Grab the <code class=\"language-text\">efsid</code> output variable value that will be printed after the <code class=\"language-text\">terraform apply</code> is successfully completed and update the <code class=\"language-text\">StorageClass</code> resource defined in <code class=\"language-text\">sc.yaml</code> file under <code class=\"language-text\">deploy/k8s</code> directory and replace the value of 'fileSystemId' parameter as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 620px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/71caf0691ae21b5cbdf0be062dbc9982/2a195/sc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACMklEQVQ4y3WTyY7UMBRF6x96AaJScTzbSZxUUqmh1SPNsEECiS0S//8XB8WVHqCbxdFzrPj6vsGrLvUcT0dSSmit0doRQo1zHmsddd1knPVP67ZNxFgjpUJK/Rerpm2w1tJvt3Spo08dh8Oevu/y3m6amKaJYRhynJkv996z2WxesRJCUJaCMFzSj3tOu4Hb/cD1rqdvIs5oorNYY5BqdiQpiiJTluUrVlopKqlw4zX+8ICut1glaZzJRKszoiyzyOzi8fDL9ZOg0ppKCHTdE6db2hjpokdWVd6Xlcjx5SGxUJZzmv91eIWf7nDbS7zV1EZSLy5ra/LPs8MPxYaL9Zp32W1JudTuWXBxaJuB+vhA3F0Rphvc9kQdAlMbaLzJZVBKMmjJrxT5Ft1Z7N+UnXNZMKSB/acf7B++c/jyk6bfcTN23E89Q/RMTSDVnntv+d0G6kq83ZRZcK6Xjol4/EzY3+P3H3Gx5fO+J0WH8BWm0VRa8H5dcLEuWL/RkBeCAhM74uksGPuJQxu5HBOuNdSjz3Ejls5uNhTFmTx/xcI8h08OQ0s8fsLvbmi6kSEl2mgYh8huiIxzys6SvKULLrONHm0lJipMUIiqZBVCQMmzYDg8EA4fCaevuOmOZjgy9mN2exgbujHQTxFfG7SSaFkhREmlBJUUyxwqxfxaKqXRsUeFlNFz1IbGW5xRSFuhvUSaKqdWLLx6es8fBcX6A5uFeT3P3To/s3ONHuNbzXhsyh8qlZKkmhPmowAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sc\"\n        title=\"sc\"\n        src=\"/static/71caf0691ae21b5cbdf0be062dbc9982/2a195/sc.png\"\n        srcset=\"/static/71caf0691ae21b5cbdf0be062dbc9982/772e8/sc.png 200w,\n/static/71caf0691ae21b5cbdf0be062dbc9982/e17e5/sc.png 400w,\n/static/71caf0691ae21b5cbdf0be062dbc9982/2a195/sc.png 620w\"\n        sizes=\"(max-width: 620px) 100vw, 620px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Create the <em><code class=\"language-text\">StorageClass</code></em> resource by running <code class=\"language-text\">kubectl apply -f deploy/k8s/sc.yaml</code> and run <code class=\"language-text\">kubectl get sc</code> to ensure storage class was successfully created. You should see an output like what's shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7b857f9f721a17ae06535d3594020f4/33c15/sc_result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVQI11XMwUrDMACA4Wia2dXUNOuSZrUtdqOS1YPi9KAMRBQvnnwDjzvspODr/4KC4OG7fmIYBmKMxPXIOq44qd9Imy9090Hi90i346DckVR7EvuJeL3g8F0gW4WrHYUpsNb+yPMc0fc9WmuapmEcI+F0RGVLQrth0d1ypJd0qzvOzrdYd0naltSbQOEK7MxijEEphRDiVwiBqqrw3rMIHuOuyebPTMsHJmaLSG/I/RPZ/JHj2QvpVcf0fvIXSCn/hd9NwE3uAbSZpgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sc_result\"\n        title=\"sc_result\"\n        src=\"/static/b7b857f9f721a17ae06535d3594020f4/5a190/sc_result.png\"\n        srcset=\"/static/b7b857f9f721a17ae06535d3594020f4/772e8/sc_result.png 200w,\n/static/b7b857f9f721a17ae06535d3594020f4/e17e5/sc_result.png 400w,\n/static/b7b857f9f721a17ae06535d3594020f4/5a190/sc_result.png 800w,\n/static/b7b857f9f721a17ae06535d3594020f4/c1b63/sc_result.png 1200w,\n/static/b7b857f9f721a17ae06535d3594020f4/33c15/sc_result.png 1463w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Create a <code class=\"language-text\">PersistentVolumeClaim</code> and an application <code class=\"language-text\">Pod</code> that mounts the EFS as persistent storage by running <code class=\"language-text\">kubectl apply -f deploy/k8s/pod.yaml</code> In the sample application I'm using an init container to create a file <code class=\"language-text\">hello.txt</code> in EFS storage that is mounted as persistent storage and in the main container I'm just simply displaying the contents of <code class=\"language-text\">hello.txt</code> file. You can see the full source for pod.yaml <a href=\"https://github.com/rprakashg/tf_eks_with_efs/blob/main/deploy/k8s/pod.yaml\">here</a></p>\n<p>Here is a screen capture below from my environment I was using for this post that demonstrates this</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bb4858fa7264ff74fcd822e974c5d463/f793b/efs-pod.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVQI1yXMQUvDMBxA8X/SuqRpamdSs9ROhVo2QWpREARvfhYPm4rf//bEefhd3uHJNE3knEkpcdVn1mGLrp8p/BPN5RsuvFJdvCDmETELUi/IcobcCs7WNE2DtRbvPc45ZBiGU/wTYyCExKpKSLEm9TtiumPT7/DtlnLVIfocaRViBa00WmuUUojIv3EcmeeZ/f6em+uetntAwhcqHlDxiOqO6PhBuflBx29UPiCfjuJdcGWNbzxVVWGMOQ1/AZjTSkhHZvJFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"efs-pod\"\n        title=\"efs-pod\"\n        src=\"/static/bb4858fa7264ff74fcd822e974c5d463/5a190/efs-pod.png\"\n        srcset=\"/static/bb4858fa7264ff74fcd822e974c5d463/772e8/efs-pod.png 200w,\n/static/bb4858fa7264ff74fcd822e974c5d463/e17e5/efs-pod.png 400w,\n/static/bb4858fa7264ff74fcd822e974c5d463/5a190/efs-pod.png 800w,\n/static/bb4858fa7264ff74fcd822e974c5d463/c1b63/efs-pod.png 1200w,\n/static/bb4858fa7264ff74fcd822e974c5d463/f793b/efs-pod.png 1404w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>If the pod dies and comes up in another node and since we are using a persistent storage all the data would still be available for the application pod when it comes up on another node or when additional pods are created when a horizontal scale out event occurs.</p>\n<p>Looking at the EFS file system in AWS web console we can see that an additional access point for the application that I just deployed was created.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/35c19e87d829651ab9f24bf7ae0207f4/b8256/efs_aws_console.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABCUlEQVQoz4VR2W6EMBDL//8j+0LZZTlC7osEVzOA2qqVOpKVzCGP4wjrHEKMqLVCKQ0fAiiO4/gTFO1okHpDTAmlFORc0FrjngghcJGG53lB/zHAGMNL9n3/Rf5FKBFjRM4ZKSUWRH3hnEcIkZNtU7DWoe4V/4UymhcTWbqUHq1BEDPJpdNYB+s8w1gLpQ1WZaDNCbKHLHHeQyrJfRJE+Q1xb6ytYXxPGJ5PKK2ZkBTIb4SOCL2H9wExF7bFX0RUo7u4fSGFNODC6Z0PET5mrrd6W3B5WCvc+EKZJ34qzRBSjj8JpdJ4y1PdsGx4vFYscsO8rlilxCLleT46jF3HL6HeNC/86/3U4xNvkh/5lKtSKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"efs-app-access-point\"\n        title=\"efs-app-access-point\"\n        src=\"/static/35c19e87d829651ab9f24bf7ae0207f4/5a190/efs_aws_console.png\"\n        srcset=\"/static/35c19e87d829651ab9f24bf7ae0207f4/772e8/efs_aws_console.png 200w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/e17e5/efs_aws_console.png 400w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/5a190/efs_aws_console.png 800w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/c1b63/efs_aws_console.png 1200w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/29007/efs_aws_console.png 1600w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/b8256/efs_aws_console.png 2017w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this helps, as always reach out to me via any of the contact methods listed here if you have questions about this post.</p>\n<p>Thanks,\nRam</p>","id":"f69cbec1-89d8-5e8f-92da-07ef494f1270","frontmatter":{"title":"Using Amazon Elastic File System as persistent storage for Kubernetes workloads","date":"January 15, 2024","tags":["EFS","Platform","AWS","Amazon","Storage","K8s","Kubernetes","EKS"],"author":"Ram Gopinathan"},"fields":{"slug":"/efs-with-k8s/"}}},{"node":{"excerpt":"Introduction In this post I'm going to walk through deploying Azure RedHat OpenShift clusters with Pulumi and Infrastructure as code. I'm going to assume that you are familiar with Pulumi. If you areâ€¦","html":"<h2>Introduction</h2>\n<p>In this post I'm going to walk through deploying Azure RedHat OpenShift clusters with Pulumi and Infrastructure as code. I'm going to assume that you are familiar with Pulumi. If you are new to pulumi I recommend you check out this getting started <a href=\"https://www.pulumi.com/docs/get-started/\">guide</a></p>\n<p>Pulumi templates are the fastest way to deploy infrastructure to your cloud environments in a consistent and repeatable fashion. Check out this template <a href=\"https://github.com/pulumi/templates\">repo</a> to see a list of available templates. Since there is nothing available for Azure RedHat Openshift I decided to create one. I still haven't contributed this to the template repo yet but for now you can find this in my github <a href=\"https://github.com/rprakashg-redhat/pulumi-aro\">here</a></p>\n<p>Before you can get started with this you will need to login to azure portal and request quota increase for compute in EastUS region where we will be deploying the Azure RedHat OpenShift cluster</p>\n<ul>\n<li>Standard DSv3 Family vCPUs = 150</li>\n<li>Total Regional vCPUs = 200</li>\n</ul>\n<p>Increasing limits by VM series for Azure Red Hat OpenShift installation is necessary to ensure that your Azure Red Hat OpenShift cluster has the resources it needs to operate efficiently and reliably.</p>\n<p>Login to Azure from CLI</p>\n<p>Create a directory and cd into it as shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir my-aro &amp;&amp; cd my-aro</code></pre></div>\n<p>Create a new pulumi project by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pulumi new https://github.com/rprakashg-redhat/pulumi-aro/tree/main -s rprakashg-redhat/my-aro/dev</code></pre></div>\n<p>Above command will prompt to enter configuration values, you can keep the default except the pullSecret which you will need to obtain from console.redhat.com/openshift/downloads\nSee screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/675eb5d1d4dc3b89d402e74c983759aa/497e1/puluminew.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVQoz52S2W7bMBBFqY2kKJnWykiwahu2HxpHceUNeWz//6dOQRUtggJB4z4czBAc3LmcodgfDnRdi857hJ4I0hNCnxDpK0J/Q+gDoQkwqSZLUzJjyN9htCZVao7+LPL1mnyzIXUtad+QrhzZlydM35CtHNZVWNcRLxZEHmPmmBQFsbUzybL4cy/atzfKacJ+faY9X+nGE3Z3wLSOZdejyopkuUR6ypLEWlRdo51DNc2vvG3nOlXViPp2p50mupeRfrej9AV5TpgkM0EcE/goJVEUEYUhQoiPqS5XmsuF/nik3G7JhoHMd/aO8hy5sHOe+GemBiklIgg+FnSXC910pjudcMcXiv2eZr3B1vW8BK3kPPD4X85+U5/PVOM4u+zGETcMJEqhpCT4rMh7nr7/oL7fqW43uuuVfrtF+Q3676D1PLeHBIvVgC4rYj+rhcUWBTrLCMNw5mGHdVPSupp8YQgC8bjA3yxdgacZWnKboZQliuR/C/4E3hb2+wb+FtgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"puluminew\"\n        title=\"puluminew\"\n        src=\"/static/675eb5d1d4dc3b89d402e74c983759aa/5a190/puluminew.png\"\n        srcset=\"/static/675eb5d1d4dc3b89d402e74c983759aa/772e8/puluminew.png 200w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/e17e5/puluminew.png 400w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/5a190/puluminew.png 800w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/c1b63/puluminew.png 1200w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/29007/puluminew.png 1600w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/497e1/puluminew.png 1891w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can open the current folder in visual studio code to see that the project was bootstrapped using the template. You can also see the stack file (dev) that is generated. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 621px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fba2361c313008384ea7556400fb8046/3075e/pulumiprojectdir.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVQ4y6WTa3KCQBCEOYiCAiqrrK4sr0BYH6AmVsz9b9OpGUIqMYlR8+OrKVjo6pnptbSOkaYZqCq1ZKJInxH98O4r9H8cJ7CapsFqtYIQs/fDGEEwxWQimCAQfOb7I3iedwGfsU6nE4xpBfO8gFIRhkP6YPSB749h2w56vR76/T7X37CyrG03lAtstw2MWbPDTqjDcQYsZtv2Raw0TaG1ZodF8Yi63iEM53Bd/z7BoiiQJAlmsxAPDyVD7lzXY1GCnh3Huc1huExh1g23LaXCdCohRIggmHEdDIbXCZZliTzPoZc59rsjnp5fcDy+oq4PiKIMSiVcaYM09D8FSSzWGmMhUZk19vsDNpua49Juu43D1S0bY0Bz9McCcq44NlIuOIOfN331UsghLYVckKOOTqyrN22ZOM9dJ3azIAWb7mB7tUb/F6QZVlX1Lcj3Cr4BhUSW8ckiMbkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pulumiproject\"\n        title=\"pulumiproject\"\n        src=\"/static/fba2361c313008384ea7556400fb8046/3075e/pulumiprojectdir.png\"\n        srcset=\"/static/fba2361c313008384ea7556400fb8046/772e8/pulumiprojectdir.png 200w,\n/static/fba2361c313008384ea7556400fb8046/e17e5/pulumiprojectdir.png 400w,\n/static/fba2361c313008384ea7556400fb8046/3075e/pulumiprojectdir.png 621w\"\n        sizes=\"(max-width: 621px) 100vw, 621px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Run command below to set the Location on azure-native pulumi provider</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pulumi config set azure-native:location EastUS</code></pre></div>\n<p>To deploy the Azure RedHat OpenShift cluster with pulumi we can simply run <code class=\"language-text\">pulumi up</code>. Cluster provisioning takes about 50 minutes. You can see output from my environment in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9d5d4ca84fe78ef4a94a0b68dea3319d/60a48/pulumiup.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVklEQVQ4y51U2XLiMBAcSbYlX/iQbfCBAduBEEKS/f+P6y0NC0sqL1v70KWSNO4ezfSYfGNQVQPyPEOe5zDGQErJUEqBiOB5Gk2zQxiGEEI87qUQ8LSBbxOOY4iAMG4HfH5+4nw+43q94uXlBbvdDpvNhoMc8fX6zmdO9A5bWJjSgI4EkndCT8CWloOHYcB+v8fhcECWZQ9VR7jb7aG1/pvJHQGBekf0yFCg6zpc3i+c2ev5lTM9Ho/YbrcoigKe5+Hj44PF2rZlsUAHiKMYfuqD5idCUoSqrDAdJozDiGVaME8zpmnC5XLhNYoiFuv7nsvQNA2qqkK7bhEVEWh4IrSJvalogjACFAmQL0Akvj3tuRmuBHe4828lGLIeaZGADDEp10TSz1r9K+I0hylWUDaETENIX0OFITwd/B/hvnvF2J5QlwPMqkCYFTC2QbQq2H9C+pAqgJTBbVUBFMPdqZ+EhS5Q6hKZv8LKSxCqBEomCIIC2lhoXSKKNgijlvd+UCDQJbRpIMTNRko+vUYaH22/Rz90aPsOVW2RJDGEIIYLco2Y5zPq2iJNE6wcVgnKIkecp0iONcwhhAoVSPgCdVVhmReM48iWcSZ35q7r5kE4HQ6wtnp0VriOk7w1cU+g8d7MgNC1HXtuWRacTifG29sb7621TPL19YvPnLmdB525y7yEzvRt9OY/hC7Dpm4wzzMHu9XBGXi9XvPMuklxIo68rmueHke6bjaI8gi0oxtciaQvOWA7bnmsHKmD+9hNSJqmiOOYx/D+9/kGn2CmEOESQUUefgPIcVjHnrb8QAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pulumiup\"\n        title=\"pulumiup\"\n        src=\"/static/9d5d4ca84fe78ef4a94a0b68dea3319d/5a190/pulumiup.png\"\n        srcset=\"/static/9d5d4ca84fe78ef4a94a0b68dea3319d/772e8/pulumiup.png 200w,\n/static/9d5d4ca84fe78ef4a94a0b68dea3319d/e17e5/pulumiup.png 400w,\n/static/9d5d4ca84fe78ef4a94a0b68dea3319d/5a190/pulumiup.png 800w,\n/static/9d5d4ca84fe78ef4a94a0b68dea3319d/c1b63/pulumiup.png 1200w,\n/static/9d5d4ca84fe78ef4a94a0b68dea3319d/60a48/pulumiup.png 1325w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After the cluster provisioning is complete we login to the openshift cluster using the default kubeadmin credentials created. Run the command below to retrieve the default kubeadmin credentials</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export CLUSTER=arodemo\nexport RESOURCEGROUP=aro-rg\n\naz aro list-credentials \\\n  --name $CLUSTER \\\n  --resource-group $RESOURCEGROUP</code></pre></div>\n<p>Above command will return a JSON payload just like what's shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n  \"kubeadminPassword\": \"&lt;generated password>\",\n  \"kubeadminUsername\": \"kubeadmin\"\n}</code></pre></div>\n<p>Next we can get the OpenShift console URL by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">az aro show \\\n    --name $CLUSTER \\\n    --resource-group $RESOURCEGROUP \\\n    --query \"consoleProfile.url\"</code></pre></div>\n<p>Launch the console in a new web browser and login with default kubeadmin credentials. Screen capture below shows OpenShift console after successfully logging into it</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/81cbc6e29d98d7ba0ce66b07819b9010/010dc/arocluster.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2UlEQVQoz2WR23LaMBCGfduShGGKwdbRknzAh2CDMZkhjeENehXCTd//Mf6O5Nik7cU3K++ufu/+8i6XC859j8v5jL7vcX776ej7N3SHPQ7tDu2uxmHfoDu06No9jmN+b2kcXbtzeP58jo0QWPo+ZrMZvi/W+LYIMPtB8OCg9/OS4nFJMfcZnnw6sBzi/BNPSI0oMlgHFKuAY1H/wqL7jcfmiof6fcCdr5jV73jaXeF3H1gePly0rI43BC83rI83eFXTIskrxFmJZFOirLao6waCcTBCwSn7D/Yv5I5n4g2ENGBcubhiCiGLQHkEwhUCIrAmwsWRdcixDtkA4X/VvDQrIaPYCTqERtO9otq2yDYVhIxBmZrqlEVQOocxFbTOwYWesHUvTvLpw0bCJPKiRpIWbuJIJVN9FMyyCs/bPYqihjaZ61E6df1u5bHZXrRjq7SCyp5BuAahAoRKUCpdtEiTQ6cltBURGiERU80JcjEKKuedVAlWnz6F1iNu3I9kZNzlgMrBv4C5fPjVQ7vaOKUTiwyOLycUxRbW38FXg5AKqCRxK1MZgesMLEohk8qtmsQGQmXwsqx0PkyGmxSn1x5FOfg45oOQoSxSdMcTyqoB5feHGrezj/IHY/I0l7mmG/kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ocpconsole\"\n        title=\"ocpconsole\"\n        src=\"/static/81cbc6e29d98d7ba0ce66b07819b9010/5a190/arocluster.png\"\n        srcset=\"/static/81cbc6e29d98d7ba0ce66b07819b9010/772e8/arocluster.png 200w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/e17e5/arocluster.png 400w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/5a190/arocluster.png 800w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/c1b63/arocluster.png 1200w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/29007/arocluster.png 1600w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/010dc/arocluster.png 1714w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Logging into azure portal we can see aro cluster and vnet in <code class=\"language-text\">aro-rg</code> resource group as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/65f20554ed6408638ed0a4ddaed20692/cdef6/aro-rg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjklEQVQoz51T2XLbMAzUT8QSSZG6eemwI8uepp3p///VdgCJbp0mecjDDggSWGBBMrvf7zjPEypdwpQKpRRQojiQQxb50/qv/z/oLCOyKQZoJZlMFgVKKaGkgNEGtdHQSsEYWpdcWJfJqr2RY6+pDLLbdYV3FmMMWOYRXdsgeI/btmGwDssYYYyGdQHLFDGPEV3XcQzZMQTOb9sO6+WM7PevN1zOC7wd4OyAtq4w9D2vm0qja2quLPIXliTyE2RxYktj2P0cpTwkT9ExGUkTpz3JxwnWR9ieOvCIwaOpK54xkbdUpK5YLhWkXJohjSybx8CEFMzDlQK2axGd5X1K2NZX/Hz7weSXZcZ2XdnS+f228f7epUAWnNsHrOTjtiiALsvbnrukrtzQI3rHhYvTy0NqUkVkTEhJyUlPxrYNpjBBmhbqCE7PgtZU/D0ehLd15YtIwSSZfNMOKPsIrQ20+pjkI2T0FIKzLDsNlsFVU+XiScVXyK6XhW8pyXr+KQni09/xHtnoLOTh/Ev6XfwBEAlGaxk6FbkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aro-rg\"\n        title=\"aro-rg\"\n        src=\"/static/65f20554ed6408638ed0a4ddaed20692/5a190/aro-rg.png\"\n        srcset=\"/static/65f20554ed6408638ed0a4ddaed20692/772e8/aro-rg.png 200w,\n/static/65f20554ed6408638ed0a4ddaed20692/e17e5/aro-rg.png 400w,\n/static/65f20554ed6408638ed0a4ddaed20692/5a190/aro-rg.png 800w,\n/static/65f20554ed6408638ed0a4ddaed20692/cdef6/aro-rg.png 1163w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>and all the cluster infrastructure resources provisioned in <code class=\"language-text\">aro-infra-rg</code> as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/485e3d1a226d65145d9f368903e45788/67fe0/aro-infra-rg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB50lEQVQ4y3WT6ZKbMBCEeYckgGEQh4RAF5aNWdubs/L+79QpjdfrTdX6xxTSAJ+6W1Km4wnBWRzjHt5ZtA1BUI16V96qLFCVxdv8Nr7PH/3HOPPrCdt6xHqIcGZmWFNXoLpCQ4RWCMi+5b4QAkPXom8FBBE6IdA2DVfqERGyQ4ysbtYjl7cGfddCSYm4j5BSwZsZXSsgleb3qUaloLW+PccRzkzouh7Z9fdf/Hy9sl0zT6xSDj1D4uIxtAKjHCD7DnSPYVeCqsf4Yy/T2mPxlkEpvzL/xnlMxkPpGVpJVjSNClTtPq0UUaq62iFzJsBMSbrknO4fJUWTVgxMCx0PEa+XMy8cvMN5O+HltPK/aQ+2dWVotvgJ3lq2xau8yXfG8O67WSNYAzUMDNsHz5BnarMYArq2wa7I35vJsjUj4iGAxABqBKjMn0L+A7pgsR2P6ETDoKSyKgpYP2OMEZX0aEYP6hSadKQ+ZPZZZW4fsPeOs7oHW+U53OKgTy8MpCmCxsC7yErSOX1qefuOGBxn9A4scszWYlg21CqA9AJSSeUIqu8b9zk000vEPErkX788MixyGOch4wV1Uqj3IOVAbXKRbtJz29n5esGfXz/4rKUMEzDd30EOaLVF3c8gaUC9ZuDNbvnU8j+KimhU6FpwcwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aro-infra-rg\"\n        title=\"aro-infra-rg\"\n        src=\"/static/485e3d1a226d65145d9f368903e45788/5a190/aro-infra-rg.png\"\n        srcset=\"/static/485e3d1a226d65145d9f368903e45788/772e8/aro-infra-rg.png 200w,\n/static/485e3d1a226d65145d9f368903e45788/e17e5/aro-infra-rg.png 400w,\n/static/485e3d1a226d65145d9f368903e45788/5a190/aro-infra-rg.png 800w,\n/static/485e3d1a226d65145d9f368903e45788/67fe0/aro-infra-rg.png 1101w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can run <code class=\"language-text\">pulumi destroy</code> to delete all the cluster resources. Be sure to do this after you no longer need the resources so that you won't incur any unnecessary charges in Azure</p>\n<p>Hope this was helpful and helps you start getting hands on with Azure RedHat OpenShift. If you have any questions about this post or OpenShift please reach out to me via any of the contact methods listed in my blog</p>\n<p>Thanks,\nRam</p>\n<h2>Resources that helped me creating this template</h2>\n<ul>\n<li><a href=\"https://www.pulumi.com/blog/how-to-create-and-share-a-pulumi-template/\">https://www.pulumi.com/blog/how-to-create-and-share-a-pulumi-template</a></li>\n<li><a href=\"https://github.com/pulumi/templates\">https://github.com/pulumi/templates</a></li>\n</ul>","id":"06d11f9c-9f1d-59c1-b273-8576fd5d3137","frontmatter":{"title":"Deploying ARO Clusters with Pulumi and Infrastructure as code","date":"January 12, 2024","tags":["OpenShift","Platform","Azure","Pulumi","Infrastructure","IaC"],"author":"Ram Gopinathan"},"fields":{"slug":"/deploying-aro-clusters-with-pulumi/"}}},{"node":{"excerpt":"One of the problems I've seen with most customers making a move from monolith to microservices is around deployment. Typically all of the logic of deploying to kubernetes clusters are baked into CICDâ€¦","html":"<p>One of the problems I've seen with most customers making a move from monolith to microservices is around deployment. Typically all of the logic of deploying to kubernetes clusters are baked into CICD pipelines for respective microservices. When your number of clusters and microservices grows there are few potential issues that you need to keep in mind.</p>\n<ul>\n<li>\n<p>CICD Pipelines managed by developers will need credentials to authenticate with the clusters and necessary permissions to deploy the workload. You will need to ensure that these credentials are read from a secure key vault when pipeline runs.</p>\n</li>\n<li>\n<p>There are many tools such as kubectl, helm, kustomize, etc. that developers can use to deploy workloads on kubernetes clusters. Developers in your organization will need to learn these tools. Hard to keep track of what tools and the versions are being used</p>\n</li>\n<li>\n<p>Even a small change such as rotating deployment credentials, deploying to a newer cluster can be costly change when you broadly look across entire org since we now have 100s of microservices instead of a few monolithic apps deployed across clusters running in multiple public clouds, on-premises sites and also in the edge.</p>\n</li>\n<li>\n<p>Lastly deploying workloads on kubernetes clusters is something everyone is going to need to do so instead of pushing that concern to individual development teams and their pipelines its a good idea to build a common consistent mechanism that every team leverages. You can implement best practices such as GitOps, etc. here and doesn't require every developer in your organization to be experts and can free them to focus on business logic. Additionally this can provide visibility into what's running where as well as one place to make changes/improvements</p>\n</li>\n</ul>\n<p>If you are a start-up or small development shop the issues I mentioned above are not that hard to manage but at scale when you have lots of development teams deploying 100s of microservices to kubernetes clusters across multiple clouds, on-premsises and even on the edge, this can get pretty messy.</p>\n<p>So in this post I will cover how Red Hat Advanced Cluster Management for kubernetes can help with this. for the purposes of this article I'm using a sample getting started app from quarkus quickstarts and I've provisioned two clusters \"ocpeast\" and \"ocpwest\" from ACM hub cluster in AWS east and west regions to simulate a production environment deployment scenario. We are also going to use GitOps to automate deployments to production clusters ocpeast and ocpwest.</p>\n<p>I've added a very simple github actions pipleline to this quarkus getting started app which does three things</p>\n<ul>\n<li>\n<ol>\n<li>Maven build</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>Build container image and push that image to github's internal container registry</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>Update kustimization file to inject the new version of image that was built to promote to production clusters in <a href=\"https://github.com/rprakashg-redhat/rhacm-demos/tree/main/applications/getting-started-async\">this</a> repository.</li>\n</ol>\n</li>\n<li>\n<ol start=\"4\">\n<li>Open a Pull Request (Trigger a GitOps deployment process upon merge)</li>\n</ol>\n</li>\n</ul>\n<p>Here is the pipeline code below. You can also find the source <a href=\"https://github.com/rprakashg-redhat/getting-started-async/blob/main/.github/workflows/ci.yaml\">here</a> in this Github repository</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name: ci\non:\n  push:\n    branches:\n    - main\nenv:\n  IMAGE_TAGS: ${{ github.sha }}\n  IMAGE_REGISTRY: ghcr.io/${{ github.repository_owner }}\n  REGISTRY_USER: ${{ github.actor }}\n  REGISTRY_PASSWORD: ${{ github.token }}\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: setup java\n        uses: actions/setup-java@v3\n        with:\n          java-version: '17'\n          distribution: 'temurin'\n          cache: 'maven'\n      - name: build\n        run: ./mvnw clean install\n      - name: upload artifact\n        uses: actions/upload-artifact@v3\n        with:\n          name: quarkus-app\n          path: target/quarkus-app/\n\n  containerize:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: download artifact\n        uses: actions/download-artifact@v3\n        with:\n          name: quarkus-app\n          path: target/quarkus-app/\n      - name: build image\n        uses: redhat-actions/buildah-build@v2\n        with:\n          image: getting-started-async\n          tags: ${{ env.IMAGE_TAGS }}\n          containerfiles: |\n            src/main/docker/Dockerfile.jvm\n      - name: push to registry\n        id: push-to-registry\n        uses: redhat-actions/push-to-registry@v2\n        with:\n          image: getting-started-async\n          tags: ${{ env.IMAGE_TAGS }}\n          registry: ${{ env.IMAGE_REGISTRY }}\n          username: ${{ env.REGISTRY_USER }}\n          password: ${{ env.REGISTRY_PASSWORD }}\n          extra-args: |\n            --disable-content-trust\n    outputs:\n      digest: ${{ steps.push-to-registry.outputs.digest }}\n    needs: build\n\n  update-deployment-manifests:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with:\n        repository: rprakashg-redhat/rhacm-demos\n        ref: refs/heads/main\n        token: ${{ secrets.GH_TOKEN }}\n    - name: setup git\n      run: |\n        # Setting up the git config.\n        git config --global user.email \"rgopinat@redhat.com\" # HARD CODING FOR NOW, NEED TO DETERMINE HOW TO RETRIEVE THIS FROM CURRENT USER CONTEXT\n        git config --global user.name ${{ github.actor }}\n    - name: update manifest\n      run: |\n        IMAGE=\\\"${{ env.IMAGE_REGISTRY }}/getting-started-async@${{ needs.containerize.outputs.digest }}\\\"\n        git checkout -b \"${{ github.job }}-${{ github.sha }}\"\n        sed -i \"s#\\(.*value:\\s*\\).*#\\1 ${IMAGE}#\" applications/getting-started-async/overlays/prod/kustomization.yaml\n\n        git add .\n        git commit -m \"updated manifest to point to image tag $IMAGE\"\n        git push origin \"${{ github.job }}-${{ github.sha }}\"\n    needs: containerize\n\n  open-pr:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n    - name: open pr\n      uses: ./.github/actions/open-pr\n      with:\n        repo: rprakashg-redhat/rhacm-demos\n        token: ${{ secrets.GH_TOKEN }}\n        title: \"PR for commit - ${{ github.sha }}\"\n        body: \"PR for commit - ${{ github.sha }} by ${{ github.actor }}\"\n        base: main\n        head: \"update-deployment-manifests-${{ github.sha }}\"\n    - uses: actions/checkout@v3\n    needs: update-deployment-manifests</code></pre></div>\n<p>The CI pipeline above completed successfully on push and you can see the container image is already built and pushed to github container registry as show in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b44db5f9b6e33db495e01190262dbcaf/2ba99/getting-started-container.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZElEQVQoz22Ti1LjMAxF+/9/CMvCFgqdThonfseW5MvING2yg2aONY7jG71yICKcTp94/vOC4/Ed/47v3f99fUPKGWqtNV1vrPu9rc8OzIzZWhhjMM0zrLMIwcM5C2a6v8zSULmhkkDvOusQY+xnq5j6g0jDbAOMcTCTh50LYhBEzwiekDKhVIJPFVOoGH3BUhnjMGAcDax1YJaHoC4pURfyrsJOSsFsCmKsXUyppHD3LIKcl55RCBFLKQ9BIu4HP0zwMYCFUZlQiO6CynKDWDBNc6+9cxohPwQ13Ivx+BoczlePi4kYXUEua0R7llI7pdS70K4pWkMXF9iwwMbSfcwE+aWTaiI/TbkOA85fZzjvoVluBAWTS7jaBOMyRpswx9q7unZwi0ald9+en3D6+OgTEmPajI0IXKIuMkfqqeq8/Sa2xYfYu5x3s6oRttaLXG9oZNKRjZf/9g36Q5RSUGvdfegbxOYNIymYWtYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gettingstartedcontainer\"\n        title=\"gettingstartedcontainer\"\n        src=\"/static/b44db5f9b6e33db495e01190262dbcaf/5a190/getting-started-container.png\"\n        srcset=\"/static/b44db5f9b6e33db495e01190262dbcaf/772e8/getting-started-container.png 200w,\n/static/b44db5f9b6e33db495e01190262dbcaf/e17e5/getting-started-container.png 400w,\n/static/b44db5f9b6e33db495e01190262dbcaf/5a190/getting-started-container.png 800w,\n/static/b44db5f9b6e33db495e01190262dbcaf/c1b63/getting-started-container.png 1200w,\n/static/b44db5f9b6e33db495e01190262dbcaf/2ba99/getting-started-container.png 1221w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Additionally you can see that the pipeline created a new branch in the the github repo that contains the deployment artifacts for this getting started app and updated the kustomization file to inject new version of the container that needs to be deployed. Additionally it creates a pull request to merge those changes to main as shown in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b15583c91249a3483aee1f7372d4df63/0931d/prforcommit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8ElEQVQoz02Sy27bMBRE9f+/0P5AVt1311WQVRAgCxdOYseWLct6US++pVPwOklDYDBXFDiaGSp72D7y5/meS1FSXitOpzO73Z7jqeA9L3g5nNkeLrwcLmwPBS/Hkr/7M9v3gvzaEUJkXVdmbTDWkW3qHY/HZ4L1OGtxzhG8l5fGBXrtaefA5FZGD0Nid+OEuCyktSyRGDxZvn3lWg2c1MxlMIJydFxnT2Mi1eypZ49yK72/Ie1PfmGNQdylFWPEaE3WXAqubce57igESuaqnwT1qIW72TJHmPzKYCM6rLRdh9Ya570IL8tKltSd81itZXNNET54SYhRGG5OPlcIgWEcmeZZzqezqU8RtNqilJJitTYMw4jqe3rhgbZTwuM4MU0z1joRMcZirP34IPgQyLb1jvxacDoXHPKcoixFLMVJ3PVKnIzTKJyQREKMMkuqD9fee7KHwyPlUFN1mqrtaLqOVqkvpGfr3FfU1JcaBqx3Eje5E9HvkXfNkbws6NuBtunkf1QppuqJIYrQ56HPW00Ox2mS2/3eqwg+nTb8vL/jx/0dv55+U3c9pdJclKFSM5WaZG4Gw2wts3FM1tC0rfSd/t3UqzGG7G2zYZ/v2eSvvNcnqrHFhYBxHp2KT/D/5xTZ+XCLrpSIpO7SJSW3/wBhsU0a/b+FKwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pr\"\n        title=\"pr\"\n        src=\"/static/b15583c91249a3483aee1f7372d4df63/5a190/prforcommit.png\"\n        srcset=\"/static/b15583c91249a3483aee1f7372d4df63/772e8/prforcommit.png 200w,\n/static/b15583c91249a3483aee1f7372d4df63/e17e5/prforcommit.png 400w,\n/static/b15583c91249a3483aee1f7372d4df63/5a190/prforcommit.png 800w,\n/static/b15583c91249a3483aee1f7372d4df63/c1b63/prforcommit.png 1200w,\n/static/b15583c91249a3483aee1f7372d4df63/0931d/prforcommit.png 1373w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Screen capture below shows the updates to the kustomization file made by the CI pipeline for getting started app</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/66a04035d7fb37672778d0b08a163acd/5148a/fileschanged.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVQoz32O207CUBBF+/9f4rs/4JOvaiIXS2mhBawtVHoOPXdYpgcTjVEnszJ7Zic7k9w93fOczcjzFZvtjrKsmM1fSBcZ+XrDfJEzy9aRtNjwnBbM84pJuoo6XW15FwNcLmOT3Dze8lBN8MYzKIU2BmMMWmuk8QhlqYWjOXkOKrAfRs60Q4js1RlpwjUQSPCglUEbi/NjqMY6hxqntTFYqwHvLP/VJX54IRk/kkIgpUQIGWffi6iv+ymGK60xxhJCwPsfhBDvI0nRebJGUx4ERXukOkhqaail/cSw63Vk3Pf6TKvCnyRCKKTUGOtoup63puPYS07KIIcr1nl8OON8iNr6X3A++slBbNkfK5TuabqWxWrKdPnEsl6SvS5Y1hnrtqBsC9ZN/kWbx1v5zdt1FR9UoBV+DQatHAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fileschanged\"\n        title=\"fileschanged\"\n        src=\"/static/66a04035d7fb37672778d0b08a163acd/5a190/fileschanged.png\"\n        srcset=\"/static/66a04035d7fb37672778d0b08a163acd/772e8/fileschanged.png 200w,\n/static/66a04035d7fb37672778d0b08a163acd/e17e5/fileschanged.png 400w,\n/static/66a04035d7fb37672778d0b08a163acd/5a190/fileschanged.png 800w,\n/static/66a04035d7fb37672778d0b08a163acd/c1b63/fileschanged.png 1200w,\n/static/66a04035d7fb37672778d0b08a163acd/5148a/fileschanged.png 1228w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now we could have notified the ops to approve the changes or auto approve from pipeline but for the purposes of this article I'm just going to manually approve the changes and delete the branch. Also notice in the pipeline above that I do not have single kubectl command or helm command to deploy the application to cluster also I don't have to be concerned about credentials to connect to cluster etc.</p>\n<p>Steps below are one time tasks that you will need to do on the ACM hub cluster. You can pretty much do this one time for every service and remove all the deployment code you might have written into your CICD pipelines. I think this is huge productivity win for developers IMO.</p>\n<ul>\n<li>Step 1: Define a placement resource in openshift-gitops namespace to discover production clusters to deploy this getting started application. For the purposes of this article I've labelled both \"ocpeast\" and \"ocpwest\" clsuters with environment=production and I'm going to use that when defining the placement resource as shown in yaml snippet below</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: cluster.open-cluster-management.io/v1beta1\nkind: Placement\nmetadata:\n  name: production-clusters-placement\n  namespace: openshift-gitops\nspec:\n  predicates:\n    - requiredClusterSelector:\n        labelSelector:\n          matchExpressions:\n            - key: environment\n              operator: In\n              values:\n                - production</code></pre></div>\n<ul>\n<li>Step 2: Create the placement resource by running the command below</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc apply -f https://raw.githubusercontent.com/rprakashg-redhat/rhacm-demos/main/gitops/config/prod-placement.yaml</code></pre></div>\n<ul>\n<li>Step 3: Define ArgoCD ApplicationSet resource for this getting started app to be created on the ACM hub cluster.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: argoproj.io/v1alpha1\nkind: ApplicationSet\nmetadata:\n  name: \"getting-started-async-app\"\n  namespace: openshift-gitops\nspec:\n  generators:      \n  - clusterDecisionResource:\n      configMapRef: acm-placement\n      labelSelector:\n        matchLabels:\n          cluster.open-cluster-management.io/placement: production-clusters-placement\n      requeueAfterSeconds: 180\n\n  template:\n    metadata:\n      name: 'getting-started-async-app-{{name}}'\n    spec:\n      source:\n        repoURL: \"https://github.com/rprakashg-redhat/rhacm-demos.git\"\n        path: \"applications/getting-started-async/overlays/prod\"\n        targetRevision: \"HEAD\"\n\n      destination:\n        namespace: \"demos\"\n        server:  \"{{server}}\"\n\n      project: default \n\n  syncPolicy:\n    PreserveResourcesOnDeletion: false    \n    applicationsSync: sync</code></pre></div>\n<p>Key thing to understand from the above ApplicationSet resource definition is that we are using cluster decision resource generator which will read the \"production-clusters-placement\" placement resource that we created earlier and attempt to extract list of clusters from the key decisions. ClusterDecisionResource generator will then pass name, server and any other key/value pairs in the duck-type resource status list as parameters into the applicationset template. You can see from the above yaml that we are using name to generate a unique name for app and server as value for destination server.</p>\n<ul>\n<li>Step 4: Lastly we need to create the ArgoCD ApplicationSet resource on the hub cluster. Assuming we are logged in to hub cluster we can run the command below to do just that.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc apply -f https://raw.githubusercontent.com/rprakashg-redhat/rhacm-demos/main/gitops/getting-started-async/prod.yaml</code></pre></div>\n<p>We can log into ArgoCD console on the hub cluster and see that the ApplicationSet was successfully created as shown in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/63586c8a76ffc200f645b6fa3c95efac/5b795/argodeployapps.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvklEQVQoz3WQbW/ScBTF+QyamLmpe62JcaKYqBmb39i3i2YmjMEY0CCwhwTLoLT0kbbAaPsvbX+Gspi98SYn9+Sem3MfCvufvrFfOuZHpc5INRgqep4HIw3D9hBxwiqMieIk51GSkfH/KLwqHfPy4xHfT37S7HaoNi+pS20qjQukfo+xpiCPh0x0FdXQmJhTTNfCcS3smYk1M3Js+My1KDw/+MrOQZnz+glL5wpT62DrXVyzz9K9Ze7c5DA1CXXUYKpIaOM2U6Wd9/n2dQ5L7zK+a1F48rrEbrHMWb3COgGxzlgFEZFISB+d4i98bMcizSCMBJFYkzxqiNYg6y6Fp29K7BXLVC8qhGFIEAa4nsNiMWcVBARBQJKk+HMH01QR8Zr53MX3Pe7vV7kexyIfMtRMCs/efmb3/SG1yzN4eHckRJ5FHCMe+MbQ86xtXcRkWUaapoRRlPNIxMgbw513X3jx4Yhf1VPavRuqrQ7nrQ6VhoQ983KDzZjF0qXZkai1e9Rav3P9ejD8d3IoHm24VzzktN5EVk26gxFXskL/j8LYcNBsD9VyUQyb27sJfVnZ6rLCQNGZOlt9Ys6QNYu/Uw8yBO6GZEsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"argoconsole\"\n        title=\"argoconsole\"\n        src=\"/static/63586c8a76ffc200f645b6fa3c95efac/5a190/argodeployapps.png\"\n        srcset=\"/static/63586c8a76ffc200f645b6fa3c95efac/772e8/argodeployapps.png 200w,\n/static/63586c8a76ffc200f645b6fa3c95efac/e17e5/argodeployapps.png 400w,\n/static/63586c8a76ffc200f645b6fa3c95efac/5a190/argodeployapps.png 800w,\n/static/63586c8a76ffc200f645b6fa3c95efac/c1b63/argodeployapps.png 1200w,\n/static/63586c8a76ffc200f645b6fa3c95efac/5b795/argodeployapps.png 1455w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can perform a sync for each application to ensure all the application resources are successfully synchronized with target clusters. Clicking on each application tile in ArgoCD console we can visualize all the resources and their status as shown in screen captures below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/084b4a3838e3b8eb27c35e576332e3d6/284c0/gettingstartedapp-east-argoapp-details.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRElEQVQY032OzUvjQBjGc/Qm4qEo4l4WQVmKQj3ssiDePPgPe1LwsKigVWizJGliTTLpzGTS+NUvan8yo+DNgQfmeV7e3/t4zYMjfh0ec3L+j07Q49YP6IYxfpRw9z+kE8Z0ghghNfa9LRYsvpG3vvuXjdYB1x2f6XREMTTUr69MZjNGkwlFPcQ8PTEaj5nP5w76LXB1u8Va8zdXd11exlP6QpHkin5RkqqK/qAkziX3hXb/TFefGn5IVV+ZqvCWGpus/Nji7LJNXj7SyxWx0MSiJMykk/V9adyCnT8MSpSpEfrD91JJL5NEmcRb/tmksdPi9LJNqmsXRrmim2Tk2pDrygEzXSLN0LW0bevnF+cjoQmUIbTHBgavsfeHzf1DTi9uyD6B9qp/n5Mq4wA2s3Dbyvqk0KTSkAhFJBSBLPGFIhSad1nspMbQEjZXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"argoapptile\"\n        title=\"argoapptile\"\n        src=\"/static/084b4a3838e3b8eb27c35e576332e3d6/5a190/gettingstartedapp-east-argoapp-details.png\"\n        srcset=\"/static/084b4a3838e3b8eb27c35e576332e3d6/772e8/gettingstartedapp-east-argoapp-details.png 200w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/e17e5/gettingstartedapp-east-argoapp-details.png 400w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/5a190/gettingstartedapp-east-argoapp-details.png 800w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/c1b63/gettingstartedapp-east-argoapp-details.png 1200w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/29007/gettingstartedapp-east-argoapp-details.png 1600w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/284c0/gettingstartedapp-east-argoapp-details.png 2079w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3caf4fa02e2539fee9970d541b62c253/a6d66/gettingstartedapp-west-argoapp-details.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABU0lEQVQY022PzUsbURTFZ+tOBNFFtW5E0EWtpHSh0I9/2L0uXOlCS6AhFpPJZDJx5s2b95WEYMjHTH5lHti68MJvce+Bc88JPp5dcPD1J5fXN7Q7IfftR1rdiD+9mN9PIc1OSKvbI80L6lmv17w39b0sS4K9xjf2v/zgvtVmuVogrMFNp8wWC2bzOWLk0KMx05cZi+WKsqooyzdU/6mqimDz8BPbxw3umi1e5ktSaRgITSwUiTQMpSUWmn6m6AvFsLA8K/ePek9ekZZgY/eAzf1Drm4fSPWYMC2IMk2cG3qZ8vSFZqgsmXbEuSbJNdpNkHbstShV/mGUKYKto1N2Thpc3/4iMxN63lDx2H9GGEemnE+WGYtyE5LcMMg1bjJFmhFRrukoS6ewhNIQ7Hw+50Pju0/41vApESRS+9p16qRQaDf2FWt9II1PVTfo1qZCEQrNX6lfo5ATtVH3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"argoapptile\"\n        title=\"argoapptile\"\n        src=\"/static/3caf4fa02e2539fee9970d541b62c253/5a190/gettingstartedapp-west-argoapp-details.png\"\n        srcset=\"/static/3caf4fa02e2539fee9970d541b62c253/772e8/gettingstartedapp-west-argoapp-details.png 200w,\n/static/3caf4fa02e2539fee9970d541b62c253/e17e5/gettingstartedapp-west-argoapp-details.png 400w,\n/static/3caf4fa02e2539fee9970d541b62c253/5a190/gettingstartedapp-west-argoapp-details.png 800w,\n/static/3caf4fa02e2539fee9970d541b62c253/c1b63/gettingstartedapp-west-argoapp-details.png 1200w,\n/static/3caf4fa02e2539fee9970d541b62c253/29007/gettingstartedapp-west-argoapp-details.png 1600w,\n/static/3caf4fa02e2539fee9970d541b62c253/a6d66/gettingstartedapp-west-argoapp-details.png 2070w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can also look at the getting started application details in ACM hub cluster console and see an overview of the application as well as visualize the topology as shown in the screen captures below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/120346a8e7651e758123cf71d603dfe3/561da/gettingstartedapp-overview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACX0lEQVQ4y6WS204TURSG5wGEC1OQHqD03ALReOQCJTSopEEiGn0BuTG+jwpVG02UxBuND2OIEjmJIJRDZ6bTOXY+s3dLKSSYRlfyJTOZmW/Wv9ZWUpkM6WCQsUSC8XyeUChIJBImnU7R0xOgu6uL7q5zHaPEE2liyQzB/kHCkSgD0TgDg0mi/f0k7jwj9/QjmSclsnPvWmTm3rZo3B8/U7JDFxHEEhniqRyxZJZUZoRQOMrL0iIqsKXDb81jq+KyrXrsm6DXQfOg4oLahpLODnP56g0plZ3FUiRSOfpCA5TelDgsb/N96SubG2ssf1tibWWZ9dUfbK6vsv3rJ42qt1CmZ2aZffiYwvR9pgr3mCrMyOvxiUk+ff6CIf6sG+i6jmXZuK6H4zg4rottO/g+1H0fv4ly+26B2QePyE9OMXZrgpvjeSm7cm2U9x8WUU2fg4pOpXKIpmnUarUTGIZxAiWezJJrzrA/mpCxB+Npzgf6eP5iXgba39+THcpw9brEF/j11v0RSm74EtdHx0hnRxqLSWZJpofo7YuwUHwlJUIm4lSrVTRNR9c1dKPGgW5xuhQhOY1YSs+FMPMLRflSRVWxHQ/LNKVUzFD8wPXqrdm1ZijitXMkDEhho8Od8h6266EZNoZpAz5n1ZkdnhDu7EqFYTpSWKsZjYU0l3K0IMuyOousqqqMY1mmjN0u6VgY6A2zUHyNOGgraxvo1caHQvy36qhDcf5ECaHnefL69DJaS+lkhrvlspybiPfPQtnhfLGtM1ceXP4rclOo1Vxs15dULQ/dbKAaNo7j4rrH/AEq88I/dH8EkgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"appoverview\"\n        title=\"appoverview\"\n        src=\"/static/120346a8e7651e758123cf71d603dfe3/5a190/gettingstartedapp-overview.png\"\n        srcset=\"/static/120346a8e7651e758123cf71d603dfe3/772e8/gettingstartedapp-overview.png 200w,\n/static/120346a8e7651e758123cf71d603dfe3/e17e5/gettingstartedapp-overview.png 400w,\n/static/120346a8e7651e758123cf71d603dfe3/5a190/gettingstartedapp-overview.png 800w,\n/static/120346a8e7651e758123cf71d603dfe3/561da/gettingstartedapp-overview.png 969w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ead18fd7073e6b40fa414e1368d0227/1790f/gettingstartedapp-topology.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPUlEQVQ4y52SXU/CMBiF+3+9gsTEC4Xf4Z2LEuWfeAsOb2FjY+36sbWMiGHlmFa+lhhwLHnyptve0/Oeltw8vqP7/IlOMELnaYRuMMLty8TTDcYNOsEYd4MP9Ich7l9D9N5C9IYhHna1P5yAKClQLZdYVwWqUmClFervFbabL1zzkNksAqUUUZojYxycCzCW+1rbLeraNrHnIUJKr2zWFhvb3M1a2xqSpimqqsLSaBijofURY8wFNITKG+9IkiS+WSmFoihawQVHShOo4thL4jj2ym5RlmUrhBRIsjmkkof+qwTdv7rU3lm8iHx1U7Z2uB/r1x33zLMYLKeesw7PZefcUU6R5QufIc0zxGn0t2Dbg4nSqc9y39sQPBX9T5Zal4iSqT8Ul+HO4dzfw9N75z5IKcE5v4gblTF2WP8AHtfPKYnxzf4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"apptopology\"\n        title=\"apptopology\"\n        src=\"/static/4ead18fd7073e6b40fa414e1368d0227/5a190/gettingstartedapp-topology.png\"\n        srcset=\"/static/4ead18fd7073e6b40fa414e1368d0227/772e8/gettingstartedapp-topology.png 200w,\n/static/4ead18fd7073e6b40fa414e1368d0227/e17e5/gettingstartedapp-topology.png 400w,\n/static/4ead18fd7073e6b40fa414e1368d0227/5a190/gettingstartedapp-topology.png 800w,\n/static/4ead18fd7073e6b40fa414e1368d0227/1790f/gettingstartedapp-topology.png 1189w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Lastly we can verify the the getting started application is successfully deployed to both \"ocpeast\" and \"ocpwest\" clusters by accessing the exposed routes from a browser as shown below</p>\n<p>Screen capture below shows instance running on the \"ocpwest\" cluster\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bbfea47252aeacdfe781e8bea90f01c5/fe9f1/gettingstartedapp-west.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAfElEQVQI162KQQ6DMBAD+f8bCwFUtYSS7CZZSNXLVIRDP1BLlq2xu/r+cDrbweID6xoZZ8/NPRimBTevDLNvvR+f9NNvu7hv/GTT/UVnViilsO+GqlJzRkUIIWBmiAgp5ZaiipdCjNK+dhxoSiRNbNvG6BxdjLGda638Q182K+U6dv7kFAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gettingstartedwest\"\n        title=\"gettingstartedwest\"\n        src=\"/static/bbfea47252aeacdfe781e8bea90f01c5/5a190/gettingstartedapp-west.png\"\n        srcset=\"/static/bbfea47252aeacdfe781e8bea90f01c5/772e8/gettingstartedapp-west.png 200w,\n/static/bbfea47252aeacdfe781e8bea90f01c5/e17e5/gettingstartedapp-west.png 400w,\n/static/bbfea47252aeacdfe781e8bea90f01c5/5a190/gettingstartedapp-west.png 800w,\n/static/bbfea47252aeacdfe781e8bea90f01c5/fe9f1/gettingstartedapp-west.png 883w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>and the instance of the getting started app running on east cluster\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/48c562ede008c3e9d1581dd6534c3d15/6bff2/gettingstartedapp-east.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAg0lEQVQI15WOyQ7DIAxE+f9PjBLSLamgVcsibENEpoKot15qafTGc/BYlVKQc8br7WCMxXq3GMYLpnmBPi2d03zDqK8Y9MG26/Pa/Vfm4WGfAco5B+89iAjCjI0ZKaVeIiIHmUEiCFzATD3bakUiQnvIGoN2J8YIFWLoptaKv2bff8YfpT7mhFRO9/0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gettingstartedeast\"\n        title=\"gettingstartedeast\"\n        src=\"/static/48c562ede008c3e9d1581dd6534c3d15/5a190/gettingstartedapp-east.png\"\n        srcset=\"/static/48c562ede008c3e9d1581dd6534c3d15/772e8/gettingstartedapp-east.png 200w,\n/static/48c562ede008c3e9d1581dd6534c3d15/e17e5/gettingstartedapp-east.png 400w,\n/static/48c562ede008c3e9d1581dd6534c3d15/5a190/gettingstartedapp-east.png 800w,\n/static/48c562ede008c3e9d1581dd6534c3d15/6bff2/gettingstartedapp-east.png 957w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this was helpful. As always please reach out to me if you have questions about this post or want to learn more about managing application deployments to clusters using Red Hat Advanced Cluster Management for Kubernetes and GitOps</p>\n<p>Thanks,\nRam</p>","id":"5126c64b-6fa7-51a0-a20c-0406442fa26d","frontmatter":{"title":"Multi cluster deployments with GitOps and Red Hat Advanced Cluster Management for Kubernetes","date":"December 15, 2023","tags":["OpenShift","Platform","Kubernetes"],"author":"Ram Gopinathan"},"fields":{"slug":"/multicluster-deployment-with-gitops-and-acm/"}}}]}},"pageContext":{"limit":3,"skip":3,"numPages":10,"currentPage":2}},
    "staticQueryHashes": ["1611934721","2366241629"]}