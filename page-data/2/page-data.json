{
    "componentChunkName": "component---src-templates-post-list-js",
    "path": "/2",
    "result": {"data":{"site":{"siteMetadata":{"title":"rprakashg.github.io","author":"RAM GOPINATHAN"}},"allMarkdownRemark":{"totalCount":26,"edges":[{"node":{"excerpt":"In kubernetes by default all ingress and egress traffic are allowed on all pods running in a cluster. From a zero trust security standpoint this is a bad thing because once a POD within a cluster isâ€¦","html":"<p>In kubernetes by default all ingress and egress traffic are allowed on all pods running in a cluster. From a zero trust security standpoint this is a bad thing because once a POD within a cluster is compromised attacker could gain foothold on other application pods running on the cluster causing more damage to company.</p>\n<p>In Kubernetes network policy resource allows us to define how pods running on a cluster should communicate with each other and other network endpoints. One of the common challenges that most customers face is that even after creating the required network policies it is often hard to identify whether the applied network policies achieve the desire network topology. Red Hat Advanced Cluster security for kubernetes provides a set of tools to help with this.</p>\n<ul>\n<li>Network graph (Helps you visualize network flows within your environment)</li>\n<li>Network policy generator (Generate required network policies based on established baseline network flows)</li>\n<li>Network policy simulator (Quickly preview the policies in environment before it is applied)</li>\n<li>Build time network policy generator (Shift left, create and apply policies from a CICD pipeline)</li>\n</ul>\n<p>Much indepth explanation of these capabilities can be found here in RHACS documentation <a href=\"https://docs.openshift.com/acs/4.3/operating/manage-network-policies.html\">here</a></p>\n<p>I got a chance to dive a bit deeper into this last week and my goal with this article is to share what I have done with the community. I wanted to experience these capabilities like any kubernetes developer would go through so instead of leveraging some of our internal pre-built demos I decided to build off of set of demo applications I had already built over last year. Everything I'm covering here can be found in this github <a href=\"https://github.com/rprakashg-redhat/rhacs-policy-management\">repo</a></p>\n<h2>Overview of Demo Applications</h2>\n<p>There are two demo applications that I'm going to use to demonstrate the network segmentation capabilities.</p>\n<ul>\n<li>Eventscheduler</li>\n</ul>\n<p>This is microservice which provides 3 REST Apis for Event, Session, Speaker resources. It uses hibernate/panache ORM capabilities to persist data into a PostgreSQL database.</p>\n<ul>\n<li>Graph</li>\n</ul>\n<p>This is a GraphQL server that mobile and web apps can use to read data and present it to users. GraphQL server queries all Event, Session and Speaker data by invoking the REST endpoints exposed by the eventscheduler microservice. GraphQL server also leverages Prisma ORM to query session reviews from a MongoDB database. Key goal here is to abstract away all of the complexities of data read and write from underlying sources from the front end developers and provide a consistent and standard mechanism.</p>\n<h2>Overview of Demo Environment</h2>\n<p>For the purposes of this exercise I decided to use AWS cloud. Containerized applications are deployed to an EKS cluster and for Postgresql I'm using RDS managed database service. Provisioning of EKS and RDS instance was done using set of terraform scripts which you can find <a href=\"https://github.com/rprakashg-redhat/rhacs-policy-management/tree/main/deploy/infra\">here</a></p>\n<p>To provision the infrastructure resources required on AWS follow steps below</p>\n<p>Clone the repository by running <code class=\"language-text\">git clone git@github.com:rprakashg-redhat/rhacs-policy-management.git</code>.</p>\n<p>Next switch the current directory to directory where terraform scripts are by running this command <code class=\"language-text\">cd rhacs-policy-management/deploy/infra</code></p>\n<p>Run commands below to provision the required infrastructure in AWS</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">terraform init\nterraform plan\nterraform apply</code></pre></div>\n<p>For Red Hat Advanced Cluster Security I'm using hosted ACS instances which is a fully managed offerring. We have lot of customers that are leveraging that because they don't want to worry about managing the infrastructure needed to run RHACS workload.</p>\n<p>Next I installed RHACS secure cluster components on the EKS cluster to see how RHACS can help implement network segmentation in my EKS cluster with kubernetes network policies. Instructions for installing secure cluster services on other kubernetes distributions can be found <a href=\"https://docs.openshift.com/acs/4.3/installing/installing_other/install-secured-cluster-other.html\">here</a></p>\n<p>Screen capture below shows all secure cluster service running healthy on the EKS cluster and cluster successfully joined to hosted ACS instance</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8b0b114e82a3dabcc3d3bda07c0dad97/e16b4/acs-clusters.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.499999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArUlEQVQY06WK3QqCQBCFfYiIgqAIerTqjUr3Ry2zFs11vbEn0xR3O2HaXnTbwMd8Z8444irgehSHoweXMDA/hEcYCOWgLADjweg+KONg3AehA33fE8c3ROcIpzCEM5nOsN3t8ShLSCmhVA6lFAqlhl0UA2P+dv1vLiWSNMNFpIjFHSLJ4MwXKxDG8c8Y87LuLNcbHF3yCW3bQmttqZ81qrpC0zT21nWddWPMDxpvUA4KCsSaSsIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"acs-cluster\"\n        title=\"acs-cluster\"\n        src=\"/static/8b0b114e82a3dabcc3d3bda07c0dad97/5a190/acs-clusters.png\"\n        srcset=\"/static/8b0b114e82a3dabcc3d3bda07c0dad97/772e8/acs-clusters.png 200w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/e17e5/acs-clusters.png 400w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/5a190/acs-clusters.png 800w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/c1b63/acs-clusters.png 1200w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/29007/acs-clusters.png 1600w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/e16b4/acs-clusters.png 2546w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Deploying the demo applications</h2>\n<p>I automated all the steps for building and deploying the demo apps to EKS cluster using a github actions workflow which can be found <a href=\"https://github.com/rprakashg-redhat/rhacs-policy-management/tree/main/.github/workflows\">here</a>. You will find two workflow files here <strong>1)</strong> ci.yaml and <strong>2)</strong> cd.yaml</p>\n<ul>\n<li>\n<p>ci work flow automates all aspects of going from application source code to container images. Application container images are pushed to container registry. For the purposes of this post I'm using github container registry and also leveraging buildah to build the container images. This workflow is automatically triggered on push when any files under apps directory are updated. All of the source code for the demo applications are stored under this directory. last step of the workflow I'm updating deployment manifests to inject new version of container image to deploy to EKS cluster.</p>\n</li>\n<li>\n<p>cd work flow automates all aspects of deploying container images to EKS cluster. I'm using kustomize and kubectl to deploy and configure application components on the EKS cluster. This workflow is automatically triggered when any files under deploy/apps directory are modified. This is where the deployment manifests are stored which is why I've set it up that way. Workflow also has a on dispatch trigger where I can turn on build time network policy generation using roxctl which is a cli tool provided with Red Hat Advanced Cluster Security that we can use to generate network policies during build time by inspecting the kubernetes manifests for demo applications.</p>\n</li>\n</ul>\n<p>I'm going to manually trigger the ci pipeline for the purposes of this post so we can build the container images for applications to be deployed to cluster. Pipleline completed without failures as you can see from screen capture below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d93ccde619da822adf02fbe83ed0182/f705a/ci.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABHklEQVQoz52QzXKCMBSFmVYRCBAiAVKINGAbQLQjXXTGRfv+b3U6icJYl118c39zcuY6abVDlBQgNLNQVmCbCoRJ/i+cujugqBokvMQ2l4i3AiErEN0wS/e5mZt8jo84Qu6RvbxaMYNpikpBvY/YNR1y+YY4lZBK27lUnY0sq+5ExY0CTt330MMZ3TjZR36UIhM7JKmARyi8kMENKPyIYUOoxdSuH19jEC9sAmoEBysom+vPhHKESYaIZXbB9SPL09rHakMWnt3AsvL+9hwjlIoaQcztjUjMIdQe58s3pq8fjNMFUvUgjKPpj2j1EY0+gvESNBdo+xPqdkAhW2vGEbJFXqrl+EaQlzX0xyf0YUKjT3ZuHK69cGF2ONezw18lFayxrf1WEwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ci\"\n        title=\"ci\"\n        src=\"/static/3d93ccde619da822adf02fbe83ed0182/5a190/ci.png\"\n        srcset=\"/static/3d93ccde619da822adf02fbe83ed0182/772e8/ci.png 200w,\n/static/3d93ccde619da822adf02fbe83ed0182/e17e5/ci.png 400w,\n/static/3d93ccde619da822adf02fbe83ed0182/5a190/ci.png 800w,\n/static/3d93ccde619da822adf02fbe83ed0182/c1b63/ci.png 1200w,\n/static/3d93ccde619da822adf02fbe83ed0182/f705a/ci.png 1493w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can also see that a new pull request was created to deploy new versions of the application as shown in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54c7ad304e8b034bd25453ea331970c9/37c35/pr.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkUlEQVQoz33RyW7bMBSFYQFpktbxJMuaRw6SSJuyPCbv/2R/IRXxqsjiwyG4OLi89PZxjr9PSLKaIMpYrHxefy/59f7B258Vr3Mu5zvv5Z2Xt8WPvLq11KLH2BOqd8h+QNkzyl7Q9kJ7uNK7O9KciQvJYr3/kVdYQ5QJklKRVi1x2ZM0jkSOhNWRsHZEtSOsB4JUsvLjH3lBXLGLS4JJmBLGOVFaEacVGz9iPdmGLDcBq23I2o//2f2fV0qDH+Zze6S/yPsvynak7C6kwpGKI1Fl8VONn6rZNlFsEsU6lmwm3+dE4ZnhxlQ6TdLULVnWkEtD0dh5FYU8zpJCk1YdadVTNj1GW2x7wLQWow2H7oASHZ7sHFmlWfshZW9o7JHGOBrrqI2jHe8odyVvD5TdkbIfqMyAPp1ox/FJjyPSObyPTchyG80S8Ukmb/OTc3EizLvZLtVsI/G0iwXBlE9yzm3Y4H3/zlTYiIJalBSyI6sFperQwxV1PFNpg5gmNwOH04nH48LtPjlzvZ95fF4RWvEXLO7uAajC/akAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pr\"\n        title=\"pr\"\n        src=\"/static/54c7ad304e8b034bd25453ea331970c9/5a190/pr.png\"\n        srcset=\"/static/54c7ad304e8b034bd25453ea331970c9/772e8/pr.png 200w,\n/static/54c7ad304e8b034bd25453ea331970c9/e17e5/pr.png 400w,\n/static/54c7ad304e8b034bd25453ea331970c9/5a190/pr.png 800w,\n/static/54c7ad304e8b034bd25453ea331970c9/c1b63/pr.png 1200w,\n/static/54c7ad304e8b034bd25453ea331970c9/29007/pr.png 1600w,\n/static/54c7ad304e8b034bd25453ea331970c9/37c35/pr.png 1810w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>and the container images for both apps are successfully built and pushed to github container registry as shown below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc6d225a18325482e21a731be757c67e/620ae/packages.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVQoz42S226DMBBE+f//bJMUgm9rr28w1a4D4aFSaukoCx4Gz4RpdRHGRljPsC7pbFzC0xCMG/NqCatoXIJ96YcmXjQJxhAm4wOs80icQTHpHCjhsRj4EPTeaiyMdaAYQURwzsP6iJ9nUI3zhPvs8DMvmFKuECIXRB6zwKWdc9K56f5VcxBSxtN6rDZgyq8HuQwTFhGXwflQUURbaj+1uXa9Lq3rntyfjPPIRUxY4+VSIGvbdmzb9mbfEShiea5nPctqMC8rHvMCzgX7DkwhEHwgWOu0J+cDAhFa62q87/tJa01f2HrX/VIKci7gnNH7pvrp6/bA/TGDEg8iI0TWyHz0eaAx2yXywYguL53kyBKl9Q21df09kGvh6KnU9uI9V+2v6qwn/P6+aVw9uvRI49OQGiS+dPtpSRWCGt7ud5RaBxIlZzBnNRKkr2uPfzE6fRkaaxFTQkqMGBOOP0k+XqH/x7B11akh/rE+GV51vy5YqGsritWUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"package\"\n        title=\"package\"\n        src=\"/static/cc6d225a18325482e21a731be757c67e/5a190/packages.png\"\n        srcset=\"/static/cc6d225a18325482e21a731be757c67e/772e8/packages.png 200w,\n/static/cc6d225a18325482e21a731be757c67e/e17e5/packages.png 400w,\n/static/cc6d225a18325482e21a731be757c67e/5a190/packages.png 800w,\n/static/cc6d225a18325482e21a731be757c67e/620ae/packages.png 1043w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next I'll just merge the PR which will trigger the cd pipeline and deploy the new version of demo applications to EKS cluster. Screen capture below shows cd pipeline running</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c05dabd5baffee59548afb00c0f8c7d2/2eb79/cd-onpush.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABFElEQVQoz4WR2XaCMBRF02rFgkAYkjDGEBDFOqz+/8edrhssbV/qw16ZVvY9uWF7o2HHK+x4mTle0Y0X9McrhtMNw3RHf7rhMN3duTl8IFMtwkRhx+UfaI/VZoQ5nFG0FmXbQ9UdUtlAVAay7iDKvVunqgHPKyejkQRc1IizcsEJm25EpYefg7xEEAtUrXWJdD+5QkU7IBQGeaExnj+RiBqJnIskTlzNwrLRUI1FuERXTpjKGmEi4fkxtrtkJuDwHri5H88EM7THtJ1cwu8eEH6UI0oV1l4A9rIGW3lgqw1e396fwqgnRWMRpcUiJWEmC2h7cunpmdTH1cZ/CiMJPfH3T5GQZwKqMuB5+WiHcBcoxX/CLyvQqyM2dDjsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd\"\n        title=\"cd\"\n        src=\"/static/c05dabd5baffee59548afb00c0f8c7d2/5a190/cd-onpush.png\"\n        srcset=\"/static/c05dabd5baffee59548afb00c0f8c7d2/772e8/cd-onpush.png 200w,\n/static/c05dabd5baffee59548afb00c0f8c7d2/e17e5/cd-onpush.png 400w,\n/static/c05dabd5baffee59548afb00c0f8c7d2/5a190/cd-onpush.png 800w,\n/static/c05dabd5baffee59548afb00c0f8c7d2/c1b63/cd-onpush.png 1200w,\n/static/c05dabd5baffee59548afb00c0f8c7d2/2eb79/cd-onpush.png 1256w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Pipeline completed without failures as shown in screen capture below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e908a9a1b2073742b37cc3aab614c03f/b7936/cd-details.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABE0lEQVQ4y6WTzW6DMBCEacOfwcY22A6kqIkSKT31/R9vot1AStSoNeIw8sX6NLszm7j+E9IEKLtnSeNxPF/h+hFFpZEW9Soll69vhMMJfjiC4EK1MF2PxgZkpcQur7HLq2gl/XhmZ03bs0ppUesOynhWWWu8Z4I/0/ufkvF0nUa9j01AcmjdAOMGdjkDoxzOoCVQTg6ldryX1cBZM1CTQ39AGz5QLEaOAv6ku3BoHJQNEMo+drcJqNs9rB8YXFQN3tLyKZTVQIJQbUjUy1yoaJcvgQSilHVHdQqomnYbUFnPUEpaSINsq0MCUdLksG46lNIgLeL6+BJIl0JANe1RSBtd8F9AwcV2DKIO3u+5ejq/v4A3L4E7i5fPRq0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd-details\"\n        title=\"cd-details\"\n        src=\"/static/e908a9a1b2073742b37cc3aab614c03f/5a190/cd-details.png\"\n        srcset=\"/static/e908a9a1b2073742b37cc3aab614c03f/772e8/cd-details.png 200w,\n/static/e908a9a1b2073742b37cc3aab614c03f/e17e5/cd-details.png 400w,\n/static/e908a9a1b2073742b37cc3aab614c03f/5a190/cd-details.png 800w,\n/static/e908a9a1b2073742b37cc3aab614c03f/b7936/cd-details.png 1155w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can see that the steps to generate build time network policies and deploy them to EKS cluster was not run because its driven off a workflow dispatch input flag. Reason for this is that first we want to see the experience of an application with no network polcies within RHACS. The other thing you will see in the pipeline is that I'm generating a diagram of all the networkflows using the roxctl tool provided by RHACS. This command <code class=\"language-text\">roxctl netpol connectivity map</code> is used to generate a dot file which is then converted into png format using Graphviz. Both the dot file and the png files are saved as pipeline artifacts which can be downloaded anytime.\nScreen capture blow shows a connectivity diagram that was generated from the previous pipeline run without any network policies</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2fb02e22f0df24651c826fbe6252973/cc155/connlist.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVQoz12QiW7kMAxD8//f2EWOtkmaw47txHEuvsVMdgbFChAoQBJBMpPgbj3xrgtShNGgokRlDmUFZcmVF1z9F3rsef3pPWc3wYvpJMSOJRlCHEiLI7pvvC2YvSXYmisGlCZ0zOjaXgrepNm+w7aJB+5bZJxqBr/QmgG3GHyMDGHGLB6XHMe5cOqWoGvlPFfO63orzboOPj4gz0VRwMPdZwnln40ih6qE2cO+3kqW1dC5lh/X0YeBaW7oQ0/nf+h8R3ae6Dik40D7vqmbWo3BqXe1QuzlFiMzG7l1kl16oag7o1O6otCu2/HTs/7L8GLbHTEZJj8wTjvjONN2nq82UTcN05QIPpHWFelEv/J7WpZkJewLAYtkl5Bs/Y39rHjio5saW1XYppGdZ/7d//6X/QuGbR4iUSIcmQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"connlist\"\n        title=\"connlist\"\n        src=\"/static/e2fb02e22f0df24651c826fbe6252973/5a190/connlist.png\"\n        srcset=\"/static/e2fb02e22f0df24651c826fbe6252973/772e8/connlist.png 200w,\n/static/e2fb02e22f0df24651c826fbe6252973/e17e5/connlist.png 400w,\n/static/e2fb02e22f0df24651c826fbe6252973/5a190/connlist.png 800w,\n/static/e2fb02e22f0df24651c826fbe6252973/cc155/connlist.png 886w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can see pretty much everything is wide open. Later in the article I'm going to trigger the workflow manually and check the flag to generate and deploy network policies and we will come back to RHACS and see how the experience looks like and also take a look at the connectivity diagram that was generated with build time network policies in place.</p>\n<p>I'm going to login to my hosted ACS instance and we will examine the network graph which is one of the capabilities within RHACS which helps you visualize network flows. I've selected the ekscluster and namespace where the demo applications are deployed so we can see traffic flows for the demo apps. You can select multiple clusters and namespaces depending on your environment and how you want to visualize network flows.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/486339489689f45b12c76f0fe0fce805/91953/network-graph.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVQY052NzUoCYRhG50YKTamwEsMWLYJuSOhaAp2xyXFfaRdQ3UAbq52WVlKmozPzzY9TUPidmCkNW7TohcMLDw/nUTKZdRLJJQqFPfSKjqqWKKplNK2MYRh/Uq0a6IcVippOST1gXzNQtnd2yWzkODu/4L8nJxL5MeFdgpLdzLOYTHN0fILv+7iuS/j6xnBkYVnzmOYw5ndu2/Y3ViTcIpleoVY/JQxDHMeJVyOxECL+9mBA4Pvctu9oXF3juV6cz4h6QsR9JZvLk0gtfwnHY0zTREqJ53lxIQgCOs0mrVYL1/VwHDEbE+JHOh1XVteyLCRS1Op1Ri8jGpc39LqDmTD6T71nut1HHjp97tt9PH8qFHMyZ2jyCc/alvFulcwuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"network-graph\"\n        title=\"network-graph\"\n        src=\"/static/486339489689f45b12c76f0fe0fce805/5a190/network-graph.png\"\n        srcset=\"/static/486339489689f45b12c76f0fe0fce805/772e8/network-graph.png 200w,\n/static/486339489689f45b12c76f0fe0fce805/e17e5/network-graph.png 400w,\n/static/486339489689f45b12c76f0fe0fce805/5a190/network-graph.png 800w,\n/static/486339489689f45b12c76f0fe0fce805/c1b63/network-graph.png 1200w,\n/static/486339489689f45b12c76f0fe0fce805/29007/network-graph.png 1600w,\n/static/486339489689f45b12c76f0fe0fce805/91953/network-graph.png 2549w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>One of the first things you will notice is that RHACS is showing the two deployments in the namespace have no policies and is allowing all traffic. We can click on the network policy generator button on the top right cornor of the screen which will allow us to 1) Automatically generate and simulate a set of recommended network policies based on a cluster baseline which is an aggregation of the baselines of all the deployments in the cluster. Network policies generated can be downloaded and applied to target cluster using kubectl. You can also compare side by side with existing network policies that might be on the cluster as well and 2) If you have created network policies on your own you can upload the yaml and preview how it might look like in the environment before you actually apply them.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 431px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1959929eb5e21d628b554d11f3f82c0b/9cb4e/rhacs-netpol-generator.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 180.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE/UlEQVRIx41Wy47cVBBtCYk9En/AhiVILPkhdiA22URikV+ADez5BlAQREgkg8KQ6cx0+t22u9tvu9tuv9q+9kGnbPf0JJMES0dVftzyqbr1uIMoU3CiEt6hBfXt7gg3LuHFJeK8Rp4XCMMQu93unSjLEoMgqTCzc7zcZLjeZJhYuciRmWFsZggShcPhAE3Toek6dIEh6J8RxnqNPM8xOFY1yqrGsUOpalSquy8VirKGUgpVVaFW70GtMFCqgpKPlUAW1kqMNDWN8b4WJIXCIVci407ynjplUSoMXNfFZDIR+oZhYDabIYoieJ6PNE0RRbH8RKka/qHC2GrD88JIMbVz3Gwz/L1MsPQKJEWNQVEUyLJMAs8YEHzW41iWEmwyTIVRhSirhNEtKgHDM9jv92KwZaHw7qsBmqZTa0FDifYZfzpgOpAVt/3i4gLD4VDkeDzG1dUVLi8v8fz5c9zc3ODZswvBeDJpbXbG6cEhSUQf0BBjRZaO48LzfZGiez5My0J8OJxCUHYhoLFzg0mStgbJkMaSQ4zlfIrh8AW01Rzaco7R9RDj0Uu4jv2m852xXvb6IAhDqLLAxPDx7Q+/wgprBBmwChScBNhGQHJs49ezOkdvqNcHYbhDnmUI4xRPX67xy9Vv+HN6ASdMoFsedNPDIc3fYPO2S2LYB5TXk/FjPLn5HbMbHbqmQdeWCHz/Xnb3QQwmSSI3qm4ZuOscP/84xMbwYBg6NE2T5vB/WJ52meVXCUrUjZKYsQRZjsxP5lifa1KWTXPSuctc2zFsd3kfxVgsV5jNF9D0NVaa0emGPCfKSiHLctiOCz8IYDsOuAeWZUu60bgwjA8J7OiIhbnDyo4wXQdYmHvo7kHul9YeSyvC2ovByqJHcRxLqAgS6hvIyeWmVthu1tBWS8ymEwH1taFjuZiLvt1spHms12usViuRjC+bCl0+xZB/IV3P82CaplQJ3RG3bFuaKr+jzvebzeYEGmUMT4ndM5RukmXiyj6KRLJTR3Es7YxtbLfbIy+KbnMa1F2qUD8lNg1yARnSsOc6sMwtLMuE6zqne8e2RLJET53nbWlDHCuFXabgHhT8tIGf1AjSGl5yiyBt4MQV7P1RhpnZDTN27DsuZ2kqM4QfcTCNtilemRxYGaZ2K683KWY232XSqSddt164BXbpawa5KW1M7rTSN/TmTGf8KiZ1pcQ77sGdTWGlRPs9gsBHH1eZxf08DkOEQYD9foftdou0q/+mbrt2X0m3BpXCcrmUjs1co84uzQFGsIOPRiPJOXZy3/fv7ZFnLteS8UTfnZms7QBrB1f/jgslpaJIJD1JzkdAn9hMYGY+2fUVMJ/PRSem0ykWi4UkMyXfOY4Dy7axCwKgr2W6TDasBMuyBKwIxooLWBF9lbDkKPkzGuaYxVlLu8OQhtqhr52Y9HVLo/SArPrnmjRgDdPFAv6T32D/9P3dGLZ/3Qh4ouCinh0X84f9MzK3LQsbw5BUWn7zFf766IO7Lhu6fmLSs2CHIfomew6mTN11GePRQ7z48vMzl+sa+bHC8ViiOFYojiXyokRRVsiKUhL/njwRo7z07x7g3y8+7Rh2BkdmjsejGK+sXA5F19sMl3oKN27PLecj84Te4KOH+OezT84MdqerdXh7eg2TCjyQ7tIKlbp/sDfdeWj14Gs8/fjDu1Pvfdfr35wP+Gw2wf6Px/gPTzayFYCOmZkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rhacs-netpol-generator\"\n        title=\"rhacs-netpol-generator\"\n        src=\"/static/1959929eb5e21d628b554d11f3f82c0b/9cb4e/rhacs-netpol-generator.png\"\n        srcset=\"/static/1959929eb5e21d628b554d11f3f82c0b/772e8/rhacs-netpol-generator.png 200w,\n/static/1959929eb5e21d628b554d11f3f82c0b/e17e5/rhacs-netpol-generator.png 400w,\n/static/1959929eb5e21d628b554d11f3f82c0b/9cb4e/rhacs-netpol-generator.png 431w\"\n        sizes=\"(max-width: 431px) 100vw, 431px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Screen capture below shows automatic network policy generation capability.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 398px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e1878aa4a5b39f5bd8bf453a69d38471/692d4/rhacs-gen-netpol.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 151.99999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEZ0lEQVRIx5WVu44jRRSG/SQ8ACKBhAgegwyJAImIiJSIkJdAIiEh2QCBCBAB7LK3GXtnZnfs8W0847H73tWX6u6q6v5QlT2z9qxXsCX9ffqU+vx9LnVO9VaZxssN6wPY7OutvvudZp1tkWtW23cre4nU3CKVhl09KRWiMm4/q9vtNxpRtWRNt0HdUigoFfhlS681ikH/iOOjZ5wM+jx+9JCjZ085PRnw9MljXvSPnT44PuKfRw8dxqMhm9W6pywLtKrRHfSU1iRJSpIKhMiIk4Q4TpwexTFFUaKUpqprGqUcrE0HdF3nCPOioGlqamMJlWIxG/PypM/p6QsW8ylHz54wOH7Oi/4Rvrfm0Lolu5XOU93RM8bww699Hvx17v6wTA1rYQhcUVqksmF1znAXb5J2VLeEP/7W5+c/BwzXC86uY+a+ZBGUzLyczGZ7a7RLdshbR6iNdoqXLfj+l+84X/YJvRuur+YufFmWb3hzCHeE1kNjWgfV1vz9x4wHP71k7XmMLi6YTKckSXIvX909bPbucugOQLs5AteXKaOzgLquCcOQNE2RUt4R1qpFGRxMC20HtbZe8rrKr8435yoIQ0y7yZkfhAerex0rno9WjJcJc08wuUkIRM3LmUdeNfSyPGd0MaaqKry1585gJjKm0ylKNaimodnC6pd+yWQZswwyZquE8TJmHZcM5x5xVtDLsgxtDKWULOKIie8z8QJWkWBsK75KufYFqzDDi3MiUbqDXSvtpLWtGoUxmjDJ6JVlgTIaZQyLNGbk+cx9QZhKgrQiKxvavWruF2IXkSjolUXh/tRoRVZJTtcr5lFALAuCIiMqc0RRswxL4qxy4fmpxEskaVHvEbuQrYeNC0HRdoaLMHChF02FqCV5U1E2NXldUynlZNk0DllVIVWDtDlWGi/JbQ6FC9kRtoZZHDIPYoariKtIMFpHnK8Chiu7nzp5fhMy8WJuhMDPM8IiR9YNy0DQy4Rw+bOERVMz8n0WsT0KOV4sWXg566ikbjSNMg637/cacBOybS3rvnXbyzMXrqgkptWYtnVVNK050B22SO0d7Gx0RbHDMS2lI+w6wyQMmUchRis62oPGh3BHaIuSSZtcBV1LWVdcJQk3IuLcv6Jq9B3hrrz/o33CqnIVtKGtM+EqPY1CClkhimbP+G0e74Us5GvCcRgwDHzGgU9S5i7dNpft//awKEhKSVHXmxHU1Lzy1lz6CcPrhNlacBMVe6G/LYdhmtMrihyR5+6iqaSkLEu8JCaIU1ZBihcJN77+C1UlN4S383Az73in9XqKb/TKzkOtDTep4mwp8TPFWig8obgMayezytAaQ1EUznutNXaG3jrSbQfz/Ntv6H/yob1TDPOw4fcz21YVJ9eSaVAzWJRMfdvDrQtnNpsxmUyI4xg78uz83CUcfvEZzz94b+NhpVoa3brx7qS2HdK5K9TCJt1eEW3bbTrHGKzd7gU1/vpLBp9+tJ/Dd16WcOvhxVefc/zx+/wLYyYAh2CGUM0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gen-netpol\"\n        title=\"gen-netpol\"\n        src=\"/static/e1878aa4a5b39f5bd8bf453a69d38471/692d4/rhacs-gen-netpol.png\"\n        srcset=\"/static/e1878aa4a5b39f5bd8bf453a69d38471/772e8/rhacs-gen-netpol.png 200w,\n/static/e1878aa4a5b39f5bd8bf453a69d38471/692d4/rhacs-gen-netpol.png 398w\"\n        sizes=\"(max-width: 398px) 100vw, 398px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Wouldn't it be nice to automatically generate policies and apply them to cluster during build time in a CICD pipeline rather than doing this after application is already deployed to clusters? Who doesn't want to practice Shift Left right? :)</p>\n<p>I'm going to manually trigger the cd pipeline and check <strong>generate network policies</strong> option to automatically generate network policies during build time in pipeline and deploy them to cluster as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b2153a512c325b5b785fba324dca4bdb/9b1e2/cd-gen-netpol.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.000000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAElEQVQY032QzU7DMBCEcyiCkthxsv6J4zh1SCpAiUqRkBDi/Z9rkN0aAQcOn2bWuzuStyDjoDoPbT1KTthXAnvW4J41ye9uy3+5uauwi1x9UZOF7gN4Y8AyQkMoD6EGxH58q4ROlLX6phIKnGyaEbIHbzsUrR5SkZeycnKw44IhHKHsAa1yoDgblzMyhnWpb/1yCfwbFLWsJaSbMW0fMOEEO5+hwwnkV8hxS9C4QsTab9CHDdPzG8hOl8DMz+BaO6jhCOpnNN0EJj0YDUm5CslPdsLL+yce1le48AShHIoc8iuw1hDGQvXj9TYm3YtF4iy55A118OdH2GVBo1z68hfskJTWZcgIJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd-gen\"\n        title=\"cd-gen\"\n        src=\"/static/b2153a512c325b5b785fba324dca4bdb/5a190/cd-gen-netpol.png\"\n        srcset=\"/static/b2153a512c325b5b785fba324dca4bdb/772e8/cd-gen-netpol.png 200w,\n/static/b2153a512c325b5b785fba324dca4bdb/e17e5/cd-gen-netpol.png 400w,\n/static/b2153a512c325b5b785fba324dca4bdb/5a190/cd-gen-netpol.png 800w,\n/static/b2153a512c325b5b785fba324dca4bdb/c1b63/cd-gen-netpol.png 1200w,\n/static/b2153a512c325b5b785fba324dca4bdb/29007/cd-gen-netpol.png 1600w,\n/static/b2153a512c325b5b785fba324dca4bdb/9b1e2/cd-gen-netpol.png 1880w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Screen capture below shows pipeline running</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bb61f918f263b8eac9839735446c5c31/129e9/cd-gen-netpols-progress.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVQoz42S61KDMBCFo5VbAiHh0qSBQpFWB9///Y6TTVF0FP3xzZnMbs7uyYRZ16E9DRDlEbkKFNrsstfDussLptsb9LFHZXqo1lFBVhaFtuHy3WA1CrVP/WLYugmmm6DbjijrE3TjMM4LhnmB6WfIdqQef1aNQ2XOpL6fjO7DPcydR3SX20dcj6otjBvBZY0s10iERpprCFkjEQoxL5GIEsmqG5g9X2mb7dreiBcVYi7xGGU4RBkenlLCn/dgsjK0/vaNctVgur5ieF4oamMHHGIezFf9zXAbNRjaEJNLihClBeGN/gP76Tt4FWVLfB/4F++Ewr3PtN70DwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd-progress\"\n        title=\"cd-progress\"\n        src=\"/static/bb61f918f263b8eac9839735446c5c31/5a190/cd-gen-netpols-progress.png\"\n        srcset=\"/static/bb61f918f263b8eac9839735446c5c31/772e8/cd-gen-netpols-progress.png 200w,\n/static/bb61f918f263b8eac9839735446c5c31/e17e5/cd-gen-netpols-progress.png 400w,\n/static/bb61f918f263b8eac9839735446c5c31/5a190/cd-gen-netpols-progress.png 800w,\n/static/bb61f918f263b8eac9839735446c5c31/129e9/cd-gen-netpols-progress.png 1161w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Pipeline completed without any failure as shown in screen capture below and you can see this time network policies are generated and applied to cluster.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70901a255ef964958f5dc6656ac76764/914ae/cd-gen-netpol-status.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAABc0lEQVQ4y52U646CMBSE2RXkTu9QRNGoYbOa7Pu/3WxOWRBjFNYfkxZIP2Z6TuvpXQtZbpHxErmo3MhkhcpsIJRFJir3fqm85trhcL7eLaR5wgyiTCIptPvJUnnatJDVFikzdx8KWeLUXaCqBqswhR9l8MN5ee3lG+evH9jtEdq2MPUe3DSIUg6ha+TCOOCHH+EziGflNccOm/YMrjcQpnFieoMgysF1Da4t0kIhKSRW68QtovGZvGbfoTl0Y1SKTvu4jgtwZVGI0kGjjM/CHFBVO9S7k3M4VLqQtgdqC6bouUKYFCPwFdgjR0Mlh7aZAkkEjFK2zOG0h24VtmNkkjA14lz8H/jMYcoUgihbFnkeWLsqvxX5EViDqb4wuSjhh+msy1kgiVqHwDSfRn/bIR3DITYdr/eBFFf2fZgxjSSXs7FfAsVf5KHS5JDaZwrtFY+a30NlXUHIJcWmM37vLl7ukPaOKkznOHDX1+3WeYT2Dn8BwHqfKH+VcE4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd-status\"\n        title=\"cd-status\"\n        src=\"/static/70901a255ef964958f5dc6656ac76764/5a190/cd-gen-netpol-status.png\"\n        srcset=\"/static/70901a255ef964958f5dc6656ac76764/772e8/cd-gen-netpol-status.png 200w,\n/static/70901a255ef964958f5dc6656ac76764/e17e5/cd-gen-netpol-status.png 400w,\n/static/70901a255ef964958f5dc6656ac76764/5a190/cd-gen-netpol-status.png 800w,\n/static/70901a255ef964958f5dc6656ac76764/914ae/cd-gen-netpol-status.png 860w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can also see the artifacts created by the pipeline which include the generated network policies, connectivity diagrams (dot file, png file) as shown in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9eb21157b4cfcada0c64335dfe2dfbae/019a6/cd-artifacts.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAy0lEQVQoz5WSUW+EIBCE6UV7EkFAF1wVq7lLm9z//4FzgVaTvuHDF9hkmczOIogjhjHCcwSFGU1rIJWFVC5TNxp1o4oR0/6N3keYYYLzM/oQYWmB80s+u56h3ViMCMsOS3MuPH9hGFdox7A0/YkFtIbQdmUIXh/ZXWs8nJ+gDOFTanxUDW61vIw4rCrjYYhhBobUPaoLuVV3dfYLZQMSSTTMex7zqEtJE54Zng5twLL9YHu+coalYukd8ZZF0/2fYFrI71LGyw6P3/AG7Fm83sf/8PAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"artifacts\"\n        title=\"artifacts\"\n        src=\"/static/9eb21157b4cfcada0c64335dfe2dfbae/5a190/cd-artifacts.png\"\n        srcset=\"/static/9eb21157b4cfcada0c64335dfe2dfbae/772e8/cd-artifacts.png 200w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/e17e5/cd-artifacts.png 400w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/5a190/cd-artifacts.png 800w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/c1b63/cd-artifacts.png 1200w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/29007/cd-artifacts.png 1600w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/019a6/cd-artifacts.png 1818w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Here is the new connectivity diagram looks like with network policies in place.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 492px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/343186ffc390c201c3ce9625b861a746/5c6e9/connlist2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABB0lEQVQoz22RiY6CQBBE/f/fE1zPFQQPBI9Bw7Wh3qZBPDbbSaUnQ9XLpBhJdFMU4BxkGSyXEIa94lisVnYngkBsIrHdiiiCw0E4py5rY6zRO/BygSSB+XwAisWih8URfK8gDGATwnot9vs+8wEcDn93XZtE00BdlZzdieu94Jzn3W7bzokeoSH7fOH/8zC3OdHpi63bMj1M2JyDt+8vwPBCtS0qClRVL5WlSSorVNz2qu+Jmho1FfppzKOn17LGMNbIOrMe8hx8HyYT8DweP8L6FNNp3+tsJsZj4fvDnfA8ddmh/1FZyt1ucter3G73UpLIHY9yaUq3TVmGS1O5OP70WtYYxvoF3AgarFQeH4YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"connlist2\"\n        title=\"connlist2\"\n        src=\"/static/343186ffc390c201c3ce9625b861a746/5c6e9/connlist2.png\"\n        srcset=\"/static/343186ffc390c201c3ce9625b861a746/772e8/connlist2.png 200w,\n/static/343186ffc390c201c3ce9625b861a746/e17e5/connlist2.png 400w,\n/static/343186ffc390c201c3ce9625b861a746/5c6e9/connlist2.png 492w\"\n        sizes=\"(max-width: 492px) 100vw, 492px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can see from the above diagram now we only have connections allowed from graphql server pod going into eventscheduler microservice pod and on specific port protocol.</p>\n<p>Lets also now switch to my ACS instance and see what the differences are when we did not have any network policies. From the screen capture below we can see that now ACS is showing that the deployments now have network policies in place</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/300e8c91a8e439e5ad16043a7be2bf6d/08c33/netgraph-with-pols.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACE0lEQVQoz4VSy27TQBT1R1SKGsUPNQoNpG1KCi0SSIDgc2CDRF7iAxD8CgtYIVUg1iyg0FIpSfOygxOH2DOecRqbvA6aSVJYkZGOdOdaPvfMOVfZ1nUcZbNIplJQEyo0TYdu6NA0DbquwzAMqJom76JeByWd2cNWKo2N2CaePH0G+6cDs2Oi2qjCMi30ej2cVRowTROO46Df7/8Xyr0Hj3D/4WNc38ni5avXECeKfmM8HmM2myEMI0ynU9mfz+droewfHOLwzl0k9C2Uyi8QRRFc1wWlFL7vg/o+XI/A8zwQQtZC2d0/wPaNXWzE4nheKGEymaDb7UoCoXA2n4PyETxClgOYHCLr5dB/a6kwd+tIKswXy5JQeNHpdKRacaaTiZwuf3ZdMEIkAaULIiLrBZSdbA5CZVw1UCiVpXfigwiDcy59ET1JyDiI2UK9UoNHKTj3EQwZLodDBDxAMAwWhNncbahGEvnlk0WapmVhFIZS4V9CBjIYwLG74DzAj28mzr6a+PzlBO+Pj1GrXUDJ7N2EwGZCR764IOw16mien8OqVTH0XNkjngceBOi223j39g0+fPyExoWNVt1BvdnE99NTWJYFJZXOSMJYXL0iHNgW2tUKWpUKBra9IFx5yBh6/b4MjgdMPjkIAowuL6VFipG8tlzsOArFMsIwlAmLVH+J9WHsKsUVGGNgnIESCiKxWhuKP9fXvKmvbM6VAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"netgraph-withpols\"\n        title=\"netgraph-withpols\"\n        src=\"/static/300e8c91a8e439e5ad16043a7be2bf6d/5a190/netgraph-with-pols.png\"\n        srcset=\"/static/300e8c91a8e439e5ad16043a7be2bf6d/772e8/netgraph-with-pols.png 200w,\n/static/300e8c91a8e439e5ad16043a7be2bf6d/e17e5/netgraph-with-pols.png 400w,\n/static/300e8c91a8e439e5ad16043a7be2bf6d/5a190/netgraph-with-pols.png 800w,\n/static/300e8c91a8e439e5ad16043a7be2bf6d/c1b63/netgraph-with-pols.png 1200w,\n/static/300e8c91a8e439e5ad16043a7be2bf6d/08c33/netgraph-with-pols.png 1570w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>and the generate network policies now show no policies need to be generated.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 437px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/93899a031c42c18d73e4b013985f8418/5a428/genpol.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 174.00000000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAYAAACU9ioYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAELUlEQVRIx61Wy27kRBT1F/AFINZI8wH8BDu+gS2ayUNCQoifYMcCiT1L0CwQYgNCIckknfSkW52O3d1pv5/lssuux0FVfiSTBGUCKenonrJdx6det8ra2dnFq51dDHHgQ/3lqx3s7e1hf3//Uezu7sICACKAUgI1uljwLlYKY2F1DcYYWNOAscbwpuniwHWxctpi4VFMr0tcXJeYbXu+pZi7FEnJkWY5bNs2cBxn5LZ9w1erFaqqgtVyCS4UuJBoDO/QmroAawWEeBi8j1JzziGlgNUa27WxPHRBcG64GD/sfpJRjoi0xvUQ47JFUHS8agSsKAywmM+wXjlYOw4c+wolKZDEERpWGw4ljXhKOa5ChoVf42JbwYkY7JDhdE3h5y3qVsLKaIt0RANdT8rG8CHqZ0Ut4BOOgHD4BUdYdlxHDf0uoQLWwk3hRCV8IhBShbBSiCqYqOu3eVwDIZUmBqVEUIoOVCJjChO/hVVkCXjDkCUxjg8PMHt7jtM3RwaL+YWJ07NTXEzPcDY5wZujQ5wcH5o2Q2k15wweBawkSVBVNYqCwPU8JEkKzw8MD8IIrucjLwpQWqEwkYKQEkJIqH6d0qoGZzU2pBes6xp5lmJ+cY7J5ASOfWncaSfnkxOkSYKHilLKYCjrXMKK4wSSNzi59PHtD78jIUBYAutMwaeAVwI1N81HgbtCsufrQnYO9fLwYoLXf83x+vQ3HCwncOMC9jaAsw1B62Z09FAZBbXDNE1BynJ8+ev0F/w5/QOziY2VY5v1SYriRlDdd3pPsOwFBwP2LMdPP07hbkPY9hWWl0vkef6vLodnm6IX1JtaT0zNGFrOzfbTRddvCwy0aiUiwtFwZcAloHgDJ+X9GDYNbGeF9XpjloXruhCCY3F5CSWl2XrKQJnJCYsGM7eCHdY4W5dwsxZJ6GHmlbCyLEOeZSgIQUkpwiTHtZ9i7SXYBimugxR+XCBICmzDDG6UI04JvDBDkhEIzkxyUZxh7pFeMM/Rts04Y63OMlJC9FnmHS46rlOb5mY5oXO+CGgnqNGYraRM99B/8D7QQyFNG3kjeONQ9WP1NHTL5pZgFEVmHLqZ/C8O7wjGcTwulWcRvNvl/y3YTcqzCubPK6i7fFvw6bMs73d5WNhPcTe67Nu941DvYZ0MuiTRo+fsEeh2sqkw2+Y36Usf5tq22SkD+rq+Eej3Y/6T0mC8QXDR5cMaffqiFIwrXAbMnLnmZlByk0XCgqNqlck+Os2Zm0V/o+g2vzTB//47HH/+GaykF9Sn/s+nGY4cirfbCnOvxmRDTZoiTKIociyXS2w2G9MjQkjnWHTCiy+/wMFHH3QO9fjpC5OQykR9aWr7uuG8n807XTXDILru2t/s4/jTF7ePgIcPoMfKIHj11Uscvvh4cFjeO3jeG4PDr3fw9ycf4h8NYW8raH/KUwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gennetpol\"\n        title=\"gennetpol\"\n        src=\"/static/93899a031c42c18d73e4b013985f8418/5a428/genpol.png\"\n        srcset=\"/static/93899a031c42c18d73e4b013985f8418/772e8/genpol.png 200w,\n/static/93899a031c42c18d73e4b013985f8418/e17e5/genpol.png 400w,\n/static/93899a031c42c18d73e4b013985f8418/5a428/genpol.png 437w\"\n        sizes=\"(max-width: 437px) 100vw, 437px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this helps</p>\n<p>As always reach out to me if you have any questions about this post or want to learn how Red Hat Advanced Cluster Security for Kubernetes can help you in your organization.</p>\n<p>Thanks,\nRam</p>","id":"a355f0b0-f4b3-54e4-8ef0-81040c1966d1","frontmatter":{"title":"Network policy management with Red Hat Advanced Cluster Security for Kubernetes","date":"January 22, 2024","tags":["Security","Platform","AWS","Amazon","K8s","Kubernetes","EKS","ZeroTrust"],"author":"Ram Gopinathan"},"fields":{"slug":"/network-policy-management-with-rhacs/"}}},{"node":{"excerpt":"Overview I wanted to test mounting Amazon Elastic File System as persistent storage for containerized microservices running on kubernetes and realized there are lot of infrastructure pieces that mostâ€¦","html":"<h2>Overview</h2>\n<p>I wanted to test mounting Amazon Elastic File System as persistent storage for containerized microservices running on kubernetes and realized there are lot of infrastructure pieces that most developers at customers I work with don't really understand. Additionally kubernetes clusters and underlying infrastructure components are usually managed by platform/cloud infra teams and often as a developer you are at the mercy of those teams to enable and support these capabilities at the infra level. Its important for developers to understand also what's required at infra structure layer and that's exactly what this post is intended for. Also I hope this helps developers who are tasked with app modernization and containerization to test these capabilities without much road blocks and helps them have appropriate conversations and tradeoff discussions with platform/cloud teams</p>\n<p>You can find all of the content I'm covering in this post <a href=\"https://github.com/rprakashg/tf_eks_with_efs\">here</a> Github repo. I'm going to use EKS to demonstrate. What I realized as I was going through this journey like a developer would is that end to end information you need to have is scattered in multiple places and can be difficult for an enterprise developer to put all of that into perspective. I also figured I needed to have a repeatable process so I decided to just automate all aspects of infrastructure setup and configurations using Terraform.</p>\n<p>Summarizing below at a high level what you would need setup and configured at the infrastructure layer before you can use EFS as persistent storage in your containerzed applications running on Kubernetes:</p>\n<ul>\n<li>\n<ol>\n<li>Obviously you need a kubernetes cluster to run containerized application (For demonstration I'm using EKS here) and worker nodes in cluster are provisioned in private subnets and spread across multiple availability zones within a region</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>EFS csi driver installed and configured on cluster. Since I'm using EKS here this is accomplished using EKS addons</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>EFS file system provisioned. This <a href=\"https://docs.aws.amazon.com/efs/latest/ug/creating-using-create-fs.html\">doc</a> really gets into details about configuring EFS filesystem. I highly recommend reading it.</li>\n</ol>\n</li>\n</ul>\n<p>Diagram below will help visualize a regional deployment of EFS with EKS cluster.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9c4dcdff932dbb6c050435ff1a16abc/78958/eks_with_efs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEhUlEQVQ4y32O7U9adxTHz70/QLhcihRRnu7lXkBAEamAIgI+II6JD7U1alsfmuqW1a5dnQ+ggFwedivQdinWNlvbNemWpkuztbPt7Oq2NMuSZUv2Ytm7vdlfsKRv984Fa5a92ovPyTn5nvPJAae/f9w+NM9Dyx6yNHWJtNES0oXWkK43+f+EEq/pTSBtXw5RPXMC1tkpAKYXwFTaKTB8ohcKZ3HjjTDSl48h/eYQospHkaHch/SbgwcM7GeGchjpN988mAeQ/nYUr4tdFhjajiEY/VsAbVd1LR1bDTF8mZDUFygly1vEdOYYTmWacHjrDzDkehGdDSM624cMWRsOkT2gs1GczvYgKjOCTFfkiF6OiAzNpxAwzgmkj89W6XgfYS0GCEXqpawm/Yi4+hJAn1+vMm+0korU11Ll+jOSTGxjmsxngvqCQ6Zc/1yiXN+RKRIPsNpCGadiYyKDYxyBbbRLuPAzgG/L3O27zqyacqi+vkhaFTk47Llmb+jYMubNfJXdXpTZ6nik8Vzzq3xbbMlWkLU0FkgbvSGkqAJN6BfPCw2eYQRMaFoANGDWYsxkLs33wBRIqnIuLZU31rIbXG1T6UI/xGkFxO2H6/lGrZpfkdlLC4OQcdfBAitn+CN6De8n9EuzQoP7OALTSEbo3t4D0+VfutsK3/M/FEcKk3w5AHN/VrdsfNekK/6e/vSDuYsPr5y5CGf2FH2Fx2p98bdLxVzs7adXp5Ow8KtOs/5Uao13CGn3aQS0awo5430iSO6I21Y+tn6Z6i+dSGfbYOUnXcdqWQpLr2purY3P3+VGz0HsL3V47UMZLL6qLq3OTtznjsYh/iNdl7wvs8Z8QspzGkGlGJZahSruEUkuPbBA7x2XeP5eQ3XqOUUuP5OquG0Wjt9thqN3jqi4rxjJ4jeEintCw9Q9O0Ruu+Tpx0bF6kOSWWl/LaTdM4hdbhceWt+RymNfmBvHyv6axQdWcm1Xr1x6QYi5Xdo0fdNtmtpqFWd2adX7u4Qk/UJPz91y2iZuesXcNqOMPSHZFa+w4gLaOYnoWFSkzZ0TVXPXCXn6nKxmjSdrUpuEmkuKVInrUjm/QtYmzh+q9Op0SqRKlolqjiMVqQsyZfIjQpM/K6o46OZJBIxrAKnfywqpjRMCajOMt0yPiOpT/aj2kyiuKZ1B5LddGI6eY1LYwWEvALpLMwLVvTdw2+oAapkaFuluhHBqY1KgvpgXMq5BBEaHH5klbjDkAUInAbyBcYHXfwr5Omdwn/YdLDg0JujKWwY7M9aTgYkw4YY98HVP4pUdr/8kCs0AsByAmfDsu4B1BBHb3gUGKgT2hgh0Dw5gwUgUDw714cOGPHjGnOJAxugPcuZx36yr2rUDEBwJ452RKN5/ahAazBFg6BCw3s59F7COgIB1BBDrCODG5gBONXRgaosXU5vdmLl1GJMoVEiirLLIGYnlsEeFa/URTG1xYxqLFzPY/bjREcDZ11QcgooQ25cdBMbmIG46gGlsx7tHFzAAmQiAFLZ3v4uxjvZ/dyoP/Pe24voHz7E6EEnQWZgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"eks_with_efs\"\n        title=\"eks_with_efs\"\n        src=\"/static/d9c4dcdff932dbb6c050435ff1a16abc/5a190/eks_with_efs.png\"\n        srcset=\"/static/d9c4dcdff932dbb6c050435ff1a16abc/772e8/eks_with_efs.png 200w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/e17e5/eks_with_efs.png 400w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/5a190/eks_with_efs.png 800w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/c1b63/eks_with_efs.png 1200w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/78958/eks_with_efs.png 1320w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When EFS is provisioned we are creating 3 mount targets one for each AZ and use the private subnets in VPC where worker nodes are running for the elastic network interfaces (eni) that will be provisioned in our VPC. For cost and performance reasons this is recommended. Mount target provides an IP address for an NFSv4 endpoint at which you can mount an Amazon EFS file system. Additionally a security group is created to allow ingress traffic from private subnets where worker nodes in my EKS cluster are running. In addition to mount targets I'm also creating an access point to allow application access. Check out this <a href=\"https://docs.aws.amazon.com/efs/latest/ug/efs-access-points.html\">article</a> on Amazon EFS access points for more details. For more details on how EFS file system is provisioned checkout the <a href=\"https://github.com/rprakashg/tf_eks_with_efs/blob/main/deploy/eks/efs.tf\">efs.tf</a></p>\n<h2>Deploying EKS cluster with EFS csi addon and EFS filesystem</h2>\n<p>We install and configure EKS and the required and infrastructure components by running Terraform scripts. You can find the Terraform scripts <a href=\"https://github.com/rprakashg/tf_eks_with_efs\">here</a> These terraforms scripts are assembled from various examples available in terraform aws github modules.</p>\n<p>Clone this <a href=\"https://github.com/rprakashg/tf_eks_with_efs\">github repo</a> Run command below to install and configure EKS with EFS</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd tf_eks_with_efs/deploy/eks\n\nterraform init\nterraform plan\nterraform apply</code></pre></div>\n<p>When <code class=\"language-text\">terraform apply</code> command successfully completes you should see an output like the one shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ac419cc9b2c38fa485953f44a501f0b/077b7/tf_output.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUElEQVQoz4WRbW+CMBSFC+J4KRBRB1oQSOt4MY5EGBPj9P//q7Nw3cyWLPPDyUnvaZ/23rK2bXE6ndB1HXa7HZRS5OO6KApsNhvKh2FA0zRgjEHTNPI/dTgccByO6N977Pd7SClR1zUBR3iSJDifz7TnG/iv+rcel48LhuOA5rXBVm3RtR1pzMqipOx6uVItz3N6tRCCFIYhXRoEwQ2YZAkylSFVKUQmMI8WSFUGkQvIQkLkMaI4utUyge3LFmmaEnTUer0mvwPNxILxPAVzNUxmBozAALMYjMUU7IlRpns6mMMwmRuPW57FM3CPwzZtGBMD5tSEbdlwLAeu45Jzm8PjHnzug3MOy7LgOM7dx5pt29B1HUxJRb8plaT5VHVFHq1WiOOYWgqjEL7vg7v8F8g0TYK5rvsDqBSiKEJZlqiqiuazXC7p0Kjx0KiHrX7pEyOqxoZ4fgkbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"tf_output\"\n        title=\"tf_output\"\n        src=\"/static/3ac419cc9b2c38fa485953f44a501f0b/5a190/tf_output.png\"\n        srcset=\"/static/3ac419cc9b2c38fa485953f44a501f0b/772e8/tf_output.png 200w,\n/static/3ac419cc9b2c38fa485953f44a501f0b/e17e5/tf_output.png 400w,\n/static/3ac419cc9b2c38fa485953f44a501f0b/5a190/tf_output.png 800w,\n/static/3ac419cc9b2c38fa485953f44a501f0b/077b7/tf_output.png 1166w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can update the local kubeconfig file by running the command <code class=\"language-text\">aws eks --region us-west-2 update-kubeconfig --name \"admincluster\"</code> If you used a different region and cluster name be sure to use values that matches your environment.</p>\n<p>We can test connecting to the new cluster by running the command <code class=\"language-text\">kubectl get nodes</code></p>\n<h2>Deploy a Sample application to EKS cluster and mount EFS as persistent filesystem storage</h2>\n<p>Now that we have a k8s cluster with EFS all configured using terraform we can deploy a sample application pod and mount the newly created Amazon Elastic FileSystem storage as persistent storage</p>\n<p>Grab the <code class=\"language-text\">efsid</code> output variable value that will be printed after the <code class=\"language-text\">terraform apply</code> is successfully completed and update the <code class=\"language-text\">StorageClass</code> resource defined in <code class=\"language-text\">sc.yaml</code> file under <code class=\"language-text\">deploy/k8s</code> directory and replace the value of 'fileSystemId' parameter as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 620px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/71caf0691ae21b5cbdf0be062dbc9982/2a195/sc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACMklEQVQ4y3WTyY7UMBRF6x96AaJScTzbSZxUUqmh1SPNsEECiS0S//8XB8WVHqCbxdFzrPj6vsGrLvUcT0dSSmit0doRQo1zHmsddd1knPVP67ZNxFgjpUJK/Rerpm2w1tJvt3Spo08dh8Oevu/y3m6amKaJYRhynJkv996z2WxesRJCUJaCMFzSj3tOu4Hb/cD1rqdvIs5oorNYY5BqdiQpiiJTluUrVlopKqlw4zX+8ICut1glaZzJRKszoiyzyOzi8fDL9ZOg0ppKCHTdE6db2hjpokdWVd6Xlcjx5SGxUJZzmv91eIWf7nDbS7zV1EZSLy5ra/LPs8MPxYaL9Zp32W1JudTuWXBxaJuB+vhA3F0Rphvc9kQdAlMbaLzJZVBKMmjJrxT5Ft1Z7N+UnXNZMKSB/acf7B++c/jyk6bfcTN23E89Q/RMTSDVnntv+d0G6kq83ZRZcK6Xjol4/EzY3+P3H3Gx5fO+J0WH8BWm0VRa8H5dcLEuWL/RkBeCAhM74uksGPuJQxu5HBOuNdSjz3Ejls5uNhTFmTx/xcI8h08OQ0s8fsLvbmi6kSEl2mgYh8huiIxzys6SvKULLrONHm0lJipMUIiqZBVCQMmzYDg8EA4fCaevuOmOZjgy9mN2exgbujHQTxFfG7SSaFkhREmlBJUUyxwqxfxaKqXRsUeFlNFz1IbGW5xRSFuhvUSaKqdWLLx6es8fBcX6A5uFeT3P3To/s3ONHuNbzXhsyh8qlZKkmhPmowAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sc\"\n        title=\"sc\"\n        src=\"/static/71caf0691ae21b5cbdf0be062dbc9982/2a195/sc.png\"\n        srcset=\"/static/71caf0691ae21b5cbdf0be062dbc9982/772e8/sc.png 200w,\n/static/71caf0691ae21b5cbdf0be062dbc9982/e17e5/sc.png 400w,\n/static/71caf0691ae21b5cbdf0be062dbc9982/2a195/sc.png 620w\"\n        sizes=\"(max-width: 620px) 100vw, 620px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Create the <em><code class=\"language-text\">StorageClass</code></em> resource by running <code class=\"language-text\">kubectl apply -f deploy/k8s/sc.yaml</code> and run <code class=\"language-text\">kubectl get sc</code> to ensure storage class was successfully created. You should see an output like what's shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7b857f9f721a17ae06535d3594020f4/33c15/sc_result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVQI11XMwUrDMACA4Wia2dXUNOuSZrUtdqOS1YPi9KAMRBQvnnwDjzvspODr/4KC4OG7fmIYBmKMxPXIOq44qd9Imy9090Hi90i346DckVR7EvuJeL3g8F0gW4WrHYUpsNb+yPMc0fc9WmuapmEcI+F0RGVLQrth0d1ypJd0qzvOzrdYd0naltSbQOEK7MxijEEphRDiVwiBqqrw3rMIHuOuyebPTMsHJmaLSG/I/RPZ/JHj2QvpVcf0fvIXSCn/hd9NwE3uAbSZpgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sc_result\"\n        title=\"sc_result\"\n        src=\"/static/b7b857f9f721a17ae06535d3594020f4/5a190/sc_result.png\"\n        srcset=\"/static/b7b857f9f721a17ae06535d3594020f4/772e8/sc_result.png 200w,\n/static/b7b857f9f721a17ae06535d3594020f4/e17e5/sc_result.png 400w,\n/static/b7b857f9f721a17ae06535d3594020f4/5a190/sc_result.png 800w,\n/static/b7b857f9f721a17ae06535d3594020f4/c1b63/sc_result.png 1200w,\n/static/b7b857f9f721a17ae06535d3594020f4/33c15/sc_result.png 1463w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Create a <code class=\"language-text\">PersistentVolumeClaim</code> and an application <code class=\"language-text\">Pod</code> that mounts the EFS as persistent storage by running <code class=\"language-text\">kubectl apply -f deploy/k8s/pod.yaml</code> In the sample application I'm using an init container to create a file <code class=\"language-text\">hello.txt</code> in EFS storage that is mounted as persistent storage and in the main container I'm just simply displaying the contents of <code class=\"language-text\">hello.txt</code> file. You can see the full source for pod.yaml <a href=\"https://github.com/rprakashg/tf_eks_with_efs/blob/main/deploy/k8s/pod.yaml\">here</a></p>\n<p>Here is a screen capture below from my environment I was using for this post that demonstrates this</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bb4858fa7264ff74fcd822e974c5d463/f793b/efs-pod.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVQI1yXMQUvDMBxA8X/SuqRpamdSs9ROhVo2QWpREARvfhYPm4rf//bEefhd3uHJNE3knEkpcdVn1mGLrp8p/BPN5RsuvFJdvCDmETELUi/IcobcCs7WNE2DtRbvPc45ZBiGU/wTYyCExKpKSLEm9TtiumPT7/DtlnLVIfocaRViBa00WmuUUojIv3EcmeeZ/f6em+uetntAwhcqHlDxiOqO6PhBuflBx29UPiCfjuJdcGWNbzxVVWGMOQ1/AZjTSkhHZvJFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"efs-pod\"\n        title=\"efs-pod\"\n        src=\"/static/bb4858fa7264ff74fcd822e974c5d463/5a190/efs-pod.png\"\n        srcset=\"/static/bb4858fa7264ff74fcd822e974c5d463/772e8/efs-pod.png 200w,\n/static/bb4858fa7264ff74fcd822e974c5d463/e17e5/efs-pod.png 400w,\n/static/bb4858fa7264ff74fcd822e974c5d463/5a190/efs-pod.png 800w,\n/static/bb4858fa7264ff74fcd822e974c5d463/c1b63/efs-pod.png 1200w,\n/static/bb4858fa7264ff74fcd822e974c5d463/f793b/efs-pod.png 1404w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>If the pod dies and comes up in another node and since we are using a persistent storage all the data would still be available for the application pod when it comes up on another node or when additional pods are created when a horizontal scale out event occurs.</p>\n<p>Looking at the EFS file system in AWS web console we can see that an additional access point for the application that I just deployed was created.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/35c19e87d829651ab9f24bf7ae0207f4/b8256/efs_aws_console.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABCUlEQVQoz4VR2W6EMBDL//8j+0LZZTlC7osEVzOA2qqVOpKVzCGP4wjrHEKMqLVCKQ0fAiiO4/gTFO1okHpDTAmlFORc0FrjngghcJGG53lB/zHAGMNL9n3/Rf5FKBFjRM4ZKSUWRH3hnEcIkZNtU7DWoe4V/4UymhcTWbqUHq1BEDPJpdNYB+s8w1gLpQ1WZaDNCbKHLHHeQyrJfRJE+Q1xb6ytYXxPGJ5PKK2ZkBTIb4SOCL2H9wExF7bFX0RUo7u4fSGFNODC6Z0PET5mrrd6W3B5WCvc+EKZJ34qzRBSjj8JpdJ4y1PdsGx4vFYscsO8rlilxCLleT46jF3HL6HeNC/86/3U4xNvkh/5lKtSKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"efs-app-access-point\"\n        title=\"efs-app-access-point\"\n        src=\"/static/35c19e87d829651ab9f24bf7ae0207f4/5a190/efs_aws_console.png\"\n        srcset=\"/static/35c19e87d829651ab9f24bf7ae0207f4/772e8/efs_aws_console.png 200w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/e17e5/efs_aws_console.png 400w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/5a190/efs_aws_console.png 800w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/c1b63/efs_aws_console.png 1200w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/29007/efs_aws_console.png 1600w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/b8256/efs_aws_console.png 2017w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this helps, as always reach out to me via any of the contact methods listed here if you have questions about this post.</p>\n<p>Thanks,\nRam</p>","id":"f69cbec1-89d8-5e8f-92da-07ef494f1270","frontmatter":{"title":"Using Amazon Elastic File System as persistent storage for Kubernetes workloads","date":"January 15, 2024","tags":["EFS","Platform","AWS","Amazon","Storage","K8s","Kubernetes","EKS"],"author":"Ram Gopinathan"},"fields":{"slug":"/efs-with-k8s/"}}},{"node":{"excerpt":"Introduction In this post I'm going to walk through deploying Azure RedHat OpenShift clusters with Pulumi and Infrastructure as code. I'm going to assume that you are familiar with Pulumi. If you areâ€¦","html":"<h2>Introduction</h2>\n<p>In this post I'm going to walk through deploying Azure RedHat OpenShift clusters with Pulumi and Infrastructure as code. I'm going to assume that you are familiar with Pulumi. If you are new to pulumi I recommend you check out this getting started <a href=\"https://www.pulumi.com/docs/get-started/\">guide</a></p>\n<p>Pulumi templates are the fastest way to deploy infrastructure to your cloud environments in a consistent and repeatable fashion. Check out this template <a href=\"https://github.com/pulumi/templates\">repo</a> to see a list of available templates. Since there is nothing available for Azure RedHat Openshift I decided to create one. I still haven't contributed this to the template repo yet but for now you can find this in my github <a href=\"https://github.com/rprakashg-redhat/pulumi-aro\">here</a></p>\n<p>Before you can get started with this you will need to login to azure portal and request quota increase for compute in EastUS region where we will be deploying the Azure RedHat OpenShift cluster</p>\n<ul>\n<li>Standard DSv3 Family vCPUs = 150</li>\n<li>Total Regional vCPUs = 200</li>\n</ul>\n<p>Increasing limits by VM series for Azure Red Hat OpenShift installation is necessary to ensure that your Azure Red Hat OpenShift cluster has the resources it needs to operate efficiently and reliably.</p>\n<p>Login to Azure from CLI</p>\n<p>Create a directory and cd into it as shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir my-aro &amp;&amp; cd my-aro</code></pre></div>\n<p>Create a new pulumi project by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pulumi new https://github.com/rprakashg-redhat/pulumi-aro/tree/main -s rprakashg-redhat/my-aro/dev</code></pre></div>\n<p>Above command will prompt to enter configuration values, you can keep the default except the pullSecret which you will need to obtain from console.redhat.com/openshift/downloads\nSee screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/675eb5d1d4dc3b89d402e74c983759aa/497e1/puluminew.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVQoz52S2W7bMBBFqY2kKJnWykiwahu2HxpHceUNeWz//6dOQRUtggJB4z4czBAc3LmcodgfDnRdi857hJ4I0hNCnxDpK0J/Q+gDoQkwqSZLUzJjyN9htCZVao7+LPL1mnyzIXUtad+QrhzZlydM35CtHNZVWNcRLxZEHmPmmBQFsbUzybL4cy/atzfKacJ+faY9X+nGE3Z3wLSOZdejyopkuUR6ypLEWlRdo51DNc2vvG3nOlXViPp2p50mupeRfrej9AV5TpgkM0EcE/goJVEUEYUhQoiPqS5XmsuF/nik3G7JhoHMd/aO8hy5sHOe+GemBiklIgg+FnSXC910pjudcMcXiv2eZr3B1vW8BK3kPPD4X85+U5/PVOM4u+zGETcMJEqhpCT4rMh7nr7/oL7fqW43uuuVfrtF+Q3676D1PLeHBIvVgC4rYj+rhcUWBTrLCMNw5mGHdVPSupp8YQgC8bjA3yxdgacZWnKboZQliuR/C/4E3hb2+wb+FtgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"puluminew\"\n        title=\"puluminew\"\n        src=\"/static/675eb5d1d4dc3b89d402e74c983759aa/5a190/puluminew.png\"\n        srcset=\"/static/675eb5d1d4dc3b89d402e74c983759aa/772e8/puluminew.png 200w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/e17e5/puluminew.png 400w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/5a190/puluminew.png 800w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/c1b63/puluminew.png 1200w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/29007/puluminew.png 1600w,\n/static/675eb5d1d4dc3b89d402e74c983759aa/497e1/puluminew.png 1891w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can open the current folder in visual studio code to see that the project was bootstrapped using the template. You can also see the stack file (dev) that is generated. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 621px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fba2361c313008384ea7556400fb8046/3075e/pulumiprojectdir.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVQ4y6WTa3KCQBCEOYiCAiqrrK4sr0BYH6AmVsz9b9OpGUIqMYlR8+OrKVjo6pnptbSOkaYZqCq1ZKJInxH98O4r9H8cJ7CapsFqtYIQs/fDGEEwxWQimCAQfOb7I3iedwGfsU6nE4xpBfO8gFIRhkP6YPSB749h2w56vR76/T7X37CyrG03lAtstw2MWbPDTqjDcQYsZtv2Raw0TaG1ZodF8Yi63iEM53Bd/z7BoiiQJAlmsxAPDyVD7lzXY1GCnh3Huc1huExh1g23LaXCdCohRIggmHEdDIbXCZZliTzPoZc59rsjnp5fcDy+oq4PiKIMSiVcaYM09D8FSSzWGmMhUZk19vsDNpua49Juu43D1S0bY0Bz9McCcq44NlIuOIOfN331UsghLYVckKOOTqyrN22ZOM9dJ3azIAWb7mB7tUb/F6QZVlX1Lcj3Cr4BhUSW8ckiMbkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pulumiproject\"\n        title=\"pulumiproject\"\n        src=\"/static/fba2361c313008384ea7556400fb8046/3075e/pulumiprojectdir.png\"\n        srcset=\"/static/fba2361c313008384ea7556400fb8046/772e8/pulumiprojectdir.png 200w,\n/static/fba2361c313008384ea7556400fb8046/e17e5/pulumiprojectdir.png 400w,\n/static/fba2361c313008384ea7556400fb8046/3075e/pulumiprojectdir.png 621w\"\n        sizes=\"(max-width: 621px) 100vw, 621px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Run command below to set the Location on azure-native pulumi provider</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pulumi config set azure-native:location EastUS</code></pre></div>\n<p>To deploy the Azure RedHat OpenShift cluster with pulumi we can simply run <code class=\"language-text\">pulumi up</code>. Cluster provisioning takes about 50 minutes. You can see output from my environment in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9d5d4ca84fe78ef4a94a0b68dea3319d/60a48/pulumiup.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVklEQVQ4y51U2XLiMBAcSbYlX/iQbfCBAduBEEKS/f+P6y0NC0sqL1v70KWSNO4ezfSYfGNQVQPyPEOe5zDGQErJUEqBiOB5Gk2zQxiGEEI87qUQ8LSBbxOOY4iAMG4HfH5+4nw+43q94uXlBbvdDpvNhoMc8fX6zmdO9A5bWJjSgI4EkndCT8CWloOHYcB+v8fhcECWZQ9VR7jb7aG1/pvJHQGBekf0yFCg6zpc3i+c2ev5lTM9Ho/YbrcoigKe5+Hj44PF2rZlsUAHiKMYfuqD5idCUoSqrDAdJozDiGVaME8zpmnC5XLhNYoiFuv7nsvQNA2qqkK7bhEVEWh4IrSJvalogjACFAmQL0Akvj3tuRmuBHe4828lGLIeaZGADDEp10TSz1r9K+I0hylWUDaETENIX0OFITwd/B/hvnvF2J5QlwPMqkCYFTC2QbQq2H9C+pAqgJTBbVUBFMPdqZ+EhS5Q6hKZv8LKSxCqBEomCIIC2lhoXSKKNgijlvd+UCDQJbRpIMTNRko+vUYaH22/Rz90aPsOVW2RJDGEIIYLco2Y5zPq2iJNE6wcVgnKIkecp0iONcwhhAoVSPgCdVVhmReM48iWcSZ35q7r5kE4HQ6wtnp0VriOk7w1cU+g8d7MgNC1HXtuWRacTifG29sb7621TPL19YvPnLmdB525y7yEzvRt9OY/hC7Dpm4wzzMHu9XBGXi9XvPMuklxIo68rmueHke6bjaI8gi0oxtciaQvOWA7bnmsHKmD+9hNSJqmiOOYx/D+9/kGn2CmEOESQUUefgPIcVjHnrb8QAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pulumiup\"\n        title=\"pulumiup\"\n        src=\"/static/9d5d4ca84fe78ef4a94a0b68dea3319d/5a190/pulumiup.png\"\n        srcset=\"/static/9d5d4ca84fe78ef4a94a0b68dea3319d/772e8/pulumiup.png 200w,\n/static/9d5d4ca84fe78ef4a94a0b68dea3319d/e17e5/pulumiup.png 400w,\n/static/9d5d4ca84fe78ef4a94a0b68dea3319d/5a190/pulumiup.png 800w,\n/static/9d5d4ca84fe78ef4a94a0b68dea3319d/c1b63/pulumiup.png 1200w,\n/static/9d5d4ca84fe78ef4a94a0b68dea3319d/60a48/pulumiup.png 1325w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After the cluster provisioning is complete we login to the openshift cluster using the default kubeadmin credentials created. Run the command below to retrieve the default kubeadmin credentials</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export CLUSTER=arodemo\nexport RESOURCEGROUP=aro-rg\n\naz aro list-credentials \\\n  --name $CLUSTER \\\n  --resource-group $RESOURCEGROUP</code></pre></div>\n<p>Above command will return a JSON payload just like what's shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n  \"kubeadminPassword\": \"&lt;generated password>\",\n  \"kubeadminUsername\": \"kubeadmin\"\n}</code></pre></div>\n<p>Next we can get the OpenShift console URL by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">az aro show \\\n    --name $CLUSTER \\\n    --resource-group $RESOURCEGROUP \\\n    --query \"consoleProfile.url\"</code></pre></div>\n<p>Launch the console in a new web browser and login with default kubeadmin credentials. Screen capture below shows OpenShift console after successfully logging into it</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/81cbc6e29d98d7ba0ce66b07819b9010/010dc/arocluster.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2UlEQVQoz2WR23LaMBCGfduShGGKwdbRknzAh2CDMZkhjeENehXCTd//Mf6O5Nik7cU3K++ufu/+8i6XC859j8v5jL7vcX776ej7N3SHPQ7tDu2uxmHfoDu06No9jmN+b2kcXbtzeP58jo0QWPo+ZrMZvi/W+LYIMPtB8OCg9/OS4nFJMfcZnnw6sBzi/BNPSI0oMlgHFKuAY1H/wqL7jcfmiof6fcCdr5jV73jaXeF3H1gePly0rI43BC83rI83eFXTIskrxFmJZFOirLao6waCcTBCwSn7D/Yv5I5n4g2ENGBcubhiCiGLQHkEwhUCIrAmwsWRdcixDtkA4X/VvDQrIaPYCTqERtO9otq2yDYVhIxBmZrqlEVQOocxFbTOwYWesHUvTvLpw0bCJPKiRpIWbuJIJVN9FMyyCs/bPYqihjaZ61E6df1u5bHZXrRjq7SCyp5BuAahAoRKUCpdtEiTQ6cltBURGiERU80JcjEKKuedVAlWnz6F1iNu3I9kZNzlgMrBv4C5fPjVQ7vaOKUTiwyOLycUxRbW38FXg5AKqCRxK1MZgesMLEohk8qtmsQGQmXwsqx0PkyGmxSn1x5FOfg45oOQoSxSdMcTyqoB5feHGrezj/IHY/I0l7mmG/kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ocpconsole\"\n        title=\"ocpconsole\"\n        src=\"/static/81cbc6e29d98d7ba0ce66b07819b9010/5a190/arocluster.png\"\n        srcset=\"/static/81cbc6e29d98d7ba0ce66b07819b9010/772e8/arocluster.png 200w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/e17e5/arocluster.png 400w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/5a190/arocluster.png 800w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/c1b63/arocluster.png 1200w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/29007/arocluster.png 1600w,\n/static/81cbc6e29d98d7ba0ce66b07819b9010/010dc/arocluster.png 1714w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Logging into azure portal we can see aro cluster and vnet in <code class=\"language-text\">aro-rg</code> resource group as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/65f20554ed6408638ed0a4ddaed20692/cdef6/aro-rg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjklEQVQoz51T2XLbMAzUT8QSSZG6eemwI8uepp3p///VdgCJbp0mecjDDggSWGBBMrvf7zjPEypdwpQKpRRQojiQQxb50/qv/z/oLCOyKQZoJZlMFgVKKaGkgNEGtdHQSsEYWpdcWJfJqr2RY6+pDLLbdYV3FmMMWOYRXdsgeI/btmGwDssYYYyGdQHLFDGPEV3XcQzZMQTOb9sO6+WM7PevN1zOC7wd4OyAtq4w9D2vm0qja2quLPIXliTyE2RxYktj2P0cpTwkT9ExGUkTpz3JxwnWR9ieOvCIwaOpK54xkbdUpK5YLhWkXJohjSybx8CEFMzDlQK2axGd5X1K2NZX/Hz7weSXZcZ2XdnS+f228f7epUAWnNsHrOTjtiiALsvbnrukrtzQI3rHhYvTy0NqUkVkTEhJyUlPxrYNpjBBmhbqCE7PgtZU/D0ehLd15YtIwSSZfNMOKPsIrQ20+pjkI2T0FIKzLDsNlsFVU+XiScVXyK6XhW8pyXr+KQni09/xHtnoLOTh/Ev6XfwBEAlGaxk6FbkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aro-rg\"\n        title=\"aro-rg\"\n        src=\"/static/65f20554ed6408638ed0a4ddaed20692/5a190/aro-rg.png\"\n        srcset=\"/static/65f20554ed6408638ed0a4ddaed20692/772e8/aro-rg.png 200w,\n/static/65f20554ed6408638ed0a4ddaed20692/e17e5/aro-rg.png 400w,\n/static/65f20554ed6408638ed0a4ddaed20692/5a190/aro-rg.png 800w,\n/static/65f20554ed6408638ed0a4ddaed20692/cdef6/aro-rg.png 1163w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>and all the cluster infrastructure resources provisioned in <code class=\"language-text\">aro-infra-rg</code> as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/485e3d1a226d65145d9f368903e45788/67fe0/aro-infra-rg.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB50lEQVQ4y3WT6ZKbMBCEeYckgGEQh4RAF5aNWdubs/L+79QpjdfrTdX6xxTSAJ+6W1Km4wnBWRzjHt5ZtA1BUI16V96qLFCVxdv8Nr7PH/3HOPPrCdt6xHqIcGZmWFNXoLpCQ4RWCMi+5b4QAkPXom8FBBE6IdA2DVfqERGyQ4ysbtYjl7cGfddCSYm4j5BSwZsZXSsgleb3qUaloLW+PccRzkzouh7Z9fdf/Hy9sl0zT6xSDj1D4uIxtAKjHCD7DnSPYVeCqsf4Yy/T2mPxlkEpvzL/xnlMxkPpGVpJVjSNClTtPq0UUaq62iFzJsBMSbrknO4fJUWTVgxMCx0PEa+XMy8cvMN5O+HltPK/aQ+2dWVotvgJ3lq2xau8yXfG8O67WSNYAzUMDNsHz5BnarMYArq2wa7I35vJsjUj4iGAxABqBKjMn0L+A7pgsR2P6ETDoKSyKgpYP2OMEZX0aEYP6hSadKQ+ZPZZZW4fsPeOs7oHW+U53OKgTy8MpCmCxsC7yErSOX1qefuOGBxn9A4scszWYlg21CqA9AJSSeUIqu8b9zk000vEPErkX788MixyGOch4wV1Uqj3IOVAbXKRbtJz29n5esGfXz/4rKUMEzDd30EOaLVF3c8gaUC9ZuDNbvnU8j+KimhU6FpwcwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"aro-infra-rg\"\n        title=\"aro-infra-rg\"\n        src=\"/static/485e3d1a226d65145d9f368903e45788/5a190/aro-infra-rg.png\"\n        srcset=\"/static/485e3d1a226d65145d9f368903e45788/772e8/aro-infra-rg.png 200w,\n/static/485e3d1a226d65145d9f368903e45788/e17e5/aro-infra-rg.png 400w,\n/static/485e3d1a226d65145d9f368903e45788/5a190/aro-infra-rg.png 800w,\n/static/485e3d1a226d65145d9f368903e45788/67fe0/aro-infra-rg.png 1101w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can run <code class=\"language-text\">pulumi destroy</code> to delete all the cluster resources. Be sure to do this after you no longer need the resources so that you won't incur any unnecessary charges in Azure</p>\n<p>Hope this was helpful and helps you start getting hands on with Azure RedHat OpenShift. If you have any questions about this post or OpenShift please reach out to me via any of the contact methods listed in my blog</p>\n<p>Thanks,\nRam</p>\n<h2>Resources that helped me creating this template</h2>\n<ul>\n<li><a href=\"https://www.pulumi.com/blog/how-to-create-and-share-a-pulumi-template/\">https://www.pulumi.com/blog/how-to-create-and-share-a-pulumi-template</a></li>\n<li><a href=\"https://github.com/pulumi/templates\">https://github.com/pulumi/templates</a></li>\n</ul>","id":"06d11f9c-9f1d-59c1-b273-8576fd5d3137","frontmatter":{"title":"Deploying ARO Clusters with Pulumi and Infrastructure as code","date":"January 12, 2024","tags":["OpenShift","Platform","Azure","Pulumi","Infrastructure","IaC"],"author":"Ram Gopinathan"},"fields":{"slug":"/deploying-aro-clusters-with-pulumi/"}}}]}},"pageContext":{"limit":3,"skip":3,"numPages":10,"currentPage":2}},
    "staticQueryHashes": ["1611934721","2366241629"]}