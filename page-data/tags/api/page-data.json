{"componentChunkName":"component---src-templates-tag-js","path":"/tags/api/","result":{"data":{"site":{"siteMetadata":{"title":"rprakashg.github.io","author":"RAM GOPINATHAN"}},"allMarkdownRemark":{"totalCount":1,"edges":[{"node":{"excerpt":"Kubernetes-style APIs provide a powerful, declarative approach to managing infrastructure and applications, enabling automation, scalability, and consistency. These APIs follow a resource-centricâ€¦","html":"<p>Kubernetes-style APIs provide a powerful, declarative approach to managing infrastructure and applications, enabling automation, scalability, and consistency. These APIs follow a resource-centric model with well-defined schemas, making them extensible and easy to integrate with custom controllers and operators.\nBy leveraging reconciliation loops, they ensure that the system state remains aligned with the desired configuration, reducing manual intervention. Additionally, Kubernetes APIs promote interoperability across cloud and on-prem environments, fostering a standardized ecosystem for modern applications. Their self-healing nature, combined with role-based access control (RBAC) and auditability, enhances security and operational efficiency, making them a preferred choice for cloud-native development.</p>\n<p>In this post I'm going to walkthrough how you can use these same patterns to build APIs that are rich in functionality and brings the benefits that we've come to love about K8s APIs. For this post I've come up with a sameple scenario to demonstrate. If you are a infrastructure/systems builder you might be familiar with the concept of golden images which are basically standardized operating system images that you want to use for deployment of systems across the private, public clouds and even at the edge. We are going to build a service that allows consumers to declaratively define a golden system image and the service will build the image.</p>\n<p>At a high level here are the steps.</p>\n<ul>\n<li><strong>Design the API:</strong></li>\n</ul>\n<p>Start by designing the API first. For this post I'm using swagger/openapi.</p>\n<ul>\n<li>\n<p><strong>Implement a custom API server:</strong> API server handles all CRUD operations for API resources defined by the service. Since API servers store state we are going to use etcd to persist all the state.</p>\n</li>\n<li>\n<p><strong>Implement a controller with a reconciliation loop:</strong></p>\n</li>\n</ul>\n<p>Controller watches the resources and ensures that the current state matches the desired state. This is done through a reconciliation loop</p>\n<ul>\n<li><strong>Implement a scheduler:</strong></li>\n</ul>\n<p>Since building system images are long running tasks, we will need to implement a scheduler system that will scheduler image build tasks on workers.</p>\n<ul>\n<li><strong>Implement workers:</strong></li>\n</ul>\n<p>Workers run the image build tasks and report the status</p>\n<p>Lastly we are not actually going to wireup the tasks to do the actual image build, instead we will just mock the behavior.Intend really is to break down the journey at a high level so you can apply these patterns to scenarios you all are working on. So lets get right into it.</p>\n<p>As we begin with API design using OpenAPI, we'll leverage OpenAPI code generators to automatically generate types, specifications, client, and server packages. To get started, install the OpenAPI Swagger Codegen using the command below. Additionally, the service will be built in Golang. While the patterns apply universally, this post focuses on implementing the server in Golang.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">go get github.com/deepmap/oapi-codegen@v1.15</code></pre></div>\n<p>I designed the API using Swagger Editor. The screenshot below shows the new Image resource which includes familiar Kubernetes properties such as apiVersion, kind, spec, and status, among others.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/75211069851b6088c259438a94fd64b0/7161f/image-resource.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 111.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAADHElEQVR42pVVWZbaQAzkNhkwtvG+7zY2DGFmkkly/5NUSjL2kIX3ko966pZpdbVKEhvHtvGSpih8H27gw6c19yZMy5yt+Rv2f/Hf7TeGaeEUx7imGS5Ni74oYdoW9vs9LMuCzQst7u9hH24+68O3BlQnURwLlF2GostRjRXyPlcESYCkShCmIbImRZRHCLMQESG+uIgRxL7G0IAmF6nj4q0u8TI0qIsEXuTrIcdzlKk+3/w3kKENxz5gCiOcghB1RDZcGztDIfmRoArjwy7+Nd9LQJsBDS5yz8O1KnAsc0x1DS/0cHAPODgzbMdWxmJd39U8il+eahjGHPw+hxbFqYYC4+uA/nOH7kpcWlRThXqq0b/0um4vjX5r+a051Sh4RnIswYXtZqEqNwgj+UFGcZIymddNhphCiJWDOUUTYYq+QFqnyNpMv8mlItAacEvabuBh+j5hIEthMb6POH456l4ZjsK2QnksUfKy9vYC2QdpwPPu/GSbyF0PruMgIrOEN0tJpFW6Mouy6KMOWZtLfS5WBSNU5T3z14chjkGE1I9Qpbkq/PTpidhie8OivGJrqBjLfqmEjbDb88mx6+I61JjaEkMz50fyGJex5kbYpixsWYtPvgtrYS+/kxd5kfeRwx3peomP6lwj4UHNF1WUpIs41ama7VitYskF8hsRSgSVUtrIMBC4zGFWprj8uKC/sGSmjnbAcKVAzx2OtM3YsKxG+nuF+MfXI8usR5zG8BhjFkWSTZaeqPyVyr4NvLlRO32b0LEuRWlRU54pz83bXFkKO9nrwGCsVeU2ijAlzFHow2EnOL6jHeGzrxernXGbLLvt7heR7jrFVnbPbLeao8tjLUneylsHiAiSM2VFNrKWl6xDw/pjOMxtdy5LtHmhPaxKEqKcTB1RVayIEBXROqoeTBs+mYuWQ7blkD1wAEhrJeUtIOehBpeA9Vw2Puffw4BS1Lkf4H0ccemoVhLrVJG86bQhlrW0lk4cCvAwoMmADov6dD6jYh6lhJaqX/4/1nl453sY0GBBOwcO2GlCkefzfNvt2Je31vpP/AQ328oT84NGMgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Resource\"\n        title=\"\"\n        src=\"/static/75211069851b6088c259438a94fd64b0/5a190/image-resource.png\"\n        srcset=\"/static/75211069851b6088c259438a94fd64b0/772e8/image-resource.png 200w,\n/static/75211069851b6088c259438a94fd64b0/e17e5/image-resource.png 400w,\n/static/75211069851b6088c259438a94fd64b0/5a190/image-resource.png 800w,\n/static/75211069851b6088c259438a94fd64b0/7161f/image-resource.png 1182w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next, I scaffolded a new Golang project and created an <code class=\"language-text\">api</code> directory at the root. Inside <code class=\"language-text\">api</code>, I added two subdirectories: <code class=\"language-text\">spec</code> and <code class=\"language-text\">v1alpha1</code>, with <code class=\"language-text\">v1alpha1</code> serving as the initial version for resource. We'll use the OpenAPI code generator installed earlier to generate the specification and types from Swagger, which will reside under <code class=\"language-text\">v1alpha1</code>.</p>","id":"8a4c253f-b242-59e7-87eb-211adbff1b25","frontmatter":{"title":"Implementing Kubernetes Style APIs","date":"February, 2025","tags":["api","kubernetes"]},"fields":{"slug":"/k8s-style-apis/"}}}]}},"pageContext":{"tag":"api"}},"staticQueryHashes":["1611934721","2366241629"],"slicesMap":{}}