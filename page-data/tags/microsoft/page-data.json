{"componentChunkName":"component---src-templates-tag-js","path":"/tags/microsoft/","result":{"data":{"site":{"siteMetadata":{"title":"rprakashg.github.io","author":"RAM GOPINATHAN"}},"allMarkdownRemark":{"totalCount":3,"edges":[{"node":{"excerpt":"I've done quite a bit of work on windows containers on openshift and decided to write a 4 part series to deep dive into this. So here is the break down of what will be covered. Part 1 which is this…","html":"<p>I've done quite a bit of work on windows containers on openshift and decided to write a 4 part series to deep dive into this. So here is the break down of what will be covered.</p>\n<ul>\n<li>\n<p><a href=\"/windows-container-support-in-ocp-1\">Part 1</a> which is this post, we are going to cover how to enable windows container support and add windows nodes onto cluster. We are also going to deploy a sample application to test</p>\n</li>\n<li>\n<p><a href=\"/windows-container-support-in-ocp-2\">Part 2</a> we are going to cover using persistent storage and go over some of the usecases and scenarios that you might run into in real world</p>\n</li>\n<li>\n<p><a href=\"/windows-container-support-in-ocp-3\">Part 3</a> we are going to cover autoscaling windows workloads specifically custom metrics autoscaler as HPA and VPA is still not supported for windows containers yet. We are also going to cover scaling windows machineset</p>\n</li>\n<li>\n<p><a href=\"/windows-container-support-in-ocp-4\">Part 4</a> we are going to cover monitoring and observability options for windows workloads. We will examine some of the gaps that exist today for windows workloads and some approaches to address these gaps</p>\n</li>\n</ul>\n<h3>Prerequisites</h3>\n<p>Before we can enable windows container support on the cluster we need to configure Hybrid networking. Run command below. Read more about this <a href=\"https://docs.openshift.com/container-platform/4.13/networking/ovn_kubernetes_network_provider/configuring-hybrid-networking.html\">here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc patch networks.operator.openshift.io cluster --type=merge \\\n  -p '{\n    \"spec\":{\n      \"defaultNetwork\":{\n        \"ovnKubernetesConfig\":{\n          \"hybridOverlayConfig\":{\n            \"hybridClusterNetwork\":[\n              {\n                \"cidr\": \"10.132.0.0/14\",\n                \"hostPrefix\": 23\n              }\n            ]\n          }\n        }\n      }\n    }\n  }'</code></pre></div>\n<h3>Adding windows workers to Openshift cluster</h3>\n<p>I have automated the steps to enable windows container support and add windows worker nodes to the cluster using an Ansible playbook. Check out the full playbook <a href=\"https://github.com/rprakashg-redhat/windemos/tree/main/install\">here</a></p>\n<p>There are two parts to the paybook</p>\n<ul>\n<li>Install and configure Windows Machine Config Operator (WMCO)</li>\n</ul>\n<p>All the steps to install and configure WMCO are automated in this script <a href=\"https://github.com/rprakashg-redhat/windemos/blob/main/install/tasks/enable-wmco.yaml\">here</a>. Script is pretty self explanatory. One thing to call out is that when we create the namespace where windows machine config operator is installed, we are setting a label named <code class=\"language-text\">openshift.io/cluster-monitoring</code> to 'true', see the jinja2 template snippet below. This will tell WMCO to also install and configure prometheus windows exporter on the nodes and perform all necessary configurations to ensure openshift cluster monitoring prometheus server scrapes metrics exposed by the windows exporter.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: {{ namespace }} \n  labels:\n    openshift.io/cluster-monitoring: 'true'\n...</code></pre></div>\n<ul>\n<li>Add windows worker nodes by creating a <code class=\"language-text\">Machineset</code> resource.</li>\n</ul>\n<p>All of the windows machineset creation steps are automated in this <a href=\"https://github.com/rprakashg-redhat/windemos/blob/main/install/tasks/add-windows-workers.yaml\">script</a>. Script is pretty self explanatory so I won't go into too much detail here.</p>\n<p>Before running the Ansible playbook we need to generate an ssh key for WMCO which is used to authenticate with windows nodes and perform actions like installing and configuring prometheus windows exporter etc. We can generate the ssh key by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ssh-keygen  -t ed25519 -C \"$USER@aws-win\" -f ~/.ssh/aws-win -N \"\"</code></pre></div>\n<p>Next we will base64 encode the private key and store it in an environment variable by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export PRIVATE_KEY=$(cat $HOME/.ssh/aws-win | base64)</code></pre></div>\n<p>When we run the playbook we are going to pass specify `PRIVATE_KEY' environment variable as value for variable key which is used to create the kubernetes secret</p>\n<p>I've kicked off the playbook and it completed successfully</p>\n<p><a href=\"https://asciinema.org/a/TZpbfk56sqG23U5XDOettN74U\"><img src=\"https://asciinema.org/a/TZpbfk56sqG23U5XDOettN74U.svg\" alt=\"asciicast\"></a></p>\n<p>We can login to Openshift web console and see that windows machine config operator was installed and configured successfully as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a6a8c1356c2e6749f882db34ed3d0404/fe83d/wmco.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVR42pWQy0oDQRBF+xtiogazEBcuYh4aXOjCRZBkERFXIkb0AwTJ+E1qMmO+TRjM2I+Z6b5WVx4azUILDreoKqput6hX91DZqqDVvkDn5hHty3ucXj2gcz1Y0CXOboMF53cBeqTd/mB5rh9AVOv7KJTKCEdjOACxNMhI8x+4FXzv25mKo+MTbO/sIopeecwoCeeo5eyfyVKDPEt5rag1Wiiul/H0/DJdaAystbTUrQC/ch9SSsaHqNaaKBQ3MByGfgJxHCNJEiilobUmVayaVGnDdTXLue5nKJfau8wgmgeHWCttIozGfEHRJe8ypabNc/w3yGGDHY7CiAtv8Tsmkw92OWf+JD6UpktMv+jr8CcIydyx2+/rxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"wmco\"\n        title=\"\"\n        src=\"/static/a6a8c1356c2e6749f882db34ed3d0404/5a190/wmco.png\"\n        srcset=\"/static/a6a8c1356c2e6749f882db34ed3d0404/772e8/wmco.png 200w,\n/static/a6a8c1356c2e6749f882db34ed3d0404/e17e5/wmco.png 400w,\n/static/a6a8c1356c2e6749f882db34ed3d0404/5a190/wmco.png 800w,\n/static/a6a8c1356c2e6749f882db34ed3d0404/c1b63/wmco.png 1200w,\n/static/a6a8c1356c2e6749f882db34ed3d0404/29007/wmco.png 1600w,\n/static/a6a8c1356c2e6749f882db34ed3d0404/fe83d/wmco.png 2262w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Expand <code class=\"language-text\">compute</code> option on sidebar and select <code class=\"language-text\">machineset</code> and from the screen capture below we can see the new windows machineset created.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dd8ca4a40d0286528718a2b6c956d3b5/faa22/winmachineset.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4UlEQVR42p2S22oTURSGByoKTW/S1EPbgIc0h5rWIkrBw4UXovgG1qSNRUWKYAu+RPWiILV9D8ULk6fxQlqaDJM579Ps+V17pw1eSgd+9s+sxbf/tWac1VoN1XoDM6USiqUZTExO40JhJOMnJou4ODU91qV//FiFIgrFKyiUZuE0l1ZQqS5ibr6MlUfP8Xavi9eff6Cz+x2bX37i3d4vfNzvYudbF9v27I3PT4cjbVNt56CHra89OPXFZVRqtzE7fx1rr9YhpYDv+0jTFOd5nGq9iVsLDVwzwNYGGGNwXRdhGCKnhjzP/wtk+owcM+6CTXgDrXbHFqUQkJyDU0pBF2iloE7fGZ9JCUE1TafxSnDkWTZKaNJZYJmArXWwWODoJARnAv2TIwwGHo3PEYcRhl4ATWAex/D6fSi6TBI4DgJkZkW5Pk1IssD2BjVI/P7j0x4T+N4AfhAhiShpwpDEKTIDSRKwKLReEYhFkfUwI9+s1GF0+WoZL9fayBRw7KaImII7dDGMGZjIIGSGhN7lWkPRmAlBjdc0KifYeIf3Vx+guXyXoA10Nt+AenDscURcI4gChJSYqxxK50iltnvS1MRpn2cfQ9IFZ955+uwFHj5+gqU79/B+64MtCKUt4Dy/zV9n2nKVVz18OAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"machineset\"\n        title=\"\"\n        src=\"/static/dd8ca4a40d0286528718a2b6c956d3b5/5a190/winmachineset.png\"\n        srcset=\"/static/dd8ca4a40d0286528718a2b6c956d3b5/772e8/winmachineset.png 200w,\n/static/dd8ca4a40d0286528718a2b6c956d3b5/e17e5/winmachineset.png 400w,\n/static/dd8ca4a40d0286528718a2b6c956d3b5/5a190/winmachineset.png 800w,\n/static/dd8ca4a40d0286528718a2b6c956d3b5/c1b63/winmachineset.png 1200w,\n/static/dd8ca4a40d0286528718a2b6c956d3b5/faa22/winmachineset.png 1509w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Select <code class=\"language-text\">Machines</code> option from the sidebar navigation and we can see that a new Machine provisioned as node</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1726eafbb773f9a229108096170c51d8/3b477/win-machines.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVR42pVQTW/TUBD0r6CgxG5J05A4IUmhpSooTdwk4gjiH3LiT3DhBFJ7oSCQOFQCiTZp2sR+tt+n7WH9kv4AVhrNvNXT7O44O942ei0fruth65GLh50httojPPBPSI9Q6QaobmB1L4DbW7+9/QkqvTGq/QlqB1PUD1/DabSeotnpw9vexfFgjI8XM3z6ucSXywTnfxQurjS+Eb7f87XGj5mx/PWvwtlviXPC+88rfDgL4XT7B2g0O6h6NYxOp4hWt9Ayxf/Wr5nA5ULCabV7qDf8tWEwQcIldFZACAmhDEyWQymNLM+htYGQCtmmVxSAJOb0tyx6wvHp3N29FipuDcF4imXIEfICLDW4XmkwmSFOGFLOyVBblMWFsCylJFNlzfK8WG+496QNlzIM7MmMDCQSJjC/S0kLcDIUSQJNJiUyMpA8tazKQZteTsOco1dDDIan6HSf4c3bd7idLzFbxGBhjNkNA4tiJOEdYQVJpipNYARHGkWWRcyoH1ttyNxueHj0Et5O3WYYRRzzSNOJGotQIRGazkohKSdjKEtCkWdQdGrJmjYzWlldUM5O0+9i//kLyvAxBicBVmGKBaPsUoWbUIIJReYJOE03xlBOuc3uPsuyl2WZ1WWG/wArRj8bPUtVywAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"winmachines\"\n        title=\"\"\n        src=\"/static/1726eafbb773f9a229108096170c51d8/5a190/win-machines.png\"\n        srcset=\"/static/1726eafbb773f9a229108096170c51d8/772e8/win-machines.png 200w,\n/static/1726eafbb773f9a229108096170c51d8/e17e5/win-machines.png 400w,\n/static/1726eafbb773f9a229108096170c51d8/5a190/win-machines.png 800w,\n/static/1726eafbb773f9a229108096170c51d8/c1b63/win-machines.png 1200w,\n/static/1726eafbb773f9a229108096170c51d8/29007/win-machines.png 1600w,\n/static/1726eafbb773f9a229108096170c51d8/3b477/win-machines.png 1855w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Select <code class=\"language-text\">Nodes</code> option from the sidebar navigation and we can see that a new windows node is provisioned and joined to the cluster. We are only seeing one node here because in my machineset resource I specified replicas = 1 as this is just for demonstration purposes. In real world scenarios you might set it to a desired number that meets your requirements.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b2ceba5a1093bd3f13019ac616bbeb48/10a83/winnodes.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABK0lEQVR42k2P60rDQBSE8xBSr1RBRFov9YIIIv5TalGfwIr1CYQkbcWCbxzjbvaezXg2TUt/fMyZs5MhJzo67GKv3Ubn4hb3wxQPw5hIlvTfEjyPUjwRQV8+xrX2F5nXBIP3KR6JwWiK6KR3ifWNHXzGE3gAxlewpGVD2FUroFG/QrlCdEqFLSpM0wmcceC/GaxgMILDKwEnCpRSQrE/2vMlmpMvOO1zmlk9V1oh6h6fYa21hSQeg3GHLMthpYAqihpLZU4pFDl9SD5gBL1zDskYWJbVs6VdyEW98ytsbu9i+jWDpH/mUqPyJVxJOIeqmh+qta69NqZWRd5aC0kllrz3dDxlo+ubO+wfdPA9+4EKhULR47yspNIQDKWLQtMUBm9plnRBKA7ZkPsHeUuPpSFLmKYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"winnode\"\n        title=\"\"\n        src=\"/static/b2ceba5a1093bd3f13019ac616bbeb48/5a190/winnodes.png\"\n        srcset=\"/static/b2ceba5a1093bd3f13019ac616bbeb48/772e8/winnodes.png 200w,\n/static/b2ceba5a1093bd3f13019ac616bbeb48/e17e5/winnodes.png 400w,\n/static/b2ceba5a1093bd3f13019ac616bbeb48/5a190/winnodes.png 800w,\n/static/b2ceba5a1093bd3f13019ac616bbeb48/c1b63/winnodes.png 1200w,\n/static/b2ceba5a1093bd3f13019ac616bbeb48/29007/winnodes.png 1600w,\n/static/b2ceba5a1093bd3f13019ac616bbeb48/10a83/winnodes.png 2109w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>At this point cluster is ready to run windows workloads.</p>\n<h3>Deploying Windows Workloads</h3>\n<p>Runtime class simplifies use of scheduling mechanisms like taints and tolerations so your developers don't have to. I cannot tell you how many times I have had someone complain to me saying my app is not starting up and ofcourse it got scheduled to run on linux node because developer failed to set node selector labels and tolerations.</p>\n<p>We are going to create a runtime class using the yaml snippet below</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> node.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> RuntimeClass\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> legacywindows \n<span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'runhcs-wcow-process'</span>\n<span class=\"token key atrule\">scheduling</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">nodeSelector</span><span class=\"token punctuation\">:</span> \n    <span class=\"token key atrule\">kubernetes.io/os</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'windows'</span>\n    <span class=\"token key atrule\">kubernetes.io/arch</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'amd64'</span>\n    <span class=\"token key atrule\">node.kubernetes.io/windows-build</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'10.0.20348'</span>\n  <span class=\"token key atrule\">tolerations</span><span class=\"token punctuation\">:</span> \n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">effect</span><span class=\"token punctuation\">:</span> NoSchedule\n    <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> os\n    <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> Equal\n    <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Windows\"</span></code></pre></div>\n<p>next we are going to deploy a simple webserver using the yaml snippet below. Note the <em><code class=\"language-text\">runtimeClassName: legacywindows</code></em> this is all a developer needs to know to ensure workload always gets scheduled on windows nodes available on the cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> win<span class=\"token punctuation\">-</span>webserver\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> win<span class=\"token punctuation\">-</span>webserver\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> win<span class=\"token punctuation\">-</span>webserver\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> win<span class=\"token punctuation\">-</span>webserver\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> win<span class=\"token punctuation\">-</span>webserver\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">runtimeClassName</span><span class=\"token punctuation\">:</span> legacywindows\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> windowswebserver\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mcr.microsoft.com/windows/servercore<span class=\"token punctuation\">:</span>ltsc2022\n        <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> powershell.exe\n        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>command\n        <span class=\"token punctuation\">-</span> $listener = New<span class=\"token punctuation\">-</span>Object System.Net.HttpListener; $listener.Prefixes.Add('http<span class=\"token punctuation\">:</span>//<span class=\"token important\">*:80/');</span> $listener.Start();Write<span class=\"token punctuation\">-</span>Host('Listening at http<span class=\"token punctuation\">:</span>//<span class=\"token important\">*:80/');</span> while ($listener.IsListening) <span class=\"token punctuation\">{</span> $context = $listener.GetContext(); $response = $context.Response; $content='&lt;html<span class=\"token punctuation\">></span>&lt;body<span class=\"token punctuation\">></span>&lt;H1<span class=\"token punctuation\">></span>Red Hat OpenShift + Windows Container Workloads&lt;/H1<span class=\"token punctuation\">></span>&lt;/body<span class=\"token punctuation\">></span>&lt;/html<span class=\"token punctuation\">></span>'; $buffer = <span class=\"token punctuation\">[</span>System.Text.Encoding<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>UTF8.GetBytes($content); $response.ContentLength64 = $buffer.Length; $response.OutputStream.Write($buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> $buffer.Length); $response.Close(); <span class=\"token punctuation\">}</span>;\n        <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">runAsNonRoot</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n          <span class=\"token key atrule\">windowsOptions</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">runAsUserName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ContainerAdministrator\"</span></code></pre></div>\n<p>Next we are going to create a service type <code class=\"language-text\">Loadbalancer</code> and expose this service to external access as shown in command below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl apply -f apps/service.yaml</code></pre></div>\n<p>Next we are going to get the URL for this application by running command below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export SERVICE_URL=$(oc get services win-webserver -o jsonpath=\"{.status.loadBalancer.ingress[0].hostname}\")</code></pre></div>\n<p>Lastly we can run a simple curl command to verify the sample windows app is successfully deploy on the cluster.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;html>&lt;body>&lt;H1>Red Hat OpenShift + Windows Container Workloads&lt;/H1>&lt;/body>&lt;/html></code></pre></div>\n<p>We can also see the sample app running from a browser as shown in screen capture below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70a7c0f501c42fa00b7195845bb3f8c7/0b79a/winwebserver.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnUlEQVR42nWO2QqDMBRE/f/PM7jUCmofXKpp4hpF4mkife3AYWZgLtzAGMOyrox6REpF0w7UzZuuG2h7Re260jO91DRNTz8optkg1YL8THfW2me3GUYCIQRJkpCmKUkcI0ToDmviOOKZ57xeFVEUURQFWfZAhCFVWeJlrwsc1w9rLcG+73j8p9u23X6e5+3G9eM4WJb17n7nN97/6QvideO07CDjMwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"winwebserver\"\n        title=\"\"\n        src=\"/static/70a7c0f501c42fa00b7195845bb3f8c7/5a190/winwebserver.png\"\n        srcset=\"/static/70a7c0f501c42fa00b7195845bb3f8c7/772e8/winwebserver.png 200w,\n/static/70a7c0f501c42fa00b7195845bb3f8c7/e17e5/winwebserver.png 400w,\n/static/70a7c0f501c42fa00b7195845bb3f8c7/5a190/winwebserver.png 800w,\n/static/70a7c0f501c42fa00b7195845bb3f8c7/c1b63/winwebserver.png 1200w,\n/static/70a7c0f501c42fa00b7195845bb3f8c7/0b79a/winwebserver.png 1331w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this helps,</p>\n<p>Ram</p>","id":"68f76422-48df-52dc-a5c5-94fa170e152d","frontmatter":{"title":"Deep dive into Windows Container Support in OpenShift Container Platform","date":"March, 2024","tags":["containers","platform","kubernetes","openshift","redhat","windows","microsoft"]},"fields":{"slug":"/windows-container-support-in-ocp-1/"}}},{"node":{"excerpt":"This post is `Part 2 of a 4 part series on deep dive into windows container support in OpenShift container platform. Here is a full list of what's covered Part 1 we are going to cover how to enable…","html":"<p>This post is `Part 2 of a 4 part series on deep dive into windows container support in OpenShift container platform. Here is a full list of what's covered</p>\n<ul>\n<li>\n<p><a href=\"/windows-container-support-in-ocp-1\">Part 1</a> we are going to cover how to enable windows container support and add windows nodes onto cluster. We are also going to deploy a sample application to test</p>\n</li>\n<li>\n<p><a href=\"/windows-container-support-in-ocp-2\">Part 2</a> which is this post we are going to cover using persistent storage and go over some of the usecases and scenarios that you might run into in real world</p>\n</li>\n<li>\n<p><a href=\"/windows-container-support-in-ocp-3\">Part 3</a> we are going to cover autoscaling windows workloads specifically custom metrics autoscaler as HPA and VPA is still not supported for windows containers yet. We are also going to cover scaling windows machineset</p>\n</li>\n<li>\n<p><a href=\"/windows-container-support-in-ocp-4\">Part 4</a> we are going to cover monitoring and observability options for windows workloads. We will examine some of the gaps that exist today for windows workloads and some approaches to address these gaps</p>\n</li>\n</ul>\n<h3>Driver Prerequisites</h3>\n<p>Windows CSI driver daemonset pods aren't deployed to windows nodes by default. Cluster administrator must deploy the appropriate windows csi driver daemonset.</p>\n<h4>CSI driver installation instructions for windows nodes</h4>\n<h3>Storage options on Amazon</h3>\n<h4>Amazon EFS</h4>\n<p>Mounting EFS volumes into windows containers are not supported. Amazon EFS csi driver isn't compatible with windows containers.</p>\n<h4>Amazon Elastic Block Storage (EBS)</h4>\n<p>You can mount an EBS volume as filesystem storage for windows containers. Few things to understand here are dynamic provisioning is not supported which means you have to pre-provision EBS volume and then create a <a href=\"https://kubernetes.io/docs/concepts/storage/persistent-volumes/\"><code class=\"language-text\">PersistentVolume</code></a> resource and bind to the EBS volume you want to use. See an example below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: ebs-pv\nspec:\n  storageClassName: ebs-windows-sc\n  capacity: \n    storage: 5Gi\n  volumeMode: Filesystem\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  csi:\n    fsType: xfs\n    driver: ebs.csi.aws.com\n    volumeHandle: vol-01a4ac828e2164337\n  allowedTopologies:\n  - matchLabelExpressions:\n    - key: topology.ebs.csi.aws.com/zone\n      values:\n      - us-west-2a</code></pre></div>\n<p>EBS volumes can only be mounted if access mode is ReadWrite this makes it only ideal for use with single deployment/pod. Makes a great demo workshop but don't see actual use in real world for mounting as file storage.</p>\n<p>Hope this helps,</p>\n<p>Ram</p>","id":"75849c84-c249-5f0f-b3fd-288569b41eb1","frontmatter":{"title":"Using persistent storage in windows containers","date":"March, 2024","tags":["containers","platform","kubernetes","openshift","redhat","windows","microsoft"]},"fields":{"slug":"/windows-container-support-in-ocp-2/"}}},{"node":{"excerpt":"Last week I got a chance to attend Microsoft Build conference geared towards developers. I hadn't been to build for at least 3-4 years now, but it is still a top-notch developer event that everyone…","html":"<p>Last week I got a chance to attend Microsoft Build conference geared towards developers. I hadn't been to build for at least 3-4 years now, but it is still a top-notch developer event that everyone should attend if you have an opportunity, especially if you build or plan to build applications on Azure cloud platform. Build is famously known for many swag giveaways in the past which seems to be not the case anymore, but the quality of content and speakers are still top notch.</p>\n<p>My path to \"Build 2018\" conference was completely unexpected, back in April I came across a tweet by <a href=\"https://lenadroid.github.io/posts.html\">Lena Hall</a> one of the Azure Advocates talking about Azure Dev tour in Seattle.\n<img src=\"/images/twitter2.png?raw=true\" alt=\"\"></p>\n<p>I tried to register for this event, but unfortunately, I was a bit late I guess. I did not know the event was sold out when I fired off this reply.\n<img src=\"/images/twitter1.png?raw=true\" alt=\"\"></p>\n<p>I got this response from awesome Allison one of the Azure Advocates and organizers of the Azure dev tour.</p>\n<p><img src=\"/images/twitter3.png?raw=true\" alt=\"\"></p>\n<p>Long story short, I not only got a pass to attend the Azure dev tour, got an invite to attend Build and a wonderful gift from Allison. Thank you for showing kindness to a complete stranger. I'll never forget it.</p>\n<p><img src=\"/images/twitter4.png?raw=true\" alt=\"\"></p>\n<p>Through \"Azure Dev\" tour and \"Build\" I got to know and hang out with many Azure Advocates, and I have to say <a href=\"https://twitter.com/jeffsand\">Jeff Sandquist</a> and Microsoft have indeed assembled a group of remarkable individuals who are not only super technical and knowledgeable in their respective areas but also wonderful individuals who care deeply about DevRel and community.\nYou'll find Azure advocates speaking at many conferences and events, if you get a chance go attend one of those events, say hi to them, if you are already building on Azure platform tell them about your experience, speak to them about your design and technical problems, etc. trust me you won't regret it :)</p>\n<h2>Day 1</h2>\n<p>Day 1 keynote was split into two.</p>\n<ul>\n<li>\n<p>Vision keynote led by Microsoft CEO <a href=\"https://twitter.com/satyanadella\">Satya Nadela</a></p>\n</li>\n<li>\n<p>Technology keynote led by <a href=\"http://twitter.com/scottgu\">Scott Guthrie</a></p>\n</li>\n</ul>\n<p>Watch vision keynote <a href=\"https://youtu.be/rDLkKN8e8rA\">here</a></p>\n<p>Watch technology keynote <a href=\"https://youtu.be/G9615XmUfas\">here</a></p>\n<p>My key areas of focus through out the conference was containers, IoT, Big Data processing, AI and Machine learning.</p>\n<p>Below are links to recordings of few of my favorite sessions</p>\n<ul>\n<li>\n<p><a href=\"https://channel9.msdn.com/events/Build/2018/BRK3223\">Build Intelligent applications by infusing knowledge from the web</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/events/Build/2018/THR3504\">Real time data streams with Apache Kafka and Spark</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK2137\">What's new for Serverless Computing on Azure</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/events/Build/2018/BRK3802\">Azure IoT Edge: a breakthrough platform and service running cloud intelligence on any device</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/events/Build/2018/THR3202\">A Developer’s Introduction to Big Data Processing with Azure Databricks</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/events/Build/2018/THR3124\">Smart Insights with Machine Learning from Azure Monitoring</a></p>\n</li>\n</ul>\n<h2>Day 2</h2>\n<p>Day 2 technology keynote was focussed mostly on Windows and Office. You can watch the recording of Day 2 key note [here](Microsoft 365: A powerful development platform)<a href=\"https://channel9.msdn.com/Events/Build/2018/TK02\">https://channel9.msdn.com/Events/Build/2018/TK02</a></p>\n<p>Below are links to recordings of few of my favorite sessions</p>\n<ul>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK3704\">Building Custom AI Models on Azure using TensorFlow and Keras</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK2120\">Getting started with containers on Azure</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/THR2007\">Easily run containers on Azure using Azure Container Instances (ACI)</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/THR2041\">5 Azure services every developers needs to know about</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK2125\">Why Kubernetes on Azure</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK3317\">Streaming Big Data in Azure with Kafka and Event Hubs</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK3213\">Deep learning at scale in Azure</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK3812\">Building, Running, Patching Docker Containers – The Paradigm Shift</a></p>\n</li>\n</ul>\n<p>Evening I got to attend a community event \"Building the pipeline from Prison to Tech\" organized by Azure Advocates and an organization called \"Unloop\" which focuses on enabling people who have been in prison to succeed in tech. Hearing stories from people that have gone through the program, their journey was so incredible and inspiring. I also heard Jeff Sandquist speak for the first time, you could tell from his speech he genuinely cared about the cause and called upon us to act and make a difference.</p>\n<p>Here is pic (used from Twitter) of a young lady named \"Alana Andres\" who was brave enough to share her story with us.</p>\n<p><img src=\"/images/alanaandres.jpg\" alt=\"\"></p>\n<p>There was also a panel discussion with lots of good questions and discussions. I came away inspired and wanting to do something to make a change. You can support unloop by donating, more info <a href=\"https://www.un-loop.org/donate\">here</a> I've made a monthly pledge and hoping to speak about this with our internal T-Mobile team.</p>\n<h2>Day 3</h2>\n<p>There was no technology keynote on day 3. Below are links to recordings of few of my favorite sessions</p>\n<ul>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK2508\">Inside Azure Datacenter Architecture with Mark Russinovich</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK3708\">Machine Learning at Scale</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK2507\">An Introduction to Blockchain with Mark Russinovich</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/BRK3706\">Java App Hosting: Choices!</a></p>\n</li>\n<li>\n<p><a href=\"https://channel9.msdn.com/Events/Build/2018/THR3201\">Ingestion in data pipelines with Managed Kafka Clusters in Azure HDInsight</a></p>\n</li>\n</ul>\n<p>The conference ended with a celebration at museum of pop culture <a href=\"https://www.mopop.org/\">mopop</a>.\nThis was a fun event, and there was music, food, drinks, and access to all the exhibits. As a Marvel comics fan, I enjoyed the Marvel exhibits. I've uploaded all the pictures I took while I was at build to Google photos. Check out the album <a href=\"https://photos.app.goo.gl/VwjMrqk3N5YpKUMr1\">here</a></p>\n<p>Overall build was a blast, hope to be back next year hopefully as speaker. Massive shout out to the team behind build for the job they did pulling together an event like this, finally huge thanks to Azure Advocates for inviting me. Keep rocking.</p>\n<p>Cheers,</p>\n<p>Ram</p>","id":"93c23d25-5547-5b11-814c-f893347f711a","frontmatter":{"title":"My Build 2018 Experience","date":"May, 2018","tags":["build","microsoft"]},"fields":{"slug":"/my-build-2018-experience/"}}}]}},"pageContext":{"tag":"microsoft"}},"staticQueryHashes":["1611934721","2366241629"],"slicesMap":{}}