{"componentChunkName":"component---src-templates-tag-js","path":"/tags/redhat/","result":{"data":{"site":{"siteMetadata":{"title":"rprakashg.github.io","author":"RAM GOPINATHAN"}},"allMarkdownRemark":{"totalCount":4,"edges":[{"node":{"excerpt":"Most customers use an external system for storing user identities and groups that control level of access on applications and resources deployed within the corporate network. Openshift containerâ€¦","html":"<p>Most customers use an external system for storing user identities and groups that control level of access on applications and resources deployed within the corporate network. Openshift container platform ships with a builtin OAuth server that can be configured to integrate with external identity provider systems to authenticate users accessing the cluster and control level of access they have on the cluster with clusterroles and rolebindings.</p>\n<p>For demonstration I have provisioned an OpenShift cluster on AWS and also have a OKTA developer tenant at <code class=\"language-text\">https://dev-6782679.okta.com</code> where I have created following users and groups:</p>\n<table>\n<thead>\n<tr>\n<th>User Name</th>\n<th>Member Of</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Mark Smith  (<a href=\"mailto:msmith@acme.org\">msmith@acme.org</a>)</td>\n<td>cluster-admins</td>\n</tr>\n<tr>\n<td>Tiger Woods (<a href=\"mailto:twoods@acme.org\">twoods@acme.org</a>)</td>\n<td>teama</td>\n</tr>\n<tr>\n<td>Ram G (<a href=\"mailto:rprakashg@acme.org\">rprakashg@acme.org</a>)</td>\n<td>teamb</td>\n</tr>\n</tbody>\n</table>\n<p>Mark smith role is cluster administrator and Tiger Woods and Ram G are developers working on teama and teamb respectively. When tiger woods logs into cluster we want to restrict access to teama project/namespace and when Ram G logs into cluster we want to restrict access to teamb namespace.</p>\n<p>First thing we need to do is to configure identity provider to be able to login to OpenShift cluster with okta. I have created a new application in my OKTA tenant and have saved the <code class=\"language-text\">clientID</code> and <code class=\"language-text\">clientSecret</code> to a local file. I've also automated steps to configure identity provider using ansible. You can find the ansible script <a href=\"https://github.com/rprakashg-redhat/rbac-demos/blob/main/configure-oauth.yaml\">here</a></p>\n<p>In my ansible automation scripts I'm using a static vars yaml file to load some configuration related to identity provider</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">customRoles</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">contributor</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"contributor\"</span>\n    <span class=\"token key atrule\">assignTo</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">claim</span><span class=\"token punctuation\">:</span> teama\n        <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> teama\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">claim</span><span class=\"token punctuation\">:</span> teamb\n        <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> teamb\n<span class=\"token key atrule\">providers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">okta</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> okta\n    <span class=\"token key atrule\">claims</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">email</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> email\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> name\n      <span class=\"token key atrule\">preferredUsername</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> preferred_username\n      <span class=\"token key atrule\">groups</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> groups\n    <span class=\"token key atrule\">extraScopes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> email\n    <span class=\"token punctuation\">-</span> profile\n    <span class=\"token punctuation\">-</span> groups\n    <span class=\"token key atrule\">issuer</span><span class=\"token punctuation\">:</span>  https<span class=\"token punctuation\">:</span>//dev<span class=\"token punctuation\">-</span>6782679.okta.com\n    <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> okta<span class=\"token punctuation\">-</span>secret\n    <span class=\"token key atrule\">adminClaim</span><span class=\"token punctuation\">:</span> cluster<span class=\"token punctuation\">-</span>admins</code></pre></div>\n<p>I'm also using another vars file loaded from directory called <code class=\"language-text\">dynamic</code> which stores okta <code class=\"language-text\">clientId</code> and <code class=\"language-text\">clientSecret</code>. we are splitting this into seperate file because we don't want to checkin this to git. I'm using a .gitignore file to tell git to ignore everything in the dynamic directory except the .gitignore file.</p>\n<p>First thing that happens when ansible playbook executes is that I load the dynamic vars and merge them as shown in the snippet below.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"> <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> include variables\n   <span class=\"token key atrule\">include_vars</span><span class=\"token punctuation\">:</span>\n     <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ item }}\"</span>\n     <span class=\"token key atrule\">hash_behaviour</span><span class=\"token punctuation\">:</span> merge\n   <span class=\"token key atrule\">loop</span><span class=\"token punctuation\">:</span>\n   <span class=\"token punctuation\">-</span> vars/dynamic/vars.yaml</code></pre></div>\n<p>Next we are going to create a kubernetes secret in the <code class=\"language-text\">openshift-config</code> namespace to store the <code class=\"language-text\">clientSecret</code></p>\n<p>Lastly we update the OAuth configuration to add the OKTA identity provider using the <a href=\"https://docs.ansible.com/ansible/latest/collections/kubernetes/core/k8s_module.html\"><code class=\"language-text\">kubernetes.core.k8s</code></a> module as shown in the snippet below</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> configure oauth \n  <span class=\"token key atrule\">kubernetes.core.k8s</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> present\n    <span class=\"token key atrule\">apply</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">resource_definition</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{ lookup('template', 'templates/oauth.yaml.j2') | from_yaml }}\"</span></code></pre></div>\n<p>I've gone ahead and run the ansible playbook using command below and it completed successfully.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ansible-playbook -v configure-oauth.yaml</code></pre></div>\n<h2>Configure RBAC</h2>\n<p>When Mark logs in we want him to have cluster admin privileges. Since Openshift already ships with a cluster-admin role we just need to make sure any user with a group claim <code class=\"language-text\">cluster-admins</code> will have cluster admin privileges on the cluster. We can achieve that by creating a <code class=\"language-text\">ClusterRoleBinding</code>. I wrote a simple ansible script to automate the RBAC configurations covered in this demo. You can check out the ansible script <a href=\"https://github.com/rprakashg-redhat/rbac-demos/blob/main/configure-rbac.yaml\">here</a>. Snippet below shows cluster role binding creation to allow users with <code class=\"language-text\">cluster-admins</code> group claim cluster admin privileges.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">kubectl create clusterrolebinding okta<span class=\"token punctuation\">-</span>cluster<span class=\"token punctuation\">-</span>admin<span class=\"token punctuation\">-</span>crb <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>dry<span class=\"token punctuation\">-</span>run=client <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>clusterrole=cluster<span class=\"token punctuation\">-</span>admin <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>group <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> providers.okta.adminClaim <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">-</span>o yaml <span class=\"token punctuation\">|</span> kubectl apply <span class=\"token punctuation\">-</span>f <span class=\"token punctuation\">-</span></code></pre></div>\n<p>For developers Tiger Woods and Ram G I created a custom <code class=\"language-text\">ClusterRole</code> and named it <code class=\"language-text\">Contributor</code>. You can see the entire definition <a href=\"https://github.com/rprakashg-redhat/rbac-demos/blob/main/templates/contributor.yaml\">here</a></p>\n<p>Once the <strong>contributor</strong> <code class=\"language-text\">ClusterRole</code> is created we can use a <code class=\"language-text\">RoleBinding</code> resource to lock down permissions for developers to their respective namespaces <code class=\"language-text\">teama</code> and <code class=\"language-text\">teamb</code></p>\n<p>I've defined a <a href=\"https://github.com/rprakashg-redhat/rbac-demos/blob/main/templates/rb.yaml.j2\">jinja2 template</a> that loops through a list and grants any user with group claim <code class=\"language-text\">teama</code> contributor permissions on namespace <code class=\"language-text\">teama</code> and users with group claim <code class=\"language-text\">teamb</code> gets contributor rights on namespace <code class=\"language-text\">teamb</code>. Ansible playbook reads this configuration from the static vars yaml configuration file.</p>\n<p>I've run the ansible playbook using the command below and it completed successfully.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ansible-playbook -v configure-rbac.yaml</code></pre></div>\n<p>Lets login to cluster as Mark Smith. Open a browser and navigate to openshift webconsole URL for the cluster. Screen capture below shows authentication page</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e529a1535941b4b8431a552571fd37dc/29114/ocpauth.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0UlEQVR42oVSy04iQRStAE2/eAVoYHgshO5xM2vAkdVoIh9CwicomGh0KzsTN3yAbnxtxpXzVaxknDP3lFVkcDOdnD51q6vOvffcVqP9fRwdHODo8BCj0QjD4RB7e981E/1+X/PAxHo9GGyBZ8j8ppIkQdzrIRH0yIyTr+jFsY673S5iWcfcF96xsUGSxPqMvasqlQrK5TKq1SqiKEI1EjZrolarIQhDZBwHTjaLdCYD13NRKBTwcbcCq0FW9hIPZOWC63lwXXcDR4RS6bT+lmUsTDBBqVTSd23yKKpB1et15PN5jMdjXF5e4OTkGKfzOebzGWazY5yfn+GHeKyU0tU5plIK5nK5T4IRVLPZRCqVwmKxAJ/VaoV34bW83tZrvXd9c4OCCH7b3YX/T/ue72+JbQleGcHfIvL2R8TeP9Z8lsslfBHodDraT8e0n5POitL2lmCj0YAnvk0mE7y+/sL9/QOenp/x8PiE27s7/Hx5wXQ61VXRdD04GRrBQWREnJbZ1jdDKRaLCKSFMAg0AgErp3dkxwyM+6F4F0qlrhkS95mAOspm/OyFTcQqfBFhhRwKJ25hYyaxVatWu432f0DvvojXkUnA38WCIq1Wa3P2L7M/TsAIVf9MAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ocpauth\"\n        title=\"\"\n        src=\"/static/e529a1535941b4b8431a552571fd37dc/5a190/ocpauth.png\"\n        srcset=\"/static/e529a1535941b4b8431a552571fd37dc/772e8/ocpauth.png 200w,\n/static/e529a1535941b4b8431a552571fd37dc/e17e5/ocpauth.png 400w,\n/static/e529a1535941b4b8431a552571fd37dc/5a190/ocpauth.png 800w,\n/static/e529a1535941b4b8431a552571fd37dc/c1b63/ocpauth.png 1200w,\n/static/e529a1535941b4b8431a552571fd37dc/29007/ocpauth.png 1600w,\n/static/e529a1535941b4b8431a552571fd37dc/29114/ocpauth.png 1920w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Select <code class=\"language-text\">okta</code> for login and we will be redirected to <code class=\"language-text\">Okta</code> signin page as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/459b4d70d7e5af2240831d61537e9fd6/29114/authmsmith.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCUlEQVR42qWRzU6DQBSF53WgIUDKSg2Pqa+iC2OAaVn7s240cWFSIzQtzB8zxxmwVRelCZ3ky80998wJlyHzeYKLyyukaYokSRCGIaIo+uXQxwfNn83geR583+9rEAT9vTiOQSilKPIctChQWFxPF0sUTrd9lmUolwuUZTnMLLn1O91V59lXNyMYOcYMdV21+Kzbf9qxQxhjGENrjapu8LXZ2TCNU34ihMAxpJSoN1u0jKPTBlJ1GPM7yLhBQokWppM/65rpgZyLPuj+aYfr2wo3dzUenptec7NJgUoKvH40eFxt8fLG8L4etEmBe3Qn7K5uZWkfSJz7D4ev+cvJQM55/5pKqbNxWd/Bzx/u/M3SNQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"oktaauth\"\n        title=\"\"\n        src=\"/static/459b4d70d7e5af2240831d61537e9fd6/5a190/authmsmith.png\"\n        srcset=\"/static/459b4d70d7e5af2240831d61537e9fd6/772e8/authmsmith.png 200w,\n/static/459b4d70d7e5af2240831d61537e9fd6/e17e5/authmsmith.png 400w,\n/static/459b4d70d7e5af2240831d61537e9fd6/5a190/authmsmith.png 800w,\n/static/459b4d70d7e5af2240831d61537e9fd6/c1b63/authmsmith.png 1200w,\n/static/459b4d70d7e5af2240831d61537e9fd6/29007/authmsmith.png 1600w,\n/static/459b4d70d7e5af2240831d61537e9fd6/29114/authmsmith.png 1920w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Type in credentials for Mark Smith and click <code class=\"language-text\">Sign In</code>. After successful authentication we are going to get redirected back to OpenShift web console and will be logged into console successfully as shown in screen capture below. We can also see that Mark has full cluster admin privileges.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/59c33c18f72de61c93f178adbae54ca5/29114/smithclusteradmin.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB70lEQVR42m1T2XKcMBDkH7IGhABJiHPB7LJ4471SKcep/P8fdVqDE1el8tA10miOnh6Ibvc7fr694df7Ox6PB67XK66322aJ8/mMZVmwnE44EXL+B+u64vz1FRfGR64osPQ9ijxHkiRI0xSpyqCUolXii8Wv5C1JNsRxjCzLkGsttipLlERkrIc1FeJUIyGaduCDw5ddgt1TKniK1f+RZGyWYcezVTlUmiGajmf4bo+mG1G3I0o/IC8sstxA0+o8wMj9r0/ePxFi1Mc5almoNB5FWUmC9T2G6YiWTcSnSzZwKIotRoprg5y2KAynsR93izTLETXtHsbWfPDS2dU9+vGIyndwVSvFfD1gmlZ03Sw+4xpYSjXt9+jqBi7ciTQrENXNIJ0Dy5CseXb0laYmAyfjGNdiGA/o+lEShTHj626CNo3kB0hBT0afBTct0tzRhoASWhvRJtwz3gMUE0NcotnQNlCURTEuUcU2cugaCgY28+GEw7xw2yMKV8O1HLEiK46oA2tPRo5fBoloMm3bHibsgG9Ky1L2opdsip2HacF0ukhBWYCjBNTQcuyg9Z/N5yyQZgaecc0ww1Yd0lAwFAsIWhoyOq6vxAVBCktm0/yM++M7/55v/BuuZLQR8N0zvwhqO69Y7z/w8nJBVbf4DZFbNGOQ7EvGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"msmith\"\n        title=\"\"\n        src=\"/static/59c33c18f72de61c93f178adbae54ca5/5a190/smithclusteradmin.png\"\n        srcset=\"/static/59c33c18f72de61c93f178adbae54ca5/772e8/smithclusteradmin.png 200w,\n/static/59c33c18f72de61c93f178adbae54ca5/e17e5/smithclusteradmin.png 400w,\n/static/59c33c18f72de61c93f178adbae54ca5/5a190/smithclusteradmin.png 800w,\n/static/59c33c18f72de61c93f178adbae54ca5/c1b63/smithclusteradmin.png 1200w,\n/static/59c33c18f72de61c93f178adbae54ca5/29007/smithclusteradmin.png 1600w,\n/static/59c33c18f72de61c93f178adbae54ca5/29114/smithclusteradmin.png 1920w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next we are going to login to the cluster as Tiger Woods. We are going to logout and clear browser cache and open a new browser session and navigate to openshift web console and like earlier we are going to select <code class=\"language-text\">okta</code> signin option and from the okta signin page we are going to enter credentials for Tiger Woods and sign in.</p>\n<p>We can see from the screen captures for administrator and developer perspectives that tiger woods can only see resources within the namespace <code class=\"language-text\">teama</code> because he is a member of group <code class=\"language-text\">teama</code> in okta</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/537a93f5ccbd434d88975529bb0fd929/29114/tigeradminperspective.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABe0lEQVR42p1S21aDMBDMF9RiubQQEiBAgNZWabUXTl+8/P8njbtR1Acvxz7M2ckmOzu7IIZhwPPjI16ennA+n3E8HnE6DRRPOBA/7PfYbrfo+/573N1hu7vHA73jWpGrFL0xaKxFEARYzOcIoghhGCJyMXA8fM8x+F3g+3QfQkoJFS+glUKcxBBBEEFJhflCYnLlYerNiCfw/QiTiUe5a4erqUeYYcrwPuFd+9DhHP4spLMPsdkd0a42MHWHul2hapbYHwZsbncojIUpG5iqRUExL2rorESqCihtHFJlINUb15mBsN2aHlvovERGBVlRobYrlCTSdje4WffolmvHy6qBTPMPsZFLmSEhcCPBhdx5TKRpga7pXI4LGnLNkRsZEowTDdusqGnn8i0Zqu0SWV69CfLl184pjdSQ9UwXSCjHjfjuN7DQyEVFu2Oh0aEmHvMIf4j8BMFL5+W7cVmQHMoLxZxgSYI89uhodHspBC+U4X4PAn+kkf8fFq9v8THCLMSxiQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Admin\"\n        title=\"\"\n        src=\"/static/537a93f5ccbd434d88975529bb0fd929/5a190/tigeradminperspective.png\"\n        srcset=\"/static/537a93f5ccbd434d88975529bb0fd929/772e8/tigeradminperspective.png 200w,\n/static/537a93f5ccbd434d88975529bb0fd929/e17e5/tigeradminperspective.png 400w,\n/static/537a93f5ccbd434d88975529bb0fd929/5a190/tigeradminperspective.png 800w,\n/static/537a93f5ccbd434d88975529bb0fd929/c1b63/tigeradminperspective.png 1200w,\n/static/537a93f5ccbd434d88975529bb0fd929/29007/tigeradminperspective.png 1600w,\n/static/537a93f5ccbd434d88975529bb0fd929/29114/tigeradminperspective.png 1920w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1f96ce2b34b6ccb52c06cd1157906255/29114/tigerdevperspective.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoUlEQVR42o2S2XLbMAxF9d7UWiiKlKh9t7xKrhs5Hr8kmf7/H92CdJxp7XbahzMAQRDEBWmdz2e8v77ix9sbLpcLTqcTTi9nzNoaZszzjMPhgGmaHhjHEcfjEd+fn80Zq0gSTHWFvusQcA4pJaQQCIMAPq0Z8+D7DJzT2vcNTFvGEFBOEscQZMssg1IKFucSqUogwxi27cFxOdqixrIoIaMYZdWgLGu6SEHICEJExvJAwnOpeKBgBzEKEUL4Aay2W6GoeiRpiSyvkRcNumGDzf6A5bDFZjdhS35PsfV2xLDaGdt0A6I4Q6hJckiVGt9a7b+hps2salE0PVSa48vCMTzZ7m/+V8eDx8Wnv3AZ4X3ADKZD3ZWKc9NlGKVwGH9g4dHcSNZyvTW+jtlk77Hq+io3TorPgvdJ+mbdWdV0qNoeGc1Ux/5YsPpnQTroSzhhChZd58VJTRincOkRHgo27fAg+T7JYTeJBLvyV8m6YFG2iFRmuhT0ffTAb9yGvdD+LXa/9wtWWXXQaOmavGywWu+w20/0ZUZESQZO/y4I1X/xEwbuI0zRteYaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Dev\"\n        title=\"\"\n        src=\"/static/1f96ce2b34b6ccb52c06cd1157906255/5a190/tigerdevperspective.png\"\n        srcset=\"/static/1f96ce2b34b6ccb52c06cd1157906255/772e8/tigerdevperspective.png 200w,\n/static/1f96ce2b34b6ccb52c06cd1157906255/e17e5/tigerdevperspective.png 400w,\n/static/1f96ce2b34b6ccb52c06cd1157906255/5a190/tigerdevperspective.png 800w,\n/static/1f96ce2b34b6ccb52c06cd1157906255/c1b63/tigerdevperspective.png 1200w,\n/static/1f96ce2b34b6ccb52c06cd1157906255/29007/tigerdevperspective.png 1600w,\n/static/1f96ce2b34b6ccb52c06cd1157906255/29114/tigerdevperspective.png 1920w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now lets clear browser cache and log back into the cluster as Ram G and examine what the experience looks like for Ram G who is a developer working with <code class=\"language-text\">Team B</code></p>\n<p>We can see from the screen captures for administrator and developer perspectives that Ram G can only see resources within the namespace <code class=\"language-text\">teamb</code> because he is a member of group <code class=\"language-text\">teamb</code> in okta</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/921ac1550039427fcb21de06cf0d51aa/29114/ramgadminperspective.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABM0lEQVR42q2R3W7CMAyF8wyDNW3StGnakvC3rUVbV+AGCWnv/0Rnjjt2gzYhwcUn29LxceyI/eGA8+mEr/MZx+MR4zhi3O+nSAzDgL7v0REcu+6K3W6HD9INnyNEZQy6EGDyHFJKpGmKTGkopShmXE9MuZQp65Ik4ZhlKWsL8qmKAqK0NWzpkKQakmjaQEYGT7OEmc0l5s/p/yQZtFSwmYbYvL2j8Su0fo02bLB56bFavzJbysNyi8p5lLaBKWrmOnfII2UNsSCjgpLcVBy9X5JBy8JAA2zVIG5RN54ao8Yh9lxyT5rKLaaaTEW7WP1OMWQYqLmkXNOA/Aa4L77upxbxZrlx/LporHJ7k9Ff8MpNu+QpcbV7zNgw3sZWLRtebnmXodIlIppWfQTC1Z5+MDwIj2+xDDELM0wWtQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adminramg\"\n        title=\"\"\n        src=\"/static/921ac1550039427fcb21de06cf0d51aa/5a190/ramgadminperspective.png\"\n        srcset=\"/static/921ac1550039427fcb21de06cf0d51aa/772e8/ramgadminperspective.png 200w,\n/static/921ac1550039427fcb21de06cf0d51aa/e17e5/ramgadminperspective.png 400w,\n/static/921ac1550039427fcb21de06cf0d51aa/5a190/ramgadminperspective.png 800w,\n/static/921ac1550039427fcb21de06cf0d51aa/c1b63/ramgadminperspective.png 1200w,\n/static/921ac1550039427fcb21de06cf0d51aa/29007/ramgadminperspective.png 1600w,\n/static/921ac1550039427fcb21de06cf0d51aa/29114/ramgadminperspective.png 1920w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b6f292ae581358e23655d2fe2255920/29114/ramgdevperspective.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcElEQVR42pWS2U7DMBBF/Yxomya1HS+x4yRdw6ImEl3oSyUq/v+LLpMUgUShwMPRROPx9dyZsP3zM16OR7yeTjgcDnjabLDb77Hd7bDZbrElNpRr2hZN02C9Xl/Qtg3de6LaHVjhPJrlEtZaBKMx9w5SaWitoQgpBISUEEJCyo60j0KKPiqVQpsM3jkEghnrkBmPhKdQUqOt71FVc8zmK6zqB4RQIRTTnswFcKE+4ec4UR5WkaiyYPVDi0ACoZwjy0twSmp6INUZUuOIDNp66MxD0Fn3cCK+wCViysf0zapZDedLeF/1FwdRfMGQuBmMILUFTzVuozGG4+SCEcGq6bK3YrMARR2N4sm3xFwgL8l2XmCU8B/rWEFWO7GrgonAWDloctIhaRzRD6JsSh36vPqlQ44hxcG7tehah+ftFb9a7uiEomRytYYZk8PYvBdMafUfi/hm6H+hn2FZLXpCMcNsUWN194icOp9IRb+K+RdvG6EfqmhUB4QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"devramg\"\n        title=\"\"\n        src=\"/static/2b6f292ae581358e23655d2fe2255920/5a190/ramgdevperspective.png\"\n        srcset=\"/static/2b6f292ae581358e23655d2fe2255920/772e8/ramgdevperspective.png 200w,\n/static/2b6f292ae581358e23655d2fe2255920/e17e5/ramgdevperspective.png 400w,\n/static/2b6f292ae581358e23655d2fe2255920/5a190/ramgdevperspective.png 800w,\n/static/2b6f292ae581358e23655d2fe2255920/c1b63/ramgdevperspective.png 1200w,\n/static/2b6f292ae581358e23655d2fe2255920/29007/ramgdevperspective.png 1600w,\n/static/2b6f292ae581358e23655d2fe2255920/29114/ramgdevperspective.png 1920w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Resources</h2>\n<p>If you want to learn more about oauth and identity providers in openshift check out this <a href=\"https://docs.openshift.com/container-platform/4.15/authentication/understanding-identity-provider.html\">article</a></p>\n<p>Hope this helps. Please feel free to reach out if you have any questions about this post.</p>\n<p>Thanks,\nRam</p>","id":"89cdab64-2893-5ec4-b0ea-40b82664de24","frontmatter":{"title":"Authentication and role based access control in OpenShift","date":"March, 2024","tags":["containers","platform","kubernetes","openshift","redhat"]},"fields":{"slug":"/auth-and-rbac-in-ocp/"}}},{"node":{"excerpt":"There are lots of benefits to design first approach to API development in a large organization with many development teams compared to code first which is more suited for developers. With design firstâ€¦","html":"<p>There are lots of benefits to design first approach to API development in a large organization with many development teams compared to code first which is more suited for developers. With design first you first create the API definition, review it with potential stakeholders and ensure there is a strong alignment and understanding between all before you write a single line of code.</p>\n<p>In this post I will cover how Red Hat developer hub can be used to practice design first API development. For the purposes of this article I have deployed an instance of Red Hat Developer hub on an EKS cluster. There are three main parts to this solution</p>\n<ul>\n<li>\n<p>Golden path template to add a new API definition. API designers can create the API definition file using swagger editor then use the template to add the newly created API definition to git repo. For demonstration purposes I've created a repository called <a href=\"https://github.com/rprakashg-redhat/apis\">apis</a>. Currently this repository contains a sample petstore api definition. We are using this Golden path template to capture required metadata for the newly created api definition and use that to generate a backstage catalog entity kind = API. Additionally both openapi specification and the backstage entity definition is added to the git repository and a PR is opened with specified reviewers. Check out the full template <a href=\"https://github.com/rprakashg-redhat/rhdh-templates/blob/main/templates/new-api-definition/template.yaml\">here</a>. All the golden path templates used in this post can be found in this <a href=\"https://github.com/rprakashg-redhat/rhdh-templates\">repo</a></p>\n</li>\n<li>\n<p>We are going to use a static location entity will tell backstage to automatically ingest all API kind entities into software catalog. You can check out this file <a href=\"https://github.com/rprakashg-redhat/apis/blob/main/all-apis.yaml\">here</a>. When PR is merged into the repo, I'm using a github actions workflow to update the targets list to add the newly added api entity so it can be ingested into software catalog in backstage.</p>\n</li>\n<li>\n<p>Once the newly added API definition is ingested into the software catalog in backstage development teams can create a service using any of the golden path templates available and code the implementation for the newly definied API. I've added a template to build RESTFul backend services in Golang and we are going to use that for this demo.</p>\n</li>\n</ul>\n<p>Lets look at some of the app configurations for red hat developer hub instance. For catalog I've sepecified two locations 1) For golden path templates and 2) API definitions as shown in the snippet below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">catalog:\n    import:\n    entityFileName: catalog-info.yaml\n    rules:\n    - allow: [Component, System, API, Resource, Location, Domain, Template]\n    locations:\n    - type: url\n        target: https://github.com/rprakashg-redhat/rhdh-templates/blob/main/all-templates.yaml\n    - type: url\n        target: https://github.com/rprakashg-redhat/apis/blob/main/all-apis.yaml</code></pre></div>\n<p>We are going to open up a browser and navigate to URL of red hat developer hub instance I have running on EKS. My instance is already configured for Github auth and I have logged in with my Github credentials. Lets navigate to catalog and we can see that the petstore api entity is already ingested into software catalog as shown in screen capture below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7fd2d829f22171bb26135e82d628a2ce/c2d13/softwarecatalog.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABQElEQVR42oWPS0vDUBSEsxeKgghtaiyiotCNeXnbPJqbJpGobWkQGlP7AFcu/SXaBkRRRMH/OZ5EI1p8LD7OcDl35oywV68j2JeRnnSR9iPMwiPMgkPccI5ry8Lc4ZiTTn0ft50u7no93NPew2CAx9EYT8TzZIqXZIjXOIZQrkqoVao41XVEmoZI1ZBYJs6aTcSMIW40kJBOyHxIxufc/ZgcYwoZeR4uun1cTS4xIS1s7+xC2txCkxZ004RCn/3jDhpOC4bLCRfMtmF5PgzeftftNpwgAKMQw3HghSFaZG5nhqJUQ1XagEsfTcMAYwdQZDlHVZScXKtqjpK90dS+ampWTKG0sooK1fYpoUVpZnZlZvIPchb6w7uwVFqGuC7Bo3MzQ4tq/La8aLhIbrhWFqlyjaqyzwpFtb8o9r6haXgDGiDvfxeZ85wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"catalog\"\n        title=\"\"\n        src=\"/static/7fd2d829f22171bb26135e82d628a2ce/5a190/softwarecatalog.png\"\n        srcset=\"/static/7fd2d829f22171bb26135e82d628a2ce/772e8/softwarecatalog.png 200w,\n/static/7fd2d829f22171bb26135e82d628a2ce/e17e5/softwarecatalog.png 400w,\n/static/7fd2d829f22171bb26135e82d628a2ce/5a190/softwarecatalog.png 800w,\n/static/7fd2d829f22171bb26135e82d628a2ce/c1b63/softwarecatalog.png 1200w,\n/static/7fd2d829f22171bb26135e82d628a2ce/29007/softwarecatalog.png 1600w,\n/static/7fd2d829f22171bb26135e82d628a2ce/c2d13/softwarecatalog.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I've downloaded another sample api definition file for spotify apis. We will now use the software template to add the spotify API definition. We can do that by clicking <code class=\"language-text\">Create</code> sidebar navigation option which will bring up a list of golden path templates. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2926dacd740c7df8c5c891700070ad9a/c2d13/create-component.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVR42m2RS0sbYRSG8xdKS6w21Z2borlMkvnmFieZpDOTmHiJJHjDKFhaIbFuiqsiSH9Dd111Ubpp9/0BgUDdFEoRXHTVy594PDNeCOLiYb5zhnnec75JzE6l+BY2OOuuMxKGzSWGNZ/hQplR2eP784AzP+RHp8vPnV1+7e5xvv+Ci8Ehv98c8+/kHf/fnvJ3cMSffp/ExOQTPNvGL5WwNA1HKUqmicrlUNkshvSMQgFT1zHlaRWLMab0XcdlbeuAbu81YaON5zgkJlNP0Q0DXUTP8nmOKhW+ttt86nT43Ovxvl7nY7PJl40NPmxukRdRWsIyERI4Pz93ixJP4mHyMdVqlSAIcEW2XK7wanmV/ZUVeq0We4uLvJTzgQRsizgSamPkZYiInASYslkstGVUJRMW5EW5WiNoLeH5Prbr4oUhCxJY8ipYUmt3hDfcCh88SpLOZNCkkRUMGVspHV3uzDAtbMtCyTkKNAwr/vA+srJ+LExNz1CQy74SqVgU1TdE64zXRfkh+nXAOFHPcRwuASFK/e5fVxGGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create-component\"\n        title=\"\"\n        src=\"/static/2926dacd740c7df8c5c891700070ad9a/5a190/create-component.png\"\n        srcset=\"/static/2926dacd740c7df8c5c891700070ad9a/772e8/create-component.png 200w,\n/static/2926dacd740c7df8c5c891700070ad9a/e17e5/create-component.png 400w,\n/static/2926dacd740c7df8c5c891700070ad9a/5a190/create-component.png 800w,\n/static/2926dacd740c7df8c5c891700070ad9a/c1b63/create-component.png 1200w,\n/static/2926dacd740c7df8c5c891700070ad9a/29007/create-component.png 1600w,\n/static/2926dacd740c7df8c5c891700070ad9a/c2d13/create-component.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Select the <code class=\"language-text\">New API definition</code> template from the list and fill in name for the API, description and for specification paste the swagger from the api definition file. Specify owner and click next. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f16cdcf796e8dbc045dd02f7f9c17aa1/c2d13/newapidef1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABD0lEQVR42pWQ3UrDQBCF8zKaoI14b1KTzY9K25hlk03z26RN9LnEiihIERHJlY923CRFsAjai4/dnZlzzrBSPFKxmXq4u7jCPbGxthysx+d4ONPwODbwZBI8Ow5eKMUmCPHKOd7mMd7LCh91g7a5Qbuq0cYxPqsK0vHJKcrlClwMUSGgTBDw4f6NeId8Wx96PvsJDSJMZh6kI7Fh3dwizRZI0rw/s7xEXuyQbyl+7xWLJZgIkg5kGYwxRFEkCgy+fw3LsqBpGnRd/zfdfKeTDhUFnIciqUCSpMJ4jqk3g2Xbe0EErusKQ1kR/xbBdi9hGAYIIX3SvnS63nCkqmBRholHQczB0DTNP+nmduk2/QITKwyqlhdNAgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"newapidef1\"\n        title=\"\"\n        src=\"/static/f16cdcf796e8dbc045dd02f7f9c17aa1/5a190/newapidef1.png\"\n        srcset=\"/static/f16cdcf796e8dbc045dd02f7f9c17aa1/772e8/newapidef1.png 200w,\n/static/f16cdcf796e8dbc045dd02f7f9c17aa1/e17e5/newapidef1.png 400w,\n/static/f16cdcf796e8dbc045dd02f7f9c17aa1/5a190/newapidef1.png 800w,\n/static/f16cdcf796e8dbc045dd02f7f9c17aa1/c1b63/newapidef1.png 1200w,\n/static/f16cdcf796e8dbc045dd02f7f9c17aa1/29007/newapidef1.png 1600w,\n/static/f16cdcf796e8dbc045dd02f7f9c17aa1/c2d13/newapidef1.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next provide information about the git repository where all api definitions files are stored. I'm going to select the apis repo and enter reviewers and PR branch name. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c30772853efff24aafdca30e83700af4/c2d13/apidefinition2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVR42p2QSwvCMBCE+2d8VYt48aS2TTZNsLUWfID1dRAE//8PGCcqgqKXHr7DZrM7sxOM+xFuxQIHpbCLY+ySFHVKZjHqOME+IewdrMXROmIfnJzDaT7H+YWvL3mOIByOUG22cEWBGQffaPVZU+QX0xcTCiciCLq9EFVZIjMGonVjNEVtlnFh2Ee5rCDcLmKgtTRCKUHmF7a7PaxXa1jmY+hSUa0JKR36+aDV6cAx5JQ5KD42xZ/svMNBFKE+X5EvVzCiH7af5//HO/H/vvEZ3gF7gPrjwyXY2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"apidef2\"\n        title=\"\"\n        src=\"/static/c30772853efff24aafdca30e83700af4/5a190/apidefinition2.png\"\n        srcset=\"/static/c30772853efff24aafdca30e83700af4/772e8/apidefinition2.png 200w,\n/static/c30772853efff24aafdca30e83700af4/e17e5/apidefinition2.png 400w,\n/static/c30772853efff24aafdca30e83700af4/5a190/apidefinition2.png 800w,\n/static/c30772853efff24aafdca30e83700af4/c1b63/apidefinition2.png 1200w,\n/static/c30772853efff24aafdca30e83700af4/29007/apidefinition2.png 1600w,\n/static/c30772853efff24aafdca30e83700af4/c2d13/apidefinition2.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Click Next to review everything and click create. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d7c16a4d13ae1ca5030d7236d0ac2b5/c2d13/apidef3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVR42oVQ7Q6CMAzcqwhoNMH/fAQGITjD18aM7/8op52y1EXjj0uvTXu9VkRJgqqqYIxxWNfV4VvOo7XW82VZME0T+r6HiJK9F9wGtNZekDjPeZ0vm+cZSimIXRw7Qc2EQoch5wu2Grl8CUZvwWDjxjfQiZyHOc0Mw0AOE9R17Rwadh5FOoOaxnH8AP0r5NTnHB6OJ1zVBV3XQTYNyrJEURQ+/kKe5x/Isgxt20Kk6RmLvcPqGwZZo3kWpZR/QcMhyNQDdiwBabfZdOoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"apidef3\"\n        title=\"\"\n        src=\"/static/3d7c16a4d13ae1ca5030d7236d0ac2b5/5a190/apidef3.png\"\n        srcset=\"/static/3d7c16a4d13ae1ca5030d7236d0ac2b5/772e8/apidef3.png 200w,\n/static/3d7c16a4d13ae1ca5030d7236d0ac2b5/e17e5/apidef3.png 400w,\n/static/3d7c16a4d13ae1ca5030d7236d0ac2b5/5a190/apidef3.png 800w,\n/static/3d7c16a4d13ae1ca5030d7236d0ac2b5/c1b63/apidef3.png 1200w,\n/static/3d7c16a4d13ae1ca5030d7236d0ac2b5/29007/apidef3.png 1600w,\n/static/3d7c16a4d13ae1ca5030d7236d0ac2b5/c2d13/apidef3.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Scaffolder will now execute all the actions defined in the template and you can see link to newly opened PR shown as outputs. <strong>Ignore errors because I put myself as reviewer which is why github was complaining because author cannot also be a reviewer</strong>. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cea9749d0aaa4dfbbe1c630dae5d363e/c2d13/scaffolder.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABP0lEQVR42qWS30vDMBDH+5/IENmcoLSF1jZr1x9p2sRt9kGnMOfDFDf/J0HFMZiCiMwH/7qvl6APgqjow4e7S+6+uSRniShCnSQYJCn63S7ZBP0wxF7I0AsD9BiDIl+RrWl/WJboRTEk60B1IiiqV+TLIDB71mjHxrI/wBUXuC4r3JQSt7zAXcYxL0osKomFVFgeHOL+6BgPxOPoBE9n53iezrCaXWJ1McXL+BSvkwmsVnsLSimkaYqEukuJnHOzJmWFqqpMnBcFuEb7mjxHRuTvMRcFhO6w1W6j3h9ACGGSCirSVh/wQZZlP6LzdK217Qaoh2NEHYYuvVEcx6bT34h8Kbi+0cRuwOA4DlzXNZbRB5gr/UVwrdEgIQe27Rgx27b/J9hsbSKgL/d8Hz7heR5CGpuIxuE79NN8gta06BtHwyHthxcukQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"scaffolder\"\n        title=\"\"\n        src=\"/static/cea9749d0aaa4dfbbe1c630dae5d363e/5a190/scaffolder.png\"\n        srcset=\"/static/cea9749d0aaa4dfbbe1c630dae5d363e/772e8/scaffolder.png 200w,\n/static/cea9749d0aaa4dfbbe1c630dae5d363e/e17e5/scaffolder.png 400w,\n/static/cea9749d0aaa4dfbbe1c630dae5d363e/5a190/scaffolder.png 800w,\n/static/cea9749d0aaa4dfbbe1c630dae5d363e/c1b63/scaffolder.png 1200w,\n/static/cea9749d0aaa4dfbbe1c630dae5d363e/29007/scaffolder.png 1600w,\n/static/cea9749d0aaa4dfbbe1c630dae5d363e/c2d13/scaffolder.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I'm going to click on the PR link to view the PR. We can see that our github actions workflow kicked off and it updated the location entity and added the new api to the list of targets. Workflow also updates the PR with a comment to let users know that this change was made to the PR. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9578380eb29ac953bf30a73cfab1cd0a/c2d13/pr1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABDUlEQVR42o2RO2/DMAyEs7Z5WJb1lmzLcmKncYaiyNj//7eulIAUGgK0w4GDeB951O7EDYo6g0OjYM8T5s8HXNzQ+QXMrmA6oVETWpPAVSj9TWfx6yUdmIL2E3bHVqPWiWnYfoEdF3RmRCM8jtwVMdnT2wwmXIHUvn0joV18AaTJNkyQBOM6ECTDdEnQ6R6t9GWbfwH31DjYEeN0hRsupDNBhhIzR8xVkekZ909gviEPHsJHaJvgI0HHC4QdKLotNQ8RZiixXwLzVrXeuYTdVsT7HX26QoW53JFR1FZ5GLqhclPZsPa9nQRkBua7PJUj+ZDw8f3A+HWjn17h0w1h3mDjAk/bOgLWntqb334A+ZyxMBtnNU8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pr\"\n        title=\"\"\n        src=\"/static/9578380eb29ac953bf30a73cfab1cd0a/5a190/pr1.png\"\n        srcset=\"/static/9578380eb29ac953bf30a73cfab1cd0a/772e8/pr1.png 200w,\n/static/9578380eb29ac953bf30a73cfab1cd0a/e17e5/pr1.png 400w,\n/static/9578380eb29ac953bf30a73cfab1cd0a/5a190/pr1.png 800w,\n/static/9578380eb29ac953bf30a73cfab1cd0a/c1b63/pr1.png 1200w,\n/static/9578380eb29ac953bf30a73cfab1cd0a/29007/pr1.png 1600w,\n/static/9578380eb29ac953bf30a73cfab1cd0a/c2d13/pr1.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can also check out the files changed in the PR. See screen capture below. Cool thing here is API developers, API consumers, API designers involved in this API can all collaborate on the PR together.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f82872aa3aba8dfca093fb0793d07d93/c2d13/filesinpr.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVR42o2QyU7DMBRFs2FIqDM1gwfi2E1SB5qBCCEhlrDi/z/o8hKxYVHaxdGx5Puerp7HlUGyL3C/i+H/ErAUPktw47Oz3AbhlrkLou29uuQVvMPzCK4sklwh5QZRpsDiAmFSbv6PXZyDUW7NxoWEsh28ghqmRYVS9xCm35aGeUUBjYh8iUxYFKoFf3LQywme1B3iXKLrBjRugG3J9RGGUNRcSnMZYSB4jZpmvCgVW912GnCcFth+RGcO9GnBtYWor2SdaRy8B5aBlRKPX6/QHwvyU4/QWUTugJh8LZEz4D0t3NMd8rpG+z3Bfb7BvM+QM91kas4zNxAv7R/40kCPPX4AKq63V3I/D4UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"filesinpr\"\n        title=\"\"\n        src=\"/static/f82872aa3aba8dfca093fb0793d07d93/5a190/filesinpr.png\"\n        srcset=\"/static/f82872aa3aba8dfca093fb0793d07d93/772e8/filesinpr.png 200w,\n/static/f82872aa3aba8dfca093fb0793d07d93/e17e5/filesinpr.png 400w,\n/static/f82872aa3aba8dfca093fb0793d07d93/5a190/filesinpr.png 800w,\n/static/f82872aa3aba8dfca093fb0793d07d93/c1b63/filesinpr.png 1200w,\n/static/f82872aa3aba8dfca093fb0793d07d93/29007/filesinpr.png 1600w,\n/static/f82872aa3aba8dfca093fb0793d07d93/c2d13/filesinpr.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I'm going to go ahead and merge the PR and delete the branch and in few minutes we should see this newly added API ingested into software catalog in backstage. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e05c4be133191f5ed6a7ea22b208d82e/c2d13/catalog2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABV0lEQVR42p2RXUsCQRSG959Ehakksa4f+zW7M/vtiqlrltJFCnbTTUG/poskKkIiqLvoov/2dmZLEgmKLl7OcOadd54zoySui4wL9D0PXfFZe46DrhSz89phjORg4AmMWykyP0DP89Fxea42+VJDxyiJoRzvqbj3Alw5HNd+iHkUYy58zB0XN8LDLR2+o95DP8PiYIjF8BCPoxGeTiZ4np3iZTbD2/kl3s8u8DqdQtkplmDbNjRNQ7PZRJK0wDmHIFqPaDlVqSCKIIhKUM8PfIRhmPddmnB/cIRsPEGatqGUKxXEcQxOGw5RWTaDQfiGYXxL12HTyKZlQZdrApBBy33btmBSDYKAAncriOg2ScTIWK1Wc9p1rfblet2nqmoermwXCmg0GrmhVqv9WzLUogmUjc0t1Ot1CtR+JPurJFAeWCyVYZommvQ2+pfk5/wmfcW/PMMYwwcydxWQL8UoIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"catalog2\"\n        title=\"\"\n        src=\"/static/e05c4be133191f5ed6a7ea22b208d82e/5a190/catalog2.png\"\n        srcset=\"/static/e05c4be133191f5ed6a7ea22b208d82e/772e8/catalog2.png 200w,\n/static/e05c4be133191f5ed6a7ea22b208d82e/e17e5/catalog2.png 400w,\n/static/e05c4be133191f5ed6a7ea22b208d82e/5a190/catalog2.png 800w,\n/static/e05c4be133191f5ed6a7ea22b208d82e/c1b63/catalog2.png 1200w,\n/static/e05c4be133191f5ed6a7ea22b208d82e/29007/catalog2.png 1600w,\n/static/e05c4be133191f5ed6a7ea22b208d82e/c2d13/catalog2.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can also click on the <code class=\"language-text\">spotify</code> API and see overview and definition. You can see swagger UI rendered for the spotify web api.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6a41ec5dff8beda70fd7d9df81da2900/c2d13/spotifyapi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABU0lEQVR42m2Rz07CQBDG+y4iYAJ4IdBSZNvtdvsHGoptAQ+EQzF69mDisxiDRg8YjTF68e0+Z2usJfHwy+zM7HwzO6vN28fY+QFumYU77mDrSmzpfG8O8cAYHm2OJyGwi2d4TlO8pBleF0u8rdd4zzf42CjO8bla4SvPoTVbHYgggGlZf9g2htzGicPJWvs5BTUasFEFBmM0AnMcaI3mEaSU4CTicF4gHAHfDzGJxpAepxwvcwrO9/0iRvXSdaEd1A5hmib6/T50XS/s0BwgS2awLYZet0vxHvT+DwblDVMnjOL+L6qO0aRavdGEoB1Z9BSbJrHoCSKMsby4xjhO4NC5ipicQkQpuAyooaqxC1S9qyas1RsVQbsUTPIrhHFKAsQ4KXGjjJiTYPi/YKvdQUCfohwpPbiCw59mmF/eIEqW8GJiuijxY2J2Bm8SFztT+6/yDZ5AAkBuzviJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"spotify\"\n        title=\"\"\n        src=\"/static/6a41ec5dff8beda70fd7d9df81da2900/5a190/spotifyapi.png\"\n        srcset=\"/static/6a41ec5dff8beda70fd7d9df81da2900/772e8/spotifyapi.png 200w,\n/static/6a41ec5dff8beda70fd7d9df81da2900/e17e5/spotifyapi.png 400w,\n/static/6a41ec5dff8beda70fd7d9df81da2900/5a190/spotifyapi.png 800w,\n/static/6a41ec5dff8beda70fd7d9df81da2900/c1b63/spotifyapi.png 1200w,\n/static/6a41ec5dff8beda70fd7d9df81da2900/29007/spotifyapi.png 1600w,\n/static/6a41ec5dff8beda70fd7d9df81da2900/c2d13/spotifyapi.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next we will use the software template for building backend services in go and provide an implementation for the newly created spotify web api. Click create and select the <code class=\"language-text\">Go Rest Backend</code> template. Fill in all the required information and create to scaffold new backend service in go which will provide implementation for the newly created API definition. We make sure for <code class=\"language-text\">provided APIs</code> select the newly added <code class=\"language-text\">spotify</code> API from the list as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/be7bb0fd906ed6a69da798cb8271a987/705cc/spotify-service1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVR42qWU207CQBCG+wSeQA7KlVGDMZC0hrbQhdAjPdMKhafw/S9/Z9ZoUEGpXnyZdtv+/Wd2dpSJruGJMHUdY8PA6InuNQ0TITAej2EYJnR9BI3WDHpumqaMmqpCGwygctRUDIdDjNQBFMf14Hk+4nCBKsuQxzGyNEXCke45xvkSWVEiTWL4iwVSer6gaAkLge9jbju0Hkod5e72Dt3rHma2j2VRIGYBwnVdzOdz2LZ9ENdx5Hu7KDe397hotiCmM2y3W0RRRH/y4NOfmd3r3bVDKP3HARqtDtkXWK/XMpXdj4MgqIVy339As93BdDaTgnmeS9hpGIb1BdtXPZycNyjlKaqqkiLskuEXfkpvb8osdnrRhBBTbDYbKbivbseinDUupSDXsKBdZme8W3WdfTh8F+SU32vHbcPC/xZcrVZSjNP+rT2OEizL8l/1+1xDS8ij9ldn3xxOLEue0WNOQw3B5G0z/ODbGT2WTyknaYaImjmiqWETLFwX2dgM92FZbfGcZHiJaZRFMRyf3R4g2I/S6l7L4SC4sZc096gXC5p/BaXP48njJt+D6zpv4+sLr4BfdThDWJ4HAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"spotify\"\n        title=\"\"\n        src=\"/static/be7bb0fd906ed6a69da798cb8271a987/5a190/spotify-service1.png\"\n        srcset=\"/static/be7bb0fd906ed6a69da798cb8271a987/772e8/spotify-service1.png 200w,\n/static/be7bb0fd906ed6a69da798cb8271a987/e17e5/spotify-service1.png 400w,\n/static/be7bb0fd906ed6a69da798cb8271a987/5a190/spotify-service1.png 800w,\n/static/be7bb0fd906ed6a69da798cb8271a987/705cc/spotify-service1.png 1071w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this was helpful. As always reach out to me if you have questions about this post or want to learn more about Red Hat developer hub and how it can improve developer productivity</p>\n<p>Thanks,\nRam</p>","id":"8059169e-c3e9-543b-9139-6f25e9cafd39","frontmatter":{"title":"Practicing Design First API Development with Red Hat Developer Hub","date":"March, 2024","tags":["backstage","idp","kubernetes","eks","amazon","redhat","developer"]},"fields":{"slug":"/design-first-with-rhdh/"}}},{"node":{"excerpt":"As many of you may already know Red Hat Developer hub which is based on backstage project created by Spotify hit GA. If you are not familiar with RedHat Developer hub or backstage check out thisâ€¦","html":"<p>As many of you may already know Red Hat Developer hub which is based on backstage project created by Spotify hit GA. If you are not familiar with RedHat Developer hub or backstage check out this <a href=\"https://developers.redhat.com/rhdh\">article</a>. You can deploy and run developer hub on all x-K8s (AKS, EKS, GKE). In this post I will cover how to install and configure RedHat developer hub on Amazon Elastic Kubernetes Service (EKS). If you are using AKS or GKE I would think these steps would work just fine although I haven't tested in AKS or GKE. Everything I'm covering in this post can be found in this Github <a href=\"https://github.com/rprakashg-redhat/rhdh-on-eks\">repo</a>.</p>\n<p>Lets get right into it.</p>\n<p>As in many previous posts where I used EKS I'm going to use terraform to provision EKS cluster. You can find the terraform scripts <a href=\"https://github.com/rprakashg-redhat/rhdh-on-eks/tree/main/deploy/infra\">here</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">terraform init\nterraform plan\nterraform apply --var \"name=toolscluster\"</code></pre></div>\n<p>Once the cluster is provisioned we need to install an Ingress controller. There are variety of options out there but for the purposes of this post I decided to use HAProxy. HAProxy also provides an EKS addon that makes it super easy to install on to cluster but I'm going to use helm to install HAProxy controller on the cluster.</p>\n<p>You can download the kubeconfig file to authenticate with the cluster by running command below.</p>\n<p>note: <em>Be sure to make sure region value matches to one you specified when cluster was created.</em></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">aws eks update-kubeconfig --region us-west-2 --name \"toolscluster\"</code></pre></div>\n<p>First we are going to add the HAProxy helm chart repo by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">helm repo add haproxytech https://haproxytech.github.io/helm-charts</code></pre></div>\n<p>Update helm charts by running <code class=\"language-text\">helm repo update</code> and install the HAProxy ingress controller by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">helm install haproxy-kubernetes-ingress haproxytech/kubernetes-ingress \\\n  --create-namespace \\\n  --namespace haproxy-controller \\\n  --set controller.service.type=LoadBalancer</code></pre></div>\n<p>Check if the ALB is provisioned successfully on AWS by running <em><code class=\"language-text\">kubectl describe service haproxy-ingress -n haproxy-controller</code></em>. You should see full DNS name of your ALB provisioned in Amazon for public IP. If it shows pending that means some issue which you should see in the status section.</p>\n<p>Next thing we are going to do is to update the route 53 hosted zone to create an A record so we can have a friendly URL like so <em><code class=\"language-text\">devhub.sandbox2841.opentlc.com</code></em>. Basically this is going to act as an alias for routing traffic to the ALB provisioned by HAProxy Ingress controller. See screenshopt below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/006e0d3131e87b186c82c19ea6463e89/18c33/r53updates.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVR42pWS+06DMBjFef/H8gl08ZKYsDllUjagtPTG9XjaTeMfLmrJL18bei4JZDebHHePz9g8POF2c498t4c4HlFWglR/5r0UeCsOyE6NRFWVUErBBw8XAsIw/BtPnXMO2WtZ4SAqnJoWTdui5tR9DxXR+sznmXQ8/wgLxZmVNKtbeRH3NDPQ1id8uCR7n4j7gW0S45jmyDlOEyzbpYbGGEjZwViLQIPvDMMITyPLd1FgjIWzZ2EiBnEqpXk/JLJpmilwKem3ta7rV6OVz7IsyXC7e0mFolcWmHLkV22bBss8R9VVVhrE+54mcc00j/uiKJJ+ZlAmhUCx2+JAOhq7roOV8irqxHBq4j1d15D8ZYo8h9jv4bXCB3NJZmPOVaChAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"r53update\"\n        title=\"\"\n        src=\"/static/006e0d3131e87b186c82c19ea6463e89/5a190/r53updates.png\"\n        srcset=\"/static/006e0d3131e87b186c82c19ea6463e89/772e8/r53updates.png 200w,\n/static/006e0d3131e87b186c82c19ea6463e89/e17e5/r53updates.png 400w,\n/static/006e0d3131e87b186c82c19ea6463e89/5a190/r53updates.png 800w,\n/static/006e0d3131e87b186c82c19ea6463e89/c1b63/r53updates.png 1200w,\n/static/006e0d3131e87b186c82c19ea6463e89/29007/r53updates.png 1600w,\n/static/006e0d3131e87b186c82c19ea6463e89/18c33/r53updates.png 1775w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Create a namespace <code class=\"language-text\">tools</code> on the cluster where we will install developer hub components by running <em><code class=\"language-text\">kubectl create namespace tools</code></em></p>\n<p>Next thing we are going to do is download redhat pull secret file from <em>cloud.redhat.com</em> and save it locally as pull-secret.txt file then create a kubernetes secret as shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl create secret generic rhdh-pull-secret \\\n  -n tools \\\n  --from-file=.dockerconfigjson=pull-secret.txt \\\n  --type=kubernetes.io/dockerconfigjson</code></pre></div>\n<p>Path the default service account to be able to pull images from redhat registries using the kubernetes secret we created earlier by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl patch sa default -n tools -p '{\"imagePullSecrets\": [{\"name\": \"rhdh-pull-secret\"}]}'</code></pre></div>\n<p>Next thing we are going to do is create a kubernetes secret to store all sensitive configurations we want to use in the app config file for backstage. See below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl create secret generic rhdh-secrets \\\n  -n tools \\\n  --from-literal=AUTH_OKTA_CLIENT_ID=${AUTH_OKTA_CLIENT_ID} \\\n--from-literal=AUTH_OKTA_CLIENT_SECRET=${AUTH_OKTA_CLIENT_SECRET} \\\n--from-literal=AUTH_OKTA_DOMAIN=${AUTH_OKTA_DOMAIN} \\\n--from-literal=AUTH_OKTA_ADDITIONAL_SCOPES=${AUTH_OKTA_ADDITIONAL_SCOPES} \\\n--from-literal=GITLAB_TOKEN=${GITLAB_TOKEN} \\\n--from-literal=GITLAB_APP_APP_ID=${GITLAB_APP_APP_ID} \\\n--from-literal=GITLAB_APP_CLIENT_ID=${GITLAB_APP_CLIENT_ID} \\\n--from-literal=GITLAB_APP_CLIENT_SECRET=${GITLAB_APP_CLIENT_SECRET} \\\n--from-literal=GITHUB_APP_APP_ID=${GITHUB_APP_APP_ID} \\\n--from-literal=GITHUB_APP_CLIENT_ID=${GITHUB_APP_CLIENT_ID} \\\n--from-literal=GITHUB_APP_CLIENT_SECRET=${GITHUB_APP_CLIENT_SECRET} \\\n--from-literal=GITHUB_ORG=${GITHUB_ORG} \\\n--from-literal=GITHUB_APP_WEBHOOK_URL=${GITHUB_APP_WEBHOOK_URL} \\\n--from-literal=GITHUB_APP_WEBHOOK_SECRET=${GITHUB_APP_WEBHOOK_SECRET} \\\n--from-literal=GITHUB_TOKEN=${GITHUB_TOKEN} \\\n--from-literal=BACKSTAGE_AWS_ACCOUNT_ID=${BACKSTAGE_AWS_ACCOUNT_ID} \\\n--from-literal=AWS_ACCESS_KEY_ID=${BACKSTAGE_AWS_ACCESS_KEY_ID} \\\n--from-literal=AWS_SECRET_ACCESS_KEY=${BACKSTAGE_AWS_SECRET_ACCESS_KEY} \\\n--from-literal=TECHDOCS_AWSS3_BUCKET_NAME=${TECHDOCS_AWSS3_BUCKET_NAME} \\\n--from-literal=TECHDOCS_AWSS3_BUCKET_URL=${TECHDOCS_AWSS3_BUCKET_URL} \\\n--from-literal=AWS_REGION=${AWS_REGION} \\\n--from-literal=EKS_CLUSTER_URL=${EKS_CLUSTER_URL} \\\n--from-literal=EKS_CLUSTER_NAME=${EKS_CLUSTER_NAME} \\\n--from-literal=BACKSTAGE_ROLE_ARN_TO_ASSUME=${BACKSTAGE_ROLE_ARN_TO_ASSUME} \\\n--from-literal=AWS_EXTERNAL_ID=${AWS_EXTERNAL_ID} \\\n--from-literal=EKS_SA_TOKEN=${EKS_SA_TOKEN} \\\n--from-literal=ARGOCD_USER_ID=${ARGOCD_USER_ID} \\\n--from-literal=ARGOCD_USER_PWD=${ARGOCD_USER_PWD}</code></pre></div>\n<p>I was testing OKTA, GITHUB, GITLAB mine looks pretty large. Approach I took was to keep a local env file that contains all the values specific to my environment\nand I would run command <em><code class=\"language-text\">export $(cat local.env | xargs)</code></em>  before creating the secret.</p>\n<p>Originally for Auth I used OKTA and eventually landed on using GitHub. Steps for creating app in github is pretty well documented so I'm not going to cover that. Once you create the app in github you will endup having to create a private key as well. Download the private key in to your local machine and create another kubernetes secret to store the private key for your app as you will need to specify that in the app config for backstage</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl create secret generic -n tools gh-app-key \\\n--from-file=GITHUB_APP_PRIVATE_KEY=\"/Users/rgopinat/keys/demo-rhdh.2024-02-26.private-key.pem\"</code></pre></div>\n<p>For Kubernetes plugin I downloaded the EKS CA Certificate from aws console and saved locally to create another secret to store that EKC CA data as shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl create secret generic -n tools eks-ca-data \\\n--from-file=EKS_CA_DATA=eks-ca.txt</code></pre></div>\n<p>Next I do have to tell backstage about all these secrets I've created so backstage can load them as environment variables and we can do that by updating a section in values file as shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> extraEnvVarsSecrets:\n    - rhdh-secrets\n    - gh-app-key\n    - eks-ca-data</code></pre></div>\n<p>Next thing we are going to do is to go ahead and create the app config configmap. You can see a copy of mine <a href=\"https://github.com/rprakashg-redhat/rhdh-on-eks/blob/main/deploy/rhdh/developer-hub-appconfig.yaml\">here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl apply -f deploy/rhdh/developer-hub-appconfig.yaml</code></pre></div>\n<p>It is worth talking a little bit about this snippet of yaml below in the app config. Basically this is going to tell backstage to automatically ingest entities from github and the two static locations you see are one for golden path templates and the other one is for ingesting all APIs from repo where I'm storing all API specifications</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">catalog:\n    import:\n    entityFileName: catalog-info.yaml\n    rules:\n    - allow: [Component, System, API, Resource, Location, Domain, Template]\n    locations:\n    - type: url\n        target: https://github.com/rprakashg-redhat/rhdh-templates/blob/main/all-templates.yaml\n    - type: url\n        target: https://github.com/rprakashg-redhat/apis/blob/main/all-apis.yaml</code></pre></div>\n<p>At this point we are ready to install redhat developer hub. We provide a Helm chart to do just that. We will add the helm chart repo with this command <em><code class=\"language-text\">helm repo add openshift-helm-charts https://charts.openshift.io/</code></em>. Next we need to download the values yaml so we can review and customize them to fit to this EKS installation.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">helm show values openshift-helm-charts/redhat-developer-hub > values.yaml</code></pre></div>\n<p>Customize the values yaml. You can see the version I used for my installation <a href=\"https://github.com/rprakashg-redhat/rhdh-on-eks/blob/main/deploy/rhdh/values.yaml\">here</a>.\nFew other customizations to values file that are worth calling out are below</p>\n<ol>\n<li>Specified the custom hostname <code class=\"language-text\">devhub.sandbox2841.opentlc.com</code> under section global of values yaml</li>\n<li>Since I was using HAProxy ingress under upstream section I had to enable ingress and specify className as shown in the snippet below</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ingress:\n    enabled: true\n    host: \"{{ .Values.global.host }}\"\n    className: haproxy</code></pre></div>\n<ol start=\"3\">\n<li>Tell developer hub about the app config by updating the extraAppConfig section under upstream->backstage section in values file as shown in snippet below</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">extraAppConfig:\n- configMapRef: \"developer-hub-appconfig\"\n  filename: \"developer-hub-appconfig.yaml\"</code></pre></div>\n<ol start=\"4\">\n<li>Update podSecurityContext section under upstream->backstage and include below config</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">podSecurityContext:\n    runAsUser: 1001\n    runAsGroup: 1001\n    fsGroup: 1001</code></pre></div>\n<ol start=\"5\">\n<li>Update podSecurityContext section under upstream->postgresql->primary section in values file as shown in snippet below</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">podSecurityContext:\n    enabled: true\n    fsGroup: 26\n    runAsUser: 26</code></pre></div>\n<p>and set volume permissions to enabled as shown in snippet below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">volumePermissions:\n    enabled: true</code></pre></div>\n<ol start=\"6\">\n<li>Lastly I had to set route enabled to false since I'm not running developer hub on Openshift.</li>\n</ol>\n<p>At this point we can go ahead and install redhat developer hub by running command <em><code class=\"language-text\">helm upgrade --namespace tools -i developer-hub -f values.yaml openshift-helm-charts/redhat-developer-hub</code></em></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">helm upgrade --namespace tools -i developer-hub -f values.yaml openshift-helm-charts/redhat-developer-hub</code></pre></div>\n<p>Browse to <em><code class=\"language-text\">https://devhub.sandbox2841.opentlc.com</code></em> from a browser and login and you will be in home page of developer hub as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/28b17bc865fbf5cf1eddb74c31dd8d3f/c2d13/devhubhome.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABFUlEQVR42oWQyU7DMBCG/UpIXErpQuGZWKQ0cKRcCqqKql7CI3FFLEpFgKaBRNmc2Fl+xgYkhNJi6dN4xv5/z5i1trZxa57BPr/AnTHEvXmKx6GJh8MjPB2fwDYMLCh/GY3wNh7DvbyCN5ngfT6Hb1kIrBuEiusp4tkMrNMf4HXpQpYlZFVBUBQUZV03kgqBKMv0XUVWSEhAo3SsPziA4ziQUqCmQk0iHRuo6LEoDOEHAXiaIuMcJdWq77OiKMDanR4W9rNOyAqblhLmea7hZKbIqNufmoLt7HaxWnlaoLvbwG/DdbBWuwvPXSJOOdJc/tuhoD9cZ6bOWG9vH77/oUcW8stQ/Yuk/V+UIEkSPWqTWRTH+ATO9QPErE/ovAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"devhubhome\"\n        title=\"\"\n        src=\"/static/28b17bc865fbf5cf1eddb74c31dd8d3f/5a190/devhubhome.png\"\n        srcset=\"/static/28b17bc865fbf5cf1eddb74c31dd8d3f/772e8/devhubhome.png 200w,\n/static/28b17bc865fbf5cf1eddb74c31dd8d3f/e17e5/devhubhome.png 400w,\n/static/28b17bc865fbf5cf1eddb74c31dd8d3f/5a190/devhubhome.png 800w,\n/static/28b17bc865fbf5cf1eddb74c31dd8d3f/c1b63/devhubhome.png 1200w,\n/static/28b17bc865fbf5cf1eddb74c31dd8d3f/29007/devhubhome.png 1600w,\n/static/28b17bc865fbf5cf1eddb74c31dd8d3f/c2d13/devhubhome.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Navigating to APIs you can see that petstore api was ingested into catalog automatically from the repo. Currently repo has only one API spec but as we add more API specs they would be automatically ingested into the catalog which is super cool.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b38495c951fb65d0bdb74d3f88c140f0/c2d13/apis.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVR42p2Qy07bUBRF/VNIlQptESp/AA0tj34AUyJAoAqplfgixp12yis8bNlJnIcdnKTx9bUdJ1mca2AAUiYMts5jn7vvPsfy601adoP7Kw+71sC5kfzCwZXYtNslGvdtfLtDyw3w3ZCWF+LXHwQR3WZEz39Cx+tirSx84F/lO5ffKpxXNqjt/OT6xya1tXXupLY3t3C2d6jv7uLv7dGuVukeHBCenNA/PSX4/Qf38BdBdR91fIS1uPSZjuuSDf+jej1G3QAd9ckGQ9K+iQPhhuRKkcfxE0Yx2WjETCfUxdXZ3wtubpulhrW8skonCCimU3SWEUkzLwqmQD6ZlLGYzlBpxmQ2o5BeonU5W86Mc7JUk0odJ4k4/LSM53kocTAUJ0qamZBpmr6CEXnJtRF8rk1UiSaRdyYXwS84jsNA1uvJyvpZ8L2wPsoNwzBkPB6Xv5hfDZHn+VzMEzOc3PArURRRyN2MZUOUa8gJ5uFl7q1YrBSPxtpBSg4C1TgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"apis\"\n        title=\"\"\n        src=\"/static/b38495c951fb65d0bdb74d3f88c140f0/5a190/apis.png\"\n        srcset=\"/static/b38495c951fb65d0bdb74d3f88c140f0/772e8/apis.png 200w,\n/static/b38495c951fb65d0bdb74d3f88c140f0/e17e5/apis.png 400w,\n/static/b38495c951fb65d0bdb74d3f88c140f0/5a190/apis.png 800w,\n/static/b38495c951fb65d0bdb74d3f88c140f0/c1b63/apis.png 1200w,\n/static/b38495c951fb65d0bdb74d3f88c140f0/29007/apis.png 1600w,\n/static/b38495c951fb65d0bdb74d3f88c140f0/c2d13/apis.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>To create new components we can click on create and you'll see all golden path templates ingested into the catalog as shown in screen capture below. I currently have just two.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6ae8ea059068618f507cd176d129edee/c2d13/templates.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVR42m2Qy27TQBhG/VBIbBqgquANQAWVbrhIoG4bUbW0UpFA6hq2fYAuoEtWSGxgC7Q4ECdxLnYutusk+Jo49uEfR0ICOtLRN/+MdOazNavTo2/aNOuCIfzoYnxr0NI79GTuNvp0jD5WY4BtjrAE23Sw2h52x2Nk+TjWBa4wbA/R1q5c5fP6Pc4fPER/8pSfjx5T27hP7fYd6ut3aci+ublJd2sLe3ubQbXKcGcH9/AF7stXtPcPae8eMKo+I9p/jlapXKf+5SvDVoux3WcyGgkOkecROpIXPtF4TDydEqscT8o5nU7whi4fPum8/3jGd71N7I/RVtdu0bEswijiV7ag+/Ydxt4e3vExwckJ1us39I6O8CSD01PSJCHNMtL5nJlkUeQU5GT5ojzTVq6tUjcMXGnjSCun0cQ9O2dimiSDAa6uCzXiXo+565Km6V8k8kAsqFRzKbSkoRoiaRkmKYuCcuVCPJuRSJMsz8mL4j/hv2grlRv4vs9c6sZxTCKofSaSROTqExdKOM+kScpMHlBcJlPn8g9vlsKlYFlbicMw/EMQBGVG0XJW95fJgjDkN0lvONQfEOenAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"templates\"\n        title=\"\"\n        src=\"/static/6ae8ea059068618f507cd176d129edee/5a190/templates.png\"\n        srcset=\"/static/6ae8ea059068618f507cd176d129edee/772e8/templates.png 200w,\n/static/6ae8ea059068618f507cd176d129edee/e17e5/templates.png 400w,\n/static/6ae8ea059068618f507cd176d129edee/5a190/templates.png 800w,\n/static/6ae8ea059068618f507cd176d129edee/c1b63/templates.png 1200w,\n/static/6ae8ea059068618f507cd176d129edee/29007/templates.png 1600w,\n/static/6ae8ea059068618f507cd176d129edee/c2d13/templates.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this was helpful. As always feel free to reach out to me if you have questions about this post or want to learn more about RedHat developer hub. I'm so excited about RedHat developer hub and backstage and the value it can add to development teams also what RedHat is doing in this space.</p>\n<p>Thanks,\nRam</p>","id":"cb7c86c4-bde9-59d7-b4ff-acc106a6001c","frontmatter":{"title":"Installing RedHat Developer Hub on Amazon Elastic Kubernetes Service (EKS)","date":"March, 2024","tags":["backstage","idp","kubernetes","eks","amazon","redhat"]},"fields":{"slug":"/installing-rhdh-on-eks/"}}},{"node":{"excerpt":"I thought I'll do this post to document some of the things I ran into when working with RedHat Developer Hub. I'm planning to keep this post updated as I learn more from my own research as well asâ€¦","html":"<p>I thought I'll do this post to document some of the things I ran into when working with RedHat Developer Hub. I'm planning to keep this post updated as I learn more from my own research as well as from customer implementations. My hope is that others will find this useful.</p>\n<p><strong>First</strong> thing I want to cover here is when you uninstall RedHat Developer Hub using helm uninstall both the PV and PVC used by Postgresql chart will still be on the cluster, because of this when you attempt to re-install the developer hub using Helm chart you will find that the Postgresql pod will not come up. Init container that configures volume permissions will fail. You are going to see this error <strong><code class=\"language-text\">chmod: changing permissions of '/var/lib/pgsql/data/userdata': Operation not permitted</code></strong> when you look at the logs for Postgresql pod. If you ran into this issue you can just simply delete the pvc first by running this command <em><code class=\"language-text\">kubectl delete pvc data-developer-hub-postgresql-0 -n tools</code></em> also make sure the associated pv is also deleted by running <em><code class=\"language-text\">kubectl get pv</code></em> and then re-install developer hub. Unfortunately we do not have much control over this as we embed the bitnami postgresql chart into the helm chart for installing developer hub</p>\n<p><strong>Second</strong> When you configure Redhat Developer Hub instance to use OKTA auth after successfully logging in you will see an error <strong><code class=\"language-text\">User not found</code></strong> this is mainly because the backstage will check to ensure a matching user entity exists in the catalog using signin resolvers. Many auth provider plugins automatically will create user entities in the catalog unfortunately Okta and Bitbucket plugins do not do this yet. One of my coworkers wrote this <a href=\"https://github.com/redhat-na-ssa/rhdh-bitbucket-auth/blob/main/Readme.Md\">post</a> that might be helpful if you are working with bitbucket or okta plugins for auth, although the article is for bitbucket, it should also work for okta.</p>\n<p><strong>Third</strong> Backstage can automatically build and publish your technical documentation and best practice is to build publish externally in a CICD pipeline. See an example of this <a href=\"https://github.com/rprakashg-redhat/petstore-go/blob/main/.github/workflows/techdocs.yaml\">here</a> backstage can serve static HTML files directly as you can see from the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ccda603cfa22e0df4d92aa81571f9c7/c2d13/techdocs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNElEQVR42p2Py07CQBSG+1a68EYI8U1AAXHPjpCw0bABfC0TLyTS0oKUMuVSoZ3OpSx+TxtDNCFBXXw5Z85MvvmPYVpT2C8OBs9DvBHWK/VPFuz+CJ45QTB24Q7e4fTHcC0P7nAG12aYOPOM6Yig6lOdOR6MwtExHssVDGq36JeuYFI1K1VYxSKs0jXschWjmxqm9Tq8RgN+s4lFq4Wg3ca600HY7SJ66CGms7i/g3F6nsOCMSRxDLHeYLNcZqgogtyEUGEIHXEIgocRtBBIdkgkUkLHYjc38oVLuDMGoTSk1mC+DzafQyoFlSRQNDvEcrVCSAE0vc8SBsEHttstBP3AKG1K2qtU+ke+hEEmlBQ/Tlf/pywTnpxd/BBqWuE37JOlcyOXL2D1TZhecM4Psk8WcY5PgqhFMBLc6UcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"techdocs\"\n        title=\"\"\n        src=\"/static/3ccda603cfa22e0df4d92aa81571f9c7/5a190/techdocs.png\"\n        srcset=\"/static/3ccda603cfa22e0df4d92aa81571f9c7/772e8/techdocs.png 200w,\n/static/3ccda603cfa22e0df4d92aa81571f9c7/e17e5/techdocs.png 400w,\n/static/3ccda603cfa22e0df4d92aa81571f9c7/5a190/techdocs.png 800w,\n/static/3ccda603cfa22e0df4d92aa81571f9c7/c1b63/techdocs.png 1200w,\n/static/3ccda603cfa22e0df4d92aa81571f9c7/29007/techdocs.png 1600w,\n/static/3ccda603cfa22e0df4d92aa81571f9c7/c2d13/techdocs.png 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When I was first trying out the techdocs capability configuring backstage to do a build and publish locally worked fine and could see the static HTML files directly from backstage but when I switch the configuration to external docs did not render in backstage. I was getting HTTP 404 errors and the reason for this was when you publish using techdocs CLI as shown in the snippet below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- name: Publish docs site\n  run: | \n  techdocs-cli publish --publisher-type awsS3 \\\n      --storage-name $TECHDOCS_S3_BUCKET_NAME \\\n      --entity $NAMESPACE/$KIND/$REPO_NAME</code></pre></div>\n<p>I was using k8s namespace as $NAMESPACE value. S3 router expects this to be <strong><code class=\"language-text\">default</code></strong> and also Kind should be Component matching the entity in catalog. After I fixed the pipeline I'm now able to view the static HTML files built in a CICD pipeline from backstage as you can see from the screen capture above.</p>\n<p>Hope this helps,\nRam</p>","id":"3f820f87-5a6f-5410-b55e-38c4dd0018bf","frontmatter":{"title":"Things you should know about RedHat Developer Hub","date":"March, 2024","tags":["backstage","idp","kubernetes","redhat"]},"fields":{"slug":"/rhdh-things-to-know/"}}}]}},"pageContext":{"tag":"redhat"}},"staticQueryHashes":["1611934721","2366241629"],"slicesMap":{}}