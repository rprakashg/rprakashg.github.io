{"componentChunkName":"component---src-templates-tag-js","path":"/tags/rhel/","result":{"data":{"site":{"siteMetadata":{"title":"rprakashg.github.io","author":"RAM GOPINATHAN"}},"allMarkdownRemark":{"totalCount":4,"edges":[{"node":{"excerpt":"In my last post I covered how to perform an IPMI install using a custom ISO but did not go into too much details on how to build a customized ISO for provisioning systems that run virtualized…","html":"<p>In my last post I covered how to perform an IPMI install using a custom ISO but did not go into too much details on how to build a customized ISO for provisioning systems that run virtualized protection and control applications. In this post I will walk through how to use Ansible and Imagebuilder to achieve just that</p>\n<h2>Provisioning a Host Machine as Image Builder</h2>\n<p>First thing we will need to do is provision imagebuilder host machine. I'm going to use a demo AWS environment and provision an EC2 instance using the RHEL 9 AMI provided by Red Hat. I've SSH'd into the host and connected it to Red Hat subscription and have ensure the system is up to date with all the packages. I've also updated my ansible inventory file like below</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">all</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">imagebuilder</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ansible_host</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;redacted>\"</span>\n      <span class=\"token key atrule\">ansible_port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">22</span>\n      <span class=\"token key atrule\">ansible_user</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ec2-user\"</span>\n      <span class=\"token key atrule\">ansible_ssh_private_key_file</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;redacted>\"</span></code></pre></div>\n<h2>Configuring the Image Builder host</h2>\n<p>To configure the RHEL host as imagebuilder we are going to use this <a href=\"https://github.com/rprakashg/demos/tree/main/roles/setup_imagebuilder\">role</a>. Role leverages infra.osbuild to configure the host as imagebuilder, additionally it add kernel rt and nfv repos to imagebuilder sources so we can install those packages references in the image definition. For more detailed information please checkout ansible code in the role. We are going to run a simple ansible playbook that leverages the role. Playbook looks like below</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Configure RHEL host as image builder \n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> imagebuilder\n  <span class=\"token key atrule\">gather_facts</span><span class=\"token punctuation\">:</span> yes\n\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Import role\n    <span class=\"token key atrule\">ansible.builtin.import_role</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> rprakashg.vpac.setup_imagebuilder</code></pre></div>\n<p>Next we are going to install the ansible collection as shown in the snippet below</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">ansible-galaxy collection <span class=\"token function\">install</span> git+https://github.com/rprakashg/vpac.git,main</code></pre></div>\n<p>Then we are going to run the playbook as shown in the command below</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">ansible-playbook <span class=\"token parameter variable\">-i</span> inventory setup_imagebuilder.yml</code></pre></div>\n<p>If everything goes well we should see an output like below screen capture</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5c5753ef7cdeb80ec048ef741a77cef4/b5514/setup_imagebuilder.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAeCYAXISD//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEAAQUCH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABgQAAIDAAAAAAAAAAAAAAAAAAEQABEx/9oACAEBAAE/IblosbDq/9oADAMBAAIAAwAAABCwADz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAaEAEBAQEBAQEAAAAAAAAAAAABACERMUFx/9oACAEBAAE/EFDjKfs+3rLZ7Ho7u2V+zf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"setup_imagebuilder\"\n        title=\"\"\n        src=\"/static/5c5753ef7cdeb80ec048ef741a77cef4/4b190/setup_imagebuilder.jpg\"\n        srcset=\"/static/5c5753ef7cdeb80ec048ef741a77cef4/e07e9/setup_imagebuilder.jpg 200w,\n/static/5c5753ef7cdeb80ec048ef741a77cef4/066f9/setup_imagebuilder.jpg 400w,\n/static/5c5753ef7cdeb80ec048ef741a77cef4/4b190/setup_imagebuilder.jpg 800w,\n/static/5c5753ef7cdeb80ec048ef741a77cef4/e5166/setup_imagebuilder.jpg 1200w,\n/static/5c5753ef7cdeb80ec048ef741a77cef4/b17f8/setup_imagebuilder.jpg 1600w,\n/static/5c5753ef7cdeb80ec048ef741a77cef4/b5514/setup_imagebuilder.jpg 2062w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Building a standardized custom image for provisioning RHEL based systems that run virtualized protection and control applications</h2>\n<p>Now that the imagebuilder server is configured and running we can now use it to build a standardized custom image with an anaconda kickstart file that automates provisioning RHEL based systems for deploying virtualization protection and control applications. Lets now look at how we are going to achieve that.</p>\n<h3>Defining a standardized base image</h3>\n<p>First thing we will need to do is to define a standardized base image. We can achieve this by creating an ansible vars file. Image definition looks like the below yaml snippet.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">retries</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span>\n<span class=\"token key atrule\">delay</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n\n<span class=\"token comment\"># blueprint details</span>\n<span class=\"token key atrule\">builder_blueprint_name</span><span class=\"token punctuation\">:</span> RHEL<span class=\"token punctuation\">-</span>9<span class=\"token punctuation\">-</span>6<span class=\"token punctuation\">-</span>Base\n<span class=\"token key atrule\">builder_blueprint_description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Base RHEL 9.6 for virtualization host\"</span>\n<span class=\"token key atrule\">builder_blueprint_distro</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"rhel-9\"</span>\n<span class=\"token key atrule\">builder_compose_pkgs</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> ansible<span class=\"token punctuation\">-</span>core\n<span class=\"token punctuation\">-</span> wget\n<span class=\"token punctuation\">-</span> firewalld\n<span class=\"token punctuation\">-</span> rhel<span class=\"token punctuation\">-</span>system<span class=\"token punctuation\">-</span>roles\n<span class=\"token punctuation\">-</span> cockpit\n<span class=\"token punctuation\">-</span> cockpit<span class=\"token punctuation\">-</span>machines\n<span class=\"token punctuation\">-</span> cockpit<span class=\"token punctuation\">-</span>podman\n<span class=\"token punctuation\">-</span> cloud<span class=\"token punctuation\">-</span>init\n<span class=\"token punctuation\">-</span> cloud<span class=\"token punctuation\">-</span>utils<span class=\"token punctuation\">-</span>growpart\n<span class=\"token punctuation\">-</span> unzip\n<span class=\"token punctuation\">-</span> bzip2\n<span class=\"token punctuation\">-</span> zstd\n<span class=\"token punctuation\">-</span> mkisofs\n<span class=\"token punctuation\">-</span> qemu<span class=\"token punctuation\">-</span>kvm\n<span class=\"token punctuation\">-</span> libvirt\n<span class=\"token punctuation\">-</span> virt<span class=\"token punctuation\">-</span>install\n<span class=\"token punctuation\">-</span> virt<span class=\"token punctuation\">-</span>viewer\n<span class=\"token punctuation\">-</span> swtpm\n<span class=\"token punctuation\">-</span> swtpm<span class=\"token punctuation\">-</span>tools\n<span class=\"token punctuation\">-</span> dosfstools\n<span class=\"token punctuation\">-</span> edk2<span class=\"token punctuation\">-</span>ovmf <span class=\"token comment\">#uefi firmware for windows 11 install</span>\n<span class=\"token punctuation\">-</span> kernel<span class=\"token punctuation\">-</span>rt\n<span class=\"token punctuation\">-</span> kernel<span class=\"token punctuation\">-</span>rt<span class=\"token punctuation\">-</span>kvm\n<span class=\"token punctuation\">-</span> tuned<span class=\"token punctuation\">-</span>profiles<span class=\"token punctuation\">-</span>nfv<span class=\"token punctuation\">-</span>host\n<span class=\"token punctuation\">-</span> realtime<span class=\"token punctuation\">-</span>tests\n<span class=\"token punctuation\">-</span> dnf<span class=\"token punctuation\">-</span>plugins<span class=\"token punctuation\">-</span>core\n<span class=\"token punctuation\">-</span> python3<span class=\"token punctuation\">-</span>dnf<span class=\"token punctuation\">-</span>plugin<span class=\"token punctuation\">-</span>versionlock <span class=\"token comment\">#versionlock </span>\n<span class=\"token key atrule\">builder_compose_customizations</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"cockpit.socket\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"firewalld\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">firewall</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"http\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"https\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ssh\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cockpit\"</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">disabled</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"telnet\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"9090:tcp\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"22:tcp\"</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># Kickstart customizations</span>\n<span class=\"token key atrule\">builder_kickstart_options</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> lang en_US.UTF<span class=\"token punctuation\">-</span><span class=\"token number\">8</span>\n<span class=\"token punctuation\">-</span> keyboard us\n<span class=\"token punctuation\">-</span> timezone America/Los_Angeles <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>utc\n<span class=\"token punctuation\">-</span> text\n<span class=\"token punctuation\">-</span> liveimg <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>url file<span class=\"token punctuation\">:</span>///run/install/repo/liveimg.tar.gz\n<span class=\"token punctuation\">-</span> zerombr <span class=\"token comment\"># Clear the MBR/GPT on all detected disks</span>\n<span class=\"token punctuation\">-</span> bootloader <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>location=mbr\n<span class=\"token punctuation\">-</span> clearpart <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>all <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>initlabel <span class=\"token comment\"># Clears all partitions on sda and initializes the disk label</span>\n<span class=\"token punctuation\">-</span> part /boot <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>fstype=ext4 <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>size=4096 <span class=\"token comment\"># Creates a /boot partition with ext4 filesystem, 4GB size to accomodate multiple kernels</span>\n<span class=\"token punctuation\">-</span> part /boot/efi <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>fstype=efi <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>size=600\n<span class=\"token punctuation\">-</span> part pv.01 <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>size=1 <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>grow <span class=\"token comment\"># Create a physical volume for LVM</span>\n<span class=\"token punctuation\">-</span> <span class=\"token comment\"># Setup LVM</span>\n<span class=\"token punctuation\">-</span> volgroup vg_system pv.01\n<span class=\"token punctuation\">-</span> logvol / <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>vgname=vg_system <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>name=lv_root <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>fstype=xfs <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>size=150000\n<span class=\"token punctuation\">-</span> logvol /home <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>vgname=vg_system <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>name=lv_home <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>fstype=xfs <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>size=200000\n<span class=\"token punctuation\">-</span> logvol /vms <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>vgname=vg_system <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>name=lv_vms <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>fstype=xfs <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>size=500000\n<span class=\"token punctuation\">-</span> logvol swap <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>vgname=vg_system <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>name=lv_swap <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>recommended\n<span class=\"token punctuation\">-</span> network <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>bootproto=dhcp <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>activate <span class=\"token comment\">#auto detect network</span>\n<span class=\"token punctuation\">-</span> reboot <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>eject\n\n<span class=\"token comment\"># cloudinit</span>\n<span class=\"token key atrule\">hostname</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"vpac-rhel\"</span></code></pre></div>\n<p>Snippet above is pretty self explanatory so I won't go into too much details. Customize the above image definition to fit to your needs.</p>\n<h2>Building a custom ISO using the standardized image definition above</h2>\n<p>Next we will build a custom ISO using the standardized image definition we created earlier. Steps to automate this is implemented in this ansible <a href=\"https://github.com/rprakashg/vpac/tree/main/roles/build_iso\">role</a> in <a href=\"https://github.com/rprakashg/vpac\">vpac</a> ansible collection.</p>\n<p>Below you will find description of the settable variables for this role.</p>\n<table>\n<thead>\n<tr>\n<th>Variable Name</th>\n<th>Purpose</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>retries</td>\n<td>Number of retries for compose job status</td>\n</tr>\n<tr>\n<td>delay</td>\n<td>delay between retries for compose job status</td>\n</tr>\n<tr>\n<td>skip_blueprint_creation</td>\n<td>Flag to turn off blueprint creation. Useful when you haven't made any changes</td>\n</tr>\n<tr>\n<td>skip_compose</td>\n<td>Skip starting a new compose job, useful when you want to leverage artifacts from an existing compose job. If this is set to true then compose_job_id variable is required.</td>\n</tr>\n<tr>\n<td>compose_job_id</td>\n<td>Compose job id, this is automatically set when compose job is triggered. If compose job is skipped then the compose job id must be passed as value</td>\n</tr>\n<tr>\n<td>builder_blueprint_name</td>\n<td>osbuild blueprint name</td>\n</tr>\n<tr>\n<td>builder_blueprint_description</td>\n<td>osbuild blueprint description</td>\n</tr>\n<tr>\n<td>builder_blueprint_distro</td>\n<td>RHEL distro to use</td>\n</tr>\n<tr>\n<td>builder_compose_pkgs</td>\n<td>additional packages that need to be included</td>\n</tr>\n<tr>\n<td>builder_compose_customizations</td>\n<td>Customizations</td>\n</tr>\n<tr>\n<td>builder_kickstart_options</td>\n<td>Anaconda kickstart options to include</td>\n</tr>\n</tbody>\n</table>\n<p>When the role is executed the first thing we do is create a image builder blueprint based on the image definition in ansible vars file. If you have not made any changes to blueprint you can skip this by setting <code class=\"language-text\">skip_blueprint_creation</code> to true. To create the image builder blueprint, the role leverages <a href=\"https://github.com/redhat-cop/infra.osbuild/blob/main/plugins/modules/create_blueprint.py\">create_blueprint</a> plugin from infra.osbuild collection.</p>\n<p>Next step is to start an <code class=\"language-text\">image-installer</code> compose job using the blueprint to build a custom ISO and wait for the compose job to finish. When no changes have been made to blueprint and you have a pre-existing compose job that completed successfully you can skip the compose job by setting <code class=\"language-text\">skip_compose</code> to <code class=\"language-text\">true</code> and specify the job id of previously completed compose job you want to use in variable <code class=\"language-text\">compose_job_id</code></p>\n<p>Once the compose job is successfully completed, ISO artifact file is downloaded into a temp directory. Role then creates cloud-init files to perform first boot initialization steps like creating an admin user and setting the SSH key for the admin user. Additionally an anaconda kickstart file is generated using the kickstart options defined in the ansible vars file. Once the cloud init and kickstart files are generated we inject these into the ISO we downloaded earlier and create a customized ISO. For the purposes of this post I'm injecting the cloud init files also into ISO but ideally you'd want to create a seperate ISO and mount both ISO files while provisioning the system and you would just need to read the cloud init files from the mounted directory path for the cloud init iso.</p>\n<h2>Create an ansible vault to store sensive secrets</h2>\n<p>As mentioned earlier creating cloud init files require sensive information like admin password, ssh key to use etc which are read from an ansible vault. We are going to create the ansbile vault by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">ansible-vault create vars/secrets.yml</code></pre></div>\n<p>and include this snippet below</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">root_password</span><span class=\"token punctuation\">:</span> &lt;redacted<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">rh_user</span><span class=\"token punctuation\">:</span> &lt;redacted<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">rh_user_password</span><span class=\"token punctuation\">:</span> &lt;redacted<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">admin_user</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'admin'</span>\n<span class=\"token key atrule\">admin_user_password</span><span class=\"token punctuation\">:</span> &lt;redacted<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">admin_user_ssh_key</span><span class=\"token punctuation\">:</span> &lt;redacted<span class=\"token punctuation\">></span> </code></pre></div>\n<h2>Create an ansible playbook that leverages the build_iso role</h2>\n<p>We can now create an ansible playbook that leverages the <a href=\"https://github.com/rprakashg/vpac/tree/main/roles/build_iso\">build_iso</a> role in the <a href=\"https://github.com/rprakashg/vpac\">collection</a></p>\n<p>See ansible code in the yaml snippet below</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token comment\"># This playbook builds ISO with kickstart for unattended </span>\n<span class=\"token comment\"># installation of RHEL on Baremetal host for virtualization</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build ISO\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> imagebuilder\n  <span class=\"token key atrule\">become</span><span class=\"token punctuation\">:</span> yes\n  <span class=\"token key atrule\">gather_facts</span><span class=\"token punctuation\">:</span> yes\n\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Start\n    <span class=\"token key atrule\">ansible.builtin.debug</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Starting ISO build\"</span>\n  \n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Load secrets from ansible vault\n    <span class=\"token key atrule\">ansible.builtin.include_vars</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"./vars/secrets.yml\"</span>\n\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build ISO\n    <span class=\"token key atrule\">ansible.builtin.import_role</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> rprakashg.vpac.build_iso</code></pre></div>\n<p>If everything goes well we should see the playbook completed successfully without errors and see an output like the screen capture below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/049c7da835811c8eefd5281e90e71aa4/856de/build_iso.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHBm5RDF//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABYQAQEBAAAAAAAAAAAAAAAAAAEQAP/aAAgBAQABPyGgOZ//2gAMAwEAAgADAAAAEPQP/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QCf/EABURAQEAAAAAAAAAAAAAAAAAABEQ/9oACAECAQE/EAn/xAAZEAEAAwEBAAAAAAAAAAAAAAABABARMSH/2gAIAQEAAT8Q0j1pg06zwuV//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build_iso\"\n        title=\"\"\n        src=\"/static/049c7da835811c8eefd5281e90e71aa4/4b190/build_iso.jpg\"\n        srcset=\"/static/049c7da835811c8eefd5281e90e71aa4/e07e9/build_iso.jpg 200w,\n/static/049c7da835811c8eefd5281e90e71aa4/066f9/build_iso.jpg 400w,\n/static/049c7da835811c8eefd5281e90e71aa4/4b190/build_iso.jpg 800w,\n/static/049c7da835811c8eefd5281e90e71aa4/e5166/build_iso.jpg 1200w,\n/static/049c7da835811c8eefd5281e90e71aa4/b17f8/build_iso.jpg 1600w,\n/static/049c7da835811c8eefd5281e90e71aa4/856de/build_iso.jpg 3584w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Since the custom ISO is in an Ansible temp directory we can ssh into the image builder host and move it to a directory under <code class=\"language-text\">/home</code> using command below</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> <span class=\"token operator\">&lt;</span>custom iso path printed by the ansible role<span class=\"token operator\">></span> <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>We can now download this file from the image builder host and perform IPMI based installation for provisioning virtualization hosts that run virtualized protection and control applications.</p>\n<p>Hope this post was helpful, as always feel free to reach out to me if you have any questions about this post.</p>\n<p>Thanks,</p>\n<p>Ram</p>","id":"a383c26b-c991-50ff-ad8f-24ce0087ebf8","frontmatter":{"title":"Using Ansible and Image Builder to Automate Customized RHEL Image Builds for Virtualization Hosts Running Virtualized Protection and Control Software","date":"November, 2025","tags":["OS","RHEL","Linux","ImageBuilder"]},"fields":{"slug":"/build_iso_images_for_vpac/"}}},{"node":{"excerpt":"In this post, I’ll walk through how to perform a fully automated and unattended install of Red Hat Enterprise Linux (RHEL) on a bare-metal server remotely using the IPMI web interface. For readers who…","html":"<p>In this post, I’ll walk through how to perform a fully automated and unattended install of <strong>Red Hat Enterprise Linux (RHEL)</strong> on a bare-metal server <strong>remotely using the IPMI web interface</strong>. For readers who are not familiar with IPMI, IPMI stands for integrated platform management interface. Its an open standard for hardware management. I've long been wanting to write about this but finally getting to it now.</p>\n<p>For this demonstration, we’ll install RHEL on an <strong>Advantech ECU579</strong> server. This system is equipped with an <strong>ASPEED 2500 BMC</strong> chip and supports <strong>IPMI 2.0</strong> over the onboard LAN interface.</p>\n<hr>\n<h3>Preparing IPMI Access</h3>\n<p>The Advantech ECU579 includes four onboard Ethernet ports. To enable remote IPMI access, connect your Ethernet cable to <strong>LAN1</strong>.</p>\n<p>Before proceeding, ensure that <strong>IPMI is enabled</strong> and that it has a valid <strong>IP address</strong> configured in the <strong>BIOS</strong>.<br>\nYou can either assign a <strong>static IP</strong> or let it obtain one automatically via <strong>DHCP</strong>.</p>\n<p>If you’ve configured a <strong>static IP</strong>, make sure your local system’s network settings are manually adjusted to be within the <strong>same subnet</strong>.<br>\nFor example, in my setup:</p>\n<ul>\n<li>IPMI IP address: <code class=\"language-text\">172.16.10.30</code></li>\n<li>Local system IP address: <code class=\"language-text\">172.16.10.40</code></li>\n</ul>\n<hr>\n<p>You should now see the IPMI login page like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9daffb9127527fefb7f54c0d4c3e4575/41099/ipmilogin.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAMBAP/aAAwDAQACEAMQAAAB6ues1HcmNbDQJf/EABwQAAEFAAMAAAAAAAAAAAAAAAABAgMREhATM//aAAgBAQABBQKVxajV02R2Ze1CLyopOP/EABkRAAIDAQAAAAAAAAAAAAAAAAExAAIQIf/aAAgBAwEBPwE264Fv/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQITH/2gAIAQIBAT8BSoez/8QAHxAAAAMJAAAAAAAAAAAAAAAAAAEQAgMREiIxMmGB/9oACAEBAAY/ApauDJ4Igj0jKWT/xAAbEAEAAwEAAwAAAAAAAAAAAAABABExIWGRof/aAAgBAQABPyGurBe3ICOLBA4wmJ5O9nySjoM8T1Mn/9oADAMBAAIAAwAAABCwyL3/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEx/9oACAEDAQE/EDEOJaFnscv/xAAYEQEBAQEBAAAAAAAAAAAAAAABABEhMf/aAAgBAgEBPxDmwhiI8m//xAAeEAEBAAEEAwEAAAAAAAAAAAABEQAhMWFxQcHw8f/aAAgBAQABPxAJIaUsHbFQoDGN46w1UGg5cCUad9mbwaDJ71z6OXN2pyXPxWQ0AAeDP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ipmi-login\"\n        title=\"\"\n        src=\"/static/9daffb9127527fefb7f54c0d4c3e4575/41099/ipmilogin.jpg\"\n        srcset=\"/static/9daffb9127527fefb7f54c0d4c3e4575/e07e9/ipmilogin.jpg 200w,\n/static/9daffb9127527fefb7f54c0d4c3e4575/066f9/ipmilogin.jpg 400w,\n/static/9daffb9127527fefb7f54c0d4c3e4575/41099/ipmilogin.jpg 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Go ahead and log in with your credentials.</p>\n<hr>\n<h3>Mounting the RHEL ISO</h3>\n<p>After logging in, find the <strong>Virtual Media</strong> option in the menu.  Since we’ll be installing RHEL remotely, choose <strong>Virtual Media over HTML5</strong>.</p>\n<p>Here’s what it looks like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ca2a8a0c730c2a9c6b7d1b01f99051ad/8ec0a/virtualmedia.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHVtEgL/8QAFhABAQEAAAAAAAAAAAAAAAAAAhAh/9oACAEBAAEFAhon/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAQADAAAAAAAAAAAAAAAAAAECEFH/2gAIAQEABj8CiuX/AP/EABkQAAIDAQAAAAAAAAAAAAAAAAABITFRgf/aAAgBAQABPyF7Q2hwjD//2gAMAwEAAgADAAAAEIgP/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEx/9oACAEDAQE/EMI//8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/EDV//8QAGRABAAIDAAAAAAAAAAAAAAAAAQAxESFh/9oACAEBAAE/EE3AC9xBCgRE0J//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"virtual-media\"\n        title=\"\"\n        src=\"/static/ca2a8a0c730c2a9c6b7d1b01f99051ad/4b190/virtualmedia.jpg\"\n        srcset=\"/static/ca2a8a0c730c2a9c6b7d1b01f99051ad/e07e9/virtualmedia.jpg 200w,\n/static/ca2a8a0c730c2a9c6b7d1b01f99051ad/066f9/virtualmedia.jpg 400w,\n/static/ca2a8a0c730c2a9c6b7d1b01f99051ad/4b190/virtualmedia.jpg 800w,\n/static/ca2a8a0c730c2a9c6b7d1b01f99051ad/e5166/virtualmedia.jpg 1200w,\n/static/ca2a8a0c730c2a9c6b7d1b01f99051ad/b17f8/virtualmedia.jpg 1600w,\n/static/ca2a8a0c730c2a9c6b7d1b01f99051ad/8ec0a/virtualmedia.jpg 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>A new popup window will open:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2f92ccc779bcddb7cf33b06fb6125698/29d31/selectiso.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdtqhIYf/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAEQEjH/2gAIAQEAAQUCKjFD3//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAICAwAAAAAAAAAAAAAAAAABESEQMVH/2gAIAQEAAT8hSmqIcRRm2b//2gAMAwEAAgADAAAAEEcP/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Qp//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB0QAQADAAEFAAAAAAAAAAAAAAEAESFBUWGhsdH/2gAIAQEAAT8QLIWbdwFs8n2EpMgwoPTtCjip6p//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"selectiso\"\n        title=\"\"\n        src=\"/static/2f92ccc779bcddb7cf33b06fb6125698/29d31/selectiso.jpg\"\n        srcset=\"/static/2f92ccc779bcddb7cf33b06fb6125698/e07e9/selectiso.jpg 200w,\n/static/2f92ccc779bcddb7cf33b06fb6125698/066f9/selectiso.jpg 400w,\n/static/2f92ccc779bcddb7cf33b06fb6125698/29d31/selectiso.jpg 700w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>From the dropdown, choose <strong>ISO File</strong>, select your RHEL ISO from your local system, and click <strong>Mount ISO</strong>.</p>\n<blockquote>\n<p><strong>Heads up:</strong> Don’t close this popup window — keep it open while the installation runs!</p>\n</blockquote>\n<hr>\n<h3>Starting the Remote Console</h3>\n<p>Now head over to <strong>Remote Control → iKVM over HTML5</strong>, and click <strong>Launch iKVM over HTML5</strong>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9f2c0e638804881f2518523f97b8bca0/8ec0a/ikvmoverhtml5.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdWggL//xAAWEAEBAQAAAAAAAAAAAAAAAAACECH/2gAIAQEAAQUCGif/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxABAAMAAAAAAAAAAAAAAAAAAQIQUf/aAAgBAQAGPwKK5f8A/8QAGBABAQADAAAAAAAAAAAAAAAAAQARMXH/2gAIAQEAAT8he0KLlgv/2gAMAwEAAgADAAAAEPgP/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERMf/aAAgBAwEBPxDEKf/EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxA1f//EABoQAQACAwEAAAAAAAAAAAAAAAEAITFhgZH/2gAIAQEAAT8QS4AXkowCaDyf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ikvm\"\n        title=\"\"\n        src=\"/static/9f2c0e638804881f2518523f97b8bca0/4b190/ikvmoverhtml5.jpg\"\n        srcset=\"/static/9f2c0e638804881f2518523f97b8bca0/e07e9/ikvmoverhtml5.jpg 200w,\n/static/9f2c0e638804881f2518523f97b8bca0/066f9/ikvmoverhtml5.jpg 400w,\n/static/9f2c0e638804881f2518523f97b8bca0/4b190/ikvmoverhtml5.jpg 800w,\n/static/9f2c0e638804881f2518523f97b8bca0/e5166/ikvmoverhtml5.jpg 1200w,\n/static/9f2c0e638804881f2518523f97b8bca0/b17f8/ikvmoverhtml5.jpg 1600w,\n/static/9f2c0e638804881f2518523f97b8bca0/8ec0a/ikvmoverhtml5.jpg 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Once the console opens, use the <strong>Power Control</strong> menu to power on the server.  If needed, hop into the BIOS and double-check the <strong>boot order</strong> — make sure it’s set to boot from <strong>CDROM</strong> so it picks up the mounted ISO.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a550c01694fd7020048403593eb34b7/31be4/biosupdate.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAL/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAASmoB//EABgQAAMBAQAAAAAAAAAAAAAAAAABEgIR/9oACAEBAAEFAoRGSMlI6ikf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAACH/2gAIAQIBAT8Bqv/EABcQAQADAAAAAAAAAAAAAAAAAAABMTL/2gAIAQEABj8CzDMMwta3/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQ4fHw/9oACAEBAAE/IccVAZpyQ42//9oADAMBAAIAAwAAABD8/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAwEBPxCI/8QAFxEBAAMAAAAAAAAAAAAAAAAAABFhgf/aAAgBAgEBPxCbtv/EABwQAQACAwADAAAAAAAAAAAAAAEAESFRcTGR0f/aAAgBAQABPxArcHBEAIm6ZltWlbMNVOosAAcYV+Pp+T//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bios\"\n        title=\"\"\n        src=\"/static/0a550c01694fd7020048403593eb34b7/4b190/biosupdate.jpg\"\n        srcset=\"/static/0a550c01694fd7020048403593eb34b7/e07e9/biosupdate.jpg 200w,\n/static/0a550c01694fd7020048403593eb34b7/066f9/biosupdate.jpg 400w,\n/static/0a550c01694fd7020048403593eb34b7/4b190/biosupdate.jpg 800w,\n/static/0a550c01694fd7020048403593eb34b7/31be4/biosupdate.jpg 806w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<hr>\n<h3>Installing RHEL</h3>\n<p>Once the system boots from the ISO, you’ll see the familiar RHEL boot menu:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/97b0a2f1e6c1081cbf12092a2109be26/8ec0a/bootmenu.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGAAD//xAAVEAEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAQABBQKqr//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABcQAAMBAAAAAAAAAAAAAAAAAAABEVH/2gAIAQEAAT8hrWVrK1n/2gAMAwEAAgADAAAAEHAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAFxABAQEBAAAAAAAAAAAAAAAAAPEB4f/aAAgBAQABPxCs3uKz/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"install\"\n        title=\"\"\n        src=\"/static/97b0a2f1e6c1081cbf12092a2109be26/4b190/bootmenu.jpg\"\n        srcset=\"/static/97b0a2f1e6c1081cbf12092a2109be26/e07e9/bootmenu.jpg 200w,\n/static/97b0a2f1e6c1081cbf12092a2109be26/066f9/bootmenu.jpg 400w,\n/static/97b0a2f1e6c1081cbf12092a2109be26/4b190/bootmenu.jpg 800w,\n/static/97b0a2f1e6c1081cbf12092a2109be26/e5166/bootmenu.jpg 1200w,\n/static/97b0a2f1e6c1081cbf12092a2109be26/b17f8/bootmenu.jpg 1600w,\n/static/97b0a2f1e6c1081cbf12092a2109be26/8ec0a/bootmenu.jpg 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Select <strong>Install Red Hat Enterprise Linux 9.6</strong> and hit <strong>Enter</strong>. At this point, your server will begin a <strong>fully automated, unattended installation</strong> of RHEL using your <strong>custom kickstart file</strong>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8602f49d15abab69f72ea1f021e92278/8ec0a/ksinstall.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABwQEC/wD/xAAWEAADAAAAAAAAAAAAAAAAAAAAARH/2gAIAQEAAQUCrKys/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAABAx/9oACAEBAAY/AlT/xAAaEAACAgMAAAAAAAAAAAAAAAAAARGRMVFh/9oACAEBAAE/IVNl2PY7Oiz/2gAMAwEAAgADAAAAEP8Az//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EFn/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAYEAEBAQEBAAAAAAAAAAAAAAABAJEh8f/aAAgBAQABPxAoTdL67L2F/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ksinstall\"\n        title=\"\"\n        src=\"/static/8602f49d15abab69f72ea1f021e92278/4b190/ksinstall.jpg\"\n        srcset=\"/static/8602f49d15abab69f72ea1f021e92278/e07e9/ksinstall.jpg 200w,\n/static/8602f49d15abab69f72ea1f021e92278/066f9/ksinstall.jpg 400w,\n/static/8602f49d15abab69f72ea1f021e92278/4b190/ksinstall.jpg 800w,\n/static/8602f49d15abab69f72ea1f021e92278/e5166/ksinstall.jpg 1200w,\n/static/8602f49d15abab69f72ea1f021e92278/b17f8/ksinstall.jpg 1600w,\n/static/8602f49d15abab69f72ea1f021e92278/8ec0a/ksinstall.jpg 2560w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After the installation is complete you should see a screen like below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1aebedbf4718c402552fc848ce6eda1d/d0328/postinstall.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABy0YsRgAD/8QAFxAAAwEAAAAAAAAAAAAAAAAAAAMUIP/aAAgBAQABBQKpxU8qfv8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEzIP/aAAgBAQAGPwKjKMo9/wD/xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAE/IR27/9oADAMBAAIAAwAAABDDAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAYEAADAQEAAAAAAAAAAAAAAAAB0fEAIP/aAAgBAQABPxCsFrIWvhd//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"postinstall\"\n        title=\"\"\n        src=\"/static/1aebedbf4718c402552fc848ce6eda1d/4b190/postinstall.jpg\"\n        srcset=\"/static/1aebedbf4718c402552fc848ce6eda1d/e07e9/postinstall.jpg 200w,\n/static/1aebedbf4718c402552fc848ce6eda1d/066f9/postinstall.jpg 400w,\n/static/1aebedbf4718c402552fc848ce6eda1d/4b190/postinstall.jpg 800w,\n/static/1aebedbf4718c402552fc848ce6eda1d/d0328/postinstall.jpg 1135w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<hr>\n<h3>About the Kickstart File</h3>\n<p>To make the installation completely hands-free, your ISO needs a <strong>custom kickstart configuration</strong>. Without it, the installer will start a <strong>VNC session</strong>, and you’ll have to complete setup manually using a VNC client, this is because of the graphical installer. Who uses GUI installer right? :)</p>\n<p>I’ve automated all the steps for building ISO with custom kickstart along with cloud-init for initializating the provisioned system using <strong>Ansible</strong>, so the install runs start to finish without any manual steps.\nIf you’d like to try that out, check out my GitHub repo here:<br>\n👉 <a href=\"http://github.com/rprakashg-rh/enlit-build\">rprakashg-rh/enlit-build</a></p>\n<hr>\n<p>That’s it! You’ve just installed RHEL remotely using IPMI. Hopefully this walkthrough saves you some time and helps you set up your own remote installs more easily.</p>\n<p>If you run into any issues or have questions, feel free to reach out — happy to help.</p>\n<p>Thanks for reading,<br>\n<strong>Ram</strong></p>","id":"2f3d2aa6-cd4b-5338-a360-5f636414397c","frontmatter":{"title":"Installing Red Hat Enterprise Linux on bare metal servers Using IPMI","date":"October, 2025","tags":["OS","RHEL","Linux"]},"fields":{"slug":"/installing-rhel-using-ipmi/"}}},{"node":{"excerpt":"One of the things I've been focusing on in my new role with the industrial edge team is device onboarding, and FDO is a key enabling technology that we are super excited about since it solves a lot of…","html":"<p>One of the things I've been focusing on in my new role with the industrial edge team is device onboarding, and FDO is a key enabling technology that we are super excited about since it solves a lot of the device onboarding challenges. When I first started learning about FDO, what I got was a link to the FIDO Alliance website and also the FDO specification for device onboarding. This was like jumping straight into the weeds. I had to understand some of the challenges with device onboarding and also needed to get a big picture view of the components in FDO and their key roles and functions within the entire lifecycle of an edge/IoT device, starting from manufacturing to the supply chain to when the device arrives at the owner's location and is powered on. This post is meant to provide just that. I would also like to give a huge shout out to my teammate <a href=\"https://github.com/luisarizmendi\">Luis</a>; some of his work has definitely been a huge influence in writing this article and also helping me approach this with the right perspective. Please check out his GitHub, as he is always creating awesome content. With that, let's get right into it.</p>\n<p><strong>Defining what device onboarding is:</strong>\nDevice onboarding is the process of connecting and integrating a device into a network or system so it can start operating and communicating with other devices and services. Typically, this involves configuring the device's settings, establishing secure connections, and ensuring it can be managed and monitored within the device management infrastructure.</p>\n<h2>Device onboarding mechanisms without FDO</h2>\n<p>Here are some approaches that we see today on how new devices are onboarded.</p>\n<h3>Traditional device onboarding</h3>\n<p>The diagram below shows the traditional device onboarding approach. Here, a device manufacturer sends the device and a specialist to the device owner's location. The specialist then installs and configures the device. This process is slow and expensive when you have to install and configure devices in many locations.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b38fe0e215d53a6300076593004ce157/e9b2c/traditional-onboarding.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd9OCwD/xAAWEAEBAQAAAAAAAAAAAAAAAAAAQRD/2gAIAQEAAQUCTI//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAYEAACAwAAAAAAAAAAAAAAAAAAIREgcf/aAAgBAQABPyFyPVf/2gAMAwEAAgADAAAAECfP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAAICAwAAAAAAAAAAAAAAAQAhEUEQMYH/2gAIAQEAAT8QLMtag3Keq5FzvcOif//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"traditionalonboarding\"\n        title=\"\"\n        src=\"/static/b38fe0e215d53a6300076593004ce157/4b190/traditional-onboarding.jpg\"\n        srcset=\"/static/b38fe0e215d53a6300076593004ce157/e07e9/traditional-onboarding.jpg 200w,\n/static/b38fe0e215d53a6300076593004ce157/066f9/traditional-onboarding.jpg 400w,\n/static/b38fe0e215d53a6300076593004ce157/4b190/traditional-onboarding.jpg 800w,\n/static/b38fe0e215d53a6300076593004ce157/e5166/traditional-onboarding.jpg 1200w,\n/static/b38fe0e215d53a6300076593004ce157/b17f8/traditional-onboarding.jpg 1600w,\n/static/b38fe0e215d53a6300076593004ce157/e9b2c/traditional-onboarding.jpg 1758w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>Automatic/Hands-off device onboarding</h3>\n<p>The diagram below shows an automatic/hands-off device onboarding approach where the device manufacturer ships the device to the device owner's location. Once the device arrives at the location, anyone at the location can connect the device to the network and power it on, after which the device will auto-install and configure itself. With this approach, there is really no secure way to verify the authenticity of the device and where it came from. Also, the person connecting the device to the internal network has no way of knowing if the device is compromised or being tampered with. This approach can also get complex and error-prone when you have to install and configure devices in other locations.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4df496afc47111af1ab57d3fdad3a46a/95e20/handsoff-onboarding.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe82Cwf/xAAWEAEBAQAAAAAAAAAAAAAAAAAAQRD/2gAIAQEAAQUCTI//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAACAgMAAAAAAAAAAAAAAAAAARAxESFx/9oACAEBAAE/IVb0cTkqj//aAAwDAQACAAMAAAAQtw//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAACAwEBAAAAAAAAAAAAAAABEQAhMVEQ/9oACAEBAAE/ECNiXvYCQ2ueHIzF3LgZ/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"handsoffonboarding\"\n        title=\"\"\n        src=\"/static/4df496afc47111af1ab57d3fdad3a46a/4b190/handsoff-onboarding.jpg\"\n        srcset=\"/static/4df496afc47111af1ab57d3fdad3a46a/e07e9/handsoff-onboarding.jpg 200w,\n/static/4df496afc47111af1ab57d3fdad3a46a/066f9/handsoff-onboarding.jpg 400w,\n/static/4df496afc47111af1ab57d3fdad3a46a/4b190/handsoff-onboarding.jpg 800w,\n/static/4df496afc47111af1ab57d3fdad3a46a/e5166/handsoff-onboarding.jpg 1200w,\n/static/4df496afc47111af1ab57d3fdad3a46a/b17f8/handsoff-onboarding.jpg 1600w,\n/static/4df496afc47111af1ab57d3fdad3a46a/95e20/handsoff-onboarding.jpg 1644w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>What we need?</h2>\n<p>What we need is an onboarding process that can scale to thousands of devices across many edge locations and is secure to ensure the integrity and authenticity of the device from manufacturing to the supply chain to when the device finally arrives at the owner's location and is powered on. FDO is an automatic onboarding protocol that can be leveraged to solve some of the device onboarding challenges. The protocol and specifications are part of the FIDO Alliance, an open industry group. You can read more about the protocol and standards related to device onboarding <a href=\"https://fidoalliance.org/device-onboarding-overview/\">here</a>.</p>\n<p>The diagram below shows a device onboarding flow with FDO from manufacturing to the supply chain to when the device finally arrives at the owner's location and is powered on.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/17f58627e747905744d4fad893aa32db/3bcce/fdo-onboarding.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe9NCKP/xAAWEAADAAAAAAAAAAAAAAAAAAAAIEH/2gAIAQEAAQUCIn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAACAgMAAAAAAAAAAAAAAAAAARARIUGB/9oACAEBAAE/IdlVkccOP//aAAwDAQACAAMAAAAQoN//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAACAgIDAAAAAAAAAAAAAAABEQAhMUEQcbH/2gAIAQEAAT8QSBA7twhkEbd+QUxg417hn//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fdo\"\n        title=\"\"\n        src=\"/static/17f58627e747905744d4fad893aa32db/4b190/fdo-onboarding.jpg\"\n        srcset=\"/static/17f58627e747905744d4fad893aa32db/e07e9/fdo-onboarding.jpg 200w,\n/static/17f58627e747905744d4fad893aa32db/066f9/fdo-onboarding.jpg 400w,\n/static/17f58627e747905744d4fad893aa32db/4b190/fdo-onboarding.jpg 800w,\n/static/17f58627e747905744d4fad893aa32db/3bcce/fdo-onboarding.jpg 967w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Breaking down the key FDO components</h2>\n<p>In this section, I will try to break down the key FDO components so you can get an overall big picture view of how FDO solves a lot of the device onboarding challenges.</p>\n<h3>Manufacturing Server</h3>\n<p>The Manufacturing server plays a crucial role in ensuring a seamless transition of devices from the manufacturing phase to the final end-user environment where the device is going to live during its lifecycle.</p>\n<p>Below are some of the key functions of a manufacturing server:</p>\n<ul>\n<li>Ownership voucher creation</li>\n<li>Management of ownership transfer</li>\n<li>May store additional provisioning information that can be used to connect to the intended network or device management platform upon deployment of the device. This can include things like additional configuration settings, network credentials, or links to other services that will be used during the onboarding process.</li>\n<li>Ensure security and integrity of the ownership voucher. The Manufacturing server uses robust cryptographic methods to sign and verify data, preventing any tampering and unauthorized access.</li>\n<li>Authorized entities can query device information and validate ownership vouchers.</li>\n</ul>\n<h3>Ownership Voucher (OV)</h3>\n<p>The Ownership Voucher (OV) is a digital document that is used to securely transfer the ownership of the device from the device manufacturer or a trusted intermediary like resellers, distributors, etc. to the final owner or the operator.</p>\n<p>What's in an ownership voucher:</p>\n<ul>\n<li>Header which includes information about the voucher such as version and protocol</li>\n<li>Device manufacturer's public key (MfgPubKey) which is used to verify the device's authenticity and integrity</li>\n<li>Public key of the device (DevPubKey) which is embedded into the device at the time of manufacturing</li>\n<li>Public key of the owner (OwnerPubKey) which is used to establish a trust relationship between the device and the owner</li>\n<li>Signature signed with the device manufacturer's private key to ensure that the ownership voucher has not been tampered with and can be verified using the device manufacturer's public key</li>\n</ul>\n<p>The Ownership Voucher acts as a proof of ownership. As the device moves through the supply chain from the device manufacturer to distributor, reseller, and finally to the device owner, the Ownership Voucher is updated with the new owner's public key to reflect the current owner. A signature from the previous owner is also added to ensure a secure and verifiable chain of custody.</p>\n<h3>Rendezvous Server</h3>\n<p>The Rendezvous server plays a crucial role during the device onboarding process. Its key function is to act as a trusted intermediary that coordinates the initial communication between the new device that is being onboarded and the device owner's management platform.</p>\n<p>Below are some of the key functions of the Rendezvous server:</p>\n<ul>\n<li>Trusted intermediary during device onboarding: Ensures devices can securely find and connect to the service for provisioning without having any prior knowledge about it.</li>\n<li>Facilitates a secure connection: Devices securely receive information needed to connect to the owner's management infrastructure and ensures only authorized devices can access the provisioning details, protecting against unauthorized access.</li>\n</ul>\n<p>What's stored on the Rendezvous Server?</p>\n<ul>\n<li>Network credentials, endpoints to connect to the device management platform, and any other configuration details that are required during the onboarding process.</li>\n</ul>\n<h3>Owner Onboarding Server</h3>\n<p>The Owner Onboarding server is a crucial component in FDO, responsible for the secure and efficient provisioning and configuration of the device once it is ready to be integrated into the device owner's operational environment.</p>\n<p>Below are some of the key functions of the Owner Onboarding server:</p>\n<ul>\n<li>Responsible for the final steps in the device onboarding process.</li>\n<li>Ensures the device receives all necessary settings, credentials, and instructions to function as intended.</li>\n<li>Establishes a secure channel with the device to transfer all provisioning data and uses cryptographic methods to ensure the integrity and confidentiality of the data that is being transmitted to the device.</li>\n<li>Verifies device identity and ownership using the Ownership Voucher (OV) and ensures that the device matches the information provided in the Ownership Voucher (OV).</li>\n<li>Completion of onboarding may include additional steps to ensure the device is fully operational and integrated into its operational environment.</li>\n</ul>\n<h3>Service Info API</h3>\n<p>The Service Info API facilitates the exchange of service information between the device that is being onboarded and the device owner's device onboarding/management infrastructure. It enables dynamic provisioning and configuration of devices by allowing them to request and receive additional information and services needed for their operation.</p>\n<p>Below are some of the key functions of the Service Info API:</p>\n<ul>\n<li>Dynamic provisioning: Devices can request and receive additional provisioning data and configuration settings during the onboarding process.</li>\n<li>Extensible to support use cases specific to service providers.</li>\n<li>Establishes a secure channel with the device to transmit provisioning information to prevent unauthorized access and tampering. It leverages encryption and authentication mechanisms to protect the integrity and confidentiality of the provisioning data that is transmitted to the device.</li>\n</ul>\n<h3>Onboarding process</h3>\n<p>When the device is manufactured, the manufacturer generates a unique public-private key pair for the device and embeds it into the device. The device's private key is securely stored on the device as well. Once the device arrives at the owner's location, any user can connect the device to the OT network and power it on.</p>\n<p>During device onboarding, the Ownership Voucher's authenticity is verified using the device manufacturer's public key. After the verification process and the transfer of ownership, the device can accept commands from the new owner, who can now securely manage and provision the device.</p>\n<h2>What's Red Hat doing with FDO?</h2>\n<p>We have developed an FDO implementation using RUST. Additionally, we are also developing an Operator for Kubernetes, which you can use to deploy FDO components on OpenShift or other Kubernetes distributions of your choice. You can find the links to upstream projects under the resources section.</p>\n<p>RHEL for Edge, which is our edge-optimized OS for edge devices, includes a native FDO client, which is a key component in initiating onboarding flows from the device.</p>\n<h2>Resources</h2>\n<p>Below are some helpful resources on FDO:</p>\n<ul>\n<li>FDO Product Information on <a href=\"https://catalog.redhat.com/software/container-stacks/detail/633dce4e3affb9ec4165933a\">Ecosystem Catalog</a></li>\n<li><a href=\"https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/composing_installing_and_managing_rhel_for_edge_images/assembly_automatically-provisioning-and-onboarding-rhel-for-edge-devices_composing-installing-managing-rhel-for-edge-images#assembly_automatically-provisioning-and-onboarding-rhel-for-edge-devices_composing-installing-managing-rhel-for-edge-images\">Product Page</a></li>\n<li>Red Hat's FDO implementation written in RUST (<a href=\"https://github.com/fdo-rs/fido-device-onboard-rs\">https://github.com/fdo-rs/fido-device-onboard-rs</a>)</li>\n<li>Red Hat's FDO Operator if you are deploying on OpenShift/Kubernetes (<a href=\"https://github.com/fdo-rs/fdo-operator\">https://github.com/fdo-rs/fdo-operator</a>)</li>\n</ul>\n<p>Hope this was helpful. Please reach out with any questions about this post.</p>\n<p>Thanks,<br>\nRam</p>","id":"b7786be0-6202-541f-a577-0b2d8bbd77dc","frontmatter":{"title":"Secure device onboarding with FDO","date":"July, 2024","tags":["RHEL","FDO","Device","Security"]},"fields":{"slug":"/secure-device-onboarding-with-fdo/"}}},{"node":{"excerpt":"In this post I will walk through how you can setup a Gitops process for building golden images based on RHEL using RHEL image builder tool. If you are not familar with Image Builder I will recommend…","html":"<p>In this post I will walk through how you can setup a Gitops process for building golden images based on RHEL using RHEL image builder tool. If you are not familar with Image Builder I will recommend reading this <a href=\"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/composing_a_customized_rhel_system_image/composer-description_composing-a-customized-rhel-system-image\">doc</a>\nKey goal here is to have a common consistent process to build system images that can be used for cloud, on-premises and edge deployments</p>\n<p>At a high level we are going to first provision a RHEL 9 based EC2 instance on AWS and then install and configure image builder on it and lastly we are going to configure this system as a self hosted runner which will be used to run those Github CI jobs that runs image builder commands to compose images based on a blueprint. You can find everything I'm covering in this article here in this github <a href=\"https://github.com/rprakashg-redhat/osbuild-gitops\">repo</a>.</p>\n<p>Lets get right into it</p>\n<h2>Provisioning Required Infrastructure for self hosted runner on AWS cloud</h2>\n<p>I've included some terraform scripts to provision the required infrastructure components in AWS. I have already cloned the github repo to my local machine and we are going to switch to <code class=\"language-text\">runner/provision</code> directory and kick off the provisioning by running the terraform commands listed below</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">terraform init\nterraform plan\nterraform apply</code></pre></div>\n<p>Terraform scripts executed successfully and we can see the information about the EC2 instance in output as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf707c0671c6aa7078c3f7b7fdb583f6/25e83/tfout.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABn0lEQVR42o2SbXOqMBCFExQBQQwvCgOigIJK0TpO2+n0//+v0+wq1d47c+d+eGaTTXL2ZBNxOp1wOByY4/HIcb/fo21bNG3Dsa5r7HY7Xl+tVgiCAIvFAlmWYblc8jxJEp4L2jRspoODGI2rquK42Wx4TPuiKILv+5jP58x4PIYQ4sH5fGYBEiS3fd+j6zoURcF5Is9zXC4XNE0DKSVM0/zBMAwWojwh6IplWWKrnQwClCOR7XbL7tI05YK0xoeeHf0JVaZrdi8dyC3Rn3p2OPSTxq+XV1yvV7iu+8vhXwWo6rpYoyorpq5qjs2uQandtU2LNEm58WEYcg/jOGbXhOd5XIQiXz9axQiyAFEeIchDqEQf1HG5TqAyBZUqhIV+iMCHbdmwLAuTyQSO47AIQY9EsKAd2xjZo1tTjbt9ebdv3MdS/Ltvz6hA8fNThdlsph3YmE69HxzH1ZXpa+jq8oGUI0aMxMMIQb0ZejD8KUPSN3jw3+5uDnX/It07peC5DkxLQUy/NJ+aDwjn/RafcSmv1/03iHcTk9aENbZY8BtO0gkgLLPxWwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"tfout\"\n        title=\"\"\n        src=\"/static/bf707c0671c6aa7078c3f7b7fdb583f6/5a190/tfout.png\"\n        srcset=\"/static/bf707c0671c6aa7078c3f7b7fdb583f6/772e8/tfout.png 200w,\n/static/bf707c0671c6aa7078c3f7b7fdb583f6/e17e5/tfout.png 400w,\n/static/bf707c0671c6aa7078c3f7b7fdb583f6/5a190/tfout.png 800w,\n/static/bf707c0671c6aa7078c3f7b7fdb583f6/c1b63/tfout.png 1200w,\n/static/bf707c0671c6aa7078c3f7b7fdb583f6/29007/tfout.png 1600w,\n/static/bf707c0671c6aa7078c3f7b7fdb583f6/25e83/tfout.png 2302w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Configuring the self hosted runner</h2>\n<p>We are going to use Ansible to configure the self hosted runner. Switch to configure directory. Copy the public dns of EC2 instance from the terraform output and update the inventory file. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2f6ea4ba2a22eaa858d21a94feb9d487/59f0d/ansible-inventory.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVR42p2Q3W6EIBCFff/n2wvb1DWuRhRBEVBAwdOpJtv2qj+TfGGYOZzMkHWMoesYOO8xjhJCDBinCazv0ROcD2CkuXL+hJ3vum+1D7L89Y7bLcdbUZGZgpQG1jqs64rFWoQ9wvmAmCJ+E1lZVpimGWrWNJmConxZHRntWIRAWJZTmLaILUTsX9j8RaTekdJlWNcPjFLCGE2TWVg6nXPwe4KjuywKjE0DVnIM1QjZXAiCPwiqTUxi9w7HZVhDKXWaGWOgtYb3/mymGOH1jEC91R2goX9euW1bWnnCPM9PwxAC/htZ/nJH0/RomYCQGoOgP1z8p+I4/mT4DvibHOwKQrWJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"inventory\"\n        title=\"\"\n        src=\"/static/2f6ea4ba2a22eaa858d21a94feb9d487/5a190/ansible-inventory.png\"\n        srcset=\"/static/2f6ea4ba2a22eaa858d21a94feb9d487/772e8/ansible-inventory.png 200w,\n/static/2f6ea4ba2a22eaa858d21a94feb9d487/e17e5/ansible-inventory.png 400w,\n/static/2f6ea4ba2a22eaa858d21a94feb9d487/5a190/ansible-inventory.png 800w,\n/static/2f6ea4ba2a22eaa858d21a94feb9d487/c1b63/ansible-inventory.png 1200w,\n/static/2f6ea4ba2a22eaa858d21a94feb9d487/29007/ansible-inventory.png 1600w,\n/static/2f6ea4ba2a22eaa858d21a94feb9d487/59f0d/ansible-inventory.png 2370w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next we need to create an encrypted secrets file by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ansible-vault create vars/secrets.yml</code></pre></div>\n<p>Include following yaml snippet shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">rhUser</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;specify>'</span>\n<span class=\"token key atrule\">rhPassword</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;specify>'</span></code></pre></div>\n<p>Store the VAULT password that was used in an environment variable.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export VAULT_SECRET=\"&lt;replace>\"</code></pre></div>\n<p>Run the ansible playbook as shown below. You can see the full ansible playbook <a href=\"https://github.com/rprakashg-redhat/osbuild-gitops/blob/main/runner/configure/configure-runner.yaml\">here</a> I'm using ansible certified content <a href=\"https://github.com/redhat-cop/infra.osbuild/tree/main/roles/setup_server\">rhcop-osbuilder</a> to setup the server with image builder</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ansible-playbook -vvi inventory --vault-password-file &lt;(echo \"$VAULT_SECRET\") configure-runner.yaml</code></pre></div>\n<p>Playbook completed successfully.  See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ff2f2f0988428bd6845a20e2daebd11b/aa37b/configure-output.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABh0lEQVR42m2S6ZKkIBCEsYdTLlFQO/b9n7M2i3K2ZyL2xxdZpEXKpe5roXMsdF3CfS80eHyKf//wT3ijS93795wXvW/x3u+F1DkUTIUQ0fMUeMx6P17v0CE6v42PN576Qp8qxVEplmp1Ex5vmyXxxYvR0RrAaqGWnNPkvXlU/1BDaqueUnKUs6da/NScJcx7IfhP7b0lrb/I2i8y5oNzgurdYckOS/aT8+Ta0XE8PvS6HM5JdAxLrWn8UE/tXWNHMmZU2zw1bHFvvG1uhuII2Dt2UQ6d9MdrZrJVhO56aoqa4orAP32nUQudrdLVCh01U98KjQ0Kn+teK+2ZvTK9jLO0VmH7C4UgcO3cwit8YWULsaYE4kcjCOGFy3hhAnR6C74tU3/VqwSr1hL2HhGacBmoc6RcpK41IjyiMSGUNSJ4xaXY/2KMJXUcgfbdE+uxS90a4/7deJ6vQIjRIljjB+YXIQgqJXlPjEVjyjjcaDB5RQOeTPBk1kAOuq4ghvl0jEG//cBj5i+IQvhX4wx55QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"output\"\n        title=\"\"\n        src=\"/static/ff2f2f0988428bd6845a20e2daebd11b/5a190/configure-output.png\"\n        srcset=\"/static/ff2f2f0988428bd6845a20e2daebd11b/772e8/configure-output.png 200w,\n/static/ff2f2f0988428bd6845a20e2daebd11b/e17e5/configure-output.png 400w,\n/static/ff2f2f0988428bd6845a20e2daebd11b/5a190/configure-output.png 800w,\n/static/ff2f2f0988428bd6845a20e2daebd11b/c1b63/configure-output.png 1200w,\n/static/ff2f2f0988428bd6845a20e2daebd11b/29007/configure-output.png 1600w,\n/static/ff2f2f0988428bd6845a20e2daebd11b/aa37b/configure-output.png 3464w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next thing we need to do is navigate to the settings for the GitHub repo and under actions/runner click on <code class=\"language-text\">new self hosted runner</code> option to add a new self hosted runner. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a41b08ed545eeedcb008b6cc4b39280e/70d4c/addnewrunner.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACG0lEQVR42l1T2XLaQBDkMRUbhIRudEvoRBzGuBxX/v+3OtMjLwl56Fp2lunp6RmtNrsIXlxg7YR4tQOBj7W7h5XMCNIWSdkiLzvUhxFxflBkzYC06lE0IwqJJ/Ju8leWG8NPKpCYgZetD9vPUE0faI53dPM7+tMd7XRF3Z9xGM+ohyvy7g3lcBNcpXCDV8l7EJbdLJUmIY0XwiBDKglRdUJUTijbIwIpavuJduOEBaygxMbPsQ1yrCXviTBvJvj7UmWTkGrZUpzX+LF2BDuJhXCjQt9fLA+WGyHKauzCVGOPllk1qwcNLh4G2Hp7IRxETa6qWZQxnkwkWPT/mBJuZAAkNA8M2kEqbc6qiPDiEo7EfooyVfiNf+9GzMqSAdA/V9Q4Il8hybSBvrlR/gDjtr+8G5i7Gaq23IwX8aPRigxSKRX2MuFmuAiWCcd5K15XqpjgbwO2T6VKyCnyVOlOoNVINF0/Mb/9wnj+wCCrM5zvSkxU3UmLElk9qteqkMz0MExrbXHxMZSki5B9Yb59Ybp8agEmFyQRsuJwRCaDI1lS9jqD77URQtl4ktILqtQizfLHvSCUxWVBtmZ7ibwnei7+ZbI62bNCekMys4d/d3PxK0hq8fggaPVkJ9xbM6inoZCQHlKhGT2J2+mG8/tv9bA73rTFxbeTqueeLuS1gp3qUMz3a8gMobZbdPBkD3dhrq0Z8E6YPSWMh38A0pFwHDd7Cy8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"addrunner\"\n        title=\"\"\n        src=\"/static/a41b08ed545eeedcb008b6cc4b39280e/5a190/addnewrunner.png\"\n        srcset=\"/static/a41b08ed545eeedcb008b6cc4b39280e/772e8/addnewrunner.png 200w,\n/static/a41b08ed545eeedcb008b6cc4b39280e/e17e5/addnewrunner.png 400w,\n/static/a41b08ed545eeedcb008b6cc4b39280e/5a190/addnewrunner.png 800w,\n/static/a41b08ed545eeedcb008b6cc4b39280e/c1b63/addnewrunner.png 1200w,\n/static/a41b08ed545eeedcb008b6cc4b39280e/29007/addnewrunner.png 1600w,\n/static/a41b08ed545eeedcb008b6cc4b39280e/70d4c/addnewrunner.png 2548w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can pretty much skip all the steps in the download section because the ansible script that configures the self hosted runner already does that. Copy the configure command and ssh into ec2 instance and run that command. See screen capture below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/646232bba7c21a672d5886546077368c/5cd17/configsh.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/UlEQVR42qWSTU7EMAyFEztx/jrTlplDICGhgQU77n+sh20pQoAAFRafYtX1y7PjcLlcse9nnO/uMa6vaPsLeDyB+g00buD2DF4fQQ8CXgitNvTenVorRMSZcbBEaw3LqBg9o7eEIuTUwnoqmSEsyDkjpeTFpRQXICKEEN6xZNWkwZwgSfSCDikVWQoisf4YEWL4WPgdzKyFanlZIOq2jIGijrM6MUdfHPzGLCIVJhUxosYxRv9u5yFBa9nmcqjoJ06nkz+KOTVs0DOeHBJcdHYmum0b1nV15iUmfrjlbd1crPgrs2MjMCz+U8smNnfs3/O0xZ6zsjYPr8kn3gDO+OT+gm5UtwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"configsh\"\n        title=\"\"\n        src=\"/static/646232bba7c21a672d5886546077368c/5a190/configsh.png\"\n        srcset=\"/static/646232bba7c21a672d5886546077368c/772e8/configsh.png 200w,\n/static/646232bba7c21a672d5886546077368c/e17e5/configsh.png 400w,\n/static/646232bba7c21a672d5886546077368c/5a190/configsh.png 800w,\n/static/646232bba7c21a672d5886546077368c/c1b63/configsh.png 1200w,\n/static/646232bba7c21a672d5886546077368c/29007/configsh.png 1600w,\n/static/646232bba7c21a672d5886546077368c/5cd17/configsh.png 3564w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Switching to Github repo we can see that the new self hosted runner was added to the repo. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e5b645dcdc1ba8d58c294032d4942576/0bd07/newrunner.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABQ0lEQVR42pWQ23aCMBBFaZcoIIRLEu4KiSAUxfoB/f/fOk1C8fLYh70mM5M5cxJrvt0xXWZcrjcTh3HC+HUx8dT1ODbijaaVb0h1R/Y9WnmCkB2smJcgSQaWH+FHHLZLsNtHsB2CrTpvvRBblbtBYvrWxn1ie7B3BBs7wMenrnmwXMLghQx+nCLJDipmCNQCL+TgZYOsbuESCqLqMc3hBNTkbkjh+Amirkb1M4BdG9OzgiQ3IiErkVYCa76PUvC6Ry6/QasBcVojUuilsSL5g0uBbB5B+zMCNWfpYV8NE1pADDMOcjSiWpCWAqWYkB3Oyq0AK1oDVd+zwvIWPJeI6PI6a3WjBWslxorm4TDJahTHTom1izPtkldm4cLyMj2zvuwhqBtVezZnzVrXf7nWXnuvvNaegrxGP90RKwdaXLNu/Q+/kYzIIEkmi+oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"newrunner\"\n        title=\"\"\n        src=\"/static/e5b645dcdc1ba8d58c294032d4942576/5a190/newrunner.png\"\n        srcset=\"/static/e5b645dcdc1ba8d58c294032d4942576/772e8/newrunner.png 200w,\n/static/e5b645dcdc1ba8d58c294032d4942576/e17e5/newrunner.png 400w,\n/static/e5b645dcdc1ba8d58c294032d4942576/5a190/newrunner.png 800w,\n/static/e5b645dcdc1ba8d58c294032d4942576/c1b63/newrunner.png 1200w,\n/static/e5b645dcdc1ba8d58c294032d4942576/29007/newrunner.png 1600w,\n/static/e5b645dcdc1ba8d58c294032d4942576/0bd07/newrunner.png 2898w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We are going to ssh back into the ec2 instance and start the runner by running the run.sh script as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/625caa8e2e63a787eac38aaba0d872eb/ee787/startrunner.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAUklEQVR42pXNQQ7AIAhEUTSRECCiB6j3v+U0smjanV28zIoPmRvcHWYGVYWIfDBzIqIzopLBfby3tYZaazqOvK1rofeOMQYiIqNzzudJKeVX8AaqqT7ZTivrtAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"startrunner\"\n        title=\"\"\n        src=\"/static/625caa8e2e63a787eac38aaba0d872eb/5a190/startrunner.png\"\n        srcset=\"/static/625caa8e2e63a787eac38aaba0d872eb/772e8/startrunner.png 200w,\n/static/625caa8e2e63a787eac38aaba0d872eb/e17e5/startrunner.png 400w,\n/static/625caa8e2e63a787eac38aaba0d872eb/5a190/startrunner.png 800w,\n/static/625caa8e2e63a787eac38aaba0d872eb/c1b63/startrunner.png 1200w,\n/static/625caa8e2e63a787eac38aaba0d872eb/29007/startrunner.png 1600w,\n/static/625caa8e2e63a787eac38aaba0d872eb/ee787/startrunner.png 2022w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We are now ready to kick of a github CI job to build a RHEL system image. For demonstration purposes I'm using a sample blueprint from <a href=\"https://github.com/osbuild/rhel-for-edge-demo/tree/master/blueprint\">osbuild</a> community. The github actions workflow will use image builder to build rhel for edge image. Check out the <a href=\"https://github.com/rprakashg-redhat/osbuild-gitops/blob/main/.github/workflows/generate.yaml\">CI workflow</a> to see all the image builder commands we are running to build RHEL for edge system image using a sample blueprint</p>\n<p>We can ssh into EC2 instance and see that the compose job is running. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/066896611a2be9019049d3c9364d6743/22284/compose-status.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.999999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAP0lEQVR42jWJSQoAMQgEJ7gED4qI5P8/7RBhDgVdXd85B92NqkJm4nlEzH6fu8PMICJQVey9pxERmHnaz1oLF5cvFrScodVvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"composestatus\"\n        title=\"\"\n        src=\"/static/066896611a2be9019049d3c9364d6743/5a190/compose-status.png\"\n        srcset=\"/static/066896611a2be9019049d3c9364d6743/772e8/compose-status.png 200w,\n/static/066896611a2be9019049d3c9364d6743/e17e5/compose-status.png 400w,\n/static/066896611a2be9019049d3c9364d6743/5a190/compose-status.png 800w,\n/static/066896611a2be9019049d3c9364d6743/c1b63/compose-status.png 1200w,\n/static/066896611a2be9019049d3c9364d6743/29007/compose-status.png 1600w,\n/static/066896611a2be9019049d3c9364d6743/22284/compose-status.png 2428w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Job runs for about 10 mins and image out is saved as workflow artifact. See screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d89eddf61e283fd5677ab7f74f9ce188/87cc4/joboutput.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzElEQVR42o2SaW+bQBCGF3xgMGDu24Cxk7hqpaqfqoScjnFTqer//zdvZ9ZHLQe1+fBoZmdmZ+dY0W3e0D3tsHnY4uWxk/zofuHn7jdeX97w+LBDe7fFfbtFe7ulc4fnpz3t9w3uiPvbVzzT/bbtIOZ1g+tPn1EulqiaJRZXNwiTDH4UI4gSuH4Iy3FhHzjprgePYqI0hxdE8uxQrNCmFOQl0IwZDNuH6ZDTCaGbHtg3NhxMSB+TzlK3fIzIJgY6lPEUqmZCGU0hRgbEkAibGldfvmG1/oooX8jksyCTUuLGmPmp1G2Str+3m2Q/Yp0h4uoa5WqNIKvgp6VMxkR5gyCt4MUlTC8lOZd2lk6YS90+PHSO8PMacdkgzGqEaS2NbpghLVeIqeKoWMIKCqlzspBlUp6SnVfKiCCvZJAbFZJjCwFd4rkKZQx1bEAZ6lBpTsoBlefXg4iptWJxgyktg+GEOi3HDriCWC5hMLFo4PrHkBVdlK47Prx036ZPbfK2harRZif/53IGMiFVNZzYsoWBZmGk2/L7fIR3CbltnmnRrOU2Le/9Jv9Fb4WciL8Mf40+Pz/KMcxx7qct913gRMl8+XfrF1UcH+3z/wFN3kIoJ8doigAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"joboutput\"\n        title=\"\"\n        src=\"/static/d89eddf61e283fd5677ab7f74f9ce188/5a190/joboutput.png\"\n        srcset=\"/static/d89eddf61e283fd5677ab7f74f9ce188/772e8/joboutput.png 200w,\n/static/d89eddf61e283fd5677ab7f74f9ce188/e17e5/joboutput.png 400w,\n/static/d89eddf61e283fd5677ab7f74f9ce188/5a190/joboutput.png 800w,\n/static/d89eddf61e283fd5677ab7f74f9ce188/c1b63/joboutput.png 1200w,\n/static/d89eddf61e283fd5677ab7f74f9ce188/29007/joboutput.png 1600w,\n/static/d89eddf61e283fd5677ab7f74f9ce188/87cc4/joboutput.png 2936w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>As mentioned earlier I used a blueprint for RHEL for edge but the same approach can be leveraged for building RHEL system images for use in Google, AWS, Azure as well as for onpremises use as well.</p>\n<p>Hope that helps. If you have any questions about this post please comment or reach out and I'm happy to help.</p>\n<p>Thanks,\nRam</p>","id":"779cf1b3-1720-5564-baad-4e1586d1b819","frontmatter":{"title":"Building RHEL Golden images leveraging GitOps and Self Hosted Github runner on AWS","date":"May, 2024","tags":["RHEL","GitOps","AWS","Edge"]},"fields":{"slug":"/building-rhel-images-gitops/"}}}]}},"pageContext":{"tag":"RHEL"}},"staticQueryHashes":["1611934721","2366241629"],"slicesMap":{}}