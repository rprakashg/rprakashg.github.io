{"componentChunkName":"component---src-templates-tag-js","path":"/tags/kubernetes/","result":{"data":{"site":{"siteMetadata":{"title":"rprakashg.github.io","author":"RAM GOPINATHAN"}},"allMarkdownRemark":{"totalCount":10,"edges":[{"node":{"excerpt":"When you use HAProxy Ingress with ArgoCD on Kubernetes you are going to run into this error 'ERR_TOO_MANY_REDIRECTS' when you browse to the ArgoCD server URL. I lost of few hours trying to figure out…","html":"<p>When you use HAProxy Ingress with ArgoCD on Kubernetes you are going to run into this error 'ERR_TOO_MANY_REDIRECTS' when you browse to the ArgoCD server URL. I lost of few hours trying to figure out what the cause is and wanted to write this up with the hope that it saves some one else time later and also a note for myself so I don't forget exactly what I did to solve the issue.</p>\n<p>I installed ArgoCD server on my EKS cluster following the instructions in the ArgoCD docs using the command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectcl create namespace gitops\nkubectl apply -n gitops -f https://raw.githubusercontent.com/argoproj/argo-cd/master/manifests/install.yaml</code></pre></div>\n<p>After that I created an Ingress Resource by running the command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: argocd\n  namespace: gitops\nspec:\n  ingressClassName: haproxy\n  rules:\n  - host: gitops.sandbox2841.opentlc.com\n    http:\n      paths:\n      - backend:\n          service:\n            name: argocd-server\n            port:\n              name: https\n        path: /\n        pathType: Prefix\n  tls:\n  - hosts:\n    - gitops.sandbox2841.opentlc.com\nEOF</code></pre></div>\n<p>Browse to <code class=\"language-text\">https://gitops.sandbox2841.opentlc.com</code> and started noticing 'ERR_TOO_MANY_REDIRECTS'. reason why this was happening is because HAProxy by default terminates SSL and forwards HTTP to backend service and ArgoCD server when it sees an HTTP traffic it automatically redirects to HTTPS. This results in an infinite loop and eventually HAProxy gives up and you see that error in browser.\nSo to fix this problem I simply had to add an annotation <code class=\"language-text\">ingress.kubernetes.io/ssl-passthrough: \"true\"</code> to the ingress resource so HAProxy instead of terminating HTTPS traffic at the proxy will do an SNI passthrough.</p>\n<p>Updated Ingress resource as shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: argocd\n  namespace: gitops\n  annotations:\n    ingress.kubernetes.io/ssl-passthrough: \"true\"\nspec:\n  ingressClassName: haproxy\n  rules:\n  - host: gitops.sandbox2841.opentlc.com\n    http:\n      paths:\n      - backend:\n          service:\n            name: argocd-server\n            port:\n              name: https\n        path: /\n        pathType: Prefix\n  tls:\n  - hosts:\n    - gitops.sandbox2841.opentlc.com\nEOF</code></pre></div>\n<p>Grab the admin password from kubernetes secret by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl get secrets argocd-initial-admin-secret -n gitops -o jsonpath=\"{.data.password}\" | base64 -d | pbcopy</code></pre></div>\n<p>Browse to <code class=\"language-text\">https://gitops.sandbox2841.opentlc.com</code> enter admin for username and paste the password obtained from previous step and you will be logged into ArgoCD server successfully as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9ea613f81a97d2d066809a1501b42380/12e1b/argocd.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVR42pWQu0oDURCGt40gWlmKCqKNgkSENIIvIHa2lj6ZLyAoKSw06qrEJOayJCa7m83er7nauMn+zjkJooVCio85Z+acj5kRXD+Cb/uwTR+GHcJ0Quh2BMvrw49GHMMK4dDdDUdw/D48FoMBTJdyFG1WC4b0pgvh5OwcmeNTiPkioh4V/ICKERUDxHGMeDym+IkxxfFkgiRJgBkJ3enwnUuSCYTV9CFS6zu4uMwiX2si91rBQ6HK6bgB4cMMurDDHsyIuu6PEPSHxAjhgM69ISec5YW1gyMsbu4he/8Mb/CBtkMSL+TIlsdpme4U4zeNjo1iQ0WxrqKuWTwnrOxkuPDqVoRJXTR1GzJ9Zigk+wuV9i6pBipNDdVWBzXF4DlhaSuN1MYuru9EWDRSy3D+FXEZwSZhXVdIxmjqDjRakbC8vY+FOYSsc0nVaVQZ5XeVutOmUdZQaijzCdlIdc0kSZskCt5IcCMWkM290B5lSIo+f4c/5Wzkp3IdjyWJ/2Nr+AJ7vXGtXdpr+wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"argocd\"\n        title=\"\"\n        src=\"/static/9ea613f81a97d2d066809a1501b42380/5a190/argocd.png\"\n        srcset=\"/static/9ea613f81a97d2d066809a1501b42380/772e8/argocd.png 200w,\n/static/9ea613f81a97d2d066809a1501b42380/e17e5/argocd.png 400w,\n/static/9ea613f81a97d2d066809a1501b42380/5a190/argocd.png 800w,\n/static/9ea613f81a97d2d066809a1501b42380/c1b63/argocd.png 1200w,\n/static/9ea613f81a97d2d066809a1501b42380/29007/argocd.png 1600w,\n/static/9ea613f81a97d2d066809a1501b42380/12e1b/argocd.png 1607w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this helps,</p>\n<p>Thanks,\nRam</p>","id":"2b8c0cb4-6808-5d23-806d-7f23131e082c","frontmatter":{"title":"Fixing error 'ERR_TOO_MANY_REDIRECTS' when using HAProxy with ArgoCD","date":"March, 2024","tags":["gitops","argocd","Kubernetes"]},"fields":{"slug":"/haproxy-ingress-with-argocd/"}}},{"node":{"excerpt":"I recently got a chance to install Istio ambient mesh on OpenShift and ran into couple of issues.  In this post I will walk through steps to get through the installation issues. This is the article I…","html":"<p>I recently got a chance to install Istio ambient mesh on OpenShift and ran into couple of issues.  In this post I will walk through steps to get through the installation issues. This is the <a href=\"https://istio.io/latest/docs/ops/ambient/getting-started/\">article</a> I followed to install Ambient Mesh on OpenShift Container Platform</p>\n<p>First thing you are going to run into is ztunnel and istio cni installation failures.</p>\n<h2>Fixing z-tunnel errors</h2>\n<p>You will see an error like below, this is mainly because by default everything runs in openshift in least privilege mode. We can fix these errors by assigning additional SCC's to the service account associated with the ztunnel POD</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error creating: pods \"ztunnel-\" is forbidden: unable to validate against any security context constraint: [provider \"anyuid\": Forbidden: not usable by user or serviceaccount, provider restricted-v2: .containers[0].runAsUser: Invalid value: 0: must be in the ranges: [1000680000, 1000689999], provider restricted-v2: .containers[0].capabilities.add: Invalid value: \"NET_ADMIN\": capability may not be added, provider \"restricted\": Forbidden: not usable by user or serviceaccount, provider \"nonroot-v2\": Forbidden: not usable by user or serviceaccount, provider \"nonroot\": Forbidden: not usable by user or serviceaccount, provider \"hostmount-anyuid\": Forbidden: not usable by user or serviceaccount, provider \"machine-api-termination-handler\": Forbidden: not usable by user or serviceaccount, provider \"hostnetwork-v2\": Forbidden: not usable by user or serviceaccount, provider \"hostnetwork\": Forbidden: not usable by user or serviceaccount, provider \"hostaccess\": Forbidden: not usable by user or serviceaccount, provider \"node-exporter\": Forbidden: not usable by user or serviceaccount, provider \"privileged\": Forbidden: not usable by user or serviceaccount]</code></pre></div>\n<p>Assign additional security context constraints to <code class=\"language-text\">ztunnel</code> service account on <code class=\"language-text\">istio-system</code> namespace by running commands below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc adm policy add-scc-to-user hostmount-anyuid --serviceaccount ztunnel --namespace istio-system\noc adm policy add-scc-to-user anyuid --serviceaccount ztunnel --namespace istio-system\noc adm policy add-scc-to-user nonroot-v2 --serviceaccount ztunnel --namespace istio-system\noc adm policy add-scc-to-user hostnetwork-v2 --serviceaccount ztunnel --namespace istio-system\noc adm policy add-scc-to-user restricted-v2 --serviceaccount ztunnel --namespace istio-system\noc adm policy add-scc-to-user machine-api-termination-handler --serviceaccount ztunnel --namespace istio-system\noc adm policy add-scc-to-user hostnetwork --serviceaccount ztunnel --namespace istio-system\noc adm policy add-scc-to-user hostaccess --serviceaccount ztunnel --namespace istio-system\noc adm policy add-scc-to-user node-exporter --serviceaccount ztunnel --namespace istio-system\noc adm policy add-scc-to-user privileged --serviceaccount ztunnel --namespace istio-system</code></pre></div>\n<h2>Fixing istio-cni-node errors</h2>\n<p>Similar to z-tunnel you will see these errors shown below. We can fix these errors by assigning additional SCC's to service account associated with istio-cni-node POD</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error creating: pods \"istio-cni-node-\" is forbidden: unable to validate against any security context constraint: [provider \"anyuid\": Forbidden: not usable by user or serviceaccount, provider restricted-v2: .spec.securityContext.hostNetwork: Invalid value: true: Host network is not allowed to be used, spec.volumes[0]: Invalid value: \"hostPath\": hostPath volumes are not allowed to be used, spec.volumes[1]: Invalid value: \"hostPath\": hostPath volumes are not allowed to be used, spec.volumes[2]: Invalid value: \"hostPath\": hostPath volumes are not allowed to be used, spec.volumes[3]: Invalid value: \"hostPath\": hostPath volumes are not allowed to be used, spec.volumes[4]: Invalid value: \"hostPath\": hostPath volumes are not allowed to be used, provider restricted-v2: .containers[0].runAsUser: Invalid value: 0: must be in the ranges: [1000680000, 1000689999], provider restricted-v2: .containers[0].privileged: Invalid value: true: Privileged containers are not allowed, provider restricted-v2: .containers[0].hostNetwork: Invalid value: true: Host network is not allowed to be used, provider \"restricted\": Forbidden: not usable by user or serviceaccount, provider \"nonroot-v2\": Forbidden: not usable by user or serviceaccount, provider \"nonroot\": Forbidden: not usable by user or serviceaccount, provider \"hostmount-anyuid\": Forbidden: not usable by user or serviceaccount, provider \"machine-api-termination-handler\": Forbidden: not usable by user or serviceaccount, provider \"hostnetwork-v2\": Forbidden: not usable by user or serviceaccount, provider \"hostnetwork\": Forbidden: not usable by user or serviceaccount, provider \"hostaccess\": Forbidden: not usable by user or serviceaccount, provider \"node-exporter\": Forbidden: not usable by user or serviceaccount, provider \"privileged\": Forbidden: not usable by user or serviceaccount]</code></pre></div>\n<p>Assign SCC's to <code class=\"language-text\">istio-cni</code> service account on <code class=\"language-text\">istio-system</code> namespace by running commands below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc adm policy add-scc-to-user anyuid --serviceaccount istio-cni --namespace istio-system\noc adm policy add-scc-to-user restricted-v2 --serviceaccount istio-cni --namespace istio-system\noc adm policy add-scc-to-user restricted --serviceaccount istio-cni --namespace istio-system\noc adm policy add-scc-to-user nonroot-v2 --serviceaccount istio-cni --namespace istio-system \noc adm policy add-scc-to-user nonroot --serviceaccount istio-cni --namespace istio-system\noc adm policy add-scc-to-user hostmount-anyuid --serviceaccount istio-cni --namespace istio-system \noc adm policy add-scc-to-user machine-api-termination-handler --serviceaccount istio-cni --namespace istio-system\noc adm policy add-scc-to-user hostnetwork-v2 --serviceaccount istio-cni --namespace istio-system\noc adm policy add-scc-to-user hostnetwork --serviceaccount istio-cni --namespace istio-system\noc adm policy add-scc-to-user hostaccess --serviceaccount istio-cni --namespace istio-system\noc adm policy add-scc-to-user node-exporter --serviceaccount istio-cni --namespace istio-system\n</code></pre></div>\n<h2>Fixing Istio Ingress Gateway errors</h2>\n<p>Ingress gateway deployment is also going to get stuck due to errors below. We can fix them by assigning additional SCC's to service account associated with istio ingress gateway POD</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error creating: pods \"istio-ingressgateway-75767568b7-\" is forbidden: unable to validate against any security context constraint: [provider \"anyuid\": Forbidden: not usable by user or serviceaccount, provider restricted-v2: .containers[0].runAsUser: Invalid value: 1337: must be in the ranges: [1000680000, 1000689999], provider \"restricted\": Forbidden: not usable by user or serviceaccount, provider \"nonroot-v2\": Forbidden: not usable by user or serviceaccount, provider \"nonroot\": Forbidden: not usable by user or serviceaccount, provider \"hostmount-anyuid\": Forbidden: not usable by user or serviceaccount, provider \"machine-api-termination-handler\": Forbidden: not usable by user or serviceaccount, provider \"hostnetwork-v2\": Forbidden: not usable by user or serviceaccount, provider \"hostnetwork\": Forbidden: not usable by user or serviceaccount, provider \"hostaccess\": Forbidden: not usable by user or serviceaccount, provider \"node-exporter\": Forbidden: not usable by user or serviceaccount, provider \"privileged\": Forbidden: not usable by user or serviceaccount]</code></pre></div>\n<p>Assign SCC's to <code class=\"language-text\">istio-ingressgateway-service-account</code> service account on <code class=\"language-text\">istio-system</code> namespace</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc adm policy add-scc-to-user anyuid --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user restricted-v2 --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user restricted --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user nonroot-v2 --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user nonroot --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user hostmount-anyuid --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user machine-api-termination-handler --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user hostnetwork-v2 --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user hostnetwork --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user hostaccess --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user node-exporter --serviceaccount istio-ingressgateway-service-account --namespace istio-system\noc adm policy add-scc-to-user privileged --serviceaccount istio-ingressgateway-service-account --namespace istio-system\n</code></pre></div>\n<p>I re-ran the install command just to make sure everything completes</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">istioctl install --set profile=ambient --set \"components.ingressGateways[0].enabled=true\" --set \"components.ingressGateways[0].name=istio-ingressgateway\" --skip-confirmation</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab7ae02fe0ce7c887eae1f6d3980e069/764d0/ambient.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAW0lEQVR42m2NwQ6AMAhDi8uAbic/wKv//4cVnRcTDy8F2hSgH4KfQuzqbMpIjUGRQ8xNc0Bzom5QJuTeylv7A1+/lKQAC8G8hq3AL2ZWRaFIKurhjfvS3v2TvwBWACpH8ElOKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ambient\"\n        title=\"\"\n        src=\"/static/ab7ae02fe0ce7c887eae1f6d3980e069/5a190/ambient.png\"\n        srcset=\"/static/ab7ae02fe0ce7c887eae1f6d3980e069/772e8/ambient.png 200w,\n/static/ab7ae02fe0ce7c887eae1f6d3980e069/e17e5/ambient.png 400w,\n/static/ab7ae02fe0ce7c887eae1f6d3980e069/5a190/ambient.png 800w,\n/static/ab7ae02fe0ce7c887eae1f6d3980e069/c1b63/ambient.png 1200w,\n/static/ab7ae02fe0ce7c887eae1f6d3980e069/29007/ambient.png 1600w,\n/static/ab7ae02fe0ce7c887eae1f6d3980e069/764d0/ambient.png 1898w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now that we have ambient mesh installed we need to install prometheus and kiali before we install istio sample apps.</p>\n<h2>Installing Prometheus and Kiali on OpenShift</h2>\n<p>I installed Prometheus operator from the operator hub and used the sample prometheus installation provided by istio referenced here in this <a href=\"https://istio.io/latest/docs/ops/integrations/prometheus/#installation\">doc</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/prometheus.yaml</code></pre></div>\n<p>After you run the above command you are going to see these errors below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pods \"prometheus-5d5d6d6fc-\" is forbidden: unable to validate against any security context constraint: [provider \"anyuid\": Forbidden: not usable by user or serviceaccount, provider restricted-v2: .spec.securityContext.fsGroup: Invalid value: []int64{65534}: 65534 is not an allowed group, provider restricted-v2: .containers[0].runAsUser: Invalid value: 65534: must be in the ranges: [1000680000, 1000689999], provider restricted-v2: .containers[1].runAsUser: Invalid value: 65534: must be in the ranges: [1000680000, 1000689999], provider \"restricted\": Forbidden: not usable by user or serviceaccount, provider \"nonroot-v2\": Forbidden: not usable by user or serviceaccount, provider \"nonroot\": Forbidden: not usable by user or serviceaccount, provider \"hostmount-anyuid\": Forbidden: not usable by user or serviceaccount, provider \"machine-api-termination-handler\": Forbidden: not usable by user or serviceaccount, provider \"hostnetwork-v2\": Forbidden: not usable by user or serviceaccount, provider \"hostnetwork\": Forbidden: not usable by user or serviceaccount, provider \"hostaccess\": Forbidden: not usable by user or serviceaccount, provider \"node-exporter\": Forbidden: not usable by user or serviceaccount, provider \"privileged\": Forbidden: not usable by user or serviceaccount]</code></pre></div>\n<p>We can grant additional SCC's to <code class=\"language-text\">promethues</code> service account by running commands below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc adm policy add-scc-to-user anyuid --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user restricted-v2 --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user restricted --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user nonroot-v2 --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user nonroot --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user hostmount-anyuid --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user machine-api-termination-handler --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user hostnetwork-v2 --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user hostnetwork --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user hostaccess --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user node-exporter --serviceaccount prometheus --namespace istio-system\noc adm policy add-scc-to-user privileged --serviceaccount prometheus --namespace istio-system</code></pre></div>\n<p>Install Kiali Operator from the operator hub and create an instance of kiali.</p>\n<h2>Deploy Istio sample apps</h2>\n<p>Deploy istio sample apps following the instructions <a href=\"https://istio.io/latest/docs/ops/ambient/getting-started/#bookinfo\">here</a> in this getting started with Ambient Mesh article</p>\n<h2>Expose a route to istio ingress gateway</h2>\n<p>Follow steps below to expose a route to istio ingress gateway so we can test the sample bookinfo application.</p>\n<ul>\n<li>Login to OpenShift console and navigate to <code class=\"language-text\">Routes</code> under <code class=\"language-text\">Networking</code></li>\n<li>Select <code class=\"language-text\">istio-system</code> in <code class=\"language-text\">Project</code> drop down and click <code class=\"language-text\">Create Route</code></li>\n<li>Enter <code class=\"language-text\">istio-ingressgateway</code> for <code class=\"language-text\">Name</code></li>\n<li>Select <code class=\"language-text\">istio-ingressgateway</code> for <code class=\"language-text\">Service</code></li>\n<li>Select <code class=\"language-text\">80-8080</code> for <code class=\"language-text\">Target Port</code> and click on <code class=\"language-text\">Create</code>.</li>\n</ul>\n<p>See screen capture below\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/013fbbc117c48251a9febf724ef47198/95e59/createroute.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1UlEQVR42pWSTU8aURSGJ9V2V3HBRqgiMlP5EoQBakyjMdG/1Z/QblyaLvoLmrioSRuXxsSgMmJQorGLNiYWlJE73Pm68/ZcSmwXttCbPLOYmTx5z32PokWj0DMZRF5EEQ6H8Sw0hbFQFGMTETx5PvVPxkMRPJ0kQr9R0rkCtFQWs3EVyewi3mx9xtvtJt5tN7C5c4HNT8TO5aNsfbnC+92vxNUDSiqTx5yaRGxOQ26xhOZ5A/II4dMzGDD6UQp6BVI6HVOxkC/i4NBAu+vi5rqNH/UG2ucX6LTuYXLAZD5MSzxKhwkwLqBkc0WkadRYXCOhjqPjGliPg3W7YHcdOMyC53rwRTAUQShSFk/MDxKWUKsZ8H0PnHO4rguHsG2b3vkIgmAoSqmy3E+ovkyjWFrC6SndIX3o9XrgJJIyIcRIsr5wZW0Dy69XoZeXsLq2DqN+BO5wWHe3sJpncBmDkCVRQikeRn/k+dQCjZxAllaoelzHPfdgmyaCrvmfHeOPtaFS8oUyqtVDWI4D6/s3OO3Wr78G44yUUKaTpczMqrSHOk4MA27rBjbdoUcSWYxEljJSQjlyQktihhKWK6/w4eMe9vdp90z2IHNkYsvqN28PivobPwHgLfx2s2754gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"createroute\"\n        title=\"\"\n        src=\"/static/013fbbc117c48251a9febf724ef47198/5a190/createroute.png\"\n        srcset=\"/static/013fbbc117c48251a9febf724ef47198/772e8/createroute.png 200w,\n/static/013fbbc117c48251a9febf724ef47198/e17e5/createroute.png 400w,\n/static/013fbbc117c48251a9febf724ef47198/5a190/createroute.png 800w,\n/static/013fbbc117c48251a9febf724ef47198/c1b63/createroute.png 1200w,\n/static/013fbbc117c48251a9febf724ef47198/95e59/createroute.png 1460w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Grab the route URL and access the product page from a browser</p>","id":"aca6fa2f-9091-59b5-b27c-b36a28df6ac1","frontmatter":{"title":"Installing Istio Ambient Mesh on OpenShift","date":"January, 2024","tags":["Crossplane","AWS","EKS","Tools","Kubernetes"]},"fields":{"slug":"/installing-istio-ambient-mesh-on-openshift/"}}},{"node":{"excerpt":"I've been hearing a lot about Crossplane for over a year now and recently I got a chance to try it out, specifically resource composition capabilities. In this post I'll go over how I used these…","html":"<p>I've been hearing a lot about Crossplane for over a year now and recently I got a chance to try it out, specifically resource composition capabilities. In this post I'll go over how I used these capabilities to build a system that automates provisioning of EKS clusters in AWS. I hope you are just as excited as I am. What I liked the most is that crossplane allows us to extend kubernetes without really writing single line of go code or having to be expert in kubernetes operators. Everything I'm going to cover here is in <a href=\"https://github.com/rprakashg-redhat/crossplane-eks\">this</a> github repo. Lets jump right into it.</p>\n<p>Provision an EKS cluster by running terraform scripts included in the infra directory in the github repo, this cluster is going to act as a tools cluster where I will be installing crossplane.</p>\n<p>Create the tools cluster by running terraform commands below</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">cd infra\n\nterraform init\nterraform plan\nterraform apply</code></pre></div>\n<p>After terraform commands are completed successfully we can see that the cluster was provisioned and is active from the screen capture below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a0a0d5ea445cb5a8406ce46d2b5ba3e1/63b67/ekscrossplane.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.500000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjUlEQVR42k3MSw7CMAwE0N7/UhyBLUuEEKI0bYiTOr8mQ2JoxeLJ9tjyoOYFz9eE2/2B3k9q/qs/6mtued/ts5gURqUxXs8YLycMMSWEEKANIeUsOHjkbZM8xohSCmqpWD03rt0kyXYhJmRPyLxgqLWCmeUhOQfbGKKjkrXSd5reWIyGsXRkndysDMseH5B35hYtJ1h7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"crossplaneeks\"\n        title=\"\"\n        src=\"/static/a0a0d5ea445cb5a8406ce46d2b5ba3e1/5a190/ekscrossplane.png\"\n        srcset=\"/static/a0a0d5ea445cb5a8406ce46d2b5ba3e1/772e8/ekscrossplane.png 200w,\n/static/a0a0d5ea445cb5a8406ce46d2b5ba3e1/e17e5/ekscrossplane.png 400w,\n/static/a0a0d5ea445cb5a8406ce46d2b5ba3e1/5a190/ekscrossplane.png 800w,\n/static/a0a0d5ea445cb5a8406ce46d2b5ba3e1/c1b63/ekscrossplane.png 1200w,\n/static/a0a0d5ea445cb5a8406ce46d2b5ba3e1/29007/ekscrossplane.png 1600w,\n/static/a0a0d5ea445cb5a8406ce46d2b5ba3e1/63b67/ekscrossplane.png 2447w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Install crossplane using helm chart. This is pretty well documented <a href=\"https://docs.crossplane.io/v1.14/software/install/\">here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">helm repo update\n\nhelm install crossplane \\\n    crossplane<span class=\"token punctuation\">-</span>stable/crossplane \\\n    <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>namespace crossplane<span class=\"token punctuation\">-</span>system \\\n    <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>create<span class=\"token punctuation\">-</span>namespace</code></pre></div>\n<p>Lets verify that the crossplane pods are running and healthy</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">kubectl get pods <span class=\"token punctuation\">-</span>n crossplane<span class=\"token punctuation\">-</span>system</code></pre></div>\n<p>and we can see that all crossplane system pods are up and running</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5d70a69e0bc5d09f64c1d32e106a8699/2c118/crossplanesystem.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAfUlEQVR42kXKuw6CMBiA0b+WqfciVYjBiPImJmIY3dT3f47PhsXhbEeGYaA/HjC2ReyjWlBhrZ4ov6DjSj5/sP2LePpi7jPt22OuFlMMKSWcc3jv6boOmaaJcRwppbBvQxXZ7RQistFa12zIOTHfLgQXaKQh+kiOeTtK/f8P87kw0ePCGIcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"crossplanesystem\"\n        title=\"\"\n        src=\"/static/5d70a69e0bc5d09f64c1d32e106a8699/5a190/crossplanesystem.png\"\n        srcset=\"/static/5d70a69e0bc5d09f64c1d32e106a8699/772e8/crossplanesystem.png 200w,\n/static/5d70a69e0bc5d09f64c1d32e106a8699/e17e5/crossplanesystem.png 400w,\n/static/5d70a69e0bc5d09f64c1d32e106a8699/5a190/crossplanesystem.png 800w,\n/static/5d70a69e0bc5d09f64c1d32e106a8699/c1b63/crossplanesystem.png 1200w,\n/static/5d70a69e0bc5d09f64c1d32e106a8699/2c118/crossplanesystem.png 1505w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Install following crossplane AWS providers shown below. Providers enable crossplane to provision infrastructure on an external service. For more info on other providers including the AWS ones listed below checkout <a href=\"https://marketplace.upbound.io/providers\">https://marketplace.upbound.io/providers</a></p>\n<ul>\n<li><a href=\"https://marketplace.upbound.io/providers/upbound/provider-aws-ec2/v0.47.1\">ec2</a></li>\n<li><a href=\"https://marketplace.upbound.io/providers/upbound/provider-aws-kms/v0.47.1\">kms</a></li>\n<li><a href=\"https://marketplace.upbound.io/providers/upbound/provider-aws-iam/v0.47.1\">iam</a></li>\n<li><a href=\"https://marketplace.upbound.io/providers/upbound/provider-aws-eks/v0.47.1\">eks</a></li>\n</ul>\n<p>Install a go templating composition function which I'll use when defining resource composition for the composite API we will define later in this post. For more information about this function check out the upbound marketplace <a href=\"https://marketplace.upbound.io/functions/crossplane-contrib/function-go-templating/v0.4.1\">https://marketplace.upbound.io/functions/crossplane-contrib/function-go-templating/v0.4.1</a></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">cat &lt;&lt;EOF <span class=\"token punctuation\">|</span> kubectl apply <span class=\"token punctuation\">-</span>f <span class=\"token punctuation\">-</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> pkg.crossplane.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Function\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> function<span class=\"token punctuation\">-</span>go<span class=\"token punctuation\">-</span>templating\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">package</span><span class=\"token punctuation\">:</span> xpkg.upbound.io/upbound/function<span class=\"token punctuation\">-</span>go<span class=\"token punctuation\">-</span>templating<span class=\"token punctuation\">:</span>v0.4.1\nEOF</code></pre></div>\n<p>verify that the function was installed successfully and running healthy.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">kubectl get function</code></pre></div>\n<p>Setup cloud provider credentials. Run command below to create a credentials file. Be sure to create an IAM account with required privileges and set the environment variables referenced in the below command with respective values that match your environment.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">echo \"[default] \\naws_access_key_id = ${AWS_ACCESS_KEY_ID}\\naws_secret_access_key = ${AWS_SECRET_ACCESS_KEY}\" > aws-credentials.txt</code></pre></div>\n<p><strong><em>Be sure to not checkin the <code class=\"language-text\">aws-credentials.txt</code> file to github by including an entry in your <code class=\"language-text\">.gitignore</code> file to ignore it</em></strong></p>\n<p>Create a kubernetes secret from <code class=\"language-text\">aws-credentials.txt</code> file by running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl create secret \\\n    generic aws-secret \\\n    -n crossplane-system \\\n    --from-file=creds=./aws-credentials.txt</code></pre></div>\n<p>Create a provider config resource to customize the settings of the AWS provider. Basically this is how we tell the crossplane AWS provider how to authenticate with AWS.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">cat &lt;&lt;EOF <span class=\"token punctuation\">|</span> kubectl apply <span class=\"token punctuation\">-</span>f <span class=\"token punctuation\">-</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> aws.upbound.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ProviderConfig\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>config\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">credentials</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span> Secret\n    <span class=\"token key atrule\">secretRef</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> crossplane<span class=\"token punctuation\">-</span>system\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>secret\n      <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> creds\nEOF</code></pre></div>\n<h2>Create Composite Resource Definitions</h2>\n<p>Composite resource definitions (XRDs) allows us to define the schema for custom APIs. All schemas follow kubernetes custom resource definition <a href=\"https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#specifying-a-structural-schema\">OpenAPIv3 structural schema</a>. Since I want the cluster to be provisioned within its own VPC with public and private subnets and route tables I decided to create 2 custom APIs. 1) Virtualnetwork (Creates VPC with subnets and route tables, Internet Gateway, NAT Gateway, Routing rules). 2) EKSCluster (Creates EKS Clusters with managed nodegroups and virtual network). Both APIs can be found <a href=\"https://github.com/rprakashg-redhat/crossplane-eks/tree/main/apis\">here</a></p>\n<p>Create the XRDs by running the command below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl apply -f apis/virtualnetwork.yaml\n\nkubectl apply -f apis/ekscluster.yaml</code></pre></div>\n<p>We can verify that the XRD's are created by running <code class=\"language-text\">kubectl get xrd</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/26d15dbdc340593d60e4ee19c52fd44b/54c3a/verifyxrd.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.499999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhUlEQVR42j2MzQqCQBgAv9UFMXVX19T9gYTwED1DxxA61sEuvf9rTELQYRiYw0iMkR+JcejQ1RWT3vjlQxNf9POGO23U4YluH2TNSt6vZPeS7CaoQVHYAmssWmskpYT3nhDC7ony4DiOC9bNSN4yxQuVSbjhjNIdkrV7N4gRpN6HohCRP19FYjFx04gJTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"verifyxrd\"\n        title=\"\"\n        src=\"/static/26d15dbdc340593d60e4ee19c52fd44b/5a190/verifyxrd.png\"\n        srcset=\"/static/26d15dbdc340593d60e4ee19c52fd44b/772e8/verifyxrd.png 200w,\n/static/26d15dbdc340593d60e4ee19c52fd44b/e17e5/verifyxrd.png 400w,\n/static/26d15dbdc340593d60e4ee19c52fd44b/5a190/verifyxrd.png 800w,\n/static/26d15dbdc340593d60e4ee19c52fd44b/c1b63/verifyxrd.png 1200w,\n/static/26d15dbdc340593d60e4ee19c52fd44b/54c3a/verifyxrd.png 1257w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Create Compositions</h2>\n<p>Compositions are like a deployment template for provisioning a group of resources as single object. I've defined the composition logic for both virtualnetwork and ekscluster XRDs and will go ahead and create them. In summary all required steps for provisioning VPC with subnets and route tables are defined in the composition for virtualnetwork and all resources that need to be created to have a fully functional eks cluster are defined in the composition for ekscluster XRD. You can see in the composition file I'm basically defining all the managed resources defined in the providers and crossplane takes care of provisioning them in my AWS account. You'll also notice each managed resource has a <code class=\"language-text\">providerConfigRef</code> property that we are using to tell crossplane system how to authenticate with the AWS account which we configured earlier.</p>\n<p>You can also see in the composition for <code class=\"language-text\">ekscluster</code> XRD that I'm nesting the <code class=\"language-text\">VirtualNetwork</code> XRD instead of duplicating all the logic of provisioning VPC, Subnets, route tables etc. By moving that into a seperate XRD allows us to reuse it for other usecases as well</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl apply -f composition/virtualnetwork.yaml\nkubectl apply -f composition/ekscluster.yaml</code></pre></div>\n<p>We can see that composition resources are created successfully for our XRDs</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54af83fc5bedb03e4ac1110a02240831/9ba38/composition.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.999999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgUlEQVR42lXMywqCQBiA0R80yhoHZ8RM0HEEYVwG4i6Qrvj+L/Rl7lqc7ZEQAs65TVVdyLKcLiyUbuagrzT9m25YODczupgwxY1955BBkFyIjhE61RhjSJIE+UXe+zVssdagUkPpF7LqSawmCvchr18bWz9Q9s6ub5FxzU4xIvLnC5AoM3PDbbQMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"compositions\"\n        title=\"\"\n        src=\"/static/54af83fc5bedb03e4ac1110a02240831/5a190/composition.png\"\n        srcset=\"/static/54af83fc5bedb03e4ac1110a02240831/772e8/composition.png 200w,\n/static/54af83fc5bedb03e4ac1110a02240831/e17e5/composition.png 400w,\n/static/54af83fc5bedb03e4ac1110a02240831/5a190/composition.png 800w,\n/static/54af83fc5bedb03e4ac1110a02240831/c1b63/composition.png 1200w,\n/static/54af83fc5bedb03e4ac1110a02240831/9ba38/composition.png 1329w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Creating an EKS cluster</h2>\n<p>We can now create an EKS cluster by simply running command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: stacks.aws.io/v1alpha1\nkind: EKSCluster\nmetadata:\n  name: crossplane-eks-cluster\nspec:\n  region: \"us-west-1\"\n  version: \"1.27\"\n  compute:\n    nodeGroups:\n    - name: default\n      instanceType: t3.medium\n      scaling:\n        minSize: 2\n        maxSize: 3\n        desiredSize: 2\n  availabilityZones:\n  - us-west-1a\n  - us-west-1c\n  networking:\n    name: crossplane-eks-cluster-vpc\n    cidr: 10.0.0.0/16\n    publicSubnet:\n      cidr:\n      - 10.0.3.0/24\n      - 10.0.4.0/24\n    privateSubnet:\n      cidr:\n      - 10.0.1.0/24\n      - 10.0.2.0/24\nEOF</code></pre></div>\n<p>To see a list of managed resources that are created and their status we can run <code class=\"language-text\">kubectl get managed</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b31cce763de8128348beb4a33a705cff/07d7d/managed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABk0lEQVR42n2T2ZKCUBBD3ZUdFARcAMHSUuf/fy/D6ar7Mo4+pJqLTTrpXCd1XWu/32u3KxRm9xEP+cldwViT4ke7V636VqmqaiVJotlspslk8hlVVSmKIsVxpDTxDUnsKwzWisKNYi9SnuU6Ho/K89xA/3q9NrwRXq9XDcNgHwzjc9t16vtBTdupG9EPvcqq1Ha7NYX0Px4PdWMf5zfCsiwVhuGoMLYGKkAFZyounMLNZmO2V6vV//aLolCWZaYApGk67nMn3rNb3jHQ9315nmfgOQgCzefzd0JCcbuBBDI3gOpCa5rGfmfgYrH4HAqNp9PJwPPhcDB75/PZhmAb4rZtx932NmC5XH5PGflub4AzNlGJYiq7JlV29/Xa0IiNv3sELhiU4gByBn+9i+zHpexUcmYAZFhkBc4FKqfT6WdCppMaJM6qSxRyFBMG5ID3EDqgFpC4DeKismwCuVwutnwqoWATMgbhhOHP59N6XP/tdtPr9bKLbumTKs3skoCofIhlyFCIZapT7P56XHLc8OwU/gIkHi9txZ0KrQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"managed\"\n        title=\"\"\n        src=\"/static/b31cce763de8128348beb4a33a705cff/5a190/managed.png\"\n        srcset=\"/static/b31cce763de8128348beb4a33a705cff/772e8/managed.png 200w,\n/static/b31cce763de8128348beb4a33a705cff/e17e5/managed.png 400w,\n/static/b31cce763de8128348beb4a33a705cff/5a190/managed.png 800w,\n/static/b31cce763de8128348beb4a33a705cff/c1b63/managed.png 1200w,\n/static/b31cce763de8128348beb4a33a705cff/07d7d/managed.png 1478w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When <code class=\"language-text\">READY</code> and <code class=\"language-text\">SYNCED</code> for all managed resources show value 'True' this means that everything was provisioned successfully in AWS. If you see it stuck in False we can run <code class=\"language-text\">kubectl describe {replace with managed resource}</code> to see more details about why its stuck.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c001eba8adbd7c9293c346acb77424f4/2dab4/managed1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVR42n2TS3OCQBCE8YkgKgqKCIKPWB58VE45pFLJIf//N3X4tjKpVDQeurZ2YXt6ume93W6rqlorWrxpWnwoyV81K96UlZ/Kn19UvRdKskRpkioIA3me9xi+7ysIAkXDvsKg5xD4XQ2HvsajSHEUqywKzWYzjUYj9ft9d7HVajncEB4OB9V1rXqz1abB/unQKK5VlpWKstRyudR0OlWWZQ7X61XH41Hr9bopOrwlTJLEXTCkaao4jp2i+XyuxWKh4lthFEUOKGXtdDq3hFyGiAvAiCk0Ho8dKJLnueuEc4C6uy1TDXDRFEwmE7dfrVZOIWd4jSL8Bt1u934oVC4br2gL4BmAyCzgn9Pp1Hi8cer+JQP4ZIYDiDiDBDsg4Jw9oNV2u/0/oQXw20Nr37wkUbrg7KG634QWjKmiVYDi8nt82OP3Q4W0gCILx4KxtC3ZMAzvz91fQMZFlNkIcWZ7m0cD33ktvV7PrWAwGLjk3Vzu93vn0XbLm65+VhIldVPNKNE+r4Rv/McrO5/Pulwu7l9GyzPvqG7BQIA6lJIs/kFor4Rg8BGgygac9QvyZEaVRDeHbQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"managed\"\n        title=\"\"\n        src=\"/static/c001eba8adbd7c9293c346acb77424f4/5a190/managed1.png\"\n        srcset=\"/static/c001eba8adbd7c9293c346acb77424f4/772e8/managed1.png 200w,\n/static/c001eba8adbd7c9293c346acb77424f4/e17e5/managed1.png 400w,\n/static/c001eba8adbd7c9293c346acb77424f4/5a190/managed1.png 800w,\n/static/c001eba8adbd7c9293c346acb77424f4/c1b63/managed1.png 1200w,\n/static/c001eba8adbd7c9293c346acb77424f4/2dab4/managed1.png 1461w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Additionally you can login to AWS console and verify all resources are successfully provisioned. Screen capture below shows EKS cluster provisioned with default managed node group</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fda82e59ef9ce5fb4d21224917c7a980/cc6fe/crossplanecluster.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNElEQVR42mVRB27DMBDz/38RFAmaZbfp+lNaeMinLZm9k53VGiCOoqhbrrbNCc3pC+ttjdV6h832iEPzjv0fPD0fsdrssavfHvSa3x5ePgo/vn6i8jFimia0o8V5ILRkQT5BhwS6h0+Lnq98lJgm2DwVPmiLahwJkZP2SkE7B+cDLEdjLBRpGOdh7Kz3pBgDaw6ez6LLvQ+BEUusApOcM9quxXfb4aftoYYBigv0HAeOwklrBi3Q0OX8HxX4k5GJu7FcMcaAwJUcd5FSKsUE0rV0kHiaGFPxyL1AeF74LSFX9t4vD2IxXaLosgJjTCl00e89TjzWzgk5I7qux5nHLfsqu/TcseXRzNU80lzULTvWXMC72ado5Cnp1qGYiU0xZUZ6gIwqCSVJkAkW/cqj/BBf1vIL9WRe/LbYGnsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"crossplanecluster\"\n        title=\"\"\n        src=\"/static/fda82e59ef9ce5fb4d21224917c7a980/5a190/crossplanecluster.png\"\n        srcset=\"/static/fda82e59ef9ce5fb4d21224917c7a980/772e8/crossplanecluster.png 200w,\n/static/fda82e59ef9ce5fb4d21224917c7a980/e17e5/crossplanecluster.png 400w,\n/static/fda82e59ef9ce5fb4d21224917c7a980/5a190/crossplanecluster.png 800w,\n/static/fda82e59ef9ce5fb4d21224917c7a980/c1b63/crossplanecluster.png 1200w,\n/static/fda82e59ef9ce5fb4d21224917c7a980/29007/crossplanecluster.png 1600w,\n/static/fda82e59ef9ce5fb4d21224917c7a980/cc6fe/crossplanecluster.png 1860w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Browse to VPC in console and verify all resource provisioned. Screen capture below shows VPC that was created by crossplane</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3229cd7e74c98f5b60eb53e65c1a7057/20785/vpc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVR42q1RXUvEMBDMD/bl4K7qWfVA7oT7o4pc03w2adNm3E2kCPogamCY3dnJEDbi4fmM/eGMTdPianOL7c2B8Ijr9glNe8J2f8SOeHd3XMF6c38qemHWPljEGJHzgpQSxmkCnzTPmDNzwrLUWc651HW+VA/1E/FCszHNxSOkMrDOYwgDOinRK4VLr/FGkFQroyB7BWMttGGvQ0ez1458SuPl0kNqU7gnFhwWQkSgl/IFvsiwBW7tP8M6C7fW1eNc7QWHeD98CfwtREn3/n8DQwhr4F8h+BM4LNIeNS01xvFH4L1/p78DzQJNrHPBLW4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vpc\"\n        title=\"\"\n        src=\"/static/3229cd7e74c98f5b60eb53e65c1a7057/5a190/vpc.png\"\n        srcset=\"/static/3229cd7e74c98f5b60eb53e65c1a7057/772e8/vpc.png 200w,\n/static/3229cd7e74c98f5b60eb53e65c1a7057/e17e5/vpc.png 400w,\n/static/3229cd7e74c98f5b60eb53e65c1a7057/5a190/vpc.png 800w,\n/static/3229cd7e74c98f5b60eb53e65c1a7057/c1b63/vpc.png 1200w,\n/static/3229cd7e74c98f5b60eb53e65c1a7057/20785/vpc.png 1307w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>So far I'm really liking what I've been able to do with Crossplane, I plan to extend this to be able to define cluster recipes (Small/Medium, Large as an example) so folks requesting cluster don't even have to know anything about networking, compute etc. Also I could have defined XRDs more provider agnostic and not use <code class=\"language-text\">EKS</code>, <code class=\"language-text\">Availability Zone</code> etc in the api spec.</p>\n<p>Hope this post helped spawn new ideas if you are a platform builder or building tools for enterprise.</p>\n<p>As always feel free to reach out if you have any questions about this post</p>\n<p>Thanks,\nRam</p>","id":"e635bc93-9143-5a2b-85af-e6b631ccdc29","frontmatter":{"title":"Automating provisioning of EKS Clusters with Crossplane","date":"January, 2024","tags":["Crossplane","AWS","EKS","Tools","Kubernetes"]},"fields":{"slug":"/provisioning-eks-clusters-with-crossplane/"}}},{"node":{"excerpt":"In kubernetes by default all ingress and egress traffic are allowed on all pods running in a cluster. From a zero trust security standpoint this is a bad thing because once a POD within a cluster is…","html":"<p>In kubernetes by default all ingress and egress traffic are allowed on all pods running in a cluster. From a zero trust security standpoint this is a bad thing because once a POD within a cluster is compromised attacker could gain foothold on other application pods running on the cluster causing more damage to company.</p>\n<p>In Kubernetes network policy resource allows us to define how pods running on a cluster should communicate with each other and other network endpoints. One of the common challenges that most customers face is that even after creating the required network policies it is often hard to identify whether the applied network policies achieve the desire network topology. Red Hat Advanced Cluster security for kubernetes provides a set of tools to help with this.</p>\n<ul>\n<li>Network graph (Helps you visualize network flows within your environment)</li>\n<li>Network policy generator (Generate required network policies based on established baseline network flows)</li>\n<li>Network policy simulator (Quickly preview the policies in environment before it is applied)</li>\n<li>Build time network policy generator (Shift left, create and apply policies from a CICD pipeline)</li>\n</ul>\n<p>Much indepth explanation of these capabilities can be found here in RHACS documentation <a href=\"https://docs.openshift.com/acs/4.3/operating/manage-network-policies.html\">here</a></p>\n<p>I got a chance to dive a bit deeper into this last week and my goal with this article is to share what I have done with the community. I wanted to experience these capabilities like any kubernetes developer would go through so instead of leveraging some of our internal pre-built demos I decided to build off of set of demo applications I had already built over last year. Everything I'm covering here can be found in this github <a href=\"https://github.com/rprakashg-redhat/rhacs-policy-management\">repo</a></p>\n<h2>Overview of Demo Applications</h2>\n<p>There are two demo applications that I'm going to use to demonstrate the network segmentation capabilities.</p>\n<ul>\n<li>Eventscheduler</li>\n</ul>\n<p>This is microservice which provides 3 REST Apis for Event, Session, Speaker resources. It uses hibernate/panache ORM capabilities to persist data into a PostgreSQL database.</p>\n<ul>\n<li>Graph</li>\n</ul>\n<p>This is a GraphQL server that mobile and web apps can use to read data and present it to users. GraphQL server queries all Event, Session and Speaker data by invoking the REST endpoints exposed by the eventscheduler microservice. GraphQL server also leverages Prisma ORM to query session reviews from a MongoDB database. Key goal here is to abstract away all of the complexities of data read and write from underlying sources from the front end developers and provide a consistent and standard mechanism.</p>\n<h2>Overview of Demo Environment</h2>\n<p>For the purposes of this exercise I decided to use AWS cloud. Containerized applications are deployed to an EKS cluster and for Postgresql I'm using RDS managed database service. Provisioning of EKS and RDS instance was done using set of terraform scripts which you can find <a href=\"https://github.com/rprakashg-redhat/rhacs-policy-management/tree/main/deploy/infra\">here</a></p>\n<p>To provision the infrastructure resources required on AWS follow steps below</p>\n<p>Clone the repository by running <code class=\"language-text\">git clone git@github.com:rprakashg-redhat/rhacs-policy-management.git</code>.</p>\n<p>Next switch the current directory to directory where terraform scripts are by running this command <code class=\"language-text\">cd rhacs-policy-management/deploy/infra</code></p>\n<p>Run commands below to provision the required infrastructure in AWS</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">terraform init\nterraform plan\nterraform apply</code></pre></div>\n<p>For Red Hat Advanced Cluster Security I'm using hosted ACS instances which is a fully managed offerring. We have lot of customers that are leveraging that because they don't want to worry about managing the infrastructure needed to run RHACS workload.</p>\n<p>Next I installed RHACS secure cluster components on the EKS cluster to see how RHACS can help implement network segmentation in my EKS cluster with kubernetes network policies. Instructions for installing secure cluster services on other kubernetes distributions can be found <a href=\"https://docs.openshift.com/acs/4.3/installing/installing_other/install-secured-cluster-other.html\">here</a></p>\n<p>Screen capture below shows all secure cluster service running healthy on the EKS cluster and cluster successfully joined to hosted ACS instance</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8b0b114e82a3dabcc3d3bda07c0dad97/e16b4/acs-clusters.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.499999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyElEQVR42lWM20rDQBRF8w9SFPpQEL9L8XdKqy/aZHKTtEV8UGKbTF7yXzG3meXkKEo2Z3HYe88c7/VwZOcrnp59dkFIGKWoMMYPFCpKnE8IVCyZCiPn41+f4Ls99fv9kSzLeElTvIvFJbd399R1zbkoKMtS0Fqj3a6qyqHF/3clRXEW8s8Tb++58JGf8K6WK9abByaN44i1FmQsg/NzudSa+VunYRgxP9/wVtc3bLaPUvR9jzHmj7Ztab4auq6b5YK1cnCGMXwDNFUKGPcIYdIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"acs-cluster\"\n        title=\"\"\n        src=\"/static/8b0b114e82a3dabcc3d3bda07c0dad97/5a190/acs-clusters.png\"\n        srcset=\"/static/8b0b114e82a3dabcc3d3bda07c0dad97/772e8/acs-clusters.png 200w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/e17e5/acs-clusters.png 400w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/5a190/acs-clusters.png 800w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/c1b63/acs-clusters.png 1200w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/29007/acs-clusters.png 1600w,\n/static/8b0b114e82a3dabcc3d3bda07c0dad97/e16b4/acs-clusters.png 2546w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Deploying the demo applications</h2>\n<p>I automated all the steps for building and deploying the demo apps to EKS cluster using a github actions workflow which can be found <a href=\"https://github.com/rprakashg-redhat/rhacs-policy-management/tree/main/.github/workflows\">here</a>. You will find two workflow files here <strong>1)</strong> ci.yaml and <strong>2)</strong> cd.yaml</p>\n<ul>\n<li>\n<p>ci work flow automates all aspects of going from application source code to container images. Application container images are pushed to container registry. For the purposes of this post I'm using github container registry and also leveraging buildah to build the container images. This workflow is automatically triggered on push when any files under apps directory are updated. All of the source code for the demo applications are stored under this directory. last step of the workflow I'm updating deployment manifests to inject new version of container image to deploy to EKS cluster.</p>\n</li>\n<li>\n<p>cd work flow automates all aspects of deploying container images to EKS cluster. I'm using kustomize and kubectl to deploy and configure application components on the EKS cluster. This workflow is automatically triggered when any files under deploy/apps directory are modified. This is where the deployment manifests are stored which is why I've set it up that way. Workflow also has a on dispatch trigger where I can turn on build time network policy generation using roxctl which is a cli tool provided with Red Hat Advanced Cluster Security that we can use to generate network policies during build time by inspecting the kubernetes manifests for demo applications.</p>\n</li>\n</ul>\n<p>I'm going to manually trigger the ci pipeline for the purposes of this post so we can build the container images for applications to be deployed to cluster. Pipleline completed without failures as you can see from screen capture below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d93ccde619da822adf02fbe83ed0182/f705a/ci.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABKUlEQVR42o2R2U7DMBBFLbpkdeIszZ6GxE2ipBQoRYIHHvj/n7qM3QpoJSQejsYztmau7zCxKeGKRMODFFGcww/Tcy1QMf2+/w+s7kYE1DRMKohNoZvwMINHqAGcHqmze4m/0fc3sKzqEKU1UcGPckRJiUbO2MoJRTPA3zTI6w5p2SKrJNR7ERea2wEKNkzPGPZH9NOjLgj6ckzNLTeA5QgYtoBJUeUqmrrm/wkb5iPafo+kuNeSHT+GFySweYi17cFwPCwMG0vDwcp0Neq8WNtX+ZLyu5UFVja99sdRSyGUj9PpDaf3Tzy9fqCfX2hQgryVkOMB3XAgC3aw/RB1P6IdHpDVUu9ADWHFdndtMG24GWdo5dRA+ai+qRVanBRxrepHIT8rvKj+AuQ0rDzRm97VAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ci\"\n        title=\"\"\n        src=\"/static/3d93ccde619da822adf02fbe83ed0182/5a190/ci.png\"\n        srcset=\"/static/3d93ccde619da822adf02fbe83ed0182/772e8/ci.png 200w,\n/static/3d93ccde619da822adf02fbe83ed0182/e17e5/ci.png 400w,\n/static/3d93ccde619da822adf02fbe83ed0182/5a190/ci.png 800w,\n/static/3d93ccde619da822adf02fbe83ed0182/c1b63/ci.png 1200w,\n/static/3d93ccde619da822adf02fbe83ed0182/f705a/ci.png 1493w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can also see that a new pull request was created to deploy new versions of the application as shown in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54c7ad304e8b034bd25453ea331970c9/37c35/pr.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiUlEQVR42n3S246bMBAGYKpW6W6akEA42BwMtgPGYMISWq36/g/2dyDtqlq1e/HJxscZD16UFggjDpZXuCQ59scAu+cDdk8HfN37j/bZ38Y+fXnC593+Q17d9qiVQddP0GaEMjdc7fzQ39H0C4z7Dt3NYIXGt1P0IS/vDFIut8VcNEiFAasdmLwhFj1xiKuHC1c4hilh/+VFjFJNS0RMIKKUE1YgySqk5BQmG58c6Xb/HFOf0di/+XSZJ7RFEOfb6UnzE3n3CtFOZAaXjgwUtUWYNQj5dRNwjRPTOLN3Lc15dlwgVLdFIqsWWVajUBZFbZHmEqV2ZAAvr8jW+cpAyA62sbD0/j1Z+70ZoGULby0EF9ctLdF1kP0AaW9kRG0d2ukHtLsjb3qULR1O60U3opmm317e+nJw8A5nep9glYKrV2R6oY0T8rUouUFcGCoGpZmqN5eN/qt9CBIFbz3oD1kXqOqSUm6QiTXdBnqYoSjiUneo2wGVcbBuxLJMmO8PL/ONvmf6/RR+AZU87sLDsoWAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pr\"\n        title=\"\"\n        src=\"/static/54c7ad304e8b034bd25453ea331970c9/5a190/pr.png\"\n        srcset=\"/static/54c7ad304e8b034bd25453ea331970c9/772e8/pr.png 200w,\n/static/54c7ad304e8b034bd25453ea331970c9/e17e5/pr.png 400w,\n/static/54c7ad304e8b034bd25453ea331970c9/5a190/pr.png 800w,\n/static/54c7ad304e8b034bd25453ea331970c9/c1b63/pr.png 1200w,\n/static/54c7ad304e8b034bd25453ea331970c9/29007/pr.png 1600w,\n/static/54c7ad304e8b034bd25453ea331970c9/37c35/pr.png 1810w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>and the container images for both apps are successfully built and pushed to github container registry as shown below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc6d225a18325482e21a731be757c67e/620ae/packages.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABYElEQVR42q1S2ZLEIAjM/3/oZHdzeN8aFtAklYeZfVmqugREpFunXTkQCGUCSB3YF8rDJh3GnrFLy/kzvmv8ld8UnsW6SWoLSmnwIYLz2BR9ZRysQoO2Fqyjhorz1jmwmFPagMaaRdz+vChY1hUmHwv4VMDFzCA/DHiK4x3z/sjRGkZsXMRJDewKJ4yZijPj9H1MXMxI+TpM+6lUiFxfrphz4+wkkEpM2IAoI72IzciO43iAjOivu2BpCJuQSHOHn2VjycgmYx0Y1IA0klIPTSwUvLU3HkC/1AYpZ6i41lrZT4mQoLXWG87fCxCso1sjrwbhQ+pSxPyg/5Bo0D6p06XTsm5AU9Z28ASE08+ljbV+RG+a+4Sv14z/R/LoPgTW0eDXMEhbI32PWv1lRD+XMhrOX6xFprGZYmSQyNSs1E7lE2prd0N6DJqKDhN4MtM/LH14uv16mDfojzQeBf7ZfgE8halxAduW9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"package\"\n        title=\"\"\n        src=\"/static/cc6d225a18325482e21a731be757c67e/5a190/packages.png\"\n        srcset=\"/static/cc6d225a18325482e21a731be757c67e/772e8/packages.png 200w,\n/static/cc6d225a18325482e21a731be757c67e/e17e5/packages.png 400w,\n/static/cc6d225a18325482e21a731be757c67e/5a190/packages.png 800w,\n/static/cc6d225a18325482e21a731be757c67e/620ae/packages.png 1043w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next I'll just merge the PR which will trigger the cd pipeline and deploy the new version of demo applications to EKS cluster. Screen capture below shows cd pipeline running</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c05dabd5baffee59548afb00c0f8c7d2/2eb79/cd-onpush.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABD0lEQVR42oWR23aCMBBF00oBNQiBcAtBRRGp9N7//7bTzLh01T7Yh70y15OZRGy6Fofn9xv68Q3D6QPD9Inx9Zvt8eWL473LF02HVVpBJgUiVd4gzPaIbpi4qDBbJtHG0UDlDeKs5kISIC4+iZFNXHJnwc0e9XrPzWchw8XGdjzRtp9cvmficoe0sDi6ybOyZZtQueV+EhWVsajs/nozsYxz6KqFLi0WUep8jcVKI4wyhFJBOn/u4sEyYULp4FPRhAPqtr95DxKUSQ4/lBDCg5j5zOPTnHnwwqv9F0Fvt96N11VpbBLM8gLd4QTjVqX1dLWGF0jM/MVdBDXTOr9/imIrpXltlRt3Scl4wfJfwR/7S6vYp928dQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd\"\n        title=\"\"\n        src=\"/static/c05dabd5baffee59548afb00c0f8c7d2/5a190/cd-onpush.png\"\n        srcset=\"/static/c05dabd5baffee59548afb00c0f8c7d2/772e8/cd-onpush.png 200w,\n/static/c05dabd5baffee59548afb00c0f8c7d2/e17e5/cd-onpush.png 400w,\n/static/c05dabd5baffee59548afb00c0f8c7d2/5a190/cd-onpush.png 800w,\n/static/c05dabd5baffee59548afb00c0f8c7d2/c1b63/cd-onpush.png 1200w,\n/static/c05dabd5baffee59548afb00c0f8c7d2/2eb79/cd-onpush.png 1256w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Pipeline completed without failures as shown in screen capture below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e908a9a1b2073742b37cc3aab614c03f/b7936/cd-details.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDUlEQVR42qWTy26DMBBFURsgdvzGNo/QJlGjdtP//72bGSfZtF1AWYwAyTo6d66p8nSGchna92WUS5jPV6ThDa102LVq1VQfn9/IxwvSdEIcT5Cmg08jXDeg3vOhA14buXiq8f0KHXoYAtg4QuhQoGzKI5RbB5wvXzBhKHH5yUAXB4Q0lWmlwUstlgOfu3sCJQGV7eibDG0ssVcZ/gSyoaX4IR/R9TNF9tsMRTGMMD7TLsP6Un4BFRv2xZBL2R/s9h1yEZoM2VITtBZ6W2QTMhlOpW225RVsAnLDDGU7oT0aYeiw2Ab08f63sB03vfT6/Ankdi29m8ceea93y/8aUlS+i/zbNVTIrpWLm74BDPQ8yksjW/wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd-details\"\n        title=\"\"\n        src=\"/static/e908a9a1b2073742b37cc3aab614c03f/5a190/cd-details.png\"\n        srcset=\"/static/e908a9a1b2073742b37cc3aab614c03f/772e8/cd-details.png 200w,\n/static/e908a9a1b2073742b37cc3aab614c03f/e17e5/cd-details.png 400w,\n/static/e908a9a1b2073742b37cc3aab614c03f/5a190/cd-details.png 800w,\n/static/e908a9a1b2073742b37cc3aab614c03f/b7936/cd-details.png 1155w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can see that the steps to generate build time network policies and deploy them to EKS cluster was not run because its driven off a workflow dispatch input flag. Reason for this is that first we want to see the experience of an application with no network polcies within RHACS. The other thing you will see in the pipeline is that I'm generating a diagram of all the networkflows using the roxctl tool provided by RHACS. This command <code class=\"language-text\">roxctl netpol connectivity map</code> is used to generate a dot file which is then converted into png format using Graphviz. Both the dot file and the png files are saved as pipeline artifacts which can be downloaded anytime.\nScreen capture blow shows a connectivity diagram that was generated from the previous pipeline run without any network policies</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2fb02e22f0df24651c826fbe6252973/cc155/connlist.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABI0lEQVR42m2RCY7CMAxFuf8dEbQdYAJtuqVJuthvzCKNEDh6SRzZjvW948P0SYpoXaNliRZHozJK5HhEml+YM99s91ZKhZi90TIlzzKNJF8x+YLYtcT2goQeSQ26BotfXy0816PgtoGIueZva6TpC5ow4jrHZMWHPFBbkXrq6FJrsemVarsmRGdD/zt0DvZ7OBygOCqlURVQHTLFwe4lWKPk9EwY4w3XO9xwpR5vtOOF61g/3m7m75YFzRmdZzSmWZ13eu1GvfqTjsGrH1rtYqdD6o1WkfgQWWTRbQ12ZhMK3WR78KFhXk2r2dNHT4gLXT/gmoFzHfm9XYhTZskLss2WIV+HEj6wr0MfQ1URbMjh9PPkfLr7Es5nwjQRRO7x8pb7ByO8HvUSna6LAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"connlist\"\n        title=\"\"\n        src=\"/static/e2fb02e22f0df24651c826fbe6252973/5a190/connlist.png\"\n        srcset=\"/static/e2fb02e22f0df24651c826fbe6252973/772e8/connlist.png 200w,\n/static/e2fb02e22f0df24651c826fbe6252973/e17e5/connlist.png 400w,\n/static/e2fb02e22f0df24651c826fbe6252973/5a190/connlist.png 800w,\n/static/e2fb02e22f0df24651c826fbe6252973/cc155/connlist.png 886w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can see pretty much everything is wide open. Later in the article I'm going to trigger the workflow manually and check the flag to generate and deploy network policies and we will come back to RHACS and see how the experience looks like and also take a look at the connectivity diagram that was generated with build time network policies in place.</p>\n<p>I'm going to login to my hosted ACS instance and we will examine the network graph which is one of the capabilities within RHACS which helps you visualize network flows. I've selected the ekscluster and namespace where the demo applications are deployed so we can see traffic flows for the demo apps. You can select multiple clusters and namespaces depending on your environment and how you want to visualize network flows.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/486339489689f45b12c76f0fe0fce805/91953/network-graph.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVR42pWP20rDQBRF8y+VSGqxVLEPgh+l+BdtLm36O2p9174oDVFs1EAScCbJxMYXJ9meTCAIouCBxdzX2aP1jT56OzpOz87hzB2YponJ1IJl23Bd908WhD2bY2oR5gwTZwFtfHyC4cERbm5XaEpKibrGv6quJKpPCUnvtL39EXq6gYvLKwiRoygKbMsPMMbAOW9JU6REFMeIokjNu7PuTjtqo8MxjMEQy+U1yrKEIGETMc/zDkYikQt4Dz48z1NNv593ZFmbcNcYKKGgTc44qqoVZlmTWCDwfYSvoVpznv4qE+9baDrJmi83wiRMcLdagyUpJRUkyFSaYPOEIAiweYzx8pyoJj9k9Lu39T2+ACEZlsEqloz8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"network-graph\"\n        title=\"\"\n        src=\"/static/486339489689f45b12c76f0fe0fce805/5a190/network-graph.png\"\n        srcset=\"/static/486339489689f45b12c76f0fe0fce805/772e8/network-graph.png 200w,\n/static/486339489689f45b12c76f0fe0fce805/e17e5/network-graph.png 400w,\n/static/486339489689f45b12c76f0fe0fce805/5a190/network-graph.png 800w,\n/static/486339489689f45b12c76f0fe0fce805/c1b63/network-graph.png 1200w,\n/static/486339489689f45b12c76f0fe0fce805/29007/network-graph.png 1600w,\n/static/486339489689f45b12c76f0fe0fce805/91953/network-graph.png 2549w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>One of the first things you will notice is that RHACS is showing the two deployments in the namespace have no policies and is allowing all traffic. We can click on the network policy generator button on the top right cornor of the screen which will allow us to 1) Automatically generate and simulate a set of recommended network policies based on a cluster baseline which is an aggregation of the baselines of all the deployments in the cluster. Network policies generated can be downloaded and applied to target cluster using kubectl. You can also compare side by side with existing network policies that might be on the cluster as well and 2) If you have created network policies on your own you can upload the yaml and preview how it might look like in the environment before you actually apply them.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 431px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1959929eb5e21d628b554d11f3f82c0b/9cb4e/rhacs-netpol-generator.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 180.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE5ElEQVR42pVWya7jVBDNDrYs+AFW7Nj0nr9hAzuQQEKIBV+B1BuWrFkgoVajZup+Ug9vSvIyOnEmx4mTeIwd2znUqdh+yXvQg6WTqnudW666t07VrXnbDAsvhRMcsPBTzNwdlqITfpwjjmOs12tsNps7cE/GaZqi5gQZ2tYWV+MI9ckWrdkW15MIzekWN6Kvwhye52EwGGA4HBYwFYPBsJKj0Qhb+XAtSXMQcSF3maDQk91hPssy7HY7kSlywV2puniX5zlq/MllQZ5n2Bf6fp8fxpXcIxeESY4gzm6lgNIvwI/X5raNVquloZimiW6noyEulktEUQTX9dTDTDx3ZH+5DdyeczPSrboW/awfwlgk8gExyA3nwu12q3tAmSRJhZ2EwnAZSZhkekhulFZe+XKoniLVbaq5rqsGD15k4MMQifIpxyfzlMfA/rCHTAd6Rfns2TNcXl7i7OwMzWYT5+fnePHiBZ4/f45Go6Hv+a7dbuP4YQRhGKmuBulhFG0xn9tYyt5xX4nFYonZzILvB5qLBBcTdw0GQXhrkB4Gvodety0eXmBg9NDvdVC/vkTj+gq2Pa9Cf9NTW61WyNMETXOBr398BNMOYQfA0Ekx93OMN5IayZsNlR+rrcTDWDx03BB/XZh4dPUET7svYa0CmJYDc+bAj2K87aMhh2FYfeFx4zf83fwDvaaJkeTmaGhgvXLeKtx7BvP8sGjQXeHnh1cYm7Yk+0B5zP+9k8FDHqYqmU9lXpF6JR3LveJ8mZNkEKtMlh0oWp3yRijW6xvodHsYmiMYUkEOuqnzRCqLQkkxi+nlOCLn4KFOZzMda2JvNmt4kmeWm6A/22Aw99CdrGBYLsxFoGPqhuVhsvThCs+Zt77va2QE8/MQTX4a8ng8wlD2q9NpS5Foi25gPDJhGH0pHgamkwm63a78b6zFpJQsKiVtbw2KdXuxwGQyVXYwjIWMZyJ5KAxpNp3J+4kaIlhUCRaRe4ei1URCYeliwaBkWMdjlnmGxwzSEIuDORzikUH+mZOBGCbNptOpwpZNP4wnsKyZeDgVivqvpWFtzQaz3mjZX0fSsIRuTniMDMtCriLZFj/DXJqYXTYzkUF8x8MoCrU4zqX7sTk1tElFaElF7syLxiWVuSPjurxrF3Nsaj07xiYq6ujtHgYaQpqzd0AZk5W6IFPsVeZFPU2Z0NrQMo2uKg7HaeN6rlLMlW3wfa/qtzwUzuk70S05eUZVVfMiB+8Z7AozLi4u0JKKTP36uo6bmxtBSyt2vd7QvHsllZwp9V+Hc1IcKKuGVYBjzlMvJblbplQQBCir/j0P+XUmsWEYqjNpe71edWtgL+n3+9U8MZfUYvJvhNNi5Lan8KuWZenLMg/JCi4gK/iOczROWVKPLDkO+8RDGmPT5yJylp6Qp/S45O3xvHouaPf6cP78HfOfHp5Sj38ajcYKesaFNFTymZ6Vc2U0LB7Mwt4Xn+GfD96/DZnFdTgcVJ7oQsFExkRaXIaI8lKguszzMX/4FhefPjj2cI84SQU7uXXtVG5j6ikikfn/cHdf5N/gu6/w6sHHpwbrQrvHN75QLhZ6JXJP3OKVXIqWwl9S83UGh99/g5effHRcD/d6ex06CWzhtF3cakl+Fo00e72HvS8/x9MP37vfRt/5KdaF9Us4v/6CfwHw2bOgeHGBQwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rhacs-netpol-generator\"\n        title=\"\"\n        src=\"/static/1959929eb5e21d628b554d11f3f82c0b/9cb4e/rhacs-netpol-generator.png\"\n        srcset=\"/static/1959929eb5e21d628b554d11f3f82c0b/772e8/rhacs-netpol-generator.png 200w,\n/static/1959929eb5e21d628b554d11f3f82c0b/e17e5/rhacs-netpol-generator.png 400w,\n/static/1959929eb5e21d628b554d11f3f82c0b/9cb4e/rhacs-netpol-generator.png 431w\"\n        sizes=\"(max-width: 431px) 100vw, 431px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Screen capture below shows automatic network policy generation capability.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 398px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e1878aa4a5b39f5bd8bf453a69d38471/692d4/rhacs-gen-netpol.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 151.99999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEXUlEQVR42pVWyY7kRBCtL+EHkBBcR/wD5zlwQkLizJkrP8BHwAkkkJCQkBBiuhmm971qqtqu3fu+O20/XqarurtmeraUnsKV6XyOjHgRWYNVJLCOGyxD0YO/V1Gzsf3cq3a7trp7p1Z2FggMslIgzkoUdYO8apAW1Qa1sqXo5+R6kld8R3CuRdV0OwA6TMMGg7qucXJ8jMPDA5yeHOPf/X31fHZ6ihf/PefaEQ4PDpTd39vD3rNnmEzGkKPrOmWjOEYnKlgZMBBCwPNDIlALQRARIYIwguf5yIsCbdtAfrhtWzRNo+zDkaRkagVMSVhXFVYzDcPrc1xfX2I+1XByJD08xvnZKVzH2fHmsbFdMtJWetjgh59f4Jd/bpALYM2gmzG9zlrYScPYvZloO9oNo5F29JBH/vHPC/z+/Aojc4HLuQeNvutWAs2IVXLeNXY9bIT6MTZH+P637zBcXMCzDayWc8xnOvIs2938LkIZ5KZpGeh+9u8/bvHrT9ewLBOj0UtomoYwDN8axx3Cbca2k3MtwGTooiwL+L6PKIr4XN5trkQHKTv6cAc5dxdD+fLV9Y2asGxHbZYwTOtRT6ZOicORyfhG0AnNCGGGFYaawYqpMJAejCcTRWKZJmL+TqjH2XxOadVoCFHfY2rnGDJxMytSpOOlj5WXQ186mNEO0jSly0IJWPc9jG2bCXKw9mKMFj69CLHg5rUbw/QSBHGuhC0Ye6FE3qj9PDxuqYyBzGLNTNfU4yIMcOu4WHKzH5fwiLQUDzL8aI438W+hOxkJ80x9QSIscpybBnTPpbATmGkML6VXSYmlk8KLCnqawQ5yGF6GMK0eCLu7J5QeSkJB929JtqKnaVUg2aKUYEdiPKXNWa4ZEXM+q9mBiI57x/LISZKQsI9Dw9hoJNRdn4s+Fn6ECe3IdBlXJsIN8ZJWQncCGHEEmydwibKscLOOJWHMfiZjKBDxi0Pbwpydx4lSWH6Oud1bGeMeLcq6f76X04MjFzxyXtVsAjUskpuUTS5qlT0ZG5nRXvzda+i6VqGPoUxK2hP6aa4IG5JcWZaSjtSffPkxoteJHxDKpCRFudFSx2Azo6zdZci4uWvONx9GKD2M8uIuy+soJJGLGUUeZzmirPpwwpCEpcpyg4nrYOSwWtipA1ZR3xAE49S+55FZKQE9kVpSR6bOJq7NamGtmhEWTgLDz5hZsamVNxNqkjAjYUJPclZJRdlIawY+PF5WKzuCxZqWrextKORF1tTQ/HLTYNlcZX+V6e+6vjZ30e1o7lUo2fDWM4IN4TKocbnKYfFyWvNfgBnVbEWVsklJnfEdWVGqqmQbkzHdXqWbj+nffoOjJ5/2hFO3wl/DmGVWsnwKRXaxYJX4rFneenmeYzqdQtd1dR3E7JdVVe30nOHTL3D88UfykpJXZavaeEnUTaf+agjavJZl1leE9KjbXPTSQyHEDuH46y9x9vln93fK+4y3XfYvv3qKsyef4H+luAAPB8b3+wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gen-netpol\"\n        title=\"\"\n        src=\"/static/e1878aa4a5b39f5bd8bf453a69d38471/692d4/rhacs-gen-netpol.png\"\n        srcset=\"/static/e1878aa4a5b39f5bd8bf453a69d38471/772e8/rhacs-gen-netpol.png 200w,\n/static/e1878aa4a5b39f5bd8bf453a69d38471/692d4/rhacs-gen-netpol.png 398w\"\n        sizes=\"(max-width: 398px) 100vw, 398px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Wouldn't it be nice to automatically generate policies and apply them to cluster during build time in a CICD pipeline rather than doing this after application is already deployed to clusters? Who doesn't want to practice Shift Left right? :)</p>\n<p>I'm going to manually trigger the cd pipeline and check <strong>generate network policies</strong> option to automatically generate network policies during build time in pipeline and deploy them to cluster as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b2153a512c325b5b785fba324dca4bdb/9b1e2/cd-gen-netpol.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.000000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVR42n2QbU+DMBSF+aBTXIHS0hcKhRXGNLo5jSbG+P9/1/HSzW0mxg9PTtLc++SeJpVpoWoPTbBCImUcd1mJZS5iXt0scX07w/5kkWYx57lFypAUsoZpAgphkJUGubDIKbnyByoX3xg3R/Qv5v1CujhXSItE0IWlauLSLDygkdOQ6zfw4R7arSB0C0mzvKpPlCThJFR1j6aboiP5kVwKWaEg3YBh9wkb9nDrV5jwDOm3qLozpX+CotT9FsPjO1QznoWXzFW4bqDaNSo3QthAF3tkR3K1AqMMtsfLxxfG3Rva8EBN2/+EjmQd1WriP81vpzZVF9NQK7/fwE0TBMlyafENqXGVicpepocAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd-gen\"\n        title=\"\"\n        src=\"/static/b2153a512c325b5b785fba324dca4bdb/5a190/cd-gen-netpol.png\"\n        srcset=\"/static/b2153a512c325b5b785fba324dca4bdb/772e8/cd-gen-netpol.png 200w,\n/static/b2153a512c325b5b785fba324dca4bdb/e17e5/cd-gen-netpol.png 400w,\n/static/b2153a512c325b5b785fba324dca4bdb/5a190/cd-gen-netpol.png 800w,\n/static/b2153a512c325b5b785fba324dca4bdb/c1b63/cd-gen-netpol.png 1200w,\n/static/b2153a512c325b5b785fba324dca4bdb/29007/cd-gen-netpol.png 1600w,\n/static/b2153a512c325b5b785fba324dca4bdb/9b1e2/cd-gen-netpol.png 1880w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Screen capture below shows pipeline running</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bb61f918f263b8eac9839735446c5c31/129e9/cd-gen-netpols-progress.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVR42pWR626DMAyFo04woFySACEQoKSs28r7v9+pEzaVdtXU/vh0LMuxjx3W9QbaTEh5g0ys5OIavwoz9gv2tEA2A0o9QCiDXGqI2oBX3XUI5X7V5Z0WZfu3oeomNMb6orWwhaRmh3nBOJ+hhxmFOkD3R0wfi6+RqvfqhrrGW5gZLQb7ebMyr1rU7YgoFQiTgsjxTkR77uMgzrw+gul+Jjfnm9WSvMS+KBFnwj8OohS7IH4Ktr3PCsW8xvH0TSsvUHSOity+hclTsPujuuZxJr2r8MfdK7DH379x7NzfHf4/LnNEvtmiVTxjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd-progress\"\n        title=\"\"\n        src=\"/static/bb61f918f263b8eac9839735446c5c31/5a190/cd-gen-netpols-progress.png\"\n        srcset=\"/static/bb61f918f263b8eac9839735446c5c31/772e8/cd-gen-netpols-progress.png 200w,\n/static/bb61f918f263b8eac9839735446c5c31/e17e5/cd-gen-netpols-progress.png 400w,\n/static/bb61f918f263b8eac9839735446c5c31/5a190/cd-gen-netpols-progress.png 800w,\n/static/bb61f918f263b8eac9839735446c5c31/129e9/cd-gen-netpols-progress.png 1161w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Pipeline completed without any failure as shown in screen capture below and you can see this time network policies are generated and applied to cluster.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70901a255ef964958f5dc6656ac76764/914ae/cd-gen-netpol-status.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVR42q2UW3OCMBSEGS/IJUBCIICiUmt1rC/9/39ue07UDp06JNP2Yceg8LnZPSGo9wN0u0Ommi/JsoUxayjdffveR8HmcsJwvP74IS0M4kzTZw0hjbeCyuyhm629yGRjJUhF2eB4vqJueszDFIuV8FKwv77j7fKBbveKqtvBbAaoeoMolZC6Ra4M3ZhitowJnDgV9IcTwY6Q1dqCWLwO4wyq6mjd0bYrpLm2YDdwOGP7cra5PXLIqZRVUhCMHJbGgmOhvFwGpenR9gfryuZIYAaGSW5BBW2b8+Q/8AIyhJscNzwG3qANIiEx9wHyw6xnQN4yZ6jqNZKs9HP4bDjHDhkoqJRlJPxadgHVHWi3/GdgfS9F39rmwf0Xhzm1zEPOWYZRhlkY/w7I+dnTQkBRaDo9hTNLp8PHHGY0WmleWuBU284MWXJUDI/PYsKlF5BfEOyUz/OSMpw605NAC6I1O3uAXMP9CZPPoHOVKHGbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd-status\"\n        title=\"\"\n        src=\"/static/70901a255ef964958f5dc6656ac76764/5a190/cd-gen-netpol-status.png\"\n        srcset=\"/static/70901a255ef964958f5dc6656ac76764/772e8/cd-gen-netpol-status.png 200w,\n/static/70901a255ef964958f5dc6656ac76764/e17e5/cd-gen-netpol-status.png 400w,\n/static/70901a255ef964958f5dc6656ac76764/5a190/cd-gen-netpol-status.png 800w,\n/static/70901a255ef964958f5dc6656ac76764/914ae/cd-gen-netpol-status.png 860w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can also see the artifacts created by the pipeline which include the generated network policies, connectivity diagrams (dot file, png file) as shown in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9eb21157b4cfcada0c64335dfe2dfbae/019a6/cd-artifacts.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVR42p2Ryw6CMBBFq1EjSGsflD5AFBKj//+D12EwhiW4OGlnc3vmVvjcwzUdmnSD8xlFZVBKi1JZXIhTITch8vCEpUBdZz5duMH4lu/Gd7i6BGXjakRoB2iXefDpDkNBlQ78gLIBUnsyrVcjYjeyRaUbMsp0ehxJfXc4Y38sNiOkIQuymwK1TxQeucNTof5iDiSmlUM70vqJ1mw29TbX8+1wGdg9XujHN3coTVxFpefulU08/wIn6tjz726xm7guDD9vWL4PvYXCmwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"artifacts\"\n        title=\"\"\n        src=\"/static/9eb21157b4cfcada0c64335dfe2dfbae/5a190/cd-artifacts.png\"\n        srcset=\"/static/9eb21157b4cfcada0c64335dfe2dfbae/772e8/cd-artifacts.png 200w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/e17e5/cd-artifacts.png 400w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/5a190/cd-artifacts.png 800w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/c1b63/cd-artifacts.png 1200w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/29007/cd-artifacts.png 1600w,\n/static/9eb21157b4cfcada0c64335dfe2dfbae/019a6/cd-artifacts.png 1818w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Here is the new connectivity diagram looks like with network policies in place.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 492px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/343186ffc390c201c3ce9625b861a746/5c6e9/connlist2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBUlEQVR42n2RDW+CQAyG+f+/b8EvUBQBNSYKcuP7nrVW4pZla1Jaen2fXq4BL2tbeDzgdoMkgTSF4xGKAvZ72G79s5Zl/lnLMrheTaPa2YI5cc5gpxMsFrDbGXi9NlfoRuI2lrNEB0Cem0a1v4Bq02Q+jjZVveugaVruVUn12VPWDQ/XMQzv/u8W8K/553cca5JrSHpLCfMPyXd/KhToZYpvGrxM9X1vLjeTOPleap3Lfe+K1/nkh1fP3K9aZSgr0IetKqhrWK3svZbLeREQx1rzxJFnE0EYWk8U2Ttrry5GGcoKBOTkx93vOIG4w8GibNLJgtzlYvF8fueyrB+9qi1LnLK+ALk2G4u1ZTJCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"connlist2\"\n        title=\"\"\n        src=\"/static/343186ffc390c201c3ce9625b861a746/5c6e9/connlist2.png\"\n        srcset=\"/static/343186ffc390c201c3ce9625b861a746/772e8/connlist2.png 200w,\n/static/343186ffc390c201c3ce9625b861a746/e17e5/connlist2.png 400w,\n/static/343186ffc390c201c3ce9625b861a746/5c6e9/connlist2.png 492w\"\n        sizes=\"(max-width: 492px) 100vw, 492px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can see from the above diagram now we only have connections allowed from graphql server pod going into eventscheduler microservice pod and on specific port protocol.</p>\n<p>Lets also now switch to my ACS instance and see what the differences are when we did not have any network policies. From the screen capture below we can see that now ACS is showing that the deployments now have network policies in place</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/300e8c91a8e439e5ad16043a7be2bf6d/08c33/netgraph-with-pols.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBklEQVR42o2Sy27TQBSG/Q5c0hDa4kCI7STESRO6RCAE7wUSTcMewQMgwR51BWLBhgoJIZBAbdyqdto6vt9yT5OfMxNICwvKWL/O0czo83/OGSEviqirKrLXb0AUs5BlBYoiIy/lKSooFAqUS7Qv8/w8CXKJYDdlXLi8hEePGxj0R/BDD6ZjIo5ixHGCQ9NFGIYYDgek4T8l3Ln3AHfvP4RULOPZ8xdgq9fr88PRaER5D+PxGNOTE0wmk3MllKt1VGrrSGVW0Gg+5Zue5yGKIiRJQg5juH6AIPg/EbAGmdxdTGXwpLGJ2XSKo+NjDgVm9AFB3OeXWdkh/YiL5WcUBPMoqGt1VOvrSC9f48ApAS3LRrvd5iWzxeIC6NjwHWcBCf5yL5TUKm5VakhfXcXGZpMDfd9HxzR5yZjNToHkzDN07Lc0BGGEOJkrobb8bpFQKlehrt1GZkVcODQJZhgGBjSYPxwyoO3gUDc48PP2Pr58OsCHj9t4s7UFTdMgFMsVFAmaurKMjUaTDFEPd3ew9+0r9B/f0XUdPuWAXMfkwDQO8Or1S7x99x5t3SK4DYPas9PahdnpQMhJBSj0Fi8tnQ7FPjJg7GnQtRZ8yyKHY94zVlZEUC/w4bkuut34l7ro93vzklezOWRzEj3sNHfIno1Ll1l5LrlikZXLps5FZ6zHTIu9M/oJ5NXDeUKDEcMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"netgraph-withpols\"\n        title=\"\"\n        src=\"/static/300e8c91a8e439e5ad16043a7be2bf6d/5a190/netgraph-with-pols.png\"\n        srcset=\"/static/300e8c91a8e439e5ad16043a7be2bf6d/772e8/netgraph-with-pols.png 200w,\n/static/300e8c91a8e439e5ad16043a7be2bf6d/e17e5/netgraph-with-pols.png 400w,\n/static/300e8c91a8e439e5ad16043a7be2bf6d/5a190/netgraph-with-pols.png 800w,\n/static/300e8c91a8e439e5ad16043a7be2bf6d/c1b63/netgraph-with-pols.png 1200w,\n/static/300e8c91a8e439e5ad16043a7be2bf6d/08c33/netgraph-with-pols.png 1570w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>and the generate network policies now show no policies need to be generated.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 437px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/93899a031c42c18d73e4b013985f8418/5a428/genpol.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 174.00000000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAYAAACU9ioYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEI0lEQVR42uVWS44jRRD1FTgAiD2aA3AJltyD/m0QAiEhxClGYsGS/SAWg4RAaNQ97m73dLvbbbvKn3K7/r+srKqsekRkumyjmdGIUS+QKOnpRaarniMiMyKzd3B4hIMDAvPhocahhhl/cXCI4+MjnJycEB9vuQOPu7mjoyP0yrpFWgFpDRQNkBEnpRkLBZSEqm5QlhJSSuJSQ0rmamOb+aZp0EuKGuN1gVeLHDfLHLdOru2hY2yflKMkg21ZsAi2bRPb2jawt/N5nqNXqxYVoW52XKsGZp48owj4nxmK0LKtms2cMtzSb8rYvboybldVCWNL/WNdV/qD7kVFIjHlwKechHm9ZYZLOWMWlJ9e4HsYje4wm9mY2+S6NUWaxIjCgHJTIMtStC3/gUJEgpYncU8pGjoF2SVsv8TlPMcqqpCX5GEkasSUx0hUGmyHeYkorwxv5lOpyBPyJldYE3sZjQnMPs+RxwFx796JYLkpHvgl0cAvWviy1ewJw34BeMSBbPU7Adlu3pCIMiChSDa48Wpa5ShESaHFcYT+2SmG11e4PO/jvH+Gu9shLs5f4tXgEtdXA1wR91+eEU4haEW7h9dAlQXWApTDMIQoCqRZhqWzgh8EWD2stb12PTjEURwjFwJxkiAjoSRNaRcotBtBwftQCiMYkmBBglma4G54jcHgAtPJPcajW+3d4PICnuvqD9u2xZuebvoha8nDIISqJEbzAF8/fQ57nVGiATvk5LdYxgqiareCHd4uSB7KQsCLcjz76w7Pzp/jz1Efjp9iulgTXKR5YT4E3u0hh5xR/rrZ34a/4o/r33E7sHS5zWl/xpTD10TeJchhNI35xboP8fOPV5hZD7DsKcbjMaIoemseXxPkoubuURRUdlRuhTQhchdp3iAgqft4tJF17ev6J1Eq1WVcG0Gu3/ligfHUIjGy53Ptyd1oRDVc6/D2FyPIKtw4AlMqw8GMthuVXeCucf+QUOlRKJwj3luZyOGFCRbrCLNVgKUbaXsdJHAJjhdjSfCjFCsv0tzUpj+2tcTUzXaCPMlP05i2pYg1lGlbDN3W9HxDTVfp8X4O7aAwggwOe7d+/w4mFS0Jin0PH0mQm4Lv+7TC4vE89H3TTP+bIf+vBUu879NV+3ZjJ9TauUFwHTPkhvfHBsWeLXVU+orCZ7nMMXHCXfvSB7puANw6GsObcLqbQ9cgOnt7o1Dm3VWOXfviVjR2S6xic776dDw6ZPMZLMpWdx1BBxV7Zm4WtQmX2h0/7k9Pcf75Z/uCDX4ZxHgxyfSt4HZVYLAQuk0ldObyDWIymWBGrY0jStPUeKyM8PTLE7z48IOd4PaytLk8MTiSiq9zyqTCXIza7X3HCBoP5z98i/6nT/55BLzXCm8E7e++wumTjx9PcPb9Nzj95CP8DcS4coHMV5Y7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gennetpol\"\n        title=\"\"\n        src=\"/static/93899a031c42c18d73e4b013985f8418/5a428/genpol.png\"\n        srcset=\"/static/93899a031c42c18d73e4b013985f8418/772e8/genpol.png 200w,\n/static/93899a031c42c18d73e4b013985f8418/e17e5/genpol.png 400w,\n/static/93899a031c42c18d73e4b013985f8418/5a428/genpol.png 437w\"\n        sizes=\"(max-width: 437px) 100vw, 437px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this helps</p>\n<p>As always reach out to me if you have any questions about this post or want to learn how Red Hat Advanced Cluster Security for Kubernetes can help you in your organization.</p>\n<p>Thanks,\nRam</p>","id":"a355f0b0-f4b3-54e4-8ef0-81040c1966d1","frontmatter":{"title":"Network policy management with Red Hat Advanced Cluster Security for Kubernetes","date":"January, 2024","tags":["Security","Platform","AWS","Amazon","K8s","Kubernetes","EKS","ZeroTrust"]},"fields":{"slug":"/network-policy-management-with-rhacs/"}}},{"node":{"excerpt":"Overview I wanted to test mounting Amazon Elastic File System as persistent storage for containerized microservices running on kubernetes and realized there are lot of infrastructure pieces that most…","html":"<h2>Overview</h2>\n<p>I wanted to test mounting Amazon Elastic File System as persistent storage for containerized microservices running on kubernetes and realized there are lot of infrastructure pieces that most developers at customers I work with don't really understand. Additionally kubernetes clusters and underlying infrastructure components are usually managed by platform/cloud infra teams and often as a developer you are at the mercy of those teams to enable and support these capabilities at the infra level. Its important for developers to understand also what's required at infra structure layer and that's exactly what this post is intended for. Also I hope this helps developers who are tasked with app modernization and containerization to test these capabilities without much road blocks and helps them have appropriate conversations and tradeoff discussions with platform/cloud teams</p>\n<p>You can find all of the content I'm covering in this post <a href=\"https://github.com/rprakashg/tf_eks_with_efs\">here</a> Github repo. I'm going to use EKS to demonstrate. What I realized as I was going through this journey like a developer would is that end to end information you need to have is scattered in multiple places and can be difficult for an enterprise developer to put all of that into perspective. I also figured I needed to have a repeatable process so I decided to just automate all aspects of infrastructure setup and configurations using Terraform.</p>\n<p>Summarizing below at a high level what you would need setup and configured at the infrastructure layer before you can use EFS as persistent storage in your containerzed applications running on Kubernetes:</p>\n<ul>\n<li>\n<ol>\n<li>Obviously you need a kubernetes cluster to run containerized application (For demonstration I'm using EKS here) and worker nodes in cluster are provisioned in private subnets and spread across multiple availability zones within a region</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>EFS csi driver installed and configured on cluster. Since I'm using EKS here this is accomplished using EKS addons</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>EFS file system provisioned. This <a href=\"https://docs.aws.amazon.com/efs/latest/ug/creating-using-create-fs.html\">doc</a> really gets into details about configuring EFS filesystem. I highly recommend reading it.</li>\n</ol>\n</li>\n</ul>\n<p>Diagram below will help visualize a regional deployment of EFS with EKS cluster.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9c4dcdff932dbb6c050435ff1a16abc/78958/eks_with_efs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADU0lEQVR42oVUW08TQRQ+UHpDKtDSLa29QLulugqoW8yi1lWUiIgaNEOiiTcgK6D1AkEUNWOoFAqCFjQRU0XRpz4YIMZLoukDJOqz8cUfoD+jztlyk0g8ybez852Zb86ZOTNQIdUeqaza0wjMPB7ZIMtyDgJgbcirgJwoilpCiAa27jtcGQgnEuvobw4gqYF0OouQpOZ/gBXAvkxTOaAGwqzs/v2LFQ9qO21dtnUChTw+zutJkq2miFo+zOshCRqETNkEBvTLFHLIAocQCNFlMmC2e9Tv3f2krI79ZrsH2gs9dNKgOijNVlslrYUJBkhnAU1nOJrOWeJYVny4Tq8KYu6MzA4+CAaqx7bX2Ggj56W1HEyAdtv4AUf1w4oGZ2/NBhc96oARMO5MNJukh1safZGgCzkrteYJlOhWCQJUP3ZW7RgraoEIeBwxCLgoOCrGykqlR7ZLpj7wrx8CXwnzbYxWWaRx7qptEDbnD4DXFQGfJWYxAaE6dQ9FcUIV9Mbmg4Ho5/PH6Smvn45682+0F/oH5rx8dL5Nojf4A33d/ryb/VaBfjB7o18ub7s9uOkQ7Swr6h21O0dGjBjlgqCiCrqHvwqhe7Nt36L1ny8O9tdC+Jc1NDxTqhv4eWImcjL+YagpDi1pc+PwFGcY/NH07G7bndTw8dfQ+d1liU2b1EORKR4KOzXMnx27q3nc0XTudL3QFRcMPbNuPhzXw5VUwcHWtlC90rEH6JzbTmdzoSOVJyvdwWNK8349fV9i6U6sEMQwiaDDVcxdSaG44aVceHlqS8Gttx4rm7g+8s7HNT2VOJKozo/MlCKHbdHZF6L92POQPvLGZ+meNqFGpg7xw/LHlZnDseFczG++/sppox8557Wk0UrfFruUuM/ZMsJz/Z9syKHPdmGyxHUm7ivqfW9XoyZkWZAPh/W4qVigmD7+ixOidrFlgzWiomjlFCtg5FjBI49j1aJWyyasX44Q7yAWMStQdS9W9BG7ekS33FNZsthXfWyMOnapz65h5uqpnyxYMHwYsDaxJUA08lnZUDMUIHv7AlckIplxLPqXHoNly1rQ+ltwtYkiaAOEKy9vtYeka04jrG0ZQVxlMaJ/P10YhdEJkFvMLnD2X8/YijmLEf8BvdMpydfXW68AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"eks_with_efs\"\n        title=\"\"\n        src=\"/static/d9c4dcdff932dbb6c050435ff1a16abc/5a190/eks_with_efs.png\"\n        srcset=\"/static/d9c4dcdff932dbb6c050435ff1a16abc/772e8/eks_with_efs.png 200w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/e17e5/eks_with_efs.png 400w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/5a190/eks_with_efs.png 800w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/c1b63/eks_with_efs.png 1200w,\n/static/d9c4dcdff932dbb6c050435ff1a16abc/78958/eks_with_efs.png 1320w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When EFS is provisioned we are creating 3 mount targets one for each AZ and use the private subnets in VPC where worker nodes are running for the elastic network interfaces (eni) that will be provisioned in our VPC. For cost and performance reasons this is recommended. Mount target provides an IP address for an NFSv4 endpoint at which you can mount an Amazon EFS file system. Additionally a security group is created to allow ingress traffic from private subnets where worker nodes in my EKS cluster are running. In addition to mount targets I'm also creating an access point to allow application access. Check out this <a href=\"https://docs.aws.amazon.com/efs/latest/ug/efs-access-points.html\">article</a> on Amazon EFS access points for more details. For more details on how EFS file system is provisioned checkout the <a href=\"https://github.com/rprakashg/tf_eks_with_efs/blob/main/deploy/eks/efs.tf\">efs.tf</a></p>\n<h2>Deploying EKS cluster with EFS csi addon and EFS filesystem</h2>\n<p>We install and configure EKS and the required and infrastructure components by running Terraform scripts. You can find the Terraform scripts <a href=\"https://github.com/rprakashg/tf_eks_with_efs\">here</a> These terraforms scripts are assembled from various examples available in terraform aws github modules.</p>\n<p>Clone this <a href=\"https://github.com/rprakashg/tf_eks_with_efs\">github repo</a> Run command below to install and configure EKS with EFS</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd tf_eks_with_efs/deploy/eks\n\nterraform init\nterraform plan\nterraform apply</code></pre></div>\n<p>When <code class=\"language-text\">terraform apply</code> command successfully completes you should see an output like the one shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ac419cc9b2c38fa485953f44a501f0b/077b7/tf_output.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgUlEQVR42n1QXZOiMBAMSMAQvsQVCOSARYW93fP0AMWytsoH//9v6ovhZe/h9qFrpiczneomwzDger1iHEccDgfs93uN8/mMrutQFAXu97vmfd/DMIz/ghAC8hScpkkfHI9H7Ha7fwSllHg8Hpo/P9VH3+FyvuB2u2G6TDj9Pmmx0/GEoR8wDiPef77jufN5+8Twp8db94amaVBVFeq6RlmWGkmSzIKiFMhfC+RNjqzKsEpXyGvV1wLyVaqZwEu+gWwkkh8JqqaCyASyLIMQAmmaarEoimbBZcVANzYWngUrpLAiC6ZrworpXBW3AjXzTCxUT6jxveW4iBFEAfiSw7EdcObCcz34PEToR7rO/QpRqHbVjLkcnhfAVXuer96DENznoDYF6fYdurbT2bVti49fHyqjWllaI1dWhXhRtmL4/hKMUQ3HXoAtLV1dxTlzwCiDaZggz3Dj9VoHvN3ukCYbrNYlHK8FdRuFLWy+hUFLkIUEsb6AynlmZyC5imJD8BdybsihQPTVIQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"tf_output\"\n        title=\"\"\n        src=\"/static/3ac419cc9b2c38fa485953f44a501f0b/5a190/tf_output.png\"\n        srcset=\"/static/3ac419cc9b2c38fa485953f44a501f0b/772e8/tf_output.png 200w,\n/static/3ac419cc9b2c38fa485953f44a501f0b/e17e5/tf_output.png 400w,\n/static/3ac419cc9b2c38fa485953f44a501f0b/5a190/tf_output.png 800w,\n/static/3ac419cc9b2c38fa485953f44a501f0b/077b7/tf_output.png 1166w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can update the local kubeconfig file by running the command <code class=\"language-text\">aws eks --region us-west-2 update-kubeconfig --name \"admincluster\"</code> If you used a different region and cluster name be sure to use values that matches your environment.</p>\n<p>We can test connecting to the new cluster by running the command <code class=\"language-text\">kubectl get nodes</code></p>\n<h2>Deploy a Sample application to EKS cluster and mount EFS as persistent filesystem storage</h2>\n<p>Now that we have a k8s cluster with EFS all configured using terraform we can deploy a sample application pod and mount the newly created Amazon Elastic FileSystem storage as persistent storage</p>\n<p>Grab the <code class=\"language-text\">efsid</code> output variable value that will be printed after the <code class=\"language-text\">terraform apply</code> is successfully completed and update the <code class=\"language-text\">StorageClass</code> resource defined in <code class=\"language-text\">sc.yaml</code> file under <code class=\"language-text\">deploy/k8s</code> directory and replace the value of 'fileSystemId' parameter as shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 620px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/71caf0691ae21b5cbdf0be062dbc9982/2a195/sc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPElEQVR42n1T227UMBTMZyB1c3F8i2M7iXNPL9tWQFWQQELigb/h04cTbytauuVhdHaTnPGcOePEGofbu1s45yA4hxQSnEsIoWI9QfxTJaRUBP0GyTiOaJoGfR9gjIW1DaZ5hqdnIQRs2xbRdQHrumFZFsz03jmPLMuR58UrJIwx7LBNQOsdps5jCh1C41HXNZTWMFTrJ2j6XxQFkWVnkXAak5UcZv0EOx3Rhglb63DsG4zOoKkUWqNQ5BnSNI14jywSlmUZTxRugO4vyQcJVuRInz/K97Hy/5K8IhRCECEjsiu47TO6YcHUODjF4bUihRpOS1JIxE9Nu8qLd5SeFLISspkgmgVl3aIgC0raGGOkvGRR8cUhjThQk6KJLDvvYxJNJn9soO09/MT08Qfmx19o5xvcDB0e1h5rYzH7Gq7W+G4r/J7oeSX/2vKSUCoynBRo28Kv9/AzZXK5h9AG18GiMyelWnLKZomK1Cn6/sPhcF6hMSaOpPwIe/MN9vorqvkeY+vxuI2onUI96oiC59G7Q5ZGP88rpK3uCqVpUI1HyHaBNRVmp6lyVF6gaiRKXkSSgsLMaEGMlJbFHuYMOfXviIR7WEsaSfoB9uoLDG3aUibrnm5HP2DqOxwHj7uxxdxbLKPD0NUI5GVXV+CqhLICsuaRNFHk4X4a13QruvWEcBmV6toj0B33RtJvQbZQo+XIqPGwj75HJ30d+OQ5tHstGJ1CEcoplxHkFS9Owc7Z/v4p5Gl2GjV/6+EfW3SVbsQfDgYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sc\"\n        title=\"\"\n        src=\"/static/71caf0691ae21b5cbdf0be062dbc9982/2a195/sc.png\"\n        srcset=\"/static/71caf0691ae21b5cbdf0be062dbc9982/772e8/sc.png 200w,\n/static/71caf0691ae21b5cbdf0be062dbc9982/e17e5/sc.png 400w,\n/static/71caf0691ae21b5cbdf0be062dbc9982/2a195/sc.png 620w\"\n        sizes=\"(max-width: 620px) 100vw, 620px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Create the <em><code class=\"language-text\">StorageClass</code></em> resource by running <code class=\"language-text\">kubectl apply -f deploy/k8s/sc.yaml</code> and run <code class=\"language-text\">kubectl get sc</code> to ensure storage class was successfully created. You should see an output like what's shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7b857f9f721a17ae06535d3594020f4/33c15/sc_result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVR42iXNTUvDQACE4Y3ZfJA2bHbNpslG0TYGky09WAo9WCioJ/+HKOhJ9Pe/pvXwwDCHGdH3PeM4Mgyetb9Dt6+k7S/5zTfR4gtZfXBRviPrTyLzQ/CyI3wTyGVE6UqMNhS6wBiDUgrRdR15ntM0Du8H3LUnnnVU7QPt7Z5k3nG13LO6P1IuttOZxe0adKXRRlOogizLEEL8q+uaE2srXFOh7IaZfSK7PJDqAyLZMrfHqZuYZ1K/IntMCOPwPCClJI7jcw6CgD952E5EKST10gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sc_result\"\n        title=\"\"\n        src=\"/static/b7b857f9f721a17ae06535d3594020f4/5a190/sc_result.png\"\n        srcset=\"/static/b7b857f9f721a17ae06535d3594020f4/772e8/sc_result.png 200w,\n/static/b7b857f9f721a17ae06535d3594020f4/e17e5/sc_result.png 400w,\n/static/b7b857f9f721a17ae06535d3594020f4/5a190/sc_result.png 800w,\n/static/b7b857f9f721a17ae06535d3594020f4/c1b63/sc_result.png 1200w,\n/static/b7b857f9f721a17ae06535d3594020f4/33c15/sc_result.png 1463w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Create a <code class=\"language-text\">PersistentVolumeClaim</code> and an application <code class=\"language-text\">Pod</code> that mounts the EFS as persistent storage by running <code class=\"language-text\">kubectl apply -f deploy/k8s/pod.yaml</code> In the sample application I'm using an init container to create a file <code class=\"language-text\">hello.txt</code> in EFS storage that is mounted as persistent storage and in the main container I'm just simply displaying the contents of <code class=\"language-text\">hello.txt</code> file. You can see the full source for pod.yaml <a href=\"https://github.com/rprakashg/tf_eks_with_efs/blob/main/deploy/k8s/pod.yaml\">here</a></p>\n<p>Here is a screen capture below from my environment I was using for this post that demonstrates this</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bb4858fa7264ff74fcd822e974c5d463/f793b/efs-pod.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuElEQVR42h3MSU7DMBhA4d+Jp1hFZLJTCiZSmrKgUhHDVSqBCvc/xiPJ4q2e9Mk0TXRdt9QzDIm6PVBWL+hwoo7v7NoLu+aM2AkxS9XSsUSS4K2nChXWWkIIeO+RcRyJMZLSwMN+oE8ZE44o90w8fNLu30iPH9y1r+gVs09ILpBOcMZtyAoaYxCR5eXMPM/kvACxIdzPSH1D1d+oZu2Hormi+z+K+heVrqibpfxSOOVw3m2Y1noD/wFZ90lmr5gBFwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"efs-pod\"\n        title=\"\"\n        src=\"/static/bb4858fa7264ff74fcd822e974c5d463/5a190/efs-pod.png\"\n        srcset=\"/static/bb4858fa7264ff74fcd822e974c5d463/772e8/efs-pod.png 200w,\n/static/bb4858fa7264ff74fcd822e974c5d463/e17e5/efs-pod.png 400w,\n/static/bb4858fa7264ff74fcd822e974c5d463/5a190/efs-pod.png 800w,\n/static/bb4858fa7264ff74fcd822e974c5d463/c1b63/efs-pod.png 1200w,\n/static/bb4858fa7264ff74fcd822e974c5d463/f793b/efs-pod.png 1404w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>If the pod dies and comes up in another node and since we are using a persistent storage all the data would still be available for the application pod when it comes up on another node or when additional pods are created when a horizontal scale out event occurs.</p>\n<p>Looking at the EFS file system in AWS web console we can see that an additional access point for the application that I just deployed was created.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/35c19e87d829651ab9f24bf7ae0207f4/b8256/efs_aws_console.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42oVSa2+EMAzj///NEzsdcNBX+qR4SUal7cNpSFba4tpxYPIhIMaI1hoOY5FSxn9P7x2HM6i14jxPxXVd+m4KRKgs1vngtSyY5xnEZzlnJX4S3I4NIRBiSsofXBXMpShpPw4Qk8R5OH7s0Bo451H4rmA0NTVWFoJUJ/HZUSDusjdc/b0mHo12xNV6y6NKSJxEMO5Nw1UEX8uqsa116m6sxbYbWOcUQUQ5kSCV+mNw74kivPd/BeWSsV7nR+pe0GrTDyYp+p1G4oV1QXlv2p3GroXXvztkUmQBqjLcC6tLeNqkZPkL8h1N6/ML5vFAF2HuTqPXhJ3e+AZTWSIuSF1NcQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"efs-app-access-point\"\n        title=\"\"\n        src=\"/static/35c19e87d829651ab9f24bf7ae0207f4/5a190/efs_aws_console.png\"\n        srcset=\"/static/35c19e87d829651ab9f24bf7ae0207f4/772e8/efs_aws_console.png 200w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/e17e5/efs_aws_console.png 400w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/5a190/efs_aws_console.png 800w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/c1b63/efs_aws_console.png 1200w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/29007/efs_aws_console.png 1600w,\n/static/35c19e87d829651ab9f24bf7ae0207f4/b8256/efs_aws_console.png 2017w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this helps, as always reach out to me via any of the contact methods listed here if you have questions about this post.</p>\n<p>Thanks,\nRam</p>","id":"f69cbec1-89d8-5e8f-92da-07ef494f1270","frontmatter":{"title":"Using Amazon Elastic File System as persistent storage for Kubernetes workloads","date":"January, 2024","tags":["EFS","Platform","AWS","Amazon","Storage","K8s","Kubernetes","EKS"]},"fields":{"slug":"/efs-with-k8s/"}}},{"node":{"excerpt":"One of the problems I've seen with most customers making a move from monolith to microservices is around deployment. Typically all of the logic of deploying to kubernetes clusters are baked into CICD…","html":"<p>One of the problems I've seen with most customers making a move from monolith to microservices is around deployment. Typically all of the logic of deploying to kubernetes clusters are baked into CICD pipelines for respective microservices. When your number of clusters and microservices grows there are few potential issues that you need to keep in mind.</p>\n<ul>\n<li>\n<p>CICD Pipelines managed by developers will need credentials to authenticate with the clusters and necessary permissions to deploy the workload. You will need to ensure that these credentials are read from a secure key vault when pipeline runs.</p>\n</li>\n<li>\n<p>There are many tools such as kubectl, helm, kustomize, etc. that developers can use to deploy workloads on kubernetes clusters. Developers in your organization will need to learn these tools. Hard to keep track of what tools and the versions are being used</p>\n</li>\n<li>\n<p>Even a small change such as rotating deployment credentials, deploying to a newer cluster can be costly change when you broadly look across entire org since we now have 100s of microservices instead of a few monolithic apps deployed across clusters running in multiple public clouds, on-premises sites and also in the edge.</p>\n</li>\n<li>\n<p>Lastly deploying workloads on kubernetes clusters is something everyone is going to need to do so instead of pushing that concern to individual development teams and their pipelines its a good idea to build a common consistent mechanism that every team leverages. You can implement best practices such as GitOps, etc. here and doesn't require every developer in your organization to be experts and can free them to focus on business logic. Additionally this can provide visibility into what's running where as well as one place to make changes/improvements</p>\n</li>\n</ul>\n<p>If you are a start-up or small development shop the issues I mentioned above are not that hard to manage but at scale when you have lots of development teams deploying 100s of microservices to kubernetes clusters across multiple clouds, on-premsises and even on the edge, this can get pretty messy.</p>\n<p>So in this post I will cover how Red Hat Advanced Cluster Management for kubernetes can help with this. for the purposes of this article I'm using a sample getting started app from quarkus quickstarts and I've provisioned two clusters \"ocpeast\" and \"ocpwest\" from ACM hub cluster in AWS east and west regions to simulate a production environment deployment scenario. We are also going to use GitOps to automate deployments to production clusters ocpeast and ocpwest.</p>\n<p>I've added a very simple github actions pipleline to this quarkus getting started app which does three things</p>\n<ul>\n<li>\n<ol>\n<li>Maven build</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>Build container image and push that image to github's internal container registry</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li>Update kustimization file to inject the new version of image that was built to promote to production clusters in <a href=\"https://github.com/rprakashg-redhat/rhacm-demos/tree/main/applications/getting-started-async\">this</a> repository.</li>\n</ol>\n</li>\n<li>\n<ol start=\"4\">\n<li>Open a Pull Request (Trigger a GitOps deployment process upon merge)</li>\n</ol>\n</li>\n</ul>\n<p>Here is the pipeline code below. You can also find the source <a href=\"https://github.com/rprakashg-redhat/getting-started-async/blob/main/.github/workflows/ci.yaml\">here</a> in this Github repository</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name: ci\non:\n  push:\n    branches:\n    - main\nenv:\n  IMAGE_TAGS: ${{ github.sha }}\n  IMAGE_REGISTRY: ghcr.io/${{ github.repository_owner }}\n  REGISTRY_USER: ${{ github.actor }}\n  REGISTRY_PASSWORD: ${{ github.token }}\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: setup java\n        uses: actions/setup-java@v3\n        with:\n          java-version: '17'\n          distribution: 'temurin'\n          cache: 'maven'\n      - name: build\n        run: ./mvnw clean install\n      - name: upload artifact\n        uses: actions/upload-artifact@v3\n        with:\n          name: quarkus-app\n          path: target/quarkus-app/\n\n  containerize:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: download artifact\n        uses: actions/download-artifact@v3\n        with:\n          name: quarkus-app\n          path: target/quarkus-app/\n      - name: build image\n        uses: redhat-actions/buildah-build@v2\n        with:\n          image: getting-started-async\n          tags: ${{ env.IMAGE_TAGS }}\n          containerfiles: |\n            src/main/docker/Dockerfile.jvm\n      - name: push to registry\n        id: push-to-registry\n        uses: redhat-actions/push-to-registry@v2\n        with:\n          image: getting-started-async\n          tags: ${{ env.IMAGE_TAGS }}\n          registry: ${{ env.IMAGE_REGISTRY }}\n          username: ${{ env.REGISTRY_USER }}\n          password: ${{ env.REGISTRY_PASSWORD }}\n          extra-args: |\n            --disable-content-trust\n    outputs:\n      digest: ${{ steps.push-to-registry.outputs.digest }}\n    needs: build\n\n  update-deployment-manifests:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n      with:\n        repository: rprakashg-redhat/rhacm-demos\n        ref: refs/heads/main\n        token: ${{ secrets.GH_TOKEN }}\n    - name: setup git\n      run: |\n        # Setting up the git config.\n        git config --global user.email \"rgopinat@redhat.com\" # HARD CODING FOR NOW, NEED TO DETERMINE HOW TO RETRIEVE THIS FROM CURRENT USER CONTEXT\n        git config --global user.name ${{ github.actor }}\n    - name: update manifest\n      run: |\n        IMAGE=\\\"${{ env.IMAGE_REGISTRY }}/getting-started-async@${{ needs.containerize.outputs.digest }}\\\"\n        git checkout -b \"${{ github.job }}-${{ github.sha }}\"\n        sed -i \"s#\\(.*value:\\s*\\).*#\\1 ${IMAGE}#\" applications/getting-started-async/overlays/prod/kustomization.yaml\n\n        git add .\n        git commit -m \"updated manifest to point to image tag $IMAGE\"\n        git push origin \"${{ github.job }}-${{ github.sha }}\"\n    needs: containerize\n\n  open-pr:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n    - name: open pr\n      uses: ./.github/actions/open-pr\n      with:\n        repo: rprakashg-redhat/rhacm-demos\n        token: ${{ secrets.GH_TOKEN }}\n        title: \"PR for commit - ${{ github.sha }}\"\n        body: \"PR for commit - ${{ github.sha }} by ${{ github.actor }}\"\n        base: main\n        head: \"update-deployment-manifests-${{ github.sha }}\"\n    - uses: actions/checkout@v3\n    needs: update-deployment-manifests</code></pre></div>\n<p>The CI pipeline above completed successfully on push and you can see the container image is already built and pushed to github container registry as show in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b44db5f9b6e33db495e01190262dbcaf/2ba99/getting-started-container.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVR42o1SCY7CMBDj/y/cm664JKBpc1+TeicpAsoKiUjOKFLGY8dZERF2ux3e3j/ws+6w7jp03S8+v75hrEVd0zTh1bUqpUAbA6kUVw3rDELwcN6iFLpepDIh0oSQJ1R6KSUU99T++4Grehilweks0QuJQXhoRVAyc008ICGkDOMTRpsgdORzwSgEhBiakOrySli3EIibuUkziZyhZGKVGSlTQ6YZiVFYrQ+BBYjmLoR4IyQqEOMIMQwNSmu2NzfGnBHTElVt5h4pFfb7A9vm+3xevOFptDicNQ69wVFY9GzVR2oX8wNuxBGZlT8G1t7QuAhpIpSdYUNGeRJsuRCcj0dsN5umNPGAZSjGo5cOg/YQykFyEDXV2voIqqly3XZr7JiwPpFz7t7yBO0J0mZOkeBTuf69Z6jLWoe+71v9Z7mqyRdUS6+gfpWU0uLLVMI/CucOHNaIJ98AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gettingstartedcontainer\"\n        title=\"\"\n        src=\"/static/b44db5f9b6e33db495e01190262dbcaf/5a190/getting-started-container.png\"\n        srcset=\"/static/b44db5f9b6e33db495e01190262dbcaf/772e8/getting-started-container.png 200w,\n/static/b44db5f9b6e33db495e01190262dbcaf/e17e5/getting-started-container.png 400w,\n/static/b44db5f9b6e33db495e01190262dbcaf/5a190/getting-started-container.png 800w,\n/static/b44db5f9b6e33db495e01190262dbcaf/c1b63/getting-started-container.png 1200w,\n/static/b44db5f9b6e33db495e01190262dbcaf/2ba99/getting-started-container.png 1221w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Additionally you can see that the pipeline created a new branch in the the github repo that contains the deployment artifacts for this getting started app and updated the kustomization file to inject new version of the container that needs to be deployed. Additionally it creates a pull request to merge those changes to main as shown in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b15583c91249a3483aee1f7372d4df63/0931d/prforcommit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB60lEQVR42lVTXY/TMBDs//8JPPDMAz+Ad4ROgECcdDrocT3RHmniNI4T23H8kWTYddOjZ2m0zsSe7M5uNp+2X3Dz6xtEdcKpaVAcS+z3BxSlwOEosPtbEgSeCLtnjjV+H85cKXvM85zhxhEhJmzuTzvcHx+QfIRnMgREwugDXEjoXYRyCSYsr6BznDGRGK95njBPJPj88AhBXyqURaVHgkdtAxoSaf0EOQS0Y4ROywpk3tGeBZZlyYKJ9sGP2EhRolY9qraHuEKjhwxpXI49iY6UzEBCNlKJaYaULZxzVFXMwlz6htW997nMC7msvszTdAZzayaXNRHv3Eh3A1KaXrgsqLVGIyV6bWHsADs4ijZHbSzxhvYDGe+zQEwpR+Y4mXn1cZoow7tqi2NdoRKCOkvlU6dVpyBVu0YJ1Su03RnMa2uyZwOVy4uzZ3Cmm+/FHU5WoWw0jY18hZrQqo4OppdSQ4yw7FuKuYrrxedyyU/NAWV9Qq80VNtlMbbBGpN9ufbvso+Uodbn9/99XZtys/+Bt1/f483nd/jw8yOs9dTdiMbQ6NAoSULdBSjD8xkzHHloyF9PzWQPWThnuL29xb444LH4Q7MoIG2HkQ4NdMmO54sMfnY0Hvw3BG5KDKgqQR+3GOmH4PGJMeEfw5FOQBSI0n0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pr\"\n        title=\"\"\n        src=\"/static/b15583c91249a3483aee1f7372d4df63/5a190/prforcommit.png\"\n        srcset=\"/static/b15583c91249a3483aee1f7372d4df63/772e8/prforcommit.png 200w,\n/static/b15583c91249a3483aee1f7372d4df63/e17e5/prforcommit.png 400w,\n/static/b15583c91249a3483aee1f7372d4df63/5a190/prforcommit.png 800w,\n/static/b15583c91249a3483aee1f7372d4df63/c1b63/prforcommit.png 1200w,\n/static/b15583c91249a3483aee1f7372d4df63/0931d/prforcommit.png 1373w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Screen capture below shows the updates to the kustomization file made by the CI pipeline for getting started app</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/66a04035d7fb37672778d0b08a163acd/5148a/fileschanged.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNUlEQVR42n2RW26DMBBF2f8muoDuox9VK1X9SUkgmAAJEN4GP8G3A00jVWo70tE8bI89197L7g2HOEQcJ7jkOZI0g78/IAiPYEmGfXDEPjrBD2MELMVHwO7eDxnCOEPPBb7Ne3h+xFPwCskl+oFjHCdiBOcc7ajRUD1pJM6dRsENLoNBTpx7vdVybtFLCzj31dCaGUoZGGth5xlSaczkldZbTUpJCBhj6IzDX+ZueEYrCDFimqYNIQS97mduqfG8Xkgsy/Ir7oYXNRaHYkRc9YjKFuzaIe0mZDfW+NRwGntE1guUwv6LN5AWnLSR2qCsB1QVBx8UybCOP0PImSRw2zzrxG75m4X2eXWfom5PEKqjhiWCaAf/+A5W0C8XIVgZIa0ZsoohqSIkV8op3qjZPV7X8jbFJ9EVFmznlinIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fileschanged\"\n        title=\"\"\n        src=\"/static/66a04035d7fb37672778d0b08a163acd/5a190/fileschanged.png\"\n        srcset=\"/static/66a04035d7fb37672778d0b08a163acd/772e8/fileschanged.png 200w,\n/static/66a04035d7fb37672778d0b08a163acd/e17e5/fileschanged.png 400w,\n/static/66a04035d7fb37672778d0b08a163acd/5a190/fileschanged.png 800w,\n/static/66a04035d7fb37672778d0b08a163acd/c1b63/fileschanged.png 1200w,\n/static/66a04035d7fb37672778d0b08a163acd/5148a/fileschanged.png 1228w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now we could have notified the ops to approve the changes or auto approve from pipeline but for the purposes of this article I'm just going to manually approve the changes and delete the branch. Also notice in the pipeline above that I do not have single kubectl command or helm command to deploy the application to cluster also I don't have to be concerned about credentials to connect to cluster etc.</p>\n<p>Steps below are one time tasks that you will need to do on the ACM hub cluster. You can pretty much do this one time for every service and remove all the deployment code you might have written into your CICD pipelines. I think this is huge productivity win for developers IMO.</p>\n<ul>\n<li>Step 1: Define a placement resource in openshift-gitops namespace to discover production clusters to deploy this getting started application. For the purposes of this article I've labelled both \"ocpeast\" and \"ocpwest\" clsuters with environment=production and I'm going to use that when defining the placement resource as shown in yaml snippet below</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: cluster.open-cluster-management.io/v1beta1\nkind: Placement\nmetadata:\n  name: production-clusters-placement\n  namespace: openshift-gitops\nspec:\n  predicates:\n    - requiredClusterSelector:\n        labelSelector:\n          matchExpressions:\n            - key: environment\n              operator: In\n              values:\n                - production</code></pre></div>\n<ul>\n<li>Step 2: Create the placement resource by running the command below</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc apply -f https://raw.githubusercontent.com/rprakashg-redhat/rhacm-demos/main/gitops/config/prod-placement.yaml</code></pre></div>\n<ul>\n<li>Step 3: Define ArgoCD ApplicationSet resource for this getting started app to be created on the ACM hub cluster.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: argoproj.io/v1alpha1\nkind: ApplicationSet\nmetadata:\n  name: \"getting-started-async-app\"\n  namespace: openshift-gitops\nspec:\n  generators:      \n  - clusterDecisionResource:\n      configMapRef: acm-placement\n      labelSelector:\n        matchLabels:\n          cluster.open-cluster-management.io/placement: production-clusters-placement\n      requeueAfterSeconds: 180\n\n  template:\n    metadata:\n      name: 'getting-started-async-app-{{name}}'\n    spec:\n      source:\n        repoURL: \"https://github.com/rprakashg-redhat/rhacm-demos.git\"\n        path: \"applications/getting-started-async/overlays/prod\"\n        targetRevision: \"HEAD\"\n\n      destination:\n        namespace: \"demos\"\n        server:  \"{{server}}\"\n\n      project: default \n\n  syncPolicy:\n    PreserveResourcesOnDeletion: false    \n    applicationsSync: sync</code></pre></div>\n<p>Key thing to understand from the above ApplicationSet resource definition is that we are using cluster decision resource generator which will read the \"production-clusters-placement\" placement resource that we created earlier and attempt to extract list of clusters from the key decisions. ClusterDecisionResource generator will then pass name, server and any other key/value pairs in the duck-type resource status list as parameters into the applicationset template. You can see from the above yaml that we are using name to generate a unique name for app and server as value for destination server.</p>\n<ul>\n<li>Step 4: Lastly we need to create the ArgoCD ApplicationSet resource on the hub cluster. Assuming we are logged in to hub cluster we can run the command below to do just that.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc apply -f https://raw.githubusercontent.com/rprakashg-redhat/rhacm-demos/main/gitops/getting-started-async/prod.yaml</code></pre></div>\n<p>We can log into ArgoCD console on the hub cluster and see that the ApplicationSet was successfully created as shown in the screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/63586c8a76ffc200f645b6fa3c95efac/5b795/argodeployapps.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzUlEQVR42nWSW28SURDH+Q42YvTF+KixTV+qKX0xflxfbdI0WCxt2iDlIpSitAGWhb2wyy73vcH+nF2Jb87JZM6ZmfM//5k5mTcfP/Pq8ITTfJGeavCkaGJ1Or0hI9PGDzesvAA/2KR7b7Nlw/8l8/roEy8F8MvpGbX7BjeVMqV6hetyiVqrgTJS6A66DDSVoTFCNYeYEwPbMbHEjid6qtbOl0nY7b3PcXH5laXTxhz9xNabOGaLpdthMfnFfPKbsVZn1C+hqzW0QTW1Sd7MbqdqG/co/QqZZ2+PeL6fI3+ZJ9rEhNGW9donCCK2McSyEpnOXcaWkfo8P2lBiFS/i5K2o6c7ZPbefSB7kONbMY/ve3jeGte1WSzmrNZrAV/LxS3zhYNpqARhxGzmMp26LFcryfcIw1D8IT1NSn4hYAnDwvUFyXthFAkDnziO06RAmCQymztMpUcJI8/z2STD2cqghG2aK/e62phMMpDswQnnhXOqzQeKP2pciRZu7zAsOwVLQBarGXf1KlflhgyszvfbCs32owTjXcmRMBTA7P6xMDzmrHgjPbBoPim05cu0uip9OY8sl+HYYWBYdJS//gfRxD4O9H9x1ZwIQ4s/bsExYdQwITEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"argoconsole\"\n        title=\"\"\n        src=\"/static/63586c8a76ffc200f645b6fa3c95efac/5a190/argodeployapps.png\"\n        srcset=\"/static/63586c8a76ffc200f645b6fa3c95efac/772e8/argodeployapps.png 200w,\n/static/63586c8a76ffc200f645b6fa3c95efac/e17e5/argodeployapps.png 400w,\n/static/63586c8a76ffc200f645b6fa3c95efac/5a190/argodeployapps.png 800w,\n/static/63586c8a76ffc200f645b6fa3c95efac/c1b63/argodeployapps.png 1200w,\n/static/63586c8a76ffc200f645b6fa3c95efac/5b795/argodeployapps.png 1455w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can perform a sync for each application to ensure all the application resources are successfully synchronized with target clusters. Clicking on each application tile in ArgoCD console we can visualize all the resources and their status as shown in screen captures below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/084b4a3838e3b8eb27c35e576332e3d6/284c0/gettingstartedapp-east-argoapp-details.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABO0lEQVR42oWPzUvDQBDFcxYvikKLB6HiwS+woF4sKB7733rx5MEeRBFFwVJsk02/stsku5u2aZsWsXlOtsWDBx147Mws85s3VvGqjL3LMq5v71CzGV5rdVQbDDWnife6g6rtGnE/RBZpmuKvsLZPLpA7LqHy9IJkOkZXhlBxjMlshlGSwNMKQRRhkkwx/wdmgJsHZ9jYP8X98xs+v+YQoUY3WIjLiOoIHV+hvZRQfdKA/hbvb1kr+QJWtwq4qTxC6BjMC8CEhEuyvRAOyeUSTV/CI3izJ9HqkWs9NAuZCGlmIYdmrbXdI6zvHBLwgc6LTZMR4KPF0QmUgWQAoSL4emDyFkGGozFUfwiX6gY5t+ki5mtY+eI5csWScchp6w+wLcCX52euhdKIBiNzfubSuOXkiuA25XXq2ULiG/svpIyX4qEWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"argoapptile\"\n        title=\"\"\n        src=\"/static/084b4a3838e3b8eb27c35e576332e3d6/5a190/gettingstartedapp-east-argoapp-details.png\"\n        srcset=\"/static/084b4a3838e3b8eb27c35e576332e3d6/772e8/gettingstartedapp-east-argoapp-details.png 200w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/e17e5/gettingstartedapp-east-argoapp-details.png 400w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/5a190/gettingstartedapp-east-argoapp-details.png 800w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/c1b63/gettingstartedapp-east-argoapp-details.png 1200w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/29007/gettingstartedapp-east-argoapp-details.png 1600w,\n/static/084b4a3838e3b8eb27c35e576332e3d6/284c0/gettingstartedapp-east-argoapp-details.png 2079w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3caf4fa02e2539fee9970d541b62c253/a6d66/gettingstartedapp-west-argoapp-details.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVR42nWPu0/DMBDGszEgwUBhKBNUDCBR8VCRQIDE/8rWhYV2KgipKwsU9ZE4bV5NHCd1+kK0VfJxsYQEA5bOn+27+/k7rVS5RfH0BvcPj+iwPl4/2njvMbTZAK0uw5tu4EM3YXk+8pXh/5WmKbS9izvslK9Qf2liufqCzQPwkcR4Nsd0/gk7EvBCgWQ8wWKxREbEjLb0J9JM3VUQVCscVbBxcILacxOLVQpfjODyERweww0lwaQ6W0GMgR8pdcI8T3WkNv8dMbT14j7WtnZRrTUQyBl0JwAbCvSp2fBC6G4IRmpRsR9JpVYQIZITmiSB6QuYVGNSDSPVCodn2Cwdo1pvwJdTGC6HScCWaZOTiCCJcuZFEXgslTPmccTJmKBj9XGHPugJCYMca8Xza2yXLwn49AfYtX01Qu4mf3NEDEGA/J5D8pxyNQxh0FuXenpeiG/A96LS1x3/eAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"argoapptile\"\n        title=\"\"\n        src=\"/static/3caf4fa02e2539fee9970d541b62c253/5a190/gettingstartedapp-west-argoapp-details.png\"\n        srcset=\"/static/3caf4fa02e2539fee9970d541b62c253/772e8/gettingstartedapp-west-argoapp-details.png 200w,\n/static/3caf4fa02e2539fee9970d541b62c253/e17e5/gettingstartedapp-west-argoapp-details.png 400w,\n/static/3caf4fa02e2539fee9970d541b62c253/5a190/gettingstartedapp-west-argoapp-details.png 800w,\n/static/3caf4fa02e2539fee9970d541b62c253/c1b63/gettingstartedapp-west-argoapp-details.png 1200w,\n/static/3caf4fa02e2539fee9970d541b62c253/29007/gettingstartedapp-west-argoapp-details.png 1600w,\n/static/3caf4fa02e2539fee9970d541b62c253/a6d66/gettingstartedapp-west-argoapp-details.png 2070w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can also look at the getting started application details in ACM hub cluster console and see an overview of the application as well as visualize the topology as shown in the screen captures below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/120346a8e7651e758123cf71d603dfe3/561da/gettingstartedapp-overview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACaElEQVR42qWS22oTURiF5wkUizFNajKTTDLtJFWr4Amxmp5sDS1FBUEFH8Gn0fbKG6+0TXJV8ULBxxAUG6NGzaSmzmTOh+Xee0yYtCQKbvhm7w17Fmv9/8/J00XI8ROYKxQwO1dCYjwOnk9DkvJIxI8jNnaUcASxYxHGhsOJYh68KCGZEpAi8EIW6YwIgech3HiE7MOnyNx7jOyDTWTub5B9g+xP2Dm8bw7AFU+dhVw4g2xOhpgvEGRIU9NI8yKeVXfw3Qc+qS7qHYfgMpq6j7YDKDbwwxqEoz/PnLsQigg58Jk8EZ9C8qSAaq2Gn60mPr5/h+bnOtsbux/wtbHL7krrG9gKfPphcOXVdayt38byzVUsLZcZ9HyttIDXb95CJ05+aV1oBMuy4TguLNuB7diwbTvUi8CtlNdw685dzC+uYPb6AhFaRGl+CZcuX8XOy1foGAET3N/voNulohYMw4Bpmgxd1wfgcpIMuXgaGXESKVI3GlvISojFJ/D8xRZzoCgKe8zcBEEEH74/CGnKDM5fvIL8ZJGJ0vrlpALGJ3hsV6pMhDqjj7Uuja6F6AY6ehg5ujgqQDtLxXrQezyZxtZ2hT1SVQ2O65OIBnPqui584tD1gsOCNB7lkGAi3XfYUvaYoKaT+pkWcztscVGhUYIsuunAtBxYpBm0ORQzcqbOhwtGImuaynaLddZgNex1lda3d6ZjNMJhCpVqDZ7nod74Av3PqNDujlojHfYiq2rokM7fQcGD93+qYbu91x/iUQ35q8NeDamQ55FRIfH/K3K/KaYL1w/I6ATQbR9dyye7B81wWI2j/Ab/VcZ7ZucwPwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"appoverview\"\n        title=\"\"\n        src=\"/static/120346a8e7651e758123cf71d603dfe3/5a190/gettingstartedapp-overview.png\"\n        srcset=\"/static/120346a8e7651e758123cf71d603dfe3/772e8/gettingstartedapp-overview.png 200w,\n/static/120346a8e7651e758123cf71d603dfe3/e17e5/gettingstartedapp-overview.png 400w,\n/static/120346a8e7651e758123cf71d603dfe3/5a190/gettingstartedapp-overview.png 800w,\n/static/120346a8e7651e758123cf71d603dfe3/561da/gettingstartedapp-overview.png 969w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ead18fd7073e6b40fa414e1368d0227/1790f/gettingstartedapp-topology.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQElEQVR42qWT306DMBTG+5xebPHGGzPfxCvNYuJ8GK/n5iM4yp8WKKVQIJvb+GxrHJszIUPIL+d8Df162h7I1f0rxtN3jB/nGD3MXbyeLhw2P2ZkuHl6w93LErfPC0xmS0xsPlu4MQuJ4xS6btDoAlpJ1KXCdrPG9nONIQ9ZeR4YY/BDDsYTJEkMzrmJKVrz7ttz2hP2J5qILHOJanbY7NqT1dqzyf2QKIrQNA1qXaIylGWH1roXqYT5ttMkCAIURQEpJfI8vwiRpYjiwJh2cwmlvqvGCqXURQgp4DOKTGaHMWNIBxm6XeXSGUqVO/0Pw8JUJRx+RBGbzkhFMtzQVsNTBpYwd4bcRBp5UGZ88Ja/L0HCCz9gW+/PM/xtaivpwwtX7lKsR+Eq9H1UVeXET+9Zs8ysKoTohYae+auSg/4CYtzNY0ilgygAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"apptopology\"\n        title=\"\"\n        src=\"/static/4ead18fd7073e6b40fa414e1368d0227/5a190/gettingstartedapp-topology.png\"\n        srcset=\"/static/4ead18fd7073e6b40fa414e1368d0227/772e8/gettingstartedapp-topology.png 200w,\n/static/4ead18fd7073e6b40fa414e1368d0227/e17e5/gettingstartedapp-topology.png 400w,\n/static/4ead18fd7073e6b40fa414e1368d0227/5a190/gettingstartedapp-topology.png 800w,\n/static/4ead18fd7073e6b40fa414e1368d0227/1790f/gettingstartedapp-topology.png 1189w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Lastly we can verify the the getting started application is successfully deployed to both \"ocpeast\" and \"ocpwest\" clusters by accessing the exposed routes from a browser as shown below</p>\n<p>Screen capture below shows instance running on the \"ocpwest\" cluster\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bbfea47252aeacdfe781e8bea90f01c5/fe9f1/gettingstartedapp-west.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAfElEQVR42q2Naw7DMAiDc/8zZn2s3dJWVRcgHeOXR6JqJxiShcVnILzVoB8Dy4m07ti2A8O4IPYP9Pflp9vwdCXEi3Vj8vnaWPWxm5sPzAxmwlmKHxWYd/FZzhmqCiJCqazmnO/+mDwv7tUMUqTx13FgniaEnKktmcN/1BdjSeW8r5IXyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gettingstartedwest\"\n        title=\"\"\n        src=\"/static/bbfea47252aeacdfe781e8bea90f01c5/5a190/gettingstartedapp-west.png\"\n        srcset=\"/static/bbfea47252aeacdfe781e8bea90f01c5/772e8/gettingstartedapp-west.png 200w,\n/static/bbfea47252aeacdfe781e8bea90f01c5/e17e5/gettingstartedapp-west.png 400w,\n/static/bbfea47252aeacdfe781e8bea90f01c5/5a190/gettingstartedapp-west.png 800w,\n/static/bbfea47252aeacdfe781e8bea90f01c5/fe9f1/gettingstartedapp-west.png 883w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>and the instance of the getting started app running on east cluster\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/48c562ede008c3e9d1581dd6534c3d15/6bff2/gettingstartedapp-east.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgElEQVR42pWOwRLCIAxE+f9/tLWlU61UHEoZCFjWBA9eejEzb/ZNctgoIkLOGdu2w6xPGGPRDzPGafmh7xiYbvym7KbZ4KpvzS+dxvJ4YbUeyjkHIcaIxLxTai4lUkYkmZrvVJD4ntnLcbBHlFJgreWHHEIIUN57CHI4m1rrX/sPZ6vnlROzaI4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gettingstartedeast\"\n        title=\"\"\n        src=\"/static/48c562ede008c3e9d1581dd6534c3d15/5a190/gettingstartedapp-east.png\"\n        srcset=\"/static/48c562ede008c3e9d1581dd6534c3d15/772e8/gettingstartedapp-east.png 200w,\n/static/48c562ede008c3e9d1581dd6534c3d15/e17e5/gettingstartedapp-east.png 400w,\n/static/48c562ede008c3e9d1581dd6534c3d15/5a190/gettingstartedapp-east.png 800w,\n/static/48c562ede008c3e9d1581dd6534c3d15/6bff2/gettingstartedapp-east.png 957w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hope this was helpful. As always please reach out to me if you have questions about this post or want to learn more about managing application deployments to clusters using Red Hat Advanced Cluster Management for Kubernetes and GitOps</p>\n<p>Thanks,\nRam</p>","id":"5126c64b-6fa7-51a0-a20c-0406442fa26d","frontmatter":{"title":"Multi cluster deployments with GitOps and Red Hat Advanced Cluster Management for Kubernetes","date":"December, 2023","tags":["OpenShift","Platform","Kubernetes"]},"fields":{"slug":"/multicluster-deployment-with-gitops-and-acm/"}}},{"node":{"excerpt":"We see most customers deploying kubernetes clusters in multiple on-premises sites, multiple clouds and even on the edge with that comes a set of challenges such as Deploy common configurations across…","html":"<p>We see most customers deploying kubernetes clusters in multiple on-premises sites, multiple clouds and even on the edge with that comes a set of challenges such as</p>\n<ul>\n<li>Deploy common configurations across all the clusters</li>\n<li>Easily identify and fix configuration drifts across all clusters</li>\n</ul>\n<p>In this post I will cover how you can implement a solution using Red Hat Advanced Cluster Management for Kubernetes, ArgoCD, GitOps and Kustomize to deploy common configurations as policies to Kubernetes clusters running workloads. Source files referenced in this blog post can be found <a href=\"https://github.com/rprakashg-redhat/rhacm-demos/tree/main/governance\">here</a></p>\n<p>The governance feature in Red Hat Advanced Cluster Management for Kubernetes allows you to define/externalize common configurations as policies and provides a framework to propagate and enforce those policies to clusters and visualize the results from a single pane of glass view. If you are new to Red Hat Advanced Cluster management for Kubernetes I recommend checking <a href=\"https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.9/html/governance/governance#governance-architecture\">this</a> documentation to get familiar specifically with the governance feature also to clarify further by common configurations I'm referring to internal standards that must be met for software engineering, resiliency, security, and regulatory compliance for workloads hosted on-premises, multi-cloud, and edge.</p>\n<p>In addition to the tools mentioned earlier we are also going to leverage a Kustomize plugin called PolicyGenerator. For more info on the plugin head over to <a href=\"https://github.com/open-cluster-management-io/policy-generator-plugin\">this</a> github repository. This plugin allows us to dynamically generate policy resources based on a manifest file.</p>\n<p>For the purposes of this article I have provisioned two clusters in AWS. You can see this in the screen shot of clusters section of advanced cluster management for kubernetes (ACM) hub cluster</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cd7ce44aa59f4ea35031a218e5a2f29b/0f246/clusters.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACWUlEQVR42o1TTW8SURSdbZtYLW1BLEiF8iFFLFYTY/2MC2PipgtjdGPaGON/cCOLarUUbNwY49aNoP4lNlLCMMPHMDMMM8Px3cdHYYDEl5y8N3PfO++ee+4Trvh8uJlKYdXnx1oggBWPF3NnXJhbOMW8AxSfP7uExRUvh4thweVh6wsQgqEwCGvBCAL+i9jeeYOn6T/YefsDz9M/sfs+j5f7eTYXsLtf4Os99u/VQQGvP/3G3odfHC/SeTx7l4eQSG7hUiiG9Ugcy+5V5I6/oG12Ideb+N/R7cNmEB49foLtOw9w9/5DJDe38PXbdxgsqqottHUNmqb2Zvatqhos04RljaNtdKBoBodw6/Y9JJLXEIsn4fb6kc0dw7ZttFqt3u3dLgcNualBN8yx/6NxmoV4YpNJjiIUvoxzLjcyR59hGAZKpdJw42DU6jLLUkWn05kpX7iausEJqYaLSx5GmOOBk3J54mBFakKsKTAti6mw+vKtsYsZ4XUE12OIRDfgWvbiMNMjnJZFpSrhb+kEoihClCTUmgrPeIyQpFKG4eh4hpqmOZxkzrckmP2sbEc5hoTUf6OEh5ksDyiKMlF4TVeh6zonnGYMN4XITgnPDwnpILk9Cq3NsmMzHXTGCHSRg9CDo2zPZVmWJ+RU63XobYMfntrgkxkyQtY2VKdisTg0ZlAuUayi3lBYltbstnESjkp29mG52kCpUkNDafEak3H0AGhNbjsIN8ZcJtnOITVE/iTptZAKm9XMGsHQZULvpXhw8DHDbyuzxibSwUb+9BSJ1VDnDT1L8j/s2PXiGtWGxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"clusters\"\n        title=\"\"\n        src=\"/static/cd7ce44aa59f4ea35031a218e5a2f29b/5a190/clusters.png\"\n        srcset=\"/static/cd7ce44aa59f4ea35031a218e5a2f29b/772e8/clusters.png 200w,\n/static/cd7ce44aa59f4ea35031a218e5a2f29b/e17e5/clusters.png 400w,\n/static/cd7ce44aa59f4ea35031a218e5a2f29b/5a190/clusters.png 800w,\n/static/cd7ce44aa59f4ea35031a218e5a2f29b/0f246/clusters.png 1118w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>First cluster is the management cluster cluster running Red Hat Advanced Cluster Management for Kubernetes. Second cluster \"ocp-dev\" is provisioned in AWS east region and is meant to be used for running workloads.</p>\n<p>For demonstration purposes we are going to use a gatekeeper policy to deny container latest tag in DaemonSet, Deployment as well as StatefulSet and two RHACM policies, one to install and configure Red Hat supported version of Gatekeeper and the other to install and configure Crunchy Postgresql database. All the policies are grouped into policysets namely acm-policyset and gatekeeper-policyset to better organize the policies. Since in this demo we only have 3 policies we didn't really need to use policysets but in real world you might have lots of policies and hopefully this helps as a reference,</p>\n<p>Lets examine the Policy Generator manifests for both ACM and gatekeeper policysets. Screen capture below shows the manifest file for ACM policies used in this demo</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf6642a84a7326fb9315a8b3c18abdd9/4e6ec/policygeneratormanifest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAADZklEQVR42nVUy47jRBTNJzCoO93pdOdVfttx4tixHduxEyfpV6QWIJBYgUYjMQIk1iyQWs1bgsUsZsEXsEEasWaHxH8dTlUnMEHD4uraZdepc+85txpZlmM6TaBphgpdN6EJHfE0RhJPkSQJxkGgvjmOB8t2YTNM02Z2YBgW110I7hkMNDSSZIa6Xqsf+n3BRZ15AM0guONz3YRnaLANHb5jI/AceLYFMRjw3wF6vR7BBLrdLjqdDhpBEGK12iCOU4xGY0wmEUzDRJ+M3GiO0B8i8j04pgHR76HX7XBzR22+uLg4yApQlhvHCambZOPAslyeLCA0DU5UIogyHjTB2PNgagPFZM/mTdFI0wxhGKn6ZR9kyJId28Zyc4PLzRXKZIo4DDGNQkTMBg9rn58rZucy755lkGGMLCv+AXtsroBjWViwt5erGuUswbLIUMxSHh7C1HW0uVnGOeOM0ZKgkuFoFChR1utLbMhmPA6VOC4bX222WF9tcb1eY1tXWM1zxXCTzfDqm3u8+uFb/PrVl/j9uwf89vU9Pry+QiMKU2y3d6iqFZnOEQRTWseCa5koLu+Q37yPasWy8xlS2ihi2UUU4ftPn+OnLz7HwyfP8PDsKX787Dm2ZSlVjlCWFYZDf2cbTZUsGWb1NebX72HJCoo0YQ8jxVATA7x1fIwnzSbePjlhPuF7E6dn7UdRZAghjW0qY+8By/UtVmxFkcYKSAVBLfawy3716UEVVF1mudbwPJ/sRkqM/bQoQIpSLDeoru5QlAtOTYzJDlCq/Lr3DmwjJ0OWuQfbA3q0TSw9OitR5zly9m7i+4jGY9hkeMQym6enLPMMzVYLRyxdKt54HeiAIcesWN2iXK4xp6oFrSP7KOd7SJO/Qzu9y1jnGbaLCh9sOL4c1zcDCk2VnM6XKKlwXRaoaZm6yOnHHKOhh49vb/DHi5/x1y8v8efLF7h/+hGs/wMUBBySYU4rScssqkrZpiqkgAkBh3hydIwxWzBnb2fBBMcsW05PYz9y/wV0ZQ+zCmmxwGwa7iJCwTH0XZeXRBetdpt9bOG0dfY441IUecfJO+2ApZAi6TCGU9guXWDqcHiFOboMAUsTvCgExaF4u2/SNkrlkpaQtpFAEngPLmjePpnrzIa6Zf61hmQi3x/z4e3zNzRiLPvZWeW/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"acm-policies\"\n        title=\"\"\n        src=\"/static/bf6642a84a7326fb9315a8b3c18abdd9/5a190/policygeneratormanifest.png\"\n        srcset=\"/static/bf6642a84a7326fb9315a8b3c18abdd9/772e8/policygeneratormanifest.png 200w,\n/static/bf6642a84a7326fb9315a8b3c18abdd9/e17e5/policygeneratormanifest.png 400w,\n/static/bf6642a84a7326fb9315a8b3c18abdd9/5a190/policygeneratormanifest.png 800w,\n/static/bf6642a84a7326fb9315a8b3c18abdd9/4e6ec/policygeneratormanifest.png 827w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can see the section for default settings for all policies included in the set as well as two policies for installing gatekeeper and postgresql operator.</p>\n<p>Screen capture below shows the manifest file for gatekeeper policies used in this demo</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eb97a7fc3ce8404ef6fc66aa8a89b447/f73a1/gatekeepermanifest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGUlEQVR42nVUTWsTURSdf9AurNrYJpnvz0wmk5nMZzLpZJK0pYiUtrgSRdwI4kLwYyEKXYiKbtzoQly5cS+I4N6Vf+l477OWCnZxuMObx3nn3HPfk9I0R56XMAwLmmZA102oqoY4jpGlCZI0RTxKYNuO2ON6PbiuJ2BZDno9X/xz3R5M04YUBCHquoHn+VAUjcgMyLICVdOgu32YhgnP0GAL6PAdS1RFUdDtdmmv/E+VmHk2a8BK+/0BwjASJ8qKCmtYYhj0EfkeHCLpdtrotP9gc3PzvxAKmYztsGS2wZZVVcUgq5GNZ2Q/QRQEpMyAqetQSR2TdjsdgQ7XbkesSby5KEoi0E+hkDpD1zCeNtje3kU9zpElIySjGCPqrWdbaBPJJlncoNomuy1W3SHLvh+gqrbgONxkWyhlhQYpKcoKi6bBVpGiKjJM8hTD4RCObePTowf48eYlvhw/x9fjZ/j++gXuXz+CxARlORbBcC8Hg0iEwgqLrSXqnatYzhfYqSvMSGmZpXCJ8O7RAZ7fuY2HN2/g3uEBnty6gf1ZDYl7Np1uIUn49FjEz4Fwr7LpAsXuISb1UhBFpI4tO5aF1bU1rBBWBS5i5cIaLq6vQzJNB0U+FqScMgfDfTRJYTppMNnZF+rLLCGyiA6NBGGbEpWphxzG2XCoh0PM5ztYLneRZSVZjmHQIQbNYTGdY77YxpR6mFMo3L8oOiE8SblzBrwmhWSzaRbgcPimMDgUoZCUj5fXMK3nwnIYhohPCC+3WgIbGxu4QuBvrqdzqOmGsMqEChFaNHOjiEYlLVCRuiIaYtgPxDzy2KSDPuo8g++5CH2f9iToUVjS39n7q+5UId2MnEKpFnuopxXNYoH5pMSYSOLBAEeLBt/evsKvjx/w8/07fH76GHMaK+ks0b+WdSRsudnFpCyQ00PBKOixyEjtJUo07PWw38ywV03ELeK1cwl1InT8CF4QIaAHYeDYBEt8B44Jm3os091eb62jdaUFRe7C1NTzCVVVgUzfJs2pa+pw6bXRVVkkq9C4qESg0x6D7jxDU2Sx9hsG3/Pz1AXwsgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gatekeeper-policies\"\n        title=\"\"\n        src=\"/static/eb97a7fc3ce8404ef6fc66aa8a89b447/5a190/gatekeepermanifest.png\"\n        srcset=\"/static/eb97a7fc3ce8404ef6fc66aa8a89b447/772e8/gatekeepermanifest.png 200w,\n/static/eb97a7fc3ce8404ef6fc66aa8a89b447/e17e5/gatekeepermanifest.png 400w,\n/static/eb97a7fc3ce8404ef6fc66aa8a89b447/5a190/gatekeepermanifest.png 800w,\n/static/eb97a7fc3ce8404ef6fc66aa8a89b447/f73a1/gatekeepermanifest.png 822w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>In the Kustomization file we are going to reference both manifest files under generators section as shown below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 659px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/669e78b4b747c3216072eefa34823ac7/6db71/kustomization.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABOUlEQVR42mWRSXKDMBBFuQiDQAIEkpgn23EWDkk5C+f+p/lpdRzHVVm8apWqefrdBOMwIc9LSJn/oXJkqcSyLNjWBfM8QWsNmSkUhUZZavqm4N6iKB94T3C7feF0OiMlgVIF8yNWqKoKtu3R0qPGOpJWaLsOXd/DNQ3dWfTDgOFOXdcIjscXrOvGdi/NMsk1jhPESQJdN1jHEaPVGI1GTwy1RqPp8SylvhhxFCEiwjBEcL1+Yt8/SHrANM3MsqycUAjBtTMGztSwuoQrFUwhYXIJrSQLQy+7S4N9f6eolkf1KX8RIqW0KZSboPoTZLsh1S1EaZkkN2idw3mb8XpY0DeOEpJwnlcWZLTwZxIaN4pCROEdOvvR/Bp4HYTv8QhfKSknvFzeYIxjyfOfThLBDf8JH2e/s2e88BsX2c24gsz+cwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kustomization\"\n        title=\"\"\n        src=\"/static/669e78b4b747c3216072eefa34823ac7/6db71/kustomization.png\"\n        srcset=\"/static/669e78b4b747c3216072eefa34823ac7/772e8/kustomization.png 200w,\n/static/669e78b4b747c3216072eefa34823ac7/e17e5/kustomization.png 400w,\n/static/669e78b4b747c3216072eefa34823ac7/6db71/kustomization.png 659w\"\n        sizes=\"(max-width: 659px) 100vw, 659px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next thing we need to do is to use the Application life cycle management feature of Red Hat Advanced Cluster Management for Kubernetes to run kustomize and dynamically generate policy resources and deploy them to hub cluster. We are using ArgoCD and GitOps so when changes are made in git repo ACM can automatically sync those changes to hub cluster. Once the policy resources are created in hub cluster, ACM will propagate them to target cluster based on the placement rule.</p>\n<p>In the ArgoCD application resource shown in screen capture below you can see that under source I'm referencing the github repo as well as path where policy manifests are defined and the target revision to use. I'm also specifying under destination namespace where I want the policy resources to be created.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 711px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e8186e7629f8af56580f0e2f4a6ac8cb/a8e5b/argoapp.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuklEQVR42n1SW27bMBD0PWo9+SYlmqIkW7Kb1m6bBEl8/+tMl0QgtEbRj8GuIHJ2doa7GEdM0wytLZTSGVobSKEwzzPGGCGlglQGxrp8ThsLS32Cc912L2F3PC54f78jxgl13aJt+ScYuq5DH0/wYUSkPvoeoXPwzoILQYMkDdCoqgplWWbsrO3w/PyK2+0nTeuRvlMVQuYDIpwx0LDJKRjBYCUDb2oU+wJFUWC/329kG2EiO51WHA4DQogIw5jXbuoaKiwww4LeavRaIlgF1jT48klUVeXfhN4HrOsZjIk/1uV5/YaUtIq8HZ/g+4DBSCjOIFkLyel/XaEoHwhTKNfrD1LkwLkkX3QG54KGkKfKQfUTTr2BJ4VWCjjJqdJg2qB8JBzjgre3Oy6X75T2Au8HQoSiNKXg4IY8nb/hGA44Dx5r6DB7CsYoDE5jICuiM2SFzhaRh31WeL3esn9V1WSljHEIWo9pIlx/wfoxq0srt2TFo3ebwvSmLpenTNZ1PldFby49G06X67qBHFYIP6Ggfk/J/otoI0xhJMKPjzteXl5xPn+FMY4CabOHOUnqawqqonT/R5YIfwPhjiZm5QCtAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"argoapp\"\n        title=\"\"\n        src=\"/static/e8186e7629f8af56580f0e2f4a6ac8cb/a8e5b/argoapp.png\"\n        srcset=\"/static/e8186e7629f8af56580f0e2f4a6ac8cb/772e8/argoapp.png 200w,\n/static/e8186e7629f8af56580f0e2f4a6ac8cb/e17e5/argoapp.png 400w,\n/static/e8186e7629f8af56580f0e2f4a6ac8cb/a8e5b/argoapp.png 711w\"\n        sizes=\"(max-width: 711px) 100vw, 711px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Before we can create this ArgoCD application we need to perform couple of tasks.</p>\n<ul>\n<li>Step 1: Since we are using a policy generator Kustomize plugin we need to ensure that the plugin is installed on openshift gitops container that runs kustomize. Run the command below to ensure policy generator plugin is installed</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc -n openshift-gitops patch argocd openshift-gitops --type merge --patch \"$(curl https://raw.githubusercontent.com/rprakashg-redhat/rhacm-demos/main/governance/deploy/argocd-patch.yaml)\"</code></pre></div>\n<ul>\n<li>Step 2: We need to grant the OpenShift Gitops permission to create policy resources in \"policies\" namespace on the RHACM hub cluster. We can achieve this by creating a ClusterRole and ClusterRoleBinding to assign required permissions to service account used by OpenShift GitOps. Run command below to do just that</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc apply -f https://raw.githubusercontent.com/rprakashg-redhat/rhacm-demos/main/governance/deploy/cluster-role.yaml</code></pre></div>\n<p>At this point we are ready to create the ArgoCD application on the hub cluster. Assuming you are logged into hub cluster run the command below</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc apply -f https://raw.githubusercontent.com/rprakashg-redhat/rhacm-demos/main/governance/deploy/app.yaml</code></pre></div>\n<p>Screen capture of the ArgoCD console below shows that ArgoCD app was successfully created and synced.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 794px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ac279fc2dfc87c81bf95c6b08a57706e/7de01/argoconsole.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADM0lEQVR42nWUy08TURjFJ4iPJYY3lKJEHoXyLlAKpFAwGh/EJejSsBHdKLAQ/xlXxsS4wsSIwWhIfERN3AItmra0M22Hdt5T2h6/e4EKQSY9uXeaO78533fPHaFpZApObwCtI9dQ1TmMEkcb5hafoZDPI5mSkaexUADod6qOXsKd6dvwTN2Eb3oWjQPjKKlv5UB22dksTrsKhX1UTEpiZW0dH7/+xLtPXyCUN3ejwuXh7up7xyDUteD+k6d8cTyRQjyZgkhOd1UN6SPaVVSohoHtSAyr69+w/v0XPnz+AaGm3YPL5KxrchpXfFc5cG5hGSYBw0kZ6YzCH9YNE4ZpHZNuWLDtbNExMy24/DfgJGB1lw9lbR4IteTw8TIM5lDRYWX3YNBDumVDN20+Gla2KHavEfhQQlfgFpqGAnD0jaGh34+zDS7MzC8gpZjYDMexFZGwFU2QJAR3Etik+42weEybJL6OJFS6vbjo8qKiw4vanlECtnNgRNGwHRWxI6YQjiUQlfZHSc4grZnUU6OoRFrDn3gKQXqxUNbWD0dPHyo7vajpHsE5ZwdmHixgQ0kjFA5D1w2otAmynIau6cj+Z+ezezmEJZmA5JD1rsU3yt3VEvDCJTcHBjUFEVFEjhbnKG2yqiJj0cZYFmW0cCJCRWAlxcXR6+fuKtxDOONw4e7DJQRVheKSgkmN3mMhz2QQlyk+igJN06CSW1UzaG7Aoo2JJA6AFdTDKl8ATs84qshtKQcuEjBDfZN4yey08JJprlP2LNvm/+Vy+eJYdFjePoDmsWGKjp8Hu7Th0GEGsWSS+kbAQh6J1C7PYi6X45BTS67u9sHZ50MdwVjJDDg7v4gQ9VCiEjUqjXVMoY0xCHjokt3b5PRkD6nk5tHrcFAG2Xzf4SLflGA4gpiYhELQaFxENCbyk8NgcjoDkzboBJDnb3ASDR4/7+P5xo5iD1+8WcXzVyt4/XYNL1dW8Z7O7NFyD782+WNAclXfNwEnOWwcnCCgG/ceLUGkwG5F4gjRIhba3xRqJvbgUUUOtE2nKESiTRlE5dA4h9VQP8/Q95ABk4pBxyrOF7E3s1Pwb35SoQPgX/cdLgXjbPBhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"argoconsole\"\n        title=\"\"\n        src=\"/static/ac279fc2dfc87c81bf95c6b08a57706e/7de01/argoconsole.png\"\n        srcset=\"/static/ac279fc2dfc87c81bf95c6b08a57706e/772e8/argoconsole.png 200w,\n/static/ac279fc2dfc87c81bf95c6b08a57706e/e17e5/argoconsole.png 400w,\n/static/ac279fc2dfc87c81bf95c6b08a57706e/7de01/argoconsole.png 794w\"\n        sizes=\"(max-width: 794px) 100vw, 794px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Clicking on the application tile you can see all the policy resources are dynamically generated by Kustomize + Policy Generator plugin</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/be932b785e67a28580b73c0a052fe144/c4b7c/argoappdetails.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAADXklEQVR42n1U/U8URxjeprFtKlAQrNAWkXKn8iFfFuXDSKWIjf5QNa0BSppGif7on2joL0LSYlLbpFWuenf7cTszO7u391VO7h7fmbtbDxQ3eTM7s7PPPO/zPu8Ys9dv4fIPy/hi4hJ+uv8QXq4AiwlwIcE9H4xGGYQQMtCj52ejaMyF9FEslaAeo3/sImLTCzgaG8f3q/ew/fe/2Nj8A4mUjaTN8Hj7KTaf/IXftp7o8dHj37GxtY0tet+kb+q7WjMdVgP8cnwO8bkltMUnsLS2DpYPEdCpqdCHzThKu7soYg8VVFGpVPCPdMH/z6OwV8aragUHH2NgdhG95y/jk/5zuPHLA71YLr9CrlDUqbhcQPgBCjTfLZfBfVoTHmyXQZAkuXxBH1StVmuAJ0Zn0UP6tcQnsbS6TkAlZHN5PcowD0f4SLseTCZhc4mMl4VD0bzmiAAW93UY7f1D+LS7D0ZLJ67cWoHlhUhlhN6cpPGFzZGwGHbSGaRcToXIEWCA5zS3XAGZDcFIoh21h8LoGBhBa28MH3T0YOH2z0ixADsm05GwOP6z60GbLUo1JBe4MqsPMYklkyFsyqKx12g/NYjWnn5ieIwYLiPNA705AlIMVZgusRbIFYvEKKQDXUrRg6cZhtFe4/gYaTg1T0UZxdWVe8TQfxuQTlcApko5myMgGaXMKX2LeW8AT5APB2bm0UI+vLr8BrAZVGuoAQVZSeKlI6K5R+ZWhYsAu0Zn0K1sc2okAlR6qYIk6kJrPQkgw2sANlVTAdrEzCfGjLooAuwcmUFs7hq6hi5EKavNf+4kkaYfMmSJtCt1lV0hNIBFLNVhyg2KnRoTNqunPHwB8Yvfou30ZBMgw9NEGib1sfJWTQLqEE/CJ282a6b0bZbH6KHWi11axNG4AlwnQKmr+tLxasVopEyAjGyjLgSzCfBgGJ8PTqKb4sOur/Ddj2tINWxzoChKQ3ULeUH2/YCtJ0+jjYxttB3HlZsr7/ahVfchl7pTVBcdCvjZ2Sl0DE/j469HsXiIDxssTTJyoDTkNVneDXjmPDoGp/BR3zAWl+9qhurDC/LavqA1h26X0i7dOMTyUIaquu1nv8GRk0NYuPMr/SjwLOngeSqzL54lbdI1A4fYJR2uO2Vfr9cBXwM03eGAnN/1bgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"appdetails\"\n        title=\"\"\n        src=\"/static/be932b785e67a28580b73c0a052fe144/5a190/argoappdetails.png\"\n        srcset=\"/static/be932b785e67a28580b73c0a052fe144/772e8/argoappdetails.png 200w,\n/static/be932b785e67a28580b73c0a052fe144/e17e5/argoappdetails.png 400w,\n/static/be932b785e67a28580b73c0a052fe144/5a190/argoappdetails.png 800w,\n/static/be932b785e67a28580b73c0a052fe144/c4b7c/argoappdetails.png 903w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can also see that the application resources are successfully created.\nAdditionally we can switch to applications section in ACM hub and search for the Argo app that we created in earlier step. Screen capture below shows the general overview of the application</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c94eeec3a53213f80cd26845a90443f0/ee3fb/acnappoverview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVR42o1RyU4CQRScHzEiywAD4oYmelcJxEhi/CV/wxjjwcTtB0g0RoUZxwOejQeVA1HQYbbuWcruxhlFOdhJ5aVed1fXq5bkXAHJdA5TqSwSSRlyroidvQYObrrYbTxg/+IRJ60OjjmaLzhi4PWU8TO1w+qQH14/Y//yCZJSnEVpthyL5gsz0DUVITUx6HdhG2+wPl5BXRv/WVI6k0d5aUWITUymwPn5lQrLDdDr9WFaDoMN23ZgO4TBheOyyuB8gfciSMr0HBYWl1EszSOnlFBgXNfvEAQBHMeB53mglIJQH74/hMe47/miz/ejPodUq29js76FtUoNq+tVVKobaLfvhX1CKCzLYsLMFQ3isfhDQ5e2EBkZmbvi7qJPScsKVFVjjqgY1TRNhGEoDkf1wzDQf38H8dy/GWbzRfYRpfhTMtkCNE0HvxuN/HvxPiEkfmBEMJHMCGdccOgwD+1WF5suy42PahGWJw0x5v44QVk4+xZU0Gy2WDYBDGOAgWnF4HlG4FH85BE+AVvtSGn6W2PQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"appoverview\"\n        title=\"\"\n        src=\"/static/c94eeec3a53213f80cd26845a90443f0/5a190/acnappoverview.png\"\n        srcset=\"/static/c94eeec3a53213f80cd26845a90443f0/772e8/acnappoverview.png 200w,\n/static/c94eeec3a53213f80cd26845a90443f0/e17e5/acnappoverview.png 400w,\n/static/c94eeec3a53213f80cd26845a90443f0/5a190/acnappoverview.png 800w,\n/static/c94eeec3a53213f80cd26845a90443f0/ee3fb/acnappoverview.png 1144w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>and also the topology view that shows all the resources created and the cluster details</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/308a390e749ce3945eb13ca8bd6e85d4/ee9b6/acmapptopology.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgElEQVR42o2Sa0sCQRSG90dEpZFdNE3RLK0Q+hhBRCFI0OdKvGC/IepP9kFMXXXv13FXLSnf1umyWd4GXmb2vIdnzzkzTCgcw4Y/BP9WGJ6VNeSLJXT77zCJBWIaMAwDnU4H/X4f8ywmvrePzcA2BS57fcgXShTU4jhwggRJEsHzPAXPBUwepChwWOXCohfZXJEavdc3WC+DkeTBYDBTzGHqCLF4EpHoLnzrARSKd7Q9y2rDti1nd2Xb9qc6tnv+IyZzeYWz8zQu0hkcn5zi/uGRGrqu0zZHZULTVbB8bYJvgInuJGjLgWAES84Mb7I59Lpdapqm+U+KqkBSJRCLjPWZWDzhzC9IL2XRs4rr2+lATVfwzJahaOp44BD0/WymAQkxaUw3dNSbdadS2c0hv4BD2CTgUG3ShiC1UGUrTnUayrUnGme5KkRZQEtooNqo0LzZQOc9EkLAizzqrZrTpoJaswrVuRhB5um3JItocCzNmwkcadkkPz9w4+RrHG7sA7TT0M2e1ir0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"apptopology\"\n        title=\"\"\n        src=\"/static/308a390e749ce3945eb13ca8bd6e85d4/5a190/acmapptopology.png\"\n        srcset=\"/static/308a390e749ce3945eb13ca8bd6e85d4/772e8/acmapptopology.png 200w,\n/static/308a390e749ce3945eb13ca8bd6e85d4/e17e5/acmapptopology.png 400w,\n/static/308a390e749ce3945eb13ca8bd6e85d4/5a190/acmapptopology.png 800w,\n/static/308a390e749ce3945eb13ca8bd6e85d4/ee9b6/acmapptopology.png 1041w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Switching to the governance tab on hub cluster you can see that policies are propagated and enforced on target clusters in this case the local cluster where ACM is running and ocp-dev cluster with zero violations shown in screen capture below</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2d8a6cf5321b7899c3ed6a9cdd1cbee9/21335/governance.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUElEQVR42pWSy2sTURTGs7Tipg3WtnnM5DFpTCySvrRSqQg+0E2pLvwfxIUu3GiLLt27EoVqpU2ixmVduVEj+HcELCjJvF+Zyec5N5lBsC564eNmTs793e+ccxOFooL5XB7nl5aRSmeg0PfEtISxZBbHkxmMTaRx7BCJ+HgKJyZlJNMljM8UhRLKbAVyvgQ5p0DKk6QcNu49w/1XP3D3+Wc8ePEFm6/beLT9DY9J/Dvan+y08fTtd2y9aWNzu42HL78iUZ2rgZUvllFQTiMjFfD+QwuDMED39y/4voejrESpfAa1hWXkCrMCOJ2SsLPbhBsCmqZB1w0hy7JhmhZM2m3HhW07IhbJME0hKrmKhaUVKOXqCCij3mgCgwE6nQ4lW+LmAX37vk9QEwc/D2AYRhwPggCqqqLX6w2BSqkKiXrILien0mg03olklRyadNDWNfj9PsIwhGPbAirihg7XdQWUq2FoYv3WHaxv3MaVazdw9fpNXFy7jP39TyJJ13WSBk3tkiMTfYKyM1E67RzXKIcv41zhcGX1Ei6sruFsbRHzi+dQrsyh1fooHHa7PdGrkODszvM8UTZDWRxj8UWxw6xcQFYuCvHzOXkqhd29+rA8x4kPMIiB7IIPRr2L/ouB/FwiFUsVMeVGc9hDBkTLD/pwPAcuTZgH1R/1lHePnpYoWaWSeRCReMpTMxL26k0BsWkAf7tzXId6Zwogw9hhpNjhv8CscMglRU54RQDuHZfNk+aLAu5t5LD3X4eNeCj66GlYNj9qCzo50Q4Ru2OHfwCVjBTa7cHpLgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"governance\"\n        title=\"\"\n        src=\"/static/2d8a6cf5321b7899c3ed6a9cdd1cbee9/5a190/governance.png\"\n        srcset=\"/static/2d8a6cf5321b7899c3ed6a9cdd1cbee9/772e8/governance.png 200w,\n/static/2d8a6cf5321b7899c3ed6a9cdd1cbee9/e17e5/governance.png 400w,\n/static/2d8a6cf5321b7899c3ed6a9cdd1cbee9/5a190/governance.png 800w,\n/static/2d8a6cf5321b7899c3ed6a9cdd1cbee9/21335/governance.png 1082w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We can verify that both Gatekeeper and Crunchy Postgresql operators got installed successfully by logging into ocp-dev cluster. Screen capture below shows both operators are installed successfully on ocp-dev cluster</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b867480c4a94c76a6d08a7b9c437d859/cd138/installedoperators.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmUlEQVR42m1S70/CMBDdf6KgiIggakz8YjRGTYhR/379oEyzAf4Y27purOv67N02ROMlL9e0vdd37+psdXpob+8yWltd7O2PMJm4kFIiDEMIIZAkCcqyhLHgbKq8vtfA6fYG2Gh1mHCzvYP94REeH5/w8jKB67pM7rqvKIriV2EDXcOgCuf45BSdbr8m7KLXH8J985AWQCQVRFbYnCMSErFVy4hjzqQ8jBMEYgmlK0rn9u4B49t7XFxe4+z8Elc3Y3ieD61LpFmGRKZWianUaI3/gqhMLdE5ODxhhQTyk1omQr7IXmkEQQClFO9VHpr63FgrFO814ezuDdk7AnlJLXueB22HMg9zxJnGbDrlAVEEiy+EUbXOcgX/fYE8/3nM6Q9GPF0CkdIDvu/TKWafEYTMVmoalKZcrf+e8ZSJrPk2/cEht7wsSrx9SiySHGkqLVIulpmESAQ7lymNj1jZKdcPkULy7heh/Yes0MbzLMZ8kXJx41NZ/0GKvDCYR4rzykNSSK22t9dbnlYFSzthO9n1lv5ivWUi/AaV/JRIQGyNXgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"installedoperators\"\n        title=\"\"\n        src=\"/static/b867480c4a94c76a6d08a7b9c437d859/5a190/installedoperators.png\"\n        srcset=\"/static/b867480c4a94c76a6d08a7b9c437d859/772e8/installedoperators.png 200w,\n/static/b867480c4a94c76a6d08a7b9c437d859/e17e5/installedoperators.png 400w,\n/static/b867480c4a94c76a6d08a7b9c437d859/5a190/installedoperators.png 800w,\n/static/b867480c4a94c76a6d08a7b9c437d859/c1b63/installedoperators.png 1200w,\n/static/b867480c4a94c76a6d08a7b9c437d859/cd138/installedoperators.png 1220w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Additionally we can verify that both controller manager and audit controller pods of gatekeeper system are running. Screen capture below shows both running</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c8a11e364cd232c9502aa888fc7b94d/cec12/gatekeepersystem.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACF0lEQVR42nWS204TURSG+x4GOZRSWkptwUoIphpjPAS98B18AzWIhwuvvfNWiVUIT+AjAAIlOiVg6dQGOyVA2+l0TpVASz/37CJiApOsrL3XrHz51/q3LxiKEBtJ0NcfpKcvQHevn8HhUR6//cKTmWWezyzy9P0CUyK//LzKdGqFZx8Wmf64xIvUEm/m13g9t8ar2TRTqVV8geCQgA0KUEAAB7jU1UssnkDTNKBN8+iQ41ZTxBHt9rGMVvPopN7isCV6jkVnG/n57t5/wJ17k1xP3iJ58zbjEzeYfPiIbC6P7bjoNQO38RvHO+s1WXPcBnXTxGk0qNVNLNvBFjXTOcCXGJtgNDFOOBIjEh1hMBwV0CRqPo/ruhiGQb1ePzcM4/+7KcIXGrpC/0CYyz39pyNHY1fJ5XI0hALZKNSYloVjW9giW1Ynu7Ytz5b3/yR8kWicYGiYXn8QfyAkwfHRawKo0hAKPaBeq1HSiqjbGkWx25LWyfltTdar1aoES2A44ikMSXWeOV3dfuF6B+iN7DXp1QrKZg5lvUg6U0BVt1A2Cqx8K5L5oVLZ3zsLjDEgnL4I6C3f0KssK1ukFQ0lK5T9zPNVKQj4DptqgUp5/x9waDguRhyTI1+oUNdZW8+SLfyiVNL4ntlgIZ2huLMjn1e5XD4DFAo9Y85T+NcUT6W3+APHIr2u8m5mnrnZT+zu7sn6qXGmyR8bzFhwymSuyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gatekeepersystempods\"\n        title=\"\"\n        src=\"/static/3c8a11e364cd232c9502aa888fc7b94d/5a190/gatekeepersystem.png\"\n        srcset=\"/static/3c8a11e364cd232c9502aa888fc7b94d/772e8/gatekeepersystem.png 200w,\n/static/3c8a11e364cd232c9502aa888fc7b94d/e17e5/gatekeepersystem.png 400w,\n/static/3c8a11e364cd232c9502aa888fc7b94d/5a190/gatekeepersystem.png 800w,\n/static/3c8a11e364cd232c9502aa888fc7b94d/cec12/gatekeepersystem.png 1187w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Since the gatekeeper was installed and configured via an ACM policy if there was any issues we would have seen them in the governance dashboard as violation but just good to confirm they are indeed running.</p>\n<p>We can now test if the container deny latest tag gatekeeper policy is working as expected by creating a sample deployment that references latest tag in container image. As you can see from the screen capture below the gatekeeper system now blocks creation of deployment since I'm referencing latest tag in the container image</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2c79c405fb3b537a7cd5eef4260fdbef/8d68c/sampledeployment.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACv0lEQVR42p3T6UtUURjH8UuO0bg0aiM5zuiM2zjq6DiiZbQRQkH/gJSJ9a7IpSaX9EUvFCnxRSW9iBYtM4joRWC0+V9ULgRlYbmMpc6d68w4jn479yoFLUYd+HAP5x5+nHOf+0i2NCvu7Gwyc3IwGrehT0hBijUJKZqoraZf6AyqVGKTbWzZZiU6MZ3NSVaNlF9YgiO/SATmkWoyc6Kpm56nb7n8+BXXno5y87nwYs2N9Xnv0Bi9L8e49WKM689GuTI4TM+TEXoGR5CcrlLsDic5uQUkb7fQ338PiCDPeQkqC6yurPAvQ8orKCZLnC4jK5cko4lbvXdQIxZkhQUlSCAUZlkshCOrv1gSL34mlezYQ0lpOYXFpWRk5tA38JAJ3wpv3k8x8nGW4Q8zgpf3Mz4+zvqZ+LLI5/kQk8KUL8y0vGZKmFWWkUrL93Lw0GF27d5Htj2P+w8eMaOs8nrcy9jEHO8m14xPzTM+vcAHNdgraz59XdSCJ+eDGq8cUq/sIt9ZjC3TTrzByN3+Ae1bRCIR/mdIuaLCapWz7fmYzFbaOzppbL3AqZPHqak+wtGjVVRV/VllZSXHqqs5VlODp7EFySFOqAaqRTGnZXDG04jN4cKQlMDm6E1ERek2pNPp0Ov1xMTocbmKkAoK3aIoO7+fsPl8G+V7DpDlKMBsNmOxWP7KarOSnp5ORUWFuHJekSjIfopLyrTApuZWcp0ujKkWkhLjiYmNIzZuY4aEBAwGA2VlZaJTnG6cRW7t51YDL3V109neQZOngQvNdZz3nBZqaT1XS5vQcraWs3U/nBE8DfV46uvo6uxEcrl3YBddol452ZTGQF8fhBTC3mnwy6DIrCrrT1l0jt8n1tetrxMKrFkKqlV2aQXJEoEpopcvXr3N0LDMzOwcPp9P7Jc1AUUR+4O/FQkv4fMHmJMDfAPDzse4yon+GgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sampledeployment\"\n        title=\"\"\n        src=\"/static/2c79c405fb3b537a7cd5eef4260fdbef/5a190/sampledeployment.png\"\n        srcset=\"/static/2c79c405fb3b537a7cd5eef4260fdbef/772e8/sampledeployment.png 200w,\n/static/2c79c405fb3b537a7cd5eef4260fdbef/e17e5/sampledeployment.png 400w,\n/static/2c79c405fb3b537a7cd5eef4260fdbef/5a190/sampledeployment.png 800w,\n/static/2c79c405fb3b537a7cd5eef4260fdbef/c1b63/sampledeployment.png 1200w,\n/static/2c79c405fb3b537a7cd5eef4260fdbef/8d68c/sampledeployment.png 1234w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Since we are using ArgoCD and gitops we can go back and make changes to manifests in git repo to add new policy or make changes to existing ones and openshift gitops will synchronize those changes to hub cluster which will then propagate to target clusters based on the placement rule.</p>\n<p>Hope you found this useful. Please check out this <a href=\"https://github.com/open-cluster-management-io/policy-collection\">github repo</a> for a collection of useful policies. The two policies install gatekeeper and the container deny latest tag used in this post are from this repository. Just made small changes to work with the policy generator plugin. As usual feel free to reach out to me if you want to learn more about Red Hat Advanced Cluster Management for Kubernetes or if you have any questions about this post.</p>\n<p>Thanks,\nRam</p>","id":"a3789754-26cc-5f0b-af3e-ab4dee6b3709","frontmatter":{"title":"Configuration management with Red Hat Advanced Cluster Management for Kubernetes","date":"December, 2023","tags":["OpenShift","Platform","Kubernetes"]},"fields":{"slug":"/config-management-with-acm/"}}},{"node":{"excerpt":"","html":"","id":"c3dc4a22-fb52-5f6b-b719-a6c23a8269c3","frontmatter":{"title":"Leveraging DevFiles and DevFile Registry to improve developer productivity for OpenShift developers","date":"August, 2022","tags":["OpenShift","Platform","Kubernetes","Digital","DevFile","Productivity"]},"fields":{"slug":"/devfile/"}}},{"node":{"excerpt":"A good solid digital applications platform is the foundation of any successful Digital Transformation and Application Modernization initiatives. Large enterprises often invest in this area as they…","html":"<p>A good solid digital applications platform is the foundation of any successful Digital Transformation and Application Modernization initiatives. Large enterprises often invest in this area as they embark on these initiatives. In this post, I wanted to talk about my top eight reasons why I would build my digital applications platform on OpenShift. Just to be clear these aren't listed in any order of priority, they are just my 8 reasons. In later articles I'm going to deep dive into each with demos that showcase the capabilities I'm talking about here.</p>\n<p><strong>1) Enterprise ready kubernetes</strong></p>\n<p>A good foundation is a key to the success of any enterprise digital application platform. OpenShift runs on a lightweight container optimized version of Red Hat Enterprise Linus (RHEL) called Red Hat Enterprise Linux CoreOS (RHCOS). RHCOS ships with a container runtime called CRI-O which facilitates running, stopping, and restarting containers. It fully replaces the docker container engine which was used in OpenShift 3.x versions. RHCOS also ships with a set of container tools for managing containers. Controlled immutability of RHCOS allows OpenShift to store the latest state of RHCOS systems so it's always able to create additional machines and perform updates based on the latest RHCOS configurations. An enterprise ready kubernetes is layered on top of RHCOS to provide a solid foundation upon which customers can build their digital application platform.</p>\n<p><strong>2) Secure and Compliant</strong></p>\n<p>Who doesn't want a compliant and secure platform? Being compliant with industry and enterprise standards is critical to the success of any enterprise digital applications platform. There are a lot of features in OpenShift related to security and compliance and we aren't going to go into details for each, here are a few things that I think are quite useful IMO.</p>\n<p><strong>AuthN &#x26; Authorization:</strong></p>\n<p>An Enterprise application platform has users with varying roles and responsibilities. Here are a few examples of user personas for a kubernetes based enterprise application platform.</p>\n<blockquote>\n<p><strong>Cluster Administrator:</strong> Responsible for Managing and Operating the cluster</p>\n</blockquote>\n<blockquote>\n<p><strong>Developers:</strong> Develop and Test applications</p>\n</blockquote>\n<blockquote>\n<p><strong>Operators:</strong> Manage and Monitor applications</p>\n</blockquote>\n<p>In addition to the above roles, it's a good practice to do all deployments to staging and production environments with a service account.</p>\n<p>If your team is responsible for providing platform services for the entire enterprise Authentication and Authorization (RBAC) is one of the key things that you will need to take care of as you roll out the platform within the enterprise. To help with this OpenShift comes with a built-in OAuth server, you can integrate with external identity providers that support oidc auth flows that your organization might be using. Users and their roles and responsibilities can still be defined in the external identity provider which can be mapped to roles within Openshift to allow operations that can be performed on the platform based on roles.</p>\n<p><strong>Compliance Checking:</strong></p>\n<p>Meeting compliance requirements are a necessary part of running a digital applications platform for the entire enterprise. Here are some of the major compliance frameworks relevant to containerized applications:</p>\n<blockquote>\n<p><strong>CIS Benchmarks for Kubernetes and Docker:</strong> Developed by Center for Internet Security.</p>\n</blockquote>\n<blockquote>\n<p><strong>NIST SP 800-190:</strong> One of the many cybersecurity compliance frameworks published by the National Institute of Standards and Technology</p>\n</blockquote>\n<blockquote>\n<p><strong>PCI:</strong> Payment Card Industry (PCI) framework covers organizations that store, process or transmit customer's payment information and is developed in partnership with five major credit card companies</p>\n</blockquote>\n<blockquote>\n<p><strong>HIPAA:</strong> Technological safeguards to the HIPAA act address how organizations collect, process, or transmit individually identifiable electronic protected health information of a patient.</p>\n</blockquote>\n<p>Organizations require to prove to a third party that applications are continually secure. Meeting compliance requirements can be more challenging than simply securing the application. It involves tracking and keeping records that prove continual compliance. While compliance can be challenging failing to meet compliance standards can be even more expensive.</p>\n<p>OpenShift comes with a compliance operator that can run compliance scans and recommends remediation actions. From a tooling perspective operators can use oc-compliance plugin with OpenShift cli (oc) to interact with the compliance operator. Compliance operator leverages OpenScap which is a NIST certified tool to scan and enforce security policies. Out of the box we give you a set of compliance profiles that represent different compliance benchmarks. If you want to learn more, check out this <a href=\"https://docs.openshift.com/container-platform/4.10/security/compliance_operator/compliance-operator-understanding.html\">link</a></p>\n<p><strong>File Integrity Checking:</strong></p>\n<p>OpenShift provides a File Integrity Operator that can continually run file integrity checks on the nodes in a cluster and provide a log of files that have been modified. This can be beneficial for tracking and monitoring any unauthorized file modifications by bad actors.</p>\n<p><strong>Container Security:</strong></p>\n<p>A secure and highly available container registry is one of the components that should be a part of your enterprise application platform efforts. Container images of all applications running on the platform should come from this registry. Good practice to have guard rails set up on the platform that would only allow container images from an approved container registry and restrict images from public repositories. From a security and governance perspective, this is very important.</p>\n<p>OpenShift provides quay which is a highly available container registry. Quay can be installed on OpenShift using the Quay operator. OpenShift cluster administrator can install Quay operator directly from the operator hub. Quay also provides container image vulnerability scanning using Clair. You can configure clair to periodically scan container images stored in quay registry. Results from the image vulnerability scans can be used to identify vulnerable images and necessary remediation actions can be taken with the respective teams. Quay can also mirror any external image repositories that your organization might be using. As your organization moves more towards containerization some of the images might come from external sources and by mirroring those repositories in quay you can govern the usage of third-party images in your organization.</p>\n<p>Red Hat also provides and maintains a set of base container images for the operating system and language runtimes that application teams can use as an optimal starting point to build their application container images. For more information please check out this <a href=\"https://developers.redhat.com/products/rhel/ubi\">article</a></p>\n<p><strong>3) Cluster Monitoring</strong></p>\n<p>Cluster monitoring is critical to running a production grade enterprise application platform. OpenShift comes out of the box with a monitoring stack based on Prometheus and Grafana that has all the best practices baked into it. This is one of the infrastructure workloads that can be run on infrastructure nodes in an OpenShift cluster this way customers can save the OpenShift worker cores they purchase to run their workloads.</p>\n<p><strong>4) Managed Cloud Services</strong></p>\n<p>If you are running workloads in the cloud quite honestly speaking I just don't see why a customer would prefer to have a digital applications platform that they self-manage.\nOpenShift dedicated gives you the same OpenShift experience in the cloud provider of your choice without all the headaches of managing it. Quite honestly speaking from a developer perspective as long as I'm building on an enterprise platform whether it's self managed or managed service is not going to be something I'd care much about as long as the experience of build/test/deploy and operate remains the same. OpenShift is also available as a native service in Azure (ARO) and AWS (ROSA). If you want to learn more about different managed cloud services offering for OpenShift, please <a href=\"https://www.redhat.com/en/technologies/cloud-computing/openshift\">visit</a></p>\n<p><strong>5) Choice of Running the platform where you want</strong></p>\n<p>This is super important. Most companies are now deploying workloads on multiple public clouds, on-premises sites, and even on the edge and if I'm responsible for providing platform services for the entire company choice of running where I want to run my platform will be super critical otherwise as a platform provider I have to invest a lot in maintaining skillset within the team for public clouds, on-premises, etc. You also have other concerns like developer experience. Most developers are now deploying workloads to multiple on-premises sites as well as in multiple clouds and you want them to have a consistent experience developing, testing, and deploying applications on the platform. Openshift provides you this choice, whether you are an operator or a developer regardless of where you are running your platform you have the same consistent experience. You don't need to learn new tools, methods, etc.</p>\n<p><strong>6) Cost Management</strong></p>\n<p>Understanding and managing costs for your enterprise application platform is critical to the success of any enterprise platform.</p>\n<p>OpenShift provides a cost management service which allows customers to better understand cost associated with OpenShift across your hybdrid infrastructure from high level down to specific projects, departments and regions. It helps you visualize, understand and, analyze resource usage. You can map charges to projects, departments and regions through tagging. Identify patterns in spending. Improve communications with your customers by sharing real usage data. Cost models can be created and can be used to generate showback data.</p>\n<p>Cost Management is available as a SaaS service for OpenShift customers and is included with your OpenShift subscription.</p>\n<p><strong>7) Make your developers contribute code on Day 1</strong></p>\n<p>In today's modern cloud-native application development paradigm resource requirements for development environments are considerably higher than ever before and it's not always financially feasible to give all the developers laptops with enough CPU, RAM, SSD storage so they can be productive. In addition to this enterprise developers spend a considerable amount of time setting up their development environments with IDE and all the required tools they need so that they can develop and test applications that are deployed to kubernetes based environment. Openshift provides CodeReady workspaces that can address some of the challenges we discussed earlier. CodeReady workspaces are essentially development environments in the cloud. Developers use a browser to access their development environment and login with their credentials just as they would on a real laptop and start working on tasks assigned to them on day 1 without having to spend a considerable amount of time getting their development environments ready. We hope that enterprise developers can start committing code on day 1</p>\n<p><strong>8) Leveraging the benefits of the digital platform on day 1</strong></p>\n<p>A digital application platform must be viewed as a tool to achieve digital transformation, app modernization goals but the reality is it's going to be a journey that takes time, especially when you look at it broadly as a whole enterprise. So the question comes how do I leverage the platform investments now. OpenShift provides a capability called OpenShift virtualization which allows you to simply migrate your legacy workload running on a VM to OpenShift and simultaneously work on transformation initiatives. This allows customers to leverage platform investments on day 1.</p>\n<p>As always reach out to me if you have any questions or comments about this post.</p>\n<p>Thanks,\nRam</p>","id":"3e75f00b-d8b8-5963-a924-620b29700985","frontmatter":{"title":"Eight reasons why I would build my digital applications platform on OpenShift","date":"July, 2022","tags":["OpenShift","Platform","Kubernetes","Digital"]},"fields":{"slug":"/build-your-platform-with-ocp/"}}},{"node":{"excerpt":"A good solid digital applications platform is the foundation of any successful Digital Transformation and Application Modernization initiatives. Large enterprises often invest in this area as they…","html":"<p>A good solid digital applications platform is the foundation of any successful Digital Transformation and Application Modernization initiatives. Large enterprises often invest in this area as they embark on these initiatives. In this post, I want to cover why a product mindset is required and critical to the success of enterprise application platform initiatives.</p>\n<h2>Why platform as a product</h2>\n<p>Product approach takes the experience of the customers who are consumers of the platform into consideration. Platform services must be provided as a shared service within the enterprise but unfortunately in my experience, they tend to be very infrastructure and operations focused. The use of the platform gets pushed down to development teams without giving any consideration to their needs. This approach can lead to unhappy customers and can often lead to lower adoption and eventually detrimental to overall success.</p>\n<h2>How to be successful and avoid common pitfalls</h2>\n<p>Develop platform strategy, roadmap, and, desired functionality jointly in a way that makes existing customers happy while attracting new ones. Ensure platform strategy, roadmap, and, desired functionality is managed by a Product Manager. Develop a culture of measurements and data-driven decision-making.</p>\n<p>Develop and foster an internal community of platform enthusiasts who can collaborate and work together with the platform team to continuously enhance the value of the platform for the entire enterprise.</p>\n<p>Be open and transparent and share all details about the platform with everyone in the enterprise. Ensure architecture diagrams and necessary documentation about the platform are created and kept up to date. Carefully make decisions on build v/s buy. There is so much opensource innovation out there and quite honestly might look cheaper to build it yourself rather than buying a vendor solution but when you start to look from a day 2 perspective and everything that goes into supporting an enterprise platform, having the support and backing of a vendor is always better to reduce risks for the enterprise. Remember, critical workloads that run the company's core businesses will be running on this platform, so there is a lot at stake.</p>\n<p>Hire and retain experts that can help and teach customers how to leverage and implement the capabilities of the platform correctly in a way that the platform is intended to be used. For OpenShift based platform we are talking about Kubernetes and OpenShift experts that can work closely with customers on how to design/build and deploy distributed applications correctly on the platform in a way that best leverages the capabilities of OpenShift and Kubernetes. For an Ansible based automation platform, it could be Ansible experts that can work with customers to get everything automated in a way that leverages platform capabilities to the best.</p>\n<p>Finally, whether the platform is put together with open source projects or with a vendor solution, build necessary abstractions in the right places, especially if it's around capabilities leveraged by platform customers. I refer to this as an easy button to eject. This is super critical for the enterprise as it will protect your enterprise from being locked into a specific vendor or open source projects and also makes it easy to swap out parts of the platform without impacting customers. <a href=\"https://opentelemetry.io/\">Open Telemetry</a> is an excellent example as its vendor neutral and avoids vendor lockin.</p>\n<h3>Common pitfalls</h3>\n<p>Here are some of the common pitfalls that must be avoided to achieve success.</p>\n<ul>\n<li>\n<p>DIY in other words do it yourselves, build instead of buy. Building it yourself with Opensource projects without the support and backing of a vendor is risky for enterprises who are betting their business on an enterprise application platform because critical workloads that run the business are going to be deployed and running on the platform. What happens when a developer checks in a piece of code that has security issues or breaks one of your workloads? Who is responsible for fixing it, and how do you minimize the impact on your business. Even if you have a super skilled team who are active contributors to these open source projects, is that the right focus for your company? Wouldn't you have been better off spending that time and effort on the products that your customers use? The point I'm making here is it can take away a lot of time that otherwise could have been used to make sure the product meets the needs of your customers and you are continuously adding value faster. It takes a lot of investment to match what vendors who specialize in these areas do, we are talking engineering, support, training, documentation, etc.</p>\n</li>\n<li>\n<p>Lack of vision on how the platform is going to be used by customers. Don't just deploy something and expect customers will come. You have to take time to understand the pain points of your customers and have a vision of how customers will leverage the platform and gain value/benefit because when you are proactively seeking new customers to come on the platform you have to be able to articulate this to them otherwise they are not going to use the platform.</p>\n</li>\n<li>\n<p>Not focusing on finding, engaging, and, educating potential customers, in other words platform evangelism. Azure, AWS, and, Google all do this. So be sure to focus some efforts on this area, seek, engage and educate potential customers through platform evangelism efforts</p>\n</li>\n<li>\n<p>No feedback cycles. Collecting feedback from customers who are using the platform and acting on that feedback is super critical to the success of the platform. This is an opportunity to hear from them directly what they like and don't like and use this as a way to enhance the value of the platform for your customers.</p>\n</li>\n<li>\n<p>Not Moving at the pace of customers. Finally, if you are not able to move at the pace of customers, they will go with alternate solutions no matter how awesome the platform is.</p>\n</li>\n</ul>\n<h2>What does a platform ecosystem looks like</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8fa9cb475ab051fd1feacbd12951463a/d004c/platform-ecosystem.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4UlEQVR42mM4c+YM68uXL3kYoCA3N5c9Pj5eQEVFhR3IZREVZeCR4+cXlGFg4ATxtbS02EDyWVlZPP///2cE6bly5Qrb8+fPucEGHD9+XPPgwYM5MAOBijkKC3s5l5962bfq9Iu9K0893brk2MMdK08937r89PPdy089X1BfX88UExPDDaJBenbv3m155MiRFLABoaGhzECKua+vT/LBgwfTL1y4sPjq1ctLztx/+2rNhbf/V5x+8W/piUd/Vp19+W/V+Xf/99149+XBvbvzT58+veT+/fuLgQ6yAepn9PDwAPmImeHq1auqp06dCgdxnjx5YnD27EnL8+fPW2+/8ubSylOP/y89cvf/mrMv3648+fjX6jMv/q878+zps2fPjA8fPmzz6NEj0/379/Ps2LFD9uzZs4lgF86dO1d02bJlejAv29vbsxgbG/O3rz7if+zira1nLl29f/rS9VungfSJSzd3NM3Z7CcoKMgPchEsDNva2oQXL15sCmQyMSADkAIQBirmAwU+kM3279Y29tvXLzv+//9EGMhnERIS4jM1NRVOS0tjhRrIyIAGsAqCANBQHlFRUWU5OTlJKSkpYUlJSS4GHADmWrzAwsKC08zMTMbAwEBUX18flpQYcDkABABFkOSCU19W1gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ecosystem\"\n        title=\"\"\n        src=\"/static/8fa9cb475ab051fd1feacbd12951463a/5a190/platform-ecosystem.png\"\n        srcset=\"/static/8fa9cb475ab051fd1feacbd12951463a/772e8/platform-ecosystem.png 200w,\n/static/8fa9cb475ab051fd1feacbd12951463a/e17e5/platform-ecosystem.png 400w,\n/static/8fa9cb475ab051fd1feacbd12951463a/5a190/platform-ecosystem.png 800w,\n/static/8fa9cb475ab051fd1feacbd12951463a/c1b63/platform-ecosystem.png 1200w,\n/static/8fa9cb475ab051fd1feacbd12951463a/29007/platform-ecosystem.png 1600w,\n/static/8fa9cb475ab051fd1feacbd12951463a/d004c/platform-ecosystem.png 1611w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Both platform team and customers support and influence each other, customers support and influence the platform offerings, and the platform team support and influences how workloads are designed and developed to run well on the platform.</p>\n<ul>\n<li>\n<p>Platform engineering role is responsible for the overall design of the platform, evaluates vendor solutions, and decides on build v/s buy and also Managed v/s Self-managed.</p>\n</li>\n<li>\n<p>Platform Operations role is responsible for all operational aspects of the platform. Applicable only in a self-managed platform scenario.</p>\n</li>\n<li>\n<p>Product Manager within Platform team manages product backlog for platform product, conducts grooming sessions with customers, and ensures there is a prioritized set of backlog with items that can be worked on by platform engineering.</p>\n</li>\n</ul>\n<p>Customers: Users or consumers of the enterprise application platform in the enterprise.</p>\n<ul>\n<li>\n<p>Community: Having an internal community of platform enthusiasts is great for the platform and its customers. The community can build and enhance platform services. For large companies, this can be a way to scale platform engineering efforts to meet the needs of all the customers within the enterprise.</p>\n</li>\n<li>\n<p>Development Team: Teams that are responsible for building and deploying workloads on the platform.</p>\n</li>\n</ul>\n<p>Some companies use the platform to deliver other platforms. An example of this is data services which provide databases for teams who are developing stateful workloads. They support a set of databases which should be described in their service offerings.</p>\n<p>Digital Application Platform</p>\n<p>Enterprise standards and compliance requirements as well as security requirements baked into the platform. This is one of the key values/benefits of being on the platform. Development teams can focus on workloads and not have to be concerned about meeting compliance and security requirements related to managing and operating a platform. Additionally platform also has all the shared tools and services that are beneficial for development teams.\nAn enterprise application platform is like a paved road that is proven, tested, and validated. Don't force the use of platforms on development teams, it should be a choice. If a development team decides to not use the platform and decides to build a platform on their own for their workloads be sure to document and educate security and compliance requirements for building and operating a platform.</p>\n<p>These are just my thoughts from my own experiences. Share with me your thoughts via email or Twitter. Hope this was helpful</p>\n<p>Thanks,\nRam</p>","id":"a38738df-1a9c-5bbd-b3c0-6c29500ab986","frontmatter":{"title":"Building Digital applications platform with a Product mindset","date":"July, 2022","tags":["OpenShift","Platform","Kubernetes","Digital"]},"fields":{"slug":"/platform-as-product/"}}}]}},"pageContext":{"tag":"Kubernetes"}},"staticQueryHashes":["1611934721","2366241629"],"slicesMap":{}}