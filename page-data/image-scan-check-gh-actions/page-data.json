{"componentChunkName":"component---src-templates-blog-post-js","path":"/image-scan-check-gh-actions/","result":{"data":{"site":{"siteMetadata":{"url":"https://rprakashg.github.io","title":"rprakashg.github.io"}},"markdownRemark":{"html":"<p>I recently posted about a custom github action that can be leveraged to install roxctl which is a command line utility that ships with Red Hat Advanced Cluster Security for Kubernetes. If you haven't read that post I'd recommend you <a href=\"https://rprakashg.github.io/roxctl-with-github-actions-workflow/\">read</a> that first before continuing here. As a follow up to that in this post I'm going to cover two new github actions that you can use from your Github actions workflow;</p>\n<ul>\n<li><a href=\"https://github.com/rprakashg-redhat/acs-image-scan\">acs-image-scan</a></li>\n<li><a href=\"https://github.com/rprakashg-redhat/acs-image-check\">acs-image-check</a></li>\n</ul>\n<h2>acs-image-scan</h2>\n<p>This action will run a container vulnerability scan on a specified image. Action will save the scan output file and upload that as a workflow artifact. Workflow accepts bunch of input parameters which you can see in the <a href=\"https://github.com/rprakashg-redhat/acs-image-scan/blob/main/action.yaml\">action.yaml</a>.</p>\n<h3>Usage</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> rprakashg<span class=\"token punctuation\">-</span>redhat/acs<span class=\"token punctuation\">-</span>image<span class=\"token punctuation\">-</span>scanl@main\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Central endpoint</span>\n    <span class=\"token key atrule\">central</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n    <span class=\"token comment\"># ROX Api token</span>\n    <span class=\"token key atrule\">api-token</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n    <span class=\"token comment\"># Container Image to run a vulnerability scan on</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n    <span class=\"token comment\"># output format valid values (table|csv|json|sarif)</span>\n    <span class=\"token key atrule\">output</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n    <span class=\"token comment\"># directory where the vulnerability scan output report should be created</span>\n    <span class=\"token key atrule\">output-path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span></code></pre></div>\n<h3>Example workflow</h3>\n<p>Example workflow below shows how to do a container vulnerability scan using this action on a container image. This example workflow can also be found in the action repository <a href=\"https://github.com/rprakashg-redhat/acs-image-scan/blob/main/.github/workflows/example.yaml\">here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name: example\non:\n  workflow_dispatch:\njobs:\n  scan:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - id: setup-roxctl\n        uses: rprakashg-redhat/setup-roxctl@main\n      - name: image scan help\n        run: ./roxctl image scan --help\n      - name: image scan\n        uses: ./\n        with:\n          image: \"ghcr.io/rprakashg-redhat/eventscheduler@sha256:ba9347ae0d0857ea9b11d1e7bb63e86c960cb9d670cf48330b4e22fd9fd1e4df\"\n          api-token: ${{ secrets.ROX_API_TOKEN }}\n          central: ${{ secrets.ROX_CENTRAL }}\n          output: table\n          output-path: ${{ runner.temp }}</code></pre></div>\n<h3>Scan output</h3>\n<p>Screen capture below shows output of a container vulnerability scan from github actions workflow</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/31001737c3f6d5762cd2585d395bc1ca/663b1/image-scan1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABw0lEQVR42n2RW2/aQBCF+SNVq1JSiNde2+v7BRuMTUgi9TWVmlalL/3xfWjyBhROZ4YQ0jTB0tGs17uf55zp/fp9h/V6Q/qD1WqDbz9+wo9rePEYyktheQlGbnha+qje3f29APnZbrf4/HUJY1qkyQKeX8FxcyhNYJ3AchIo56HSntKZVNvN5BzX3mq1xmZzBN7cfociUDK+hslamLyVGlANiwtSR+tO9vx0L2UqWCQVTNBj0G63ewDuBDhQHqJyCifIyHpBl0rYQQpX1mPaKzHyQlh+RGdSsT3UBv1z/Ry4t/x+aO8P6gDndFjWjkFazRCXDfykRD7pULdXombxCWFeoz9yXga+O7ME9NH2RQzmGlPXWT1DVHDtMJ5domwWmMyv5dvLQLL8gVrnLpQfw41yGLLJXTIoyCqJgTssphekOar2kjJv5N5/wJvbJf1JI0gpaC8ScFRMJE+uBygDy2YPrLurUx0u8XZgPdrkyp0OKUMG8sXnwIpyjKnDVy2/6Y8wsFyc0bTZBovfGcbhH4byFPi65S+coSu5sWUdZtKRbRK5dATO/7F8IkMCWp7Y40kfBsDAmPJ7tExTLqdPgTOx/BfIfv31bt2d5AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"imagescan1\"\n        title=\"\"\n        src=\"/static/31001737c3f6d5762cd2585d395bc1ca/5a190/image-scan1.png\"\n        srcset=\"/static/31001737c3f6d5762cd2585d395bc1ca/772e8/image-scan1.png 200w,\n/static/31001737c3f6d5762cd2585d395bc1ca/e17e5/image-scan1.png 400w,\n/static/31001737c3f6d5762cd2585d395bc1ca/5a190/image-scan1.png 800w,\n/static/31001737c3f6d5762cd2585d395bc1ca/c1b63/image-scan1.png 1200w,\n/static/31001737c3f6d5762cd2585d395bc1ca/663b1/image-scan1.png 1313w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>Workflow artifact</h3>\n<p>You can also see that the action automatically saved the output to a file and uploaded the file as workflow artifact</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cab676f769b631acb01018366076fc5f/6b26f/imagescan2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuUlEQVR42p2QWQ6DMAxEuf9BqVhCWLM6TI0JUPrVEukp1sQZLwXymacZqtNYrN9ZDLwPiJH+oljXdTdkAz1OcCHCuPCY09B4D8sdiSF3+NjwGNkYK2OmtIIoPeY0DMHBeQdKvAu6QwfpiiPFzF0Tw21qVWnUpYJuBnQbdS+ofHdNn/VBNIH/qM8cfhPD6ElEay2Cj0yQiimlC8p8azne8od2yh3y3rYK1atFzVRlA90OGLvpZ2SyqscbjiNvv4nQxBMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"imagescan2\"\n        title=\"\"\n        src=\"/static/cab676f769b631acb01018366076fc5f/5a190/imagescan2.png\"\n        srcset=\"/static/cab676f769b631acb01018366076fc5f/772e8/imagescan2.png 200w,\n/static/cab676f769b631acb01018366076fc5f/e17e5/imagescan2.png 400w,\n/static/cab676f769b631acb01018366076fc5f/5a190/imagescan2.png 800w,\n/static/cab676f769b631acb01018366076fc5f/c1b63/imagescan2.png 1200w,\n/static/cab676f769b631acb01018366076fc5f/29007/imagescan2.png 1600w,\n/static/cab676f769b631acb01018366076fc5f/6b26f/imagescan2.png 1658w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>acs-image-check</h2>\n<p>This action can be used to check for build time security policy violations using roxctl to ensure the container image built is compliant with all internal/external security standards defined. If you are not familar with this capability in RHACS check out <a href=\"https://docs.openshift.com/acs/4.3/operating/manage-security-policies.html\">this</a> document.</p>\n<h3>Usage</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> rprakashg<span class=\"token punctuation\">-</span>redhat/acs<span class=\"token punctuation\">-</span>image<span class=\"token punctuation\">-</span>check@main\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Central endpoint</span>\n    <span class=\"token key atrule\">central</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n    <span class=\"token comment\"># ROX Api token</span>\n    <span class=\"token key atrule\">api-token</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n    <span class=\"token comment\"># Container Image to check for build time policy violations</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n    <span class=\"token comment\"># output format valid values (table|csv|json|sarif)</span>\n    <span class=\"token key atrule\">output</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n\n    <span class=\"token comment\"># directory to create output from image check should be created</span>\n    <span class=\"token key atrule\">output-path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span></code></pre></div>\n<h3>Example workflow</h3>\n<p>Example workflow below shows how to run build time security policy checks on a container image using this action. Workflow can also be found in the action repo <a href=\"https://github.com/rprakashg-redhat/acs-image-check/blob/main/.github/workflows/example.yaml\">here</a></p>\n<h3>Image check output</h3>\n<p>Screen capture below shows output of build time security policy check on a container image. You can see the workflow failed because there was a high priority security issue in the image I used.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1908aa91983478742d7a6a7b952cf5a0/d073d/imagecheck1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVR42p1T2XKDMAykSQhgDhtzB5Km0077/1+o7opj2g49pg87FpK8klciGG8v4ttJbDVIUXZifSdxVsohTP6F4P70JlV3lWZ4FFdfxLpGrrdnFOglyUtJi2qB32yjttfTrH47I5jur9phahvJXCsG3blmksyPwGVD6npgkLRcvsthiY1i4I/yVqKil0Cf6nvJ8VwiTh0680rOIjli7JYymKWTyFjYtZh8tlNXS4L4Kc4kWIlmtBpIMieZrWdy2JEp9KwhjW/RFUirbgQm3Gmk7inZDfn2C6GbCcM4V4GPZyOnKN3OM4hDdMECJCubi5Ksmp6TfIcQg2CAhCQhAc+VmP4YzyzrQQm1+CmWB4A5ux3+RHg8J4gX4kFGUsZnv9knNH/okIQOg3LNoLm/EpKET1iTVtAXHCOdLDUktDj8hzD+npBIba0np8tLFL/AFmRYfPpKdOfwZGrOjcjh57B212bTSyedbIJzH5nDi7R1P1HItyPsTrfgE6EuM8ZPffhPM4l7V8DmQnM9KAc7Xn9H2h91fgfVBiyYvKu3DwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"imagecheck1\"\n        title=\"\"\n        src=\"/static/1908aa91983478742d7a6a7b952cf5a0/5a190/imagecheck1.png\"\n        srcset=\"/static/1908aa91983478742d7a6a7b952cf5a0/772e8/imagecheck1.png 200w,\n/static/1908aa91983478742d7a6a7b952cf5a0/e17e5/imagecheck1.png 400w,\n/static/1908aa91983478742d7a6a7b952cf5a0/5a190/imagecheck1.png 800w,\n/static/1908aa91983478742d7a6a7b952cf5a0/c1b63/imagecheck1.png 1200w,\n/static/1908aa91983478742d7a6a7b952cf5a0/d073d/imagecheck1.png 1297w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Both actions use roxctl CLI commands to run a container vulnerability scan on the image and well as checking for build time security policy violations so roxctl needs to be installed before you can use these actions. Use <a href=\"https://github.com/rprakashg-redhat/setup-roxctl\">setup-roxctl</a> action to install roxctl from your workflow before using <code class=\"language-text\">acs-image-scan</code> and <code class=\"language-text\">acs-image-check</code> actions</p>\n<p>Lastly if you do use these actions in your workflow be sure to define repository secrets for sensitive data such as api token, central endpoint etc...</p>\n<p>Hope this helps,</p>\n<p>As always reach out to me if you have any questions about this post or how Red Hat Advanced Cluster Security for Kubernetes can help your organization.</p>\n<p>Thanks,\nRam</p>","frontmatter":{"title":"Run container vulnerability scans and build time policy checks from Github actions workflow","date":"January 26, 2024","tags":["RHACS","RedHat","Developer","Tools","Github"],"author":"Ram Gopinathan"}}},"pageContext":{"slug":"/image-scan-check-gh-actions/"}},"staticQueryHashes":["1611934721","2366241629"],"slicesMap":{}}