{"componentChunkName":"component---src-templates-blog-post-js","path":"/init-container-pattern-with-podman/","result":{"data":{"site":{"siteMetadata":{"url":"https://rprakashg.github.io","title":"rprakashg.github.io"}},"markdownRemark":{"html":"<p>If you’ve worked with Kubernetes, you’re probably familiar with init containers—containers that run before the main application and are typically used for setup or initialization tasks. In this post, I’ll show how to apply the same concept to containerized applications running on Podman, even though Podman doesn’t natively support init containers in the Kubernetes sense.</p>\n<p>Example scenario</p>\n<p>For this article, I’ll use Gitea\nrunning as a container on Podman.</p>\n<p>By default, when Gitea runs in a container, it expects an app.ini file to exist under the /data/gitea/conf directory. On first access via a web browser, Gitea presents an initialization screen where you can override default settings and click Install Gitea. This process generates the app.ini file and initializes the database.</p>\n<p>Our goal is to move all of this initialization logic into an init container, so that when Gitea is accessed for the first time, it is already fully configured. In other words, users should land directly on a ready-to-use Gitea instance—without seeing the initial setup screen or manually completing the installation.</p>\n<p>Running Gitea on Podman</p>\n<p>To run the Gitea container on Podman, we’ll define a Podman Quadlet. If you’re not already familiar with Quadlets, I recommend reviewing the official documentation here\n.</p>\n<p>At a high level, Quadlets allow you to declaratively define containers, networks, and volumes using systemd unit files. One of the biggest advantages of this approach is that it hands off the entire lifecycle management of your containerized applications—startup, shutdown, restarts, and dependencies—to systemd.</p>\n<p>In the screen capture below, you can see the default experience when accessing the Gitea web interface for the first time without any initialization. This is the behavior we’ll eliminate by introducing an init container.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 439px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/60a726a576a9ca24704058e106fc779a/be79c/gitea-without-init.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 176.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAjABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAEDAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB96WHQIsKBmJoF//EABYQAAMAAAAAAAAAAAAAAAAAAAIQMP/aAAgBAQABBQKor//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BX//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BX//EABYQAAMAAAAAAAAAAAAAAAAAAAEQMP/aAAgBAQAGPwKpX//EABgQAQEBAQEAAAAAAAAAAAAAAAEQADGh/9oACAEBAAE/IUwEcRxHmKPU/9oADAMBAAIAAwAAABCzyDx8D//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QX//EABcRAAMBAAAAAAAAAAAAAAAAAAEQIDH/2gAIAQIBAT8QgYv/xAAfEAEAAgICAgMAAAAAAAAAAAABABEhMUFRcYEQYZH/2gAIAQEAAT8QxWEzqseYB0TX1EGBP2Gp48RdV7hBauefxuEt7fsrNYJ//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"without-init\"\n        title=\"\"\n        src=\"/static/60a726a576a9ca24704058e106fc779a/be79c/gitea-without-init.jpg\"\n        srcset=\"/static/60a726a576a9ca24704058e106fc779a/e07e9/gitea-without-init.jpg 200w,\n/static/60a726a576a9ca24704058e106fc779a/066f9/gitea-without-init.jpg 400w,\n/static/60a726a576a9ca24704058e106fc779a/be79c/gitea-without-init.jpg 439w\"\n        sizes=\"(max-width: 439px) 100vw, 439px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Below you can find the quadlet file for running <code class=\"language-text\">gitea</code> container on podman.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># /etc/containers/systemd/gitea.container</span>\n<span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\nDescription=Gitea container\nPartOf=gitea.target\nAfter=gitea<span class=\"token punctuation\">-</span>init.service\nWants=gitea<span class=\"token punctuation\">-</span>init.service\n\n<span class=\"token punctuation\">[</span>Container<span class=\"token punctuation\">]</span>\nImage=docker.io/gitea/gitea<span class=\"token punctuation\">:</span>latest\nContainerName=gitea\nPublishPort=3030<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\nPublishPort=222<span class=\"token punctuation\">:</span><span class=\"token number\">22</span>\nVolume=gitea<span class=\"token punctuation\">-</span>data<span class=\"token punctuation\">:</span>/data<span class=\"token punctuation\">:</span>Z\nVolume=/etc/localtime<span class=\"token punctuation\">:</span>/etc/localtime<span class=\"token punctuation\">:</span>ro\nEnvironment=USER_UID=1000\nEnvironment=USER_GID=1000\n\n\n<span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span>\nTimeoutStartSec=120\nRestart=on<span class=\"token punctuation\">-</span>failure\n\n<span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\nWantedBy=gitea.target</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\">#/etc/containers/systemd/gitea.volume</span>\n<span class=\"token punctuation\">[</span>Volume<span class=\"token punctuation\">]</span>\nVolumeName=gitea<span class=\"token punctuation\">-</span>data</code></pre></div>\n<p>The parts that are most relevant for this article are PartOf, After, and Wants. As you can see, this Quadlet is associated with a systemd target unit named gitea.target. Systemd target units are used to group related services and manage them as a single logical unit.</p>\n<p>We also use the After and Wants directives to express a dependency on the init container service, gitea-init. This ensures that the initialization container is started before the main Gitea container and is treated as a required component of the overall application lifecycle.</p>\n<p>Below is the Quadlet file for the Gitea init container.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># /etc/containers/systemd/gitea-init.container</span>\n<span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\nDescription=Initialize Gitea\nPartOf=gitea.target\n\n<span class=\"token punctuation\">[</span>Container<span class=\"token punctuation\">]</span>\nImage=registry.access.redhat.com/ubi9/ubi<span class=\"token punctuation\">-</span>minimal<span class=\"token punctuation\">:</span>9.7<span class=\"token punctuation\">-</span><span class=\"token number\">1763362218</span>\nContainerName=gitea<span class=\"token punctuation\">-</span>init\nPull=missing\nVolume=gitea<span class=\"token punctuation\">-</span>data<span class=\"token punctuation\">:</span>/data<span class=\"token punctuation\">:</span>Z\nVolume=/usr/share/gitea/config<span class=\"token punctuation\">:</span>/config<span class=\"token punctuation\">-</span>source<span class=\"token punctuation\">:</span>ro\nExec=/bin/sh /config<span class=\"token punctuation\">-</span>source/init.sh\n\n<span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span>\nType=oneshot\nRemainAfterExit=true\nRestart=on<span class=\"token punctuation\">-</span>failure\nRestartSec=5s\nStandardOutput=journal\nStandardError=journal\n\n<span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\nWantedBy=gitea.target</code></pre></div>\n<p>In the snippet above, we define the Gitea init container service as a oneshot systemd service. This service uses a minimal UBI image to run a script that encapsulates all the initialization logic for Gitea. Because it is a oneshot service, it runs to completion once and then exits.</p>\n<p>The init container shares the same Podman volume as the main Gitea container, allowing it to generate and populate the required configuration files—such as app.ini—before the primary application starts.</p>\n<p>Below is the Gitea initialization script.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">-e</span>\n\n<span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/gitea/conf\n<span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/gitea/repositories\n<span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/ssh\n\n<span class=\"token assign-left variable\">APPINI</span><span class=\"token operator\">=</span>/data/gitea/conf/app.ini\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$APPINI</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"[init] app.ini already exists, deleting...\"</span>\n  <span class=\"token function\">rm</span> <span class=\"token string\">\"<span class=\"token variable\">$APPINI</span>\"</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> <span class=\"token string\">\"<span class=\"token variable\">$APPINI</span>\"</span></span>\nAPP_NAME = Gitea: Git with a cup of tea\nRUN_MODE = prod\n\n[repository]\nROOT = /data/gitea/repositories\n\n[repository.local]\nLOCAL_COPY_PATH = /data/gitea/tmp/local-repo\n\n[repository.upload]\nTEMP_PATH = /data/gitea/uploads\n\n[server]\nAPP_DATA_PATH = /data/gitea\nDOMAIN           = 192.168.1.28\nSSH_DOMAIN       = 192.168.1.28\nHTTP_PORT        = 3000\nROOT_URL         = http://192.168.1.28:3030\nDISABLE_SSH      = false\nSSH_PORT         = 22\nSSH_LISTEN_PORT  = 22\nLFS_START_SERVER = false\n\n[database]\nPATH = /data/gitea/gitea.db\nDB_TYPE = sqlite3\nHOST    = localhost:3306\nNAME    = gitea\nUSER    = admin\nPASSWD  = r3dH4T1\nLOG_SQL = false\n\n[indexer]\nISSUE_INDEXER_PATH = /data/gitea/indexers/issues.bleve\n\n[session]\nPROVIDER_CONFIG = /data/gitea/sessions\n\n[picture]\nAVATAR_UPLOAD_PATH = /data/gitea/avatars\nREPOSITORY_AVATAR_UPLOAD_PATH = /data/gitea/repo-avatars\n\n[attachment]\nPATH = /data/gitea/attachments\n\n[log]\nMODE = console\nLEVEL = info\nROOT_PATH = /data/gitea/log\n\n[security]\nINSTALL_LOCK = true\nSECRET_KEY   =\nREVERSE_PROXY_LIMIT = 1\nREVERSE_PROXY_TRUSTED_PROXIES = *\n\n[service]\nDISABLE_REGISTRATION = false\nREQUIRE_SIGNIN_VIEW  = false\n\n[lfs]\nPATH = /data/git/lfs\n\n\nEOF</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"[init] app.ini generated\"</span>\n\n<span class=\"token function\">chown</span> <span class=\"token parameter variable\">-R</span> <span class=\"token number\">1000</span>:1000 /data\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"[init] Updated permissions\"</span></code></pre></div>\n<p>Finally, we can look at the Quadlet file that defines the systemd target unit gitea.target. This target groups both the Gitea init container and the main Gitea container, allowing them to be managed together as a single application unit.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\">#/etc/systemd/system/gitea.target</span>\n<span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\nDescription=Gitea services group\n\nWants=gitea<span class=\"token punctuation\">-</span>init.service\nWants=gitea.service\n\nAfter=network<span class=\"token punctuation\">-</span>online.target\nAfter=gitea<span class=\"token punctuation\">-</span>init.service\nAfter=gitea.service\n\n<span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\nWantedBy=multi<span class=\"token punctuation\">-</span>user.target</code></pre></div>\n<p>I'm using Ansible to automate deployment of quadlets to target host machines. To start the service we run command below.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">sudo</span> systemctl start gitea.target</code></pre></div>\n<p>Below is a screenshot showing the application experience after initialization. As you can see, the initial setup screen is no longer displayed.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a7722832ec08867f10bbe4f715dd99b0/11e85/gitea-with-init.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB35Cgf//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABgQAQADAQAAAAAAAAAAAAAAAAEAETEQ/9oACAEBAAE/IXIFO3z/2gAMAwEAAgADAAAAEHPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAIDAQAAAAAAAAAAAAAAAQAhETFRkf/aAAgBAQABPxAAnB5HssvWpg4T/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"with-init\"\n        title=\"\"\n        src=\"/static/a7722832ec08867f10bbe4f715dd99b0/4b190/gitea-with-init.jpg\"\n        srcset=\"/static/a7722832ec08867f10bbe4f715dd99b0/e07e9/gitea-with-init.jpg 200w,\n/static/a7722832ec08867f10bbe4f715dd99b0/066f9/gitea-with-init.jpg 400w,\n/static/a7722832ec08867f10bbe4f715dd99b0/4b190/gitea-with-init.jpg 800w,\n/static/a7722832ec08867f10bbe4f715dd99b0/e5166/gitea-with-init.jpg 1200w,\n/static/a7722832ec08867f10bbe4f715dd99b0/b17f8/gitea-with-init.jpg 1600w,\n/static/a7722832ec08867f10bbe4f715dd99b0/11e85/gitea-with-init.jpg 2533w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>You can run the command below to inspect the logs of the Gitea init container service, which is useful for troubleshooting the initialization logic.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">journalctl <span class=\"token parameter variable\">-u</span> gitea-init.service <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">20</span></code></pre></div>\n<p>Hope this helps, as always if you have any questions about this article please feel free to reach out.</p>\n<p>Thanks,\nRam</p>","frontmatter":{"title":"PODMAN TIPS: Implementing init container pattern for containers running on PODMAN","date":"January 22, 2026","tags":["podman","tips","containers","patterns"],"author":"Ram Gopinathan"}}},"pageContext":{"slug":"/init-container-pattern-with-podman/"}},"staticQueryHashes":["1611934721","2366241629"],"slicesMap":{}}